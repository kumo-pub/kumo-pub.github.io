---
date: 5/1/2024
---

# 二进制缓存

在不同的项目和机器上重复使用用 kmpkg 构建的二进制文件。

[kmpkg 公共注册表](https://gitee.com/kumo-pub/kmpkg) 中的大多数端口都是从来源。通过从源代码构建，kmpkg 可以通过使用来确保最大的兼容性
与您相同的环境、构建工具、编译器标志、链接器标志和其他配置在您的项目中使用来构建您的依赖项。

启用二进制缓存后，从源代码构建每个包后，kmpkg 会创建一个 **二进制文件包裹**。二进制包保存包的构建输出：二进制文件、构建系统集成文件、
使用文档、许可证和其他文件。如果稍后运行需要安装缓存的包，kmpkg 确定是否恢复缓存的二进制包或从源触发构建。

这样，二进制缓存可以减少从源代码构建的以下缺点的影响：

* **重复工作：** 通过减少需要从源代码构建包的次数。
* **构建时间长：** 恢复二进制包通常是一个非常快的操作，需要秒完成。

二进制缓存在临时容器或构建代理的 CI 场景中特别有效强制 kmpkg 每次都从头开始工作。通过使用基于云的二进制缓存（例如
Gitee) 包您可以在运行之间保留二进制包以确保最大速度，因为只发生重建当您更改依赖项或配置时。

:::info
建议为每个连续创建一个具有读写权限的二进制缓存
集成管道或工作流程。个人开发者应该具有只读访问权限
CI 生成的二进制缓存。
:::

二进制缓存可以托管在各种环境中。二进制缓存最基本的形式是本地计算机或网络文件共享上的文件夹

如果您的 CI 提供商提供本机“缓存”功能，建议同时使用 kmpkg 二进制文件缓存和本机方法以获得最佳性能结果。

## 重用二进制缓存进行开发

虽然不推荐作为二进制分发机制，但二进制缓存可用于重用构建多个系统的输出。例如，开发人员可以使用运行在 CI 上的 CI 生成的二进制包
他们的本地机器。有关重用和集成 kmpkg 生成的二进制文件的其他方法，请参阅[`kmpkg 导出`](../commands/export.mdx)。

## 默认二进制缓存

默认情况下，在第一个有效位置处使用 [`files` 提供程序](../reference/binarycaching.mdx#files) 启用二进制缓存：

- **Windows**

1. `%KMPKG_DEFAULT_BINARY_CACHE%`
1. `%LOCALAPPDATA%\kmpkg\archives`
1. `%APPDATA%\kmpkg\archives`

- **Non-Windows**

1. `$KMPKG_DEFAULT_BINARY_CACHE`
1. `$XDG_CACHE_HOME/kmpkg/archives`
1. `$HOME/.cache/kmpkg/archives`

通过“kmpkg help binarycaching”可以减少工具内帮助。

二进制缓存仅涵盖您构建的二进制文件。缓存源文件和预构建工具，请参阅[资源缓存](assetcaching.mdx)。

## 后续步骤

阅读教程以了解如何设置二进制缓存和[配置语法参考](../reference/binarycaching.mdx)：

* [设置本地二进制缓存](../consume/binary-caching-local.mdx)
