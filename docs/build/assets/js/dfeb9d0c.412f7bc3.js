"use strict";(self.webpackChunkkumo_website=self.webpackChunkkumo_website||[]).push([[30536],{1543:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>r,default:()=>d,frontMatter:()=>n,metadata:()=>o,toc:()=>c});var s=a(74848),l=a(28453);const n={},r="Laravel Full-Text Search",o={id:"kmsearch/laravel-full-text-search",title:"Laravel Full-Text Search",description:"Laravel Scout is a powerful package that provides a simple, driver-based solution for adding full-text search to Laravel Eloquent ORM models.",source:"@site/docs/kmsearch/laravel-full-text-search.md",sourceDirName:"kmsearch",slug:"/kmsearch/laravel-full-text-search",permalink:"/docs/next/kmsearch/laravel-full-text-search",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Jeff lothar",lastUpdatedAt:1748081772e3,frontMatter:{}},i={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Create a New Laravel Project Using Laravel Sail",id:"step-1-create-a-new-laravel-project-using-laravel-sail",level:2},{value:"Step 2: Install the Laravel Scout kumosearch Driver",id:"step-2-install-the-laravel-scout-kumosearch-driver",level:2},{value:"Step 3: Install and Configure Laravel Scout",id:"step-3-install-and-configure-laravel-scout",level:2},{value:"Configure Queueing (Optional)",id:"configure-queueing-optional",level:3},{value:"Step 4: Create a Model and Migrate Data",id:"step-4-create-a-model-and-migrate-data",level:2},{value:"Step 5: Index the Data Using Laravel Scout",id:"step-5-index-the-data-using-laravel-scout",level:2},{value:"Dynamic Search Parameters",id:"dynamic-search-parameters",level:3},{value:"Step 6: Backfill Existing Data",id:"step-6-backfill-existing-data",level:2},{value:"Examples",id:"examples",level:2}];function h(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",routerlink:"routerlink",strong:"strong",tabs:"tabs",template:"template",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"laravel-full-text-search",children:"Laravel Full-Text Search"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://laravel.com/docs/11.x/scout",children:"Laravel Scout"})," is a powerful package that provides a simple, driver-based solution for adding full-text search to ",(0,s.jsx)(t.a,{href:"https://laravel.com/docs/11.x/eloquent",children:"Laravel Eloquent"})," ORM models."]}),"\n",(0,s.jsx)(t.p,{children:"Laravel Scout has native support for kumosearch and this guide will focus on how to add the Laravel Scout kumosearch Driver to an existing Laravel project in order to add full-text search to your Laravel application."}),"\n",(0,s.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(t.p,{children:["This guide will use ",(0,s.jsx)(t.a,{href:"https://laravel.com/docs/11.x/sail",children:"Laravel Sail"}),", a CLI that enables you to run Laravel applications using Docker."]}),"\n",(0,s.jsxs)(t.p,{children:["Please ensure that you have Docker installed on your machine before proceeding. You can install Docker by following the instructions on the ",(0,s.jsx)(t.a,{href:"https://docs.docker.com/get-docker/",children:"official Docker website"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["To create a new Laravel project using Laravel Sail, you can follow the instructions in the ",(0,s.jsx)(t.a,{href:"https://laravel.com/docs/11.x/installation#docker-installation-using-sail",children:"official Laravel documentation"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"This guide will use a Linux environment, but you can adapt the commands to your operating system."}),"\n",(0,s.jsx)(t.h2,{id:"step-1-create-a-new-laravel-project-using-laravel-sail",children:"Step 1: Create a New Laravel Project Using Laravel Sail"}),"\n",(0,s.jsxs)(t.p,{children:["Laravel Sail by default uses a ",(0,s.jsx)(t.a,{href:"https://laravel.com/docs/11.x/installation#choosing-your-sail-services",children:"set of default services"}),", if the user doesn't specify any specific services. For this guide, we will use the PostgreSQL database service. This command is used to create a new Laravel project using Laravel Sail:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["This command will create a new Laravel project named ",(0,s.jsx)(t.code,{children:"kumosearch-scout-example"})," with the PostgreSQL service enabled. You can then navigate to the project directory:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Start the Laravel Sail Docker containers:"}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"And apply the User model migrations:"}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["You can now access the Laravel application by visiting ",(0,s.jsx)(t.code,{children:"http://localhost"})," in your browser."]}),"\n",(0,s.jsx)(t.h2,{id:"step-2-install-the-laravel-scout-kumosearch-driver",children:"Step 2: Install the Laravel Scout kumosearch Driver"}),"\n",(0,s.jsx)(t.p,{children:"To install the Laravel Scout kumosearch Driver, let's add the package to your Laravel project. You can do this by running the following command:"}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["And then selecting the ",(0,s.jsx)(t.code,{children:"kumosearch"})," driver from the list."]}),"\n",(0,s.jsxs)(t.p,{children:["NOTE: The default kumosearch in Laravel Scout version is ",(0,s.jsx)(t.code,{children:"0.25.2"}),". If you want to use the latest version, you can specify it in the ",(0,s.jsx)(t.code,{children:"docker-compose.yml"})," file. For example, to use version ",(0,s.jsx)(t.code,{children:"1.0.8"}),", you can add the following line to the ",(0,s.jsx)(t.code,{children:"docker-compose.yml"})," file:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['yml']",children:["\n",(0,s.jsx)(t.template,{"v-slot:yml":""}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"In order for the changes to take effect, let's rebuild the Docker containers:"}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"step-3-install-and-configure-laravel-scout",children:"Step 3: Install and Configure Laravel Scout"}),"\n",(0,s.jsxs)(t.p,{children:["As per ",(0,s.jsx)(t.a,{href:"https://laravel.com/docs/11.x/sail#executing-composer-commands",children:"Laravel Sail's documentation"}),", to install Laravel Scout via Composer, let's run the following command:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["You'll also need to install the ",(0,s.jsx)(t.a,{href:"https://github.com/kumosearch/kumosearch-php",children:"Official PHP client for the kumosearch API"})," by running the following command:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Next, let's publish the Laravel Scout configuration file:"}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["And configure Laravel Scout to use the kumosearch driver by modifying the ",(0,s.jsx)(t.code,{children:"config/scout.php"})," file:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['PHP']",children:["\n",(0,s.jsx)(t.template,{"v-slot:php":""}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"configure-queueing-optional",children:"Configure Queueing (Optional)"}),"\n",(0,s.jsxs)(t.p,{children:["While not required, you can configure Laravel Scout to handle indexing and searching using ",(0,s.jsx)(t.a,{href:"https://laravel.com/docs/11.x/scout#queueing",children:"queues"}),". For this guide, we'll use the ",(0,s.jsx)(t.code,{children:"database"})," queue driver, but you can use a plethora of different drivers mentioned in the ",(0,s.jsx)(t.a,{href:"https://laravel.com/docs/11.x/queues#driver-prerequisites",children:"official Laravel documentation"}),". To configure the ",(0,s.jsx)(t.code,{children:"database"})," queue driver, let's ensure that the database includes a table for the jobs by running the following commands:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Next, let's configure the ",(0,s.jsx)(t.code,{children:"SCOUT_CONNECTION"})," environment variable in the ",(0,s.jsx)(t.code,{children:".env"})," file to use the ",(0,s.jsx)(t.code,{children:"database"})," queue driver:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["And finally, let's configure the ",(0,s.jsx)(t.code,{children:"config/scout.php"})," file to use the ",(0,s.jsx)(t.code,{children:"database"})," queue driver:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['PHP']",children:["\n",(0,s.jsx)(t.template,{"v-slot:php":""}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"You can then run the queue worker to start processing the queued jobs:"}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["This will start the queue worker in the background, processing the queued jobs. For more info regarding queue workers and their benefits, you can refer to the ",(0,s.jsx)(t.a,{href:"https://laravel.com/docs/11.x/queues",children:"official Laravel documentation"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"step-4-create-a-model-and-migrate-data",children:"Step 4: Create a Model and Migrate Data"}),"\n",(0,s.jsxs)(t.p,{children:["Next, let's add some data to the PostgreSQL database. You can use any dataset you want, but this guide will use Terenci Claramunt's (",(0,s.jsx)(t.a,{href:"https://github.com/terencicp",children:"@terencicp"}),") public dataset of Steam Games released from 2013 to 2023, which you can find ",(0,s.jsx)(t.a,{href:"https://github.com/kumosearch/showcase-laravel-steam-games-search/blob/master/data/games.csv",children:"here"}),", and save it in the ",(0,s.jsx)(t.code,{children:"data"})," folder.\nTo use it, you'll have to create an Eloquent model for the Steam Games, and create a migration file, along with a model file and a controller. To do so, let's use the following command:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["This command will create a new Eloquent model named ",(0,s.jsx)(t.code,{children:"Game"}),", along with a migration file and a resource controller. Let's now modify the model file ",(0,s.jsx)(t.code,{children:"app/Models/Game.php"})," to include the necessary columns for the Steam Games dataset:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['PHP']",children:["\n",(0,s.jsx)(t.template,{"v-slot:php":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["And modify the migration file ",(0,s.jsx)(t.code,{children:"database/migrations/**timestamp**_create_games_table.php"})," to include the necessary columns for the Steam Games dataset:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['PHP']",children:["\n",(0,s.jsx)(t.template,{"v-slot:php":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["You can then run the migration to create the ",(0,s.jsx)(t.code,{children:"games"})," table in the PostgreSQL database:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["We've created a ",(0,s.jsx)(t.a,{href:"https://github.com/kumosearch/showcase-laravel-steam-games-search/blob/master/scripts/sourcedb.sh",children:"simple bash script"})," to load all the data into the PostgreSQL database. You can add the script in the ",(0,s.jsx)(t.code,{children:"scripts"})," folder and run it in the terminal to populate the ",(0,s.jsx)(t.code,{children:"games"})," table with the Steam Games dataset."]}),"\n",(0,s.jsx)(t.h2,{id:"step-5-index-the-data-using-laravel-scout",children:"Step 5: Index the Data Using Laravel Scout"}),"\n",(0,s.jsxs)(t.p,{children:["To index the data using Laravel Scout, let's add the ",(0,s.jsx)(t.code,{children:"Searchable"})," trait to the ",(0,s.jsx)(t.code,{children:"Game"})," model, and create a ",(0,s.jsx)(t.code,{children:"toSearchableArray"})," method that returns the indexable data array for the model. This is required only for Models that have a different schema in the database than in kumosearch, e.g. Models that include Dates. You can modify the ",(0,s.jsx)(t.code,{children:"app/Models/Game.php"})," file as follows:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['PHP']",children:["\n",(0,s.jsx)(t.template,{"v-slot:php":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["And then define the ",(0,s.jsx)(t.routerlink,{":to":"`/${$site.themeConfig.kumoLatestVersion}/api/kmsearch/collections.mdx#with-pre-defined-schema`",children:"Collection Schema"})," in the ",(0,s.jsx)(t.code,{children:"config/scout.php"})," file:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['PHP']",children:["\n",(0,s.jsx)(t.template,{"v-slot:php":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["After setting up the Laravel Scout Driver, all subsequent model changes will be ",(0,s.jsx)(t.strong,{children:"automatically synced"})," with kumosearch, using the ",(0,s.jsx)(t.a,{href:"https://github.com/laravel/scout/blob/10.x/src/ModelObserver.php",children:"Model Observer"})," provided by Laravel Scout."]}),"\n",(0,s.jsxs)(t.p,{children:["To verify that it's working, let's create a new record in the ",(0,s.jsx)(t.code,{children:"Games"})," table. We'll be using ",(0,s.jsx)(t.a,{href:"https://github.com/laravel/tinker",children:"Laravel Tinker"}),", a REPL enabling us to write and execute PHP code interactively. You can run the following command to open Laravel Tinker:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["And then create a new record in the ",(0,s.jsx)(t.code,{children:"Games"})," table:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['PHP']",children:["\n",(0,s.jsx)(t.template,{"v-slot:php":""}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"You can then run a search query to verify that the record has been indexed in kumosearch:"}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['PHP', 'Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n",(0,s.jsx)(t.template,{"v-slot:php":""}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"You should see the record you created in the search results."}),"\n",(0,s.jsx)(t.h3,{id:"dynamic-search-parameters",children:"Dynamic Search Parameters"}),"\n",(0,s.jsxs)(t.p,{children:["You can also set ",(0,s.jsx)(t.routerlink,{":to":"`/${$site.themeConfig.kumoLatestVersion}/api/kmsearch/documents.mdx#search-parameter`",children:"search parameters"})," for searching through your collections on the fly. For example, you can set the ",(0,s.jsx)(t.code,{children:"query_by"})," parameter to search by a game's Steam App ID only:"]}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['PHP']",children:["\n",(0,s.jsx)(t.template,{"v-slot:php":""}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"step-6-backfill-existing-data",children:"Step 6: Backfill Existing Data"}),"\n",(0,s.jsxs)(t.p,{children:["Our setup so far will cause data changes to be auto-synced into kumosearch for any changes ",(0,s.jsx)(t.em,{children:"going forward"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"To backfill your existing data in your tables into kumosearch, you can run this command:"}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"To test that everything is working correctly, you can run a search query:"}),"\n",(0,s.jsxs)(t.tabs,{":tabs":"['PHP', 'Shell']",children:["\n",(0,s.jsx)(t.template,{"v-slot:shell":""}),"\n",(0,s.jsx)(t.template,{"v-slot:php":""}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["You can then proceed as you prefer. You can create a controller to handle the search requests, or use the ",(0,s.jsx)(t.a,{href:"https://github.com/kumosearch/kumosearch-instantsearch-adapter",children:"kumosearch InstantSearch Adapter"})," to use Instantsearch.js on your frontend. If you prefer using a Javascript framework, you can use ",(0,s.jsx)(t.a,{href:"https://inertiajs.com/",children:"Inertia.js"})," to create a Vue.js, Svelte or React.js frontend."]}),"\n",(0,s.jsx)(t.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsxs)(t.p,{children:["This ",(0,s.jsx)(t.a,{href:"https://github.com/kumosearch/showcase-laravel-steam-games-search/tree/master",children:"Demo Laravel app"})," uses a React Typescript frontend with the kumosearch InstantSearch Adapter, and uses Laravel Scout to sync the data from Postgres to kumosearch."]})]})}function d(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,t,a)=>{a.d(t,{R:()=>r,x:()=>o});var s=a(96540);const l={},n=s.createContext(l);function r(e){const t=s.useContext(n);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(n.Provider,{value:t},e.children)}}}]);