"use strict";(self.webpackChunkkumo_website=self.webpackChunkkumo_website||[]).push([[69399],{1352:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>s,default:()=>o,frontMatter:()=>p,metadata:()=>c,toc:()=>t});var l=i(74848),r=i(28453);const p={date:"01/10/2024"},s="\u6559\u7a0b\uff1a \u5c06\u4fee\u8865\u7a0b\u5e8f\u5e94\u7528\u4e8e\u4f9d\u8d56\u9879\u7684\u6e90\u4ee3\u7801",c={id:"kmpkg/examples/patching",title:"\u6559\u7a0b\uff1a \u5c06\u4fee\u8865\u7a0b\u5e8f\u5e94\u7528\u4e8e\u4f9d\u8d56\u9879\u7684\u6e90\u4ee3\u7801",description:"\u4e86\u89e3\u5982\u4f55\u5f00\u53d1\u8865\u4e01\u5e76\u5c06\u5176\u5e94\u7528\u5230 kmpkg \u7aef\u53e3\u6587\u4ef6\u4e2d\u7684\u5e93\u3002",source:"@site/versioned_docs/version-1.1.1/kmpkg/examples/patching.mdx",sourceDirName:"kmpkg/examples",slug:"/kmpkg/examples/patching",permalink:"/docs/kmpkg/examples/patching",draft:!1,unlisted:!1,tags:[],version:"1.1.1",lastUpdatedBy:"Jeff lothar",lastUpdatedAt:1748081772e3,frontMatter:{date:"01/10/2024"},sidebar:"docs",previous:{title:"\u7528\u4f8b\uff1a \u4ece\u6e90\u7801\u6253\u5305\u9879\u76ee",permalink:"/docs/kmpkg/examples/packaging-zipfiles"},next:{title:"\u6559\u7a0b\uff1a\u66f4\u65b0\u73b0\u6709\u7684 kmpkg \u4f9d\u8d56\u9879",permalink:"/docs/kmpkg/produce/update-package-version"}},a={},t=[{value:"\u521d\u59cb\u9519\u8bef\u65e5\u5fd7",id:"\u521d\u59cb\u9519\u8bef\u65e5\u5fd7",level:2},{value:"\u8bc6\u522b\u6709\u95ee\u9898\u7684\u4ee3\u7801",id:"\u8bc6\u522b\u6709\u95ee\u9898\u7684\u4ee3\u7801",level:2},{value:"\u4fee\u8865\u4ee3\u7801\u4ee5\u63d0\u9ad8\u517c\u5bb9\u6027",id:"\u4fee\u8865\u4ee3\u7801\u4ee5\u63d0\u9ad8\u517c\u5bb9\u6027",level:2},{value:"\u786e\u8ba4",id:"\u786e\u8ba4",level:2}];function g(n){const e={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"\u6559\u7a0b-\u5c06\u4fee\u8865\u7a0b\u5e8f\u5e94\u7528\u4e8e\u4f9d\u8d56\u9879\u7684\u6e90\u4ee3\u7801",children:"\u6559\u7a0b\uff1a \u5c06\u4fee\u8865\u7a0b\u5e8f\u5e94\u7528\u4e8e\u4f9d\u8d56\u9879\u7684\u6e90\u4ee3\u7801"})}),"\n",(0,l.jsx)(e.p,{children:"\u4e86\u89e3\u5982\u4f55\u5f00\u53d1\u8865\u4e01\u5e76\u5c06\u5176\u5e94\u7528\u5230 kmpkg \u7aef\u53e3\u6587\u4ef6\u4e2d\u7684\u5e93\u3002"}),"\n",(0,l.jsx)(e.h2,{id:"\u521d\u59cb\u9519\u8bef\u65e5\u5fd7",children:"\u521d\u59cb\u9519\u8bef\u65e5\u5fd7"}),"\n",(0,l.jsx)(e.p,{children:"\u9996\u5148\uff0c\u5c1d\u8bd5\u6784\u5efa\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"PS D:\\src\\kmpkg> kmpkg install libpng:x64-uwp --editable\nComputing installation plan...\nThe following packages will be built and installed:\n    libpng[core]:x64-uwp\nStarting package 1/1: libpng:x64-uwp\nBuilding package libpng[core]:x64-uwp...\n-- Using cached D:/src/kmpkg/downloads/glennrp-libpng-v1.6.37.tar.gz\n-- Extracting source D:/src/kmpkg/downloads/glennrp-libpng-v1.6.37.tar.gz\n-- Using source at D:/src/kmpkg/buildtrees/libpng/src/v1.6.37-c993153cdf\n-- Configuring x64-uwp\n-- Building x64-uwp-rel\nCMake Error at scripts/cmake/execute_required_process.cmake:14 (message):\n  Command failed: C:/Program Files/CMake/bin/cmake.exe;--build;.;--config;Release\n\n  Working Directory: D:/src/kmpkg/buildtrees/libpng/x64-uwp-rel\n\n  See logs for more information:\n\n      D:\\src\\kmpkg\\buildtrees\\libpng\\build-x64-uwp-rel-out.log\n      D:\\src\\kmpkg\\buildtrees\\libpng\\build-x64-uwp-rel-err.log\n\nCall Stack (most recent call first):\n  scripts/cmake/kmpkg_build_cmake.cmake:3 (execute_required_process)\n  ports/libpng/portfile.cmake:22 (kmpkg_build_cmake)\n  scripts/ports.cmake:84 (include)\n\n\nError: build command failed\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u63a5\u4e0b\u6765\uff0c\u67e5\u770b\u4e0a\u9762\u7684\u65e5\u5fd7\uff08build-xxx-out.log \u548c build-xxx-err.log\uff09\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-console",children:'// build-x64-uwp-rel-out.log\n...\n"D:\\src\\kmpkg\\buildtrees\\libpng\\x64-uwp-rel\\ALL_BUILD.vcxproj" (default target) (1) ->\n"D:\\src\\kmpkg\\buildtrees\\libpng\\x64-uwp-rel\\png.vcxproj" (default target) (3) ->\n(ClCompile target) -> \n  D:\\src\\kmpkg\\buildtrees\\libpng\\src\\v1.6.37-c993153cdf\\pngerror.c(775): warning C4013: \'ExitProcess\' undefined; assuming extern returning int [D:\\src\\kmpkg\\buildtrees\\libpng\\x64-uwp-rel\\png.vcxproj]\n\n\n"D:\\src\\kmpkg\\buildtrees\\libpng\\x64-uwp-rel\\ALL_BUILD.vcxproj" (default target) (1) ->\n"D:\\src\\kmpkg\\buildtrees\\libpng\\x64-uwp-rel\\png.vcxproj" (default target) (3) ->\n(Link target) -> \n  pngerror.obj : error LNK2019: unresolved external symbol _ExitProcess referenced in function _png_longjmp [D:\\src\\kmpkg\\buildtrees\\libpng\\x64-uwp-rel\\png.vcxproj]\n  D:\\src\\kmpkg\\buildtrees\\libpng\\x64-uwp-rel\\Release\\libpng16.dll : fatal error LNK1120: 1 unresolved externals [D:\\src\\kmpkg\\buildtrees\\libpng\\x64-uwp-rel\\png.vcxproj]\n\n    1 Warning(s)\n    2 Error(s)\n\nTime Elapsed 00:00:04.19\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u8bc6\u522b\u6709\u95ee\u9898\u7684\u4ee3\u7801",children:"\u8bc6\u522b\u6709\u95ee\u9898\u7684\u4ee3\u7801"}),"\n",(0,l.jsx)(e.p,{children:"\u6b64\u5916\uff0c\u67e5\u770b\u5468\u56f4\u7684\u73af\u5883\u4e5f\u5f88\u6709\u7528\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"/* buildtrees\\libpng\\src\\v1.6.37-c993153cdf\\pngerror.c:769 */\n    /* If control reaches this point, png_longjmp() must not return. The only\n    * choice is to terminate the whole process (or maybe the thread); to do\n    * this the ANSI-C abort() function is used unless a different method is\n    * implemented by overriding the default configuration setting for\n    * PNG_ABORT().\n    */\n    PNG_ABORT();\n"})}),"\n",(0,l.jsxs)(e.p,{children:["\u9012\u5f52\u641c\u7d22",(0,l.jsx)(e.code,{children:"PNG_ABORT"}),"\u63ed\u793a\u4e86\u5b9a\u4e49\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-powershell",children:'PS D:\\src\\kmpkg\\buildtrees\\libpng\\src\\v1.6.37-c993153cdf> findstr /snipl "PNG_ABORT" *\nCHANGES:701:  Added PNG_SETJMP_SUPPORTED, PNG_SETJMP_NOT_SUPPORTED, and PNG_ABORT() macros\nlibpng-manual.txt:432:errors will result in a call to PNG_ABORT() which defaults to abort().\nlibpng-manual.txt:434:You can #define PNG_ABORT() to a function that does something\nlibpng-manual.txt:2753:errors will result in a call to PNG_ABORT() which defaults to abort().\nlibpng-manual.txt:2755:You can #define PNG_ABORT() to a function that does something\nlibpng-manual.txt:4226:PNG_NO_SETJMP, in which case it is handled via PNG_ABORT()),\nlibpng.3:942:errors will result in a call to PNG_ABORT() which defaults to abort().\nlibpng.3:944:You can #define PNG_ABORT() to a function that does something\nlibpng.3:3263:errors will result in a call to PNG_ABORT() which defaults to abort().\nlibpng.3:3265:You can #define PNG_ABORT() to a function that does something\nlibpng.3:4736:PNG_NO_SETJMP, in which case it is handled via PNG_ABORT()),\npng.h:994: * will use it; otherwise it will call PNG_ABORT().  This function was\npngerror.c:773:    * PNG_ABORT().\npngerror.c:775:   PNG_ABORT();\npngpriv.h:459:#ifndef PNG_ABORT\npngpriv.h:461:#    define PNG_ABORT() ExitProcess(0)\npngpriv.h:463:#    define PNG_ABORT() abort()\n'})}),"\n",(0,l.jsx)(e.p,{children:"\u8fd9\u5df2\u7ecf\u7ed9\u4e86\u6211\u4eec\u4e00\u4e9b\u5f88\u597d\u7684\u7ebf\u7d22\uff0c\u4f46\u5b8c\u6574\u7684\u5b9a\u4e49\u8bb2\u8ff0\u4e86\u5b8c\u6574\u7684\u6545\u4e8b\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"/* buildtrees\\libpng\\src\\v1.6.37-c993153cdf\\pngpriv.h:459 */\n#ifndef PNG_ABORT\n#  ifdef _WINDOWS_\n#    define PNG_ABORT() ExitProcess(0)\n#  else\n#    define PNG_ABORT() abort()\n#  endif\n#endif\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"abort()"})," \u662f\u6807\u51c6 CRT \u8c03\u7528\uff0c\u5f53\u7136\u53ef\u4ee5\u5728 UWP \u4e2d\u4f7f\u7528\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981\u8bf4\u670d libpng \u4e0e\u5e73\u53f0\u66f4\u52a0\u65e0\u5173\u3002\n\u5b9e\u73b0\u8fd9\u4e00\u76ee\u6807\u7684\u6700\u7b80\u5355\u3001\u6700\u53ef\u9760\u7684\u65b9\u6cd5\u662f\u4fee\u8865\u4ee3\u7801\uff1b\u867d\u7136\u5728\u8fd9\u79cd\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u4f20\u5165\u7f16\u8bd1\u5668\u6807\u5fd7\u6765\u8986\u76d6 ",(0,l.jsx)(e.code,{children:"PNG_ABORT"}),"\uff0c\n\u56e0\u4e3a\u8fd9\u662f\u4e00\u4e2a\u79c1\u6709\u6807\u5934\uff0c\u4f46\u4e00\u822c\u6765\u8bf4\uff0c\u5c3d\u53ef\u80fd\u907f\u514d\u6dfb\u52a0\u66f4\u591a\u6240\u9700\u7684\u7f16\u8bd1\u5668\u5f00\u5173\u4f1a\u66f4\u53ef\u9760\uff08\u7279\u522b\u662f\u5f53\u5b83\u5c1a\u672a\u516c\u5f00\u4e3aCMake \u9009\u9879\uff09\u3002"]}),"\n",(0,l.jsx)(e.h2,{id:"\u4fee\u8865\u4ee3\u7801\u4ee5\u63d0\u9ad8\u517c\u5bb9\u6027",children:"\u4fee\u8865\u4ee3\u7801\u4ee5\u63d0\u9ad8\u517c\u5bb9\u6027"}),"\n",(0,l.jsx)(e.p,{children:"\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 git \u521b\u5efa\u8865\u4e01\u6587\u4ef6\uff0c\u56e0\u4e3a\u60a8\u5df2\u7ecf\u5b89\u88c5\u4e86\u5b83\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-powershell",children:'PS D:\\src\\kmpkg\\buildtrees\\libpng\\src\\v1.6.37-c993153cdf> git init .\nInitialized empty Git repository in D:/src/kmpkg/buildtrees/libpng/src/v1.6.37-c993153cdf/.git/\n\nPS D:\\src\\kmpkg\\buildtrees\\libpng\\src\\v1.6.37-c993153cdf> git add .\nwarning: LF will be replaced by CRLF in ANNOUNCE.\nThe file will have its original line endings in your working directory.\n...\n\nPS D:\\src\\kmpkg\\buildtrees\\libpng\\src\\v1.6.37-c993153cdf> git commit -m "temp"\n[master (root-commit) 68f253f] temp\n 422 files changed, 167717 insertions(+)\n...\n'})}),"\n",(0,l.jsx)(e.p,{children:"\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u201cpngpriv.h\u201d\u4ee5\u5728\u4efb\u4f55\u5730\u65b9\u4f7f\u7528\u201cabort()\u201d\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"/* buildtrees\\libpng\\src\\v1.6.37-c993153cdf\\pngpriv.h:459 */\n#ifndef PNG_ABORT\n#  define PNG_ABORT() abort()\n#endif\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"git diff"})," \u7684\u8f93\u51fa\u5df2\u7ecf\u662f\u8865\u4e01\u683c\u5f0f\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5c06\u8865\u4e01\u4fdd\u5b58\u5230 ",(0,l.jsx)(e.code,{children:"ports/libpng"})," \u76ee\u5f55\u4e2d\u5373\u53ef\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"PS buildtrees\\libpng\\src\\v1.6.37-c993153cdf> git diff --ignore-space-at-eol | out-file -enc ascii ..\\..\\..\\..\\ports\\libpng\\use-abort-on-all-platforms.patch\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u6700\u540e\uff0c\u6211\u4eec\u9700\u8981\u5728\u63d0\u53d6\u6e90\u4ee3\u7801\u540e\u5e94\u7528\u8865\u4e01\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-cmake",children:'# ports\\libpng\\portfile.cmake\n...\nkmpkg_extract_source_archive_ex(\n  OUT_SOURCE_PATH SOURCE_PATH\n  ARCHIVE ${ARCHIVE}\n  PATCHES \n    "use-abort-on-all-platforms.patch"\n)\n\nkmpkg_cmake_configure(\n...\n'})}),"\n",(0,l.jsx)(e.h2,{id:"\u786e\u8ba4",children:"\u786e\u8ba4"}),"\n",(0,l.jsx)(e.p,{children:"\u4e3a\u4e86\u5b8c\u5168\u786e\u4fdd\u5b83\u53ef\u4ee5\u4ece\u5934\u5f00\u59cb\u5de5\u4f5c\uff0c\u6211\u4eec\u9700\u8981\u5220\u9664\u5305\u5e76\u91cd\u5efa\u5b83\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:"PS D:\\src\\kmpkg> kmpkg remove libpng:x64-uwp\nPackage libpng:x64-uwp was successfully removed\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u73b0\u5728\u6211\u4eec\u5c1d\u8bd5\u5168\u65b0\u7684\u3001\u4ece\u5934\u5f00\u59cb\u7684\u5b89\u88c5\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-powershell",children:"PS D:\\src\\kmpkg> kmpkg install libpng:x64-uwp\nComputing installation plan...\nThe following packages will be built and installed:\n    libpng[core]:x64-uwp\nStarting package 1/1: libpng:x64-uwp\nBuilding package libpng[core]:x64-uwp...\nCould not locate cached archive: C:\\Users\\me\\AppData\\Local\\kmpkg/archives\\f4\\f44b54f818f78b9a4ccd34b3666f566f94286850.zip\n-- Using cached D:/src/kmpkg/downloads/glennrp-libpng-v1.6.37.tar.gz\n-- Extracting source D:/src/kmpkg/downloads/glennrp-libpng-v1.6.37.tar.gz\n-- Applying patch use_abort.patch\n-- Applying patch cmake.patch\n-- Applying patch pkgconfig.patch\n-- Applying patch pkgconfig.2.patch\n-- Using source at D:/src/kmpkg/buildtrees/libpng/src/v1.6.37-10db9f58e4.clean\n-- Configuring x64-uwp\n-- Building x64-uwp-dbg\n-- Building x64-uwp-rel\n-- Fixing pkgconfig file: D:/src/kmpkg/packages/libpng_x64-uwp/lib/pkgconfig/libpng.pc\n-- Fixing pkgconfig file: D:/src/kmpkg/packages/libpng_x64-uwp/lib/pkgconfig/libpng16.pc\n-- Fixing pkgconfig file: D:/src/kmpkg/packages/libpng_x64-uwp/debug/lib/pkgconfig/libpng.pc\n-- Fixing pkgconfig file: D:/src/kmpkg/packages/libpng_x64-uwp/debug/lib/pkgconfig/libpng16.pc\n-- Installing: D:/src/kmpkg/packages/libpng_x64-uwp/share/libpng/copyright\n-- Performing post-build validation\n-- Performing post-build validation done\nStored binary cache: C:\\Users\\me\\AppData\\Local\\kmpkg/archives\\f4\\f44b54f818f78b9a4ccd34b3666f566f94286850.zip\nBuilding package libpng[core]:x64-uwp... done\nInstalling package libpng[core]:x64-uwp...\nInstalling package libpng[core]:x64-uwp... done\nElapsed time for package libpng:x64-uwp: 11.94 s\n\nTotal elapsed time: 11.95 s\n\nThe package libpng:x64-uwp provides CMake targets:\n\n    find_package(libpng CONFIG REQUIRED)\n    target_link_libraries(main PRIVATE png)\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u6700\u540e\uff0c\u8981\u5b8c\u5168\u63d0\u4ea4\u5e76\u53d1\u5e03\u66f4\u6539\uff0c\u6211\u4eec\u9700\u8981\u5728\u201ckmpkg.json\u201d\u4e2d\u66f4\u6539\u7aef\u53e3\u7248\u672c\uff0c\u5e76\u5c06\u8865\u4e01\u6587\u4ef6\u6dfb\u52a0\u5230\u6e90\u4ee3\u7801\u7ba1\u7406\u4e2d\uff0c\u7136\u540e\u53d1\u51fa\u62c9\u53d6\u8bf7\u6c42\uff01"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'{\n  "name": "libpng",\n  "version": "1.6.37",\n  "port-version": 1,\n  "dependencies": [\n    "zlib"\n  ]\n}\n'})})]})}function o(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(g,{...n})}):g(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>s,x:()=>c});var l=i(96540);const r={},p=l.createContext(r);function s(n){const e=l.useContext(p);return l.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),l.createElement(p.Provider,{value:e},n.children)}}}]);