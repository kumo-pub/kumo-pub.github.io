"use strict";(self.webpackChunkkumo_website=self.webpackChunkkumo_website||[]).push([[83130],{10724:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});var s=n(74848),r=n(28453);const o={},c="\u5b57\u7b26\u4e32\u8f6c\u6362",i={id:"cpp/base/testing/doct/stringification",title:"\u5b57\u7b26\u4e32\u8f6c\u6362",description:"String conversions",source:"@site/versioned_docs/version-1.1.1/cpp/base/testing/doct/stringification.mdx",sourceDirName:"cpp/base/testing/doct",slug:"/cpp/base/testing/doct/stringification",permalink:"/docs/cpp/base/testing/doct/stringification",draft:!1,unlisted:!1,tags:[],version:"1.1.1",lastUpdatedBy:"Jeff lothar",lastUpdatedAt:1748081772e3,frontMatter:{},sidebar:"docs",previous:{title:"\u6d4b\u8bd5\u914d\u7f6e",permalink:"/docs/cpp/base/testing/doct/configuration"},next:{title:"\u6d4b\u8bd5\u62a5\u544a",permalink:"/docs/cpp/base/testing/doct/reporters"}},d={},a=[{value:"String conversions",id:"string-conversions",level:2},{value:"<code>operator&lt;&lt;</code> overload for <code>std::ostream</code>",id:"operator-overload-for-stdostream",level:2},{value:"<code>doctest::toString</code> overload",id:"doctesttostring-overload",level:2},{value:"<code>doctest::StringMaker&lt;T&gt;</code> specialisation",id:"docteststringmakert-specialisation",level:2},{value:"Translating exceptions",id:"translated-exceptions",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"\u5b57\u7b26\u4e32\u8f6c\u6362",children:"\u5b57\u7b26\u4e32\u8f6c\u6362"})}),"\n",(0,s.jsx)(t.h2,{id:"string-conversions",children:"String conversions"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"doctest"})," \u9700\u8981\u80fd\u591f\u5c06\u65ad\u8a00\u548c\u65e5\u5fd7\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u7684\u7c7b\u578b\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\uff08\u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u548c\u62a5\u544a\u76ee\u7684\uff09\u3002\n\u5927\u591a\u6570\u5185\u7f6e\u7c7b\u578b\u90fd\u662f\u5f00\u7bb1\u5373\u7528\u7684\uff0c\u4f46\u60a8\u53ef\u4ee5\u901a\u8fc7\u4e09\u79cd\u65b9\u5f0f\u544a\u8bc9 ",(0,s.jsx)(t.strong,{children:"doctest"})," \u5982\u4f55\u5c06\u60a8\u81ea\u5df1\u7684\u7c7b\u578b\uff08\u6216\u5176\u4ed6\u7b2c\u4e09\u65b9\u7c7b\u578b\uff09\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u3002"]}),"\n",(0,s.jsxs)(t.p,{children:["\u5bf9\u4e8e\u5b57\u7b26\u4e32\u5316\u679a\u4e3e\uff0c\u8bf7\u67e5\u770b",(0,s.jsx)(t.a,{href:"https://github.com/doctest/doctest/issues/121",children:"\u6b64\u95ee\u9898"}),"\u3002"]}),"\n",(0,s.jsxs)(t.h2,{id:"operator-overload-for-stdostream",children:[(0,s.jsx)(t.code,{children:"operator<<"})," overload for ",(0,s.jsx)(t.code,{children:"std::ostream"})]}),"\n",(0,s.jsx)(t.p,{children:"\u8fd9\u662f\u5728 C++ \u4e2d\u63d0\u4f9b\u5b57\u7b26\u4e32\u8f6c\u6362\u7684\u6807\u51c6\u65b9\u6cd5 - \u60a8\u53ef\u80fd\u5df2\u7ecf\u51fa\u4e8e\u81ea\u5df1\u7684\u76ee\u7684\u63d0\u4f9b\u4e86\u8fd9\u79cd\u65b9\u6cd5\u3002\u5982\u679c\u60a8\u4e0d\u719f\u6089\u8fd9\u4e2a\u4e60\u60ef\u7528\u6cd5\uff0c\u5b83\u6d89\u53ca\u7f16\u5199\u4ee5\u4e0b\u5f62\u5f0f\u7684\u81ea\u7531\u51fd\u6570\uff1a"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-c++",children:"std::ostream& operator<< (std::ostream& os, const T& value) {\n    os << convertMyTypeToString(value);\n    return os;\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["\uff08\u5176\u4e2d\u201cT\u201d\u662f\u60a8\u7684\u7c7b\u578b\uff0c",(0,s.jsx)(t.code,{children:"convertMyTypeToString"}),"\u662f\u60a8\u7f16\u5199\u4f7f\u60a8\u7684\u7c7b\u578b\u53ef\u6253\u5370\u6240\u9700\u7684\u4efb\u4f55\u4ee3\u7801\u7684\u5730\u65b9 - \u5b83\u4e0d\u5fc5\u4f4d\u4e8e\u53e6\u4e00\u4e2a\u51fd\u6570\u4e2d\uff09\u3002"]}),"\n",(0,s.jsx)(t.p,{children:"\u60a8\u5e94\u8be5\u5c06\u6b64\u51fd\u6570\u653e\u5728\u4e0e\u60a8\u7684\u7c7b\u578b\u76f8\u540c\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\u3002"}),"\n",(0,s.jsx)(t.p,{children:"\u6216\u8005\uff0c\u60a8\u53ef\u80fd\u66f4\u559c\u6b22\u5c06\u5176\u7f16\u5199\u4e3a\u6210\u5458\u51fd\u6570\uff1a"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-c++",children:"std::ostream& T::operator<<(std::ostream& os) const {\n    os << convertMyTypeToString(*this);\n    return os;\n}\n"})}),"\n",(0,s.jsxs)(t.h2,{id:"doctesttostring-overload",children:[(0,s.jsx)(t.code,{children:"doctest::toString"})," overload"]}),"\n",(0,s.jsxs)(t.p,{children:["\u5982\u679c\u60a8\u4e0d\u60f3\u63d0\u4f9b ",(0,s.jsx)(t.code,{children:"operator<<``` \u91cd\u8f7d\uff0c\u6216\u8005\u60a8\u60f3\u51fa\u4e8e\u6d4b\u8bd5\u76ee\u7684\u4ee5\u4e0d\u540c\u65b9\u5f0f\u8f6c\u6362\u7c7b\u578b\uff0c\u5219\u53ef\u4ee5\u4e3a\u60a8\u7684\u7c7b\u578b\u63d0\u4f9b "}),"toString()``` \u91cd\u8f7d\u5b83\u8fd4\u56de",(0,s.jsx)(t.code,{children:"doctest::String"}),"\u3002"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-c++",children:"namespace user {\n    struct udt {};\n    \n    doctest::String toString(const udt& value) {\n        return convertMyTypeToString(value);\n    }\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u8be5\u51fd\u6570\u5fc5\u987b\u4e0e\u60a8\u7684\u7c7b\u578b\u4f4d\u4e8e\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u4e2d\u3002\u5982\u679c\u8be5\u7c7b\u578b\u4e0d\u5728\u4efb\u4f55\u547d\u540d\u7a7a\u95f4\u4e2d - \u90a3\u4e48\u91cd\u8f7d\u4e5f\u5e94\u8be5\u5728\u5168\u5c40\u547d\u540d\u7a7a\u95f4\u4e2d\u3002 ",(0,s.jsx)(t.code,{children:"convertMyTypeToString"})," \u662f\u60a8\u7f16\u5199\u4f7f\u60a8\u7684\u7c7b\u578b\u53ef\u6253\u5370\u6240\u9700\u7684\u4efb\u4f55\u4ee3\u7801\u7684\u5730\u65b9\u3002"]}),"\n",(0,s.jsxs)(t.h2,{id:"docteststringmakert-specialisation",children:[(0,s.jsx)(t.code,{children:"doctest::StringMaker<T>"})," specialisation"]}),"\n",(0,s.jsxs)(t.p,{children:["\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u91cd\u8f7d\u201ctoString\u201d\u4e0d\u80fd\u6309\u9884\u671f\u5de5\u4f5c\u3002\u4e13\u95e8\u5316 ",(0,s.jsx)(t.code,{children:"StringMaker<T>"})," \u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u66f4\u7cbe\u786e\u548c\u53ef\u9760\u7684\u63a7\u5236 - \u4f46\u4ee3\u4ef7\u662f\u7a0d\u5fae\u591a\u4e00\u4e9b\u4ee3\u7801\u548c\u590d\u6742\u6027\uff1a"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-c++",children:"namespace doctest {\n    template<> struct StringMaker<T> {\n        static String convert(const T& value) {\n            return convertMyTypeToString(value);\n        }\n    };\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"translated-exceptions",children:"Translating exceptions"}),"\n",(0,s.jsxs)(t.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u4ece\u201cstd::exception\u201d\u6d3e\u751f\u7684\u5f02\u5e38\u90fd\u5c06\u901a\u8fc7\u8c03\u7528\u201cwhat()\u201d\u65b9\u6cd5\uff08\u4e5f\u662f C \u5b57\u7b26\u4e32\uff09\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u3002\u5bf9\u4e8e\u4e0d\u662f\u4ece ",(0,s.jsx)(t.code,{children:"std::exception"})," \u6d3e\u751f\u7684\u5f02\u5e38\u7c7b\u578b - \u6216\u8005\u5982\u679c ",(0,s.jsx)(t.code,{children:"what()"})," \u6ca1\u6709\u8fd4\u56de\u5408\n\u9002\u7684\u5b57\u7b26\u4e32 - \u4f7f\u7528 ",(0,s.jsx)(t.code,{children:"REGISTER_EXCEPTION_TRANSLATOR"}),"\u3002\u8fd9\u5b9a\u4e49\u4e86\u4e00\u4e2a\u51fd\u6570\uff0c\u5b83\u63a5\u53d7\u5f02\u5e38\u7c7b\u578b\u5e76\u8fd4\u56de\u201cdoctest::String\u201d\u3002\u5b83\u53ef\u4ee5\u51fa\u73b0\u5728\u4ee3\u7801\u4e2d\u7684\u4efb\u4f55\u4f4d\u7f6e - \u5b83\u4e0d\u5fc5\u4f4d\u4e8e\u540c\u4e00\u4e2a\u7ffb\u8bd1\u5355\u5143\u4e2d\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-c++",children:"REGISTER_EXCEPTION_TRANSLATOR(MyType& ex) {\n    return doctest::String(ex.message());\n}\n"})}),"\n",(0,s.jsx)(t.p,{children:"\u8bf7\u6ce8\u610f\uff0c\u53ef\u4ee5\u5728\u6ca1\u6709\u5f15\u7528\u7684\u60c5\u51b5\u4e0b\u63a5\u53d7\u5f02\u5e38\uff0c\u4f46\u8fd9\u5728 C++ \u4e2d\u88ab\u8ba4\u4e3a\u662f\u4e0d\u597d\u7684\u505a\u6cd5\u3002"}),"\n",(0,s.jsx)(t.p,{children:"\u6ce8\u518c\u5f02\u5e38\u8f6c\u6362\u5668\u7684\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u5728\u6267\u884c\u4efb\u4f55\u6d4b\u8bd5\u4e4b\u524d\u5728\u67d0\u4e9b\u51fd\u6570\u4e2d\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-c++",children:"    // adding a lambda - the signature required is `doctest::String(exception_type)`\n    doctest::registerExceptionTranslator<int>([](int in){ return doctest::toString(in); });\n"})}),"\n",(0,s.jsx)(t.p,{children:"\u6ce8\u518c\u5f02\u5e38\u7ffb\u8bd1\u5668\u7684\u987a\u5e8f\u662f\u53ef\u4ee5\u63a7\u5236\u7684 - \u53ea\u9700\u6309\u7167\u6240\u9700\u7684\u987a\u5e8f\u8c03\u7528\u663e\u5f0f\u51fd\u6570\uff0c\u6216\u8005\u5728\u5355\u4e2a\u7ffb\u8bd1\u5355\u5143\u4e2d\u4ee5\u4ece\u4e0a\u5230\u4e0b\u7684\u65b9\u5f0f\u7528\u5b8f\u5217\u51fa\u5f02\u5e38\u7ffb\u8bd1\u5668 - \u5728 doctest \u4e2d\u81ea\u52a8\u6ce8\u518c\u7684\u6240\u6709\u5185\u5bb9\u90fd\u53ef\u4ee5\u5de5\u4f5c\u5355\u4e2a\u7ffb\u8bd1\u5355\u5143\uff08\u6e90\u6587\u4ef6\uff09\u7684\u81ea\u4e0a\u800c\u4e0b\u7684\u65b9\u5f0f\u3002"}),"\n",(0,s.jsxs)(t.p,{children:["\u60a8\u8fd8\u53ef\u4ee5",(0,s.jsx)(t.a,{href:"https://github.com/catchorg/Catch2/issues/539#issuecomment-454549904",children:"\u8986\u76d6\u7ffb\u8bd1\u673a\u5236"}),"\uff0c\u4ee5\u83b7\u53d6\u6e90\u81ea``std::exception```\u7684\u5f02\u5e38\u3002"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\u67e5\u770b ",(0,s.jsx)(t.a,{href:"https://gitee.com/kumo-hub/doctest/tree/master/examples/all_features/stringification.cpp",children:(0,s.jsx)(t.strong,{children:"example"})}),"\uff0c\u5b83\u5c55\u793a\u4e86\u5982\u4f55\u5bf9 ",(0,s.jsx)(t.code,{children:"std::vector \u8fdb\u884c\u5b57\u7b26\u4e32\u5316<T>"})," \u548c\u5176\u4ed6\u7c7b\u578b/\u5f02\u5e38\u3002"]}),"\n",(0,s.jsxs)(t.li,{children:["\u8bf7\u6ce8\u610f\uff0c\u5f53\u4e13\u95e8\u5316 ",(0,s.jsx)(t.code,{children:"StringMaker<T>"})," \u6216\u91cd\u8f7d ",(0,s.jsx)(t.code,{children:"toString()"})," \u65f6\uff0c\u4f7f\u7528\u7c7b\u578b ",(0,s.jsx)(t.code,{children:"String"})," - \u5b83\u662f\u5b57\u7b26\u4e32\u7c7b\u578b ",(0,s.jsx)(t.strong,{children:"doctest"})," \u4f7f\u7528\u3002 ",(0,s.jsx)(t.code,{children:"std::string"})," \u4e0d\u662f\u4e00\u4e2a\u9009\u9879\uff0c\u56e0\u4e3a doctest \u5fc5\u987b\u5305\u542b ",(0,s.jsx)(t.code,{children:"<string>"})," \u6807\u5934\u3002"]}),"\n",(0,s.jsxs)(t.li,{children:["\u4e3a\u4e86\u652f\u6301 ",(0,s.jsx)(t.code,{children:"operator<<(std::ostream&..."})," \u5b57\u7b26\u4e32\u5316\uff0c\u5e93\u5fc5\u987b\u63d0\u4f9b ",(0,s.jsx)(t.code,{children:"std::ostream"})," \u7684\u524d\u5411\u58f0\u660e\uff0c\u8fd9\u5c31\u662f\u5e93\u6240\u505a\u7684 - \u4f46\u662f\u5b83\u76ee\u524d\u5728\u6240\u6709\u7ecf\u8fc7\u6d4b\u8bd5\u7684\u7f16\u8bd1\u5668\u4e0a\u90fd\u6709\u6548\uff0c\u4f46\u5982\u679c\n\u7528\u6237\u5e0c\u671b 100% \u7b26\u5408\u6807\u51c6\uff0c\u90a3\u4e48 ",(0,s.jsx)(t.a,{href:"/docs/cpp/base/testing/doct/configuration#doctest_config_use_std_headers",children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"DOCTEST_CONFIG_USE_STD_HEADERS"})})})," \u6807\u8bc6\u7b26\u53ef\u7528\u4e8e\u5f3a\u5236\u5305\u542b ",(0,s.jsx)(t.code,{children:"<iosfwd>"})," \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u5305\n\u542b\u6807\u5934\u7684\u539f\u56e0\u662f\uff0c\u5728 MSVC \u4e0a\uff08\u4f8b\u5982\uff09\u5b83\u4f1a\u62d6\u62fd\u4e00\u5927\u5806\u5185\u5bb9 - \u5e76\u4e14\u5728\u8be5\u6807\u5934\u4e4b\u540e\u3002\u9884\u5904\u7406\u5668\u5b8c\u6210\u540e\uff0c\u7ffb\u8bd1\u5355\u5143\u5df2\u589e\u957f\u5230 42k \u884c C++ \u4ee3\u7801 - \u800c Clang \u548c libc++ \u5b9e\u73b0\u5f97\u975e\u5e38\u597d\uff0c\u5305\u62ec ",(0,s.jsx)(t.code,{children:"<iosfwd>"})," \u5bfc\u81f4\u4e86 400 \u884c\u4ee3\u7801\u3002"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>i});var s=n(96540);const r={},o=s.createContext(r);function c(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);