(self.webpackChunkkumo_website=self.webpackChunkkumo_website||[]).push([[65806],{61149:(e,r,s)=>{e.exports={src:{srcSet:s.p+"assets/ideal-img/kvar_noah2.a18d2b4.586.png 586w",images:[{path:s.p+"assets/ideal-img/kvar_noah2.a18d2b4.586.png",width:586,height:202}],src:s.p+"assets/ideal-img/kvar_noah2.a18d2b4.586.png",toString:function(){return s.p+"assets/ideal-img/kvar_noah2.a18d2b4.586.png"},placeholder:void 0,width:586,height:202},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAVklEQVR4nDWMQQrDMAzA8v+fem7n2G0SYkI0VuhBoINQsbgRPTAPrghmJmMM3J2IoPfO3ptSzfiIoKqICK01aq2Pv8w5KR4Xepx8rRLurLWeyz9+yUx+jFRyuAz9+pYAAAAASUVORK5CYII="}},40020:(e,r,s)=>{e.exports={src:{srcSet:s.p+"assets/ideal-img/kvar_noah3.3d86c36.623.png 623w",images:[{path:s.p+"assets/ideal-img/kvar_noah3.3d86c36.623.png",width:623,height:313}],src:s.p+"assets/ideal-img/kvar_noah3.3d86c36.623.png",toString:function(){return s.p+"assets/ideal-img/kvar_noah3.3d86c36.623.png"},placeholder:void 0,width:623,height:313},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiUlEQVR4nD2Myw6DMBAD+f8/rNqeKsqhBZLNaxeSTAVItWR5DrYH2xu1dVQNCZEQ0+mDixr7XvESGWyr9N6ptdFao/cG9JMPpaJXMSTDx4ILGUmFlBW1jVUytu1MX8dnkevRJyXkY6CkYiySWUMh68bsIosTBh+N++i5v+Wfz0l4jP7M28sxzYEf3MLAqVcWkpMAAAAASUVORK5CYII="}},92600:(e,r,s)=>{e.exports={src:{srcSet:s.p+"assets/ideal-img/kvar_perf.5b550a9.640.png 640w,"+s.p+"assets/ideal-img/kvar_perf.2731fd8.1030.png 1030w",images:[{path:s.p+"assets/ideal-img/kvar_perf.5b550a9.640.png",width:640,height:599},{path:s.p+"assets/ideal-img/kvar_perf.2731fd8.1030.png",width:1030,height:964}],src:s.p+"assets/ideal-img/kvar_perf.5b550a9.640.png",toString:function(){return s.p+"assets/ideal-img/kvar_perf.5b550a9.640.png"},placeholder:void 0,width:640,height:599},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuElEQVR4nGWQ0W7DIBAE/f8/WT9EUR0KxkAw4g5PBU6sqlnpOAHDLjCpKq01lmXBWosxP8QYmOcvjDHknOmaOngcx6h+IKXEuq6jt9aotZ5gjHFA/9XXROSaT977a+OtnvJ2usAe81eqDRH9SJicc5ejiiK1IlrZaxpV6usx445AUeEpmWfbKUdFOei+SjvBPpQcCI8Z8Q+IHtJ29s1CWHvcCdaSkRTYvcN/33H3G9Es7N6St2180y/3/GAerI9bPAAAAABJRU5ErkJggg=="}},40226:(e,r,s)=>{"use strict";s.r(r),s.d(r,{assets:()=>k,contentTitle:()=>l,default:()=>m,frontMatter:()=>h,metadata:()=>A,toc:()=>_});var a=s(74848),n=s(28453),c=s(92600),t=s.n(c),o=s(61149),i=s.n(o),p=s(40020),d=s.n(p);const h={},l="kvar\u4f7f\u7528",A={id:"cpp/krpc/kvar",title:"kvar\u4f7f\u7528",description:"\u4ec0\u4e48\u662fkvar\uff1f",source:"@site/versioned_docs/version-1.1.1/cpp/krpc/kvar.mdx",sourceDirName:"cpp/krpc",slug:"/cpp/krpc/kvar",permalink:"/docs/cpp/krpc/kvar",draft:!1,unlisted:!1,tags:[],version:"1.1.1",lastUpdatedBy:"Jeff lothar",lastUpdatedAt:1748081772e3,frontMatter:{}},k={},_=[{value:"\u4ec0\u4e48\u662fkvar\uff1f",id:"\u4ec0\u4e48\u662fkvar",level:2},{value:"\u65b0\u589ekvar",id:"\u65b0\u589ekvar",level:2},{value:"\u76d1\u63a7kvar",id:"\u76d1\u63a7kvar",level:2},{value:"\u5bfc\u51fa\u5230Prometheus",id:"\u5bfc\u51fa\u5230prometheus",level:2}];function v(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"kvar\u4f7f\u7528",children:"kvar\u4f7f\u7528"})}),"\n",(0,a.jsx)(r.h2,{id:"\u4ec0\u4e48\u662fkvar",children:"\u4ec0\u4e48\u662fkvar\uff1f"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.a,{href:"https://github.com/apache/krpc/tree/master/src/kvar/",children:"kvar"}),"\u662f\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u7684\u8ba1\u6570\u5668\u7c7b\u5e93\uff0c\u652f\u6301",(0,a.jsx)(r.a,{href:"/docs/cpp/krpc/kvar_c++",children:"\u5355\u7ef4\u5ea6kvar"}),"\u548c",(0,a.jsx)(r.a,{href:"/docs/cpp/krpc/mkvar_c++",children:"\u591a\u7ef4\u5ea6mkvar"}),"\uff0c\u65b9\u4fbf\u8bb0\u5f55\u548c\u67e5\u770b\u7528\u6237\u7a0b\u5e8f\u4e2d\u7684\u5404\u7c7b\u6570\u503c\uff0c\u5b83\u5229\u7528\u4e86thread local\u5b58\u50a8\u51cf\u5c11\u4e86cache bouncing\uff0c\u76f8\u6bd4UbMonitor(\u767e\u5ea6\u5185\u7684\u8001\u8ba1\u6570\u5668\u5e93)\u51e0\u4e4e\u4e0d\u4f1a\u7ed9\u7a0b\u5e8f\u589e\u52a0\u6027\u80fd\u5f00\u9500\uff0c\u4e5f\u5feb\u4e8e\u7ade\u4e89\u9891\u7e41\u7684\u539f\u5b50\u64cd\u4f5c\u3002krpc\u96c6\u6210\u4e86kvar\uff0c",(0,a.jsx)(r.a,{href:"/docs/cpp/krpc/vars",children:"/vars"}),"\u53ef\u67e5\u770b\u6240\u6709\u66dd\u5149\u7684kvar\uff0c",(0,a.jsx)(r.a,{href:"/docs/cpp/krpc/vars",children:"/vars/VARNAME"}),"\u53ef\u67e5\u9605\u67d0\u4e2akvar\uff0c\u5728krpc\u4e2d\u7684\u4f7f\u7528\u65b9\u6cd5\u8bf7\u67e5\u770b",(0,a.jsx)(r.a,{href:"/docs/cpp/krpc/vars",children:"vars"}),"\u3002krpc\u5927\u91cf\u4f7f\u7528\u4e86kvar\u63d0\u4f9b\u7edf\u8ba1\u6570\u503c\uff0c\u5f53\u4f60\u9700\u8981\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u8ba1\u6570\u5e76\u5c55\u73b0\u65f6\uff0c\u5e94\u8be5\u7b2c\u4e00\u65f6\u95f4\u60f3\u5230kvar\u3002\u4f46kvar\u4e0d\u80fd\u4ee3\u66ff\u6240\u6709\u7684\u8ba1\u6570\u5668\uff0c\u5b83\u7684\u672c\u8d28\u662f\u628a\u5199\u65f6\u7684\u7ade\u4e89\u8f6c\u79fb\u5230\u4e86\u8bfb\uff1a\u8bfb\u5f97\u5408\u5e76\u6240\u6709\u5199\u8fc7\u7684\u7ebf\u7a0b\u4e2d\u7684\u6570\u636e\uff0c\u800c\u4e0d\u53ef\u907f\u514d\u5730\u53d8\u6162\u4e86\u3002\u5f53\u4f60\u8bfb\u5199\u90fd\u5f88\u9891\u7e41\u6216\u5f97\u57fa\u4e8e\u6700\u65b0\u503c\u505a\u4e00\u4e9b\u903b\u8f91\u5224\u65ad\u65f6\uff0c\u4f60\u4e0d\u5e94\u8be5\u7528kvar\u3002"]}),"\n",(0,a.jsxs)(r.p,{children:["\u4e3a\u4e86\u7406\u89e3kvar\u7684\u539f\u7406\uff0c\u4f60\u5f97\u5148\u9605\u8bfb",(0,a.jsx)(r.a,{href:"/docs/cpp/krpc/atomic_instructions#Cacheline",children:"Cacheline\u8fd9\u8282"}),"\uff0c\u5176\u4e2d\u63d0\u5230\u7684\u8ba1\u6570\u5668\u4f8b\u5b50\u4fbf\u662fkvar\u3002\u5f53\u5f88\u591a\u7ebf\u7a0b\u90fd\u5728\u7d2f\u52a0\u4e00\u4e2a\u8ba1\u6570\u5668\u65f6\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u7d2f\u52a0\u79c1\u6709\u7684\u53d8\u91cf\u800c\u4e0d\u53c2\u4e0e\u5168\u5c40\u7ade\u4e89\uff0c\u5728\u8bfb\u53d6\u65f6\u7d2f\u52a0\u6240\u6709\u7ebf\u7a0b\u7684\u79c1\u6709\u53d8\u91cf\u3002\u867d\u7136\u8bfb\u6bd4\u4e4b\u524d\u6162\u591a\u4e86\uff0c\u4f46\u7531\u4e8e\u8fd9\u7c7b\u8ba1\u6570\u5668\u7684\u8bfb\u591a\u4e3a\u4f4e\u9891\u7684\u8bb0\u5f55\u548c\u5c55\u73b0\uff0c\u6162\u70b9\u65e0\u6240\u8c13\u3002\u800c\u5199\u5c31\u5feb\u591a\u4e86\uff0c\u6781\u5c0f\u7684\u5f00\u9500\u4f7f\u5f97\u7528\u6237\u53ef\u4ee5\u65e0\u987e\u8651\u5730\u4f7f\u7528kvar\u76d1\u63a7\u7cfb\u7edf\uff0c\u8fd9\u4fbf\u662f\u6211\u4eec\u8bbe\u8ba1kvar\u7684\u76ee\u7684\u3002"]}),"\n",(0,a.jsx)(r.p,{children:"\u4e0b\u56fe\u662fkvar\u548c\u539f\u5b50\u53d8\u91cf\uff0c\u9759\u6001UbMonitor\uff0c\u52a8\u6001UbMonitor\u5728\u88ab\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u4f7f\u7528\u65f6\u7684\u5f00\u9500\u3002\u53ef\u4ee5\u770b\u5230kvar\u7684\u8017\u65f6\u57fa\u672c\u548c\u7ebf\u7a0b\u6570\u65e0\u5173\uff0c\u4e00\u76f4\u4fdd\u6301\u5728\u6781\u4f4e\u7684\u6c34\u5e73\uff08~20\u7eb3\u79d2\uff09\u3002\u800c\u52a8\u6001UbMonitor\u572824\u6838\u65f6\u6bcf\u6b21\u7d2f\u52a0\u7684\u8017\u65f6\u8fbe7\u5fae\u79d2\uff0c\u8fd9\u610f\u5473\u7740\u4f7f\u7528300\u6b21kvar\u7684\u5f00\u9500\u624d\u62b5\u5f97\u4e0a\u4f7f\u7528\u4e00\u6b21\u52a8\u6001UbMonitor\u53d8\u91cf\u3002"}),"\n","\n",(0,a.jsx)("img",{src:t()}),"\n",(0,a.jsx)(r.h2,{id:"\u65b0\u589ekvar",children:"\u65b0\u589ekvar"}),"\n",(0,a.jsxs)(r.p,{children:["\u589e\u52a0C++ kvar\u7684\u65b9\u6cd5\u8bf7\u770b",(0,a.jsx)(r.a,{href:"/docs/cpp/krpc/kvar_c++#Introduction",children:"\u5feb\u901f\u4ecb\u7ecd"}),". kvar\u9ed8\u8ba4\u7edf\u8ba1\u4e86\u8fdb\u7a0b\u3001\u7cfb\u7edf\u7684\u4e00\u4e9b\u53d8\u91cf\uff0c\u4ee5process_, system_\u7b49\u5f00\u5934\uff0c\u6bd4\u5982\uff1a"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"process_context_switches_involuntary_second : 14\nprocess_context_switches_voluntary_second : 15760\nprocess_cpu_usage : 0.428\nprocess_cpu_usage_system : 0.142\nprocess_cpu_usage_user : 0.286\nprocess_disk_read_bytes_second : 0\nprocess_disk_write_bytes_second : 260902\nprocess_faults_major : 256\nprocess_faults_minor_second : 14\nprocess_memory_resident : 392744960\nsystem_core_count : 12\nsystem_loadavg_15m : 0.040\nsystem_loadavg_1m : 0.000\nsystem_loadavg_5m : 0.020\n"})}),"\n",(0,a.jsx)(r.p,{children:"\u8fd8\u6709\u50cfkrpc\u5185\u90e8\u7684\u5404\u7c7b\u8ba1\u6570\u5668\uff1a"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:'kthread_switch_second : 20422\nkthread_timer_scheduled_second : 4\nkthread_timer_triggered_second : 4\nkthread_timer_usage : 2.64987e-05\nkthread_worker_count : 13\nkthread_worker_usage : 1.33733\nkvar_collector_dump_second : 0\nkvar_collector_dump_thread_usage : 0.000307385\nkvar_collector_grab_second : 0\nkvar_collector_grab_thread_usage : 1.9699e-05\nkvar_collector_pending_samples : 0\nkvar_dump_interval : 10\nkvar_revision : "34975"\nkvar_sampler_collector_usage : 0.00106495\niobuf_block_count : 89\niobuf_block_count_hit_tls_threshold : 0\niobuf_block_memory : 729088\niobuf_newbigview_second : 10\n'})}),"\n",(0,a.jsx)(r.h2,{id:"\u76d1\u63a7kvar",children:"\u76d1\u63a7kvar"}),"\n",(0,a.jsxs)(r.p,{children:["\u6253\u5f00kvar\u7684",(0,a.jsx)(r.a,{href:"/docs/cpp/krpc/kvar_c++#export-all-variables",children:"dump\u529f\u80fd"}),'\u4ee5\u5bfc\u51fa\u6240\u6709\u7684kvar\u5230\u6587\u4ef6\uff0c\u683c\u5f0f\u5c31\u5982\u4e0a\u6587\u4e00\u6837\uff0c\u6bcf\u884c\u662f\u4e00\u5bf9"\u540d\u5b57:\u503c"\u3002\u6253\u5f00dump\u529f\u80fd\u540e\u5e94\u68c0\u67e5monitor/\u76ee\u5f55\u4e0b\u662f\u5426\u6709\u6570\u636e\uff0c\u6bd4\u5982\uff1a']}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:'$ ls monitor/\nkvar.echo_client.data  kvar.echo_server.data\n \n$ tail -5 monitor/kvar.echo_client.data\nprocess_swaps : 0\nprocess_time_real : 2580.157680\nprocess_time_system : 0.380942\nprocess_time_user : 0.741887\nprocess_username : "gejun"\n'})}),"\n",(0,a.jsx)(r.p,{children:"\u6bcf\u6b21\u5bfc\u51fa\u90fd\u4f1a\u8986\u76d6\u4e4b\u524d\u7684\u6587\u4ef6\uff0c\u8fd9\u4e0e\u666e\u901alog\u6dfb\u52a0\u5728\u540e\u9762\u662f\u4e0d\u540c\u7684\u3002"}),"\n",(0,a.jsx)(r.p,{children:"\u76d1\u63a7\u7cfb\u7edf\u5e94\u5b9a\u671f\u641c\u96c6\u6bcf\u53f0\u5355\u673a\u5bfc\u51fa\u7684\u6570\u636e\uff0c\u5e76\u628a\u5b83\u4eec\u6c47\u603b\u5230\u4e00\u8d77\u3002\u8fd9\u91cc\u4ee5\u767e\u5ea6\u5185\u7684noah\u4e3a\u4f8b\uff0ckvar\u5b9a\u4e49\u7684\u53d8\u91cf\u4f1a\u51fa\u73b0\u5728noah\u7684\u6307\u6807\u9879\u4e2d\uff0c\u7528\u6237\u53ef\u52fe\u9009\u5e76\u67e5\u770b\u5386\u53f2\u66f2\u7ebf\u3002"}),"\n","\n",(0,a.jsx)("img",{src:i()}),"\n","\n",(0,a.jsx)("img",{src:d()}),"\n",(0,a.jsx)(r.h2,{id:"\u5bfc\u51fa\u5230prometheus",children:"\u5bfc\u51fa\u5230Prometheus"}),"\n",(0,a.jsxs)(r.p,{children:["\u5c06",(0,a.jsx)(r.a,{href:"https://prometheus.io",children:"Prometheus"}),"\u7684\u6293\u53d6url\u5730\u5740\u7684\u8def\u5f84\u8bbe\u7f6e\u4e3a",(0,a.jsx)(r.code,{children:"/krpc_metrics"}),"\u5373\u53ef\uff0c\u4f8b\u5982krpc server\u8dd1\u5728\u672c\u673a\u76848080\u7aef\u53e3\uff0c\u5219\u6293\u53d6url\u914d\u7f6e\u4e3a",(0,a.jsx)(r.code,{children:"127.0.0.1:8080/krpc_metrics"}),"\u3002"]})]})}function m(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(v,{...e})}):v(e)}},28453:(e,r,s)=>{"use strict";s.d(r,{R:()=>t,x:()=>o});var a=s(96540);const n={},c=a.createContext(n);function t(e){const r=a.useContext(c);return a.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),a.createElement(c.Provider,{value:r},e.children)}}}]);