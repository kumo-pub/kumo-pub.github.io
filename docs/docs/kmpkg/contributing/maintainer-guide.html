<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-1.1.1 docs-doc-page docs-doc-id-kmpkg/contributing/maintainer-guide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">维护指南 | Kumo AI</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kumo-pub.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kumo-pub.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kumo-pub.github.io/docs/kmpkg/contributing/maintainer-guide"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.1.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.1.1"><meta data-rh="true" name="docsearch:version" content="1.1.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.1.1"><meta data-rh="true" property="og:title" content="维护指南 | Kumo AI"><meta data-rh="true" name="description" content="本文档列出了添加或更新端口配方时应应用的一组策略。"><meta data-rh="true" property="og:description" content="本文档列出了添加或更新端口配方时应应用的一组策略。"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://kumo-pub.github.io/docs/kmpkg/contributing/maintainer-guide"><link data-rh="true" rel="alternate" href="https://kumo-pub.github.io/docs/kmpkg/contributing/maintainer-guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://kumo-pub.github.io/docs/kmpkg/contributing/maintainer-guide" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kumo AI RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kumo AI Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Kumo AI JSON Feed">


<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E5CR2Q1NRE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E5CR2Q1NRE",{})</script>


<link rel="alternate" type="application/rss+xml" href="/changelog/rss.xml" title="Docusaurus changelog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/changelog/atom.xml" title="Docusaurus changelog Atom Feed">
<link rel="alternate" type="application/json" href="/changelog/feed.json" title="Docusaurus changelog JSON Feed">



<link rel="icon" href="/img/docusaurus.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/docusaurus.png">
<link rel="mask-icon" href="/img/docusaurus.png" color="rgb(62, 204, 94)">
<meta name="msapplication-TileImage" content="/img/docusaurus.png">
<meta name="msapplication-TileColor" content="#000">



<link rel="alternate" type="application/rss+xml" href="/tests/blog/rss.xml" title="Docusaurus Tests Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tests/blog/atom.xml" title="Docusaurus Tests Blog Atom Feed">
<link rel="alternate" type="application/json" href="/tests/blog/feed.json" title="Docusaurus Tests Blog JSON Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Kumo AI" href="/opensearch.xml">

<link rel="stylesheet" href="/katex/katex.min.css"><link rel="stylesheet" href="/assets/css/styles.21fbef88.css">
<script src="/assets/js/runtime~main.8132aada.js" defer="defer"></script>
<script src="/assets/js/main.56e29d99.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme-b4f")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss-b4f")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">🎉️ <b><a target="_blank" href="https://docusaurus.io/blog/releases/1.1">Kumo v1.1</a> is out!</b> 🥳️</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/kumo_logo.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE" height="48" width="128"><img src="/img/kumo_logo_white.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="48" width="128"></div><b class="navbar__title text--truncate">主页</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">文档</a><a class="navbar__item navbar__link" href="/docs/category/kmsearch">API</a><a class="navbar__item navbar__link" href="/blog">博客</a><a class="navbar__item navbar__link" href="/changelog">发布</a><a class="navbar__item navbar__link" href="/showcase">应用案例</a><a class="navbar__item navbar__link" href="/community/support">支持与资源</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/kmpkg/contributing/maintainer-guide">1.1.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/kmpkg/contributing/maintainer-guide">nightly 🚧</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/kmpkg/contributing/maintainer-guide">1.1.1</a></li><li><hr class="dropdown-separator"></li><li class="dropdown-archived-versions"><b>Archived versions</b></li><li><a href="https://docusaurus-archive-october-2023.netlify.app/docs/2.3.1" target="_blank" rel="noopener noreferrer" class="dropdown__link">1.0.1<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://v1.docusaurus.io" target="_blank" rel="noopener noreferrer" class="dropdown__link">1.x.x<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr class="dropdown-separator"></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/kmpkg/contributing/maintainer-guide" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://github.com/facebook/docusaurus/issues/3526" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help Us Translate<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/kumo_logo.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE" height="48" width="128"><img src="/img/kumo_logo_white.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="48" width="128"><b>主页</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">概述</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/基础准备">基础准备</a><button aria-label="Collapse sidebar category &#x27;基础准备&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/env_prepare_be">后端开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/env_prepare_fe">前端开发环境</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/持续集成----kmpkg">持续集成 -- kmpkg</a><button aria-label="Collapse sidebar category &#x27;持续集成 -- kmpkg&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/get_started/overview">kmpkg 概述</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/快速开始">快速开始</a><button aria-label="Expand sidebar category &#x27;快速开始&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/构建项目">构建项目</a><button aria-label="Expand sidebar category &#x27;构建项目&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/使用项目">使用项目</a><button aria-label="Expand sidebar category &#x27;使用项目&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/生成项目">生成项目</a><button aria-label="Expand sidebar category &#x27;生成项目&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/概念">概念</a><button aria-label="Collapse sidebar category &#x27;概念&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/asset-caching">资产缓存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/users/binarycaching">二进制缓存</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/构建系统">构建系统</a><button aria-label="Expand sidebar category &#x27;构建系统&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/classic-mode">经典模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/continuous-integration">持续集成</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/default-features">Concept: 默认功能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/features">Concept: 功能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/manifest-mode">清单模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/supported-hosts">支持主机</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/users/host-dependencies">主机依赖项</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/源代码注册表">源代码注册表</a><button aria-label="Collapse sidebar category &#x27;源代码注册表&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/kmpkg/contributing/maintainer-guide">维护指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/contributing/cmake-guidelines">cmake样式指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/contributing/pr-review-checklist">kmpkg PR审查</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/overlay-ports">端口覆盖</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/package-name-resolution">包名称解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/ports">端口</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/registries">注册表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/maintainers/authoring-script-ports">帮助程序端口</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/system-package-managers">与系统包管理器比较</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/triplets">三元组</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/users/versioning.concepts">版本控制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/registries">注册表</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/参考">参考</a><button aria-label="Expand sidebar category &#x27;参考&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/故障排查">故障排查</a><button aria-label="Expand sidebar category &#x27;故障排查&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/命令行">命令行</a><button aria-label="Expand sidebar category &#x27;命令行&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kmpkg/concepts/glossary">术语: kmpkg</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/c开发">c++开发</a><button aria-label="Expand sidebar category &#x27;c++开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/搜素基础开发">搜素基础开发</a><button aria-label="Expand sidebar category &#x27;搜素基础开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/搜索应用开发">搜索应用开发</a><button aria-label="Expand sidebar category &#x27;搜索应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/向量数据库教程">向量数据库教程</a><button aria-label="Expand sidebar category &#x27;向量数据库教程&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/搜索统一执行引擎">搜索统一执行引擎</a><button aria-label="Expand sidebar category &#x27;搜索统一执行引擎&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/搜索-ui">搜索 UI</a><button aria-label="Expand sidebar category &#x27;搜索 UI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/持续集成----kmpkg"><span itemprop="name">持续集成 -- kmpkg</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/概念"><span itemprop="name">概念</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/源代码注册表"><span itemprop="name">源代码注册表</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">维护指南</span><meta itemprop="position" content="4"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.1.1</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>维护指南</h1></header>
<p>本文档列出了添加或更新端口配方时应应用的一组策略。</p>
<p>它的目的是服务于以下角色：
<a href="https://www.debian.org/doc/debian-policy/" target="_blank" rel="noopener noreferrer">Debian 的政策手册</a>,
<a href="https://docs.brew.sh/Maintainer-Guidelines" target="_blank" rel="noopener noreferrer">Homebrew 的维护者指南</a>，以及
<a href="https://docs.brew.sh/Formula-Cookbook" target="_blank" rel="noopener noreferrer">Homebrew 的配方食谱</a>。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="总体注册表设计目标">总体注册表设计目标<a href="#总体注册表设计目标" class="hash-link" aria-label="Direct link to 总体注册表设计目标" title="Direct link to 总体注册表设计目标">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="当前基线中的端口必须可同时安装">当前基线中的端口必须可同时安装<a href="#当前基线中的端口必须可同时安装" class="hash-link" aria-label="Direct link to 当前基线中的端口必须可同时安装" title="Direct link to 当前基线中的端口必须可同时安装">​</a></h3>
<p>如果您希望向用户展示这种替代情况，请考虑描述如何有人可以创建一个 <a href="/docs/kmpkg/concepts/overlay-ports">overlay port</a> 来实现替代方案
在<code>portfile.cmake</code>中添加注释，而不是尝试添加从未内置的其他端口策划的注册表的持续集成。例如，参见
<a href="https://gitee.com/kumo-pub/kmpkg/blob/67cc1677c3bf5c23ea14b9d2416c7422fdeac492/ports/glad/portfile.cmake#L17" target="_blank" rel="noopener noreferrer">glad@0.1.36</a>。</p>
<p>在引入 <a href="/docs/kmpkg/maintainers/registries">registries</a> 之前，我们接受了一些未经测试的端口替代方案，例如<code>boringssl</code>，可能会使创作覆盖端口
更轻松。这不再被接受，因为注册表允许发布这些未经测试的端口无需修改策划的注册表。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pr-结构">PR 结构<a href="#pr-结构" class="hash-link" aria-label="Direct link to PR 结构" title="Direct link to PR 结构">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="为每个端口发出单独的拉取请求">为每个端口发出单独  的拉取请求<a href="#为每个端口发出单独的拉取请求" class="hash-link" aria-label="Direct link to 为每个端口发出单独的拉取请求" title="Direct link to 为每个端口发出单独的拉取请求">​</a></h3>
<p>尽可能将更改分为多个 PR。 这样更容易进行审查，并可防止一组更改的问题妨碍所有其他更改。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="避免对未触及的文件进行微小的更改">避免对未触及的文件进行微小的更改<a href="#避免对未触及的文件进行微小的更改" class="hash-link" aria-label="Direct link to 避免对未触及的文件进行微小的更改" title="Direct link to 避免对未触及的文件进行微小的更改">​</a></h3>
<p>例如，避免重新格式化或重命名端口文件中的变量，否则没有理由针对当前问题进行修改。但是，如果您需要出于 PR 的主要目的（更新库）修改文件，
那么显然有益的改变，如修复拼写错误，将受到赞赏！</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="对照其他存储库检查名称">对照其他存储库检查名称<a href="#对照其他存储库检查名称" class="hash-link" aria-label="Direct link to 对照其他存储库检查名称" title="Direct link to 对照其他存储库检查名称">​</a></h3>
<p>端口名称应尽量明确端口是哪个包安装。理想情况下，在搜索引擎中搜索端口名称应该很快
引导您到相应的项目。服务很好，可以检查很多包裹一次跨多个存储库的名称是<a href="https://repology.org/" target="_blank" rel="noopener noreferrer">Repology</a>。</p>
<p>名称简称或以常用词命名的项目可能需要消除歧义，特别是当没有具有强关联的项目时
到给定的单词。例如，名称为“ip”的端口是不可接受的因为多个项目很可能会被类似地命名。</p>
<p>好的消歧器的例子有：</p>
<ul>
<li>存储库的所有者用户名或组织：<code>google-cloud-cpp</code>。</li>
<li>该项目所属的一组库的名称：<code>boost-dll</code>。</li>
</ul>
<p>C++ 和开源项目使用的常见前缀和后缀无效
消歧符，一些示例包括但不限于：</p>
<ul>
<li><code>cpp</code>,</li>
<li><code>free</code>,</li>
<li><code>lib</code>,</li>
<li><code>open</code>,</li>
<li>numbers</li>
</ul>
<p>例如，在比较以下端口名称时：<code>ip-cpp</code>、<code>libip</code> 和<code>ip5</code> 并删除无效的消歧符，它们都被简化为相同的
干（<code>ip</code>），因此被认为具有相同的名称。</p>
<p>对于强关联的名称，此准则有一个例外与单个项目。例如：<code>libpng</code>、<code>openssl</code>和<code>zlib</code>。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="portfiles">Portfiles<a href="#portfiles" class="hash-link" aria-label="Direct link to Portfiles" title="Direct link to Portfiles">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="avoid-deprecated-helper-functions">避免弃用的辅助函数<a href="#avoid-deprecated-helper-functions" class="hash-link" aria-label="Direct link to 避免弃用的辅助函数" title="Direct link to 避免弃用的辅助函数">​</a></h3>
<p>目前，以下助手已被弃用：</p>
<ul>
<li>不推荐使用的不带“ARCHIVE”的“kmpkg_extract_source_archive()”重载应替换为支持的带“ARCHIVE”的重载。</li>
<li><code>kmpkg_copy_tool_dependency()</code> 应替换为 <a href="/docs/kmpkg/maintainers/functions/kmpkg_copy_tools"><code>kmpkg_copy_tools()</code></a></li>
<li>删除“PREFER_NINJA”后，“kmpkg_configure_cmake”应替换为 <a href="/docs/kmpkg/maintainers/functions/kmpkg_cmake_configure"><code>kmpkg_cmake_configure()</code></a></li>
<li><code>kmpkg_build_cmake</code> 应替换为 <a href="/docs/kmpkg/maintainers/functions/kmpkg_cmake_build"><code>kmpkg_cmake_build()</code></a></li>
<li><code>kmpkg_install_cmake</code> 应替换为 <a href="/docs/kmpkg/maintainers/functions/kmpkg_cmake_install"><code>kmpkg_cmake_install()</code></a></li>
<li><code>kmpkg_fixup_cmake_targets</code> 应替换为 <a href="/docs/kmpkg/maintainers/functions/kmpkg_cmake_config_fixup"><code>kmpkg_cmake_config_fixup</code></a></li>
</ul>
<p>一些替换帮助程序功能位于“工具端口”中，以允许消费者固定他们的特定版本的行为，以允许将帮助程序的行为锁定在特定版本
版本。工具端口需要添加到端口的“依赖项”中，如下所示：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#005CC5">&quot;name&quot;</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;kmpkg-cmake&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#005CC5">&quot;host&quot;</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token boolean" style="color:#005CC5">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#005CC5">&quot;name&quot;</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&quot;kmpkg-cmake-config&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#005CC5">&quot;host&quot;</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token boolean" style="color:#005CC5">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="avoid-excessive-comments-in-portfiles">避免端口文件中过多的注释<a href="#avoid-excessive-comments-in-portfiles" class="hash-link" aria-label="Direct link to 避免端口文件中过多的注释" title="Direct link to 避免端口文件中过多的注释">​</a></h3>
<p>理想情况下， 端口文件应该简短、简单并且尽可能具有声明性。在提交 PR 之前，删除“create”命令引入的所有样板注释。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="端口不得依赖于路径">端口不得依赖于路径<a href="#端口不得依赖于路径" class="hash-link" aria-label="Direct link to 端口不得依赖于路径" title="Direct link to 端口不得依赖于路径">​</a></h3>
<p>端口不得根据已安装的端口来更改其行为，从而改变端口安装的内容。例如，给定：</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; kmpkg install a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; kmpkg install b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; kmpkg remove a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>and</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; kmpkg install b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>无论先前安装的<code>a</code>的影响如何，<code>b</code>安装的文件必须相同。这意味着端口在采取某些操作之前不得尝试检测另一个端口是否在已安装的树中提供了某些内容。下面的“定义功能时，显式控制依赖关系”中描述了这种“路径依赖”行为的具体且常见的原因。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="唯一端口属性规则">唯一端口属性规则<a href="#唯一端口属性规则" class="hash-link" aria-label="Direct link to 唯一端口属性规则" title="Direct link to 唯一端口属性规则">​</a></h3>
<p>在整个 kmpkg 系统中，用户预计同时使用的两个端口不可能提供相同的文件。如果端口尝试安装另一个文件已提供的文件，安装将失败。例如，如果端口想要对标头使用极其常见的名称，则应该将这些标头放置在子目录中而不是<code>include</code>中。</p>
<p>通过持续集成运行定期检查此属性，该运行尝试在注册表中安装所有端口，如果两个端口提供相同的文件，则会因<code>FILE_CONFLICTS</code>而失败。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="在非官方命名空间中添加-cmake-导出">在非官方命名空间中添加 CMake 导出<a href="#在非官方命名空间中添加-cmake-导出" class="hash-link" aria-label="Direct link to 在非官方命名空间中添加 CMake 导出" title="Direct link to 在非官方命名空间中添加 CMake 导出">​</a></h3>
<p>kmpkg 的核心设计理念是不要为用户造成“锁定”。 在构建系统中，根据系统中的库和 kmpkg 中的库，不应有区别。 为此，我们避免将 CMake 导出或目标添加到具有“明显名称”的现有库，以允许上游添加自己的官方 CMake 导出，而不会与 kmpkg 冲突。</p>
<p>为此，端口导出的任何 CMake 配置（不在上游库中）都应将 <code>unofficial-</code> 作为前缀。 任何其他目标都应位于 <code>unofficial::&lt;port&gt;::</code> 命名空间中。</p>
<p>这意味着用户应看到：</p>
<ul>
<li><code>find_package(unofficial-&lt;port&gt; CONFIG)</code> 作为获取 <code>unique-to-kmpkg</code> 包的途径</li>
<li><code>unofficial::&lt;port&gt;::&lt;target&gt;</code> 作为从该端口导出的目标。</li>
</ul>
<p>示例：</p>
<ul>
<li><a href="https://gitee.com/kumo-pub/kmpkg/blob/master/ports/brotli/install.patch" target="_blank" rel="noopener noreferrer"><code>brotli</code></a> 创建 <code>unofficial-brotli</code> 包，生成目标 <code>unofficial::brotli::brotli</code>。</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="install-copyright-file">安装版权文件<a href="#install-copyright-file" class="hash-link" aria-label="Direct link to 安装版权文件" title="Direct link to 安装版权文件">​</a></h3>
<p>每个端口必须在文件夹<code>${CURRENT_PACKAGES_DIR}/share/${PORT}</code>中提供名为<code>copyright</code>的文件。如果包的许可证内容在其源文件中可用，
则应通过调用 <a href="/docs/kmpkg/maintainers/functions/kmpkg_install_copyright"><code>kmpkg_install_copyright()</code></a> 创建此文件。如果需要，<code>kmpkg_install_copyright</code> 还会捆绑多个版权文件。</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kmpkg_install_copyright(FILE_LIST &quot;${SOURCE_PATH}/LICENSE&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>手动创建此文件的较旧方法是使用 CMake 内置的<code>file</code>命令。在新端口中不鼓励这样做，有利于<code>kmpkg_install_copyright</code>，但仍然允许。</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">file(INSTALL &quot;${SOURCE_PATH}/LICENSE&quot; DESTINATION &quot;${CURRENT_PACKAGES_DIR}/share/${PORT}&quot; RENAME copyright)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果上游源文件中的许可证内容不是文本形式（例如 PDF 文件），
则“版权”应包含用户如何找到许可证要求的说明。如果可能的话，它还应该包含指向原始源文件的链接来表明这一点，以便用户可以检查它是否是最新的。</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">file(WRITE &quot;${CURRENT_PACKAGES_DIR}/share/${PORT}/copyright&quot; [[As of 2023-07-25, according to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://github.com/GPUOpen-LibrariesAndSDKs/display-library/blob/master/Public-Documents/README.md#end-user-license-agreement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">this software is bound by the &quot;SOFTWARE DEVELOPMENT KIT LICENSE AGREEMENT&quot; PDF located at</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://github.com/GPUOpen-LibrariesAndSDKs/display-library/blob/master/Public-Documents/ADL%20SDK%20EULA.pdf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="端口中的版本限制">端口中的版本限制<a href="#端口中的版本限制" class="hash-link" aria-label="Direct link to 端口中的版本限制" title="Direct link to 端口中的版本限制">​</a></h3>
<p>通常应该避免端口内的版本限制，因为它们会阻碍项目的独立发展。仅当有充分记录的理由时才允许添加此类约束，例如已证明与特定早期版本不兼容。这些限制不应仅仅用于维持与独立项目的平等。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="功能">功能<a href="#功能" class="hash-link" aria-label="Direct link to 功能" title="Direct link to 功能">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="请勿使用功能实现备选方案">请勿使用功能实现备选方案<a href="#请勿使用功能实现备选方案" class="hash-link" aria-label="Direct link to 请勿使用功能实现备选方案" title="Direct link to 请勿使用功能实现备选方案">​</a></h3>
<p>功能必须被视为附加功能。如果安装了<code>port[featureA]</code>并且安装了<code>port[featureB]</code>，则必须安装<code>port[featureA,featureB]</code>。
此外，如果第二个端口依赖于<code>[featureA]</code>而第三个端口依赖于<code>[featureB]</code>，则安装第二个和第三个端口应该满足它们的依赖关系。</p>
<p>在这种情况下，库必须选择可用选项之一（以 kmpkg 表示），并且想要不同设置的用户此时必须使用覆盖端口。</p>
<p>为了向后兼容，我们今天不接受保留的现有示例：</p>
<ul>
<li><code>libgit2</code>、<code>libzip</code>、<code>open62541</code> 都具有选择 TLS 或加密后端的功能。 <code>curl</code> 有不同的加密后端选项，但允许在运行时在它们之间进行选择，这意味着上述原则得以维持。</li>
<li><code>darknet</code> 具有 <code>opencv2</code>、<code>opencv3</code> 功能来控制其依赖项使用哪个版本的 opencv。</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="某个功能可能涉及预览版或测试版功能">某个功能可能涉及预览版或测试版功能<a href="#某个功能可能涉及预览版或测试版功能" class="hash-link" aria-label="Direct link to 某个功能可能涉及预览版或测试版功能" title="Direct link to 某个功能可能涉及预览版或测试版功能">​</a></h3>
<p>尽管有上述规定，如果存在预览分支或类似分支，其中预览功能很可能不会破坏非预览功能（例如，没有 API 删除），则可以接受一个功能来对此设置进行建模。</p>
<p>示例：</p>
<ul>
<li>Azure SDK（形式为“azure-Xxx”）具有“公共预览”功能。
-“imgui”具有“实验对接”功能，该功能参与其预览对接分支，该分支使用附加到每个公共编号版本的合并提交。</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="默认功能应该启用行为而不是-api">默认功能应该启用行为，而不是 API<a href="#默认功能应该启用行为而不是-api" class="hash-link" aria-label="Direct link to 默认功能应该启用行为，而不是 API" title="Direct link to 默认功能应该启用行为，而不是 API">​</a></h3>
<p>如果消费者直接依赖于库，他们可以轻松列出任何所需的功能（<code>library[feature1，feature2]</code>）。但是，如果消费者_不知道_他们正在使用库，
他 们就无法列出这些功能。如果该隐藏库类似于<code>libarchive</code>，其中功能向现有通用接口添加额外的压缩算法（以及行为），
则默认功能提供了一种方法来确保构建合理功能的传递库，即使最终使用者没有命名直接它。</p>
<p>如果该功能添加了额外的 API（或可执行文件或库二进制文件）并且不修改现有 API 的行为，则默认情况下应将其保留。这是因为任何可能想要使用这些 API 的消费者都可以通过直接引用轻松地要求它。</p>
<p>如有疑问，请勿将某个功能标记为默认功能。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="不要使用功能来控制已发布接口中的替代方案">不要使用功能来控制已发布接口中的替代方案<a href="#不要使用功能来控制已发布接口中的替代方案" class="hash-link" aria-label="Direct link to 不要使用功能来控制已发布接口中的替代方案" title="Direct link to 不要使用功能来控制已发布接口中的替代方案">​</a></h3>
<p>如果端口的使用者仅依赖于该端口的核心功能，那么打开该功能很可能不会破坏它们。当替代方案不是由消费者直接控制，而是由编译器设置（如<code>/std:c++17”/“-std=c++17</code>）控制时，这一点甚至更为重要。</p>
<p>为了向后兼容，我们今天不接受保留的现有示例：</p>
<ul>
<li><code>redis-plus-plus[cxx17]</code> 控制一个polyfill，但不会将设置烘焙到已安装的树中。</li>
<li><code>ace[wchar]</code> 更改所有 API 以接受 <code>const wchar_t*</code> 而不是 <code>const char*</code>。</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="某个功能可以用别名替换-polyfill前提是替换已烘焙到已安装的树中">某个功能可以用别名替换 polyfill，前提是替换已烘焙到已安装的树中<a href="#某个功能可以用别名替换-polyfill前提是替换已烘焙到已安装的树中" class="hash-link" aria-label="Direct link to 某个功能可以用别名替换 polyfill，前提是替换已烘焙到已安装的树中" title="Direct link to 某个功能可以用别名替换 polyfill，前提是替换已烘焙到已安装的树中">​</a></h3>
<p>尽管有上述规定，端口可以删除带有某个功能的 Polyfill，只要：</p>
<p>1.打开该功能会将polyfill更改为polyfill实体的别名
2. Polyfill 的状态被烘焙到已安装的标头中，这样就不太可能出现 ABI 不匹配“不可能”的运行时错误
3. 端口的使用者可以编写在两种模式下工作的代码，例如通过使用 polyfilled 或非 polyfilled 的 typedef</p>
<p>例子：</p>
<ul>
<li><code>abseil[cxx17]</code> 将 <code>absl::string_view</code>
更改为替换或 <code>std::string_view</code>； <a href="https://gitee.com/kumo-pub/kmpkg/blob/981e65ce0ac1f6c86e5a5ded7824db8780173c76/ports/abseil/fix-cxx-standard.patch" target="_blank" rel="noopener noreferrer">补丁</a>实现了烘焙要求。</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="推荐解决方案">推荐解决方案<a href="#推荐解决方案" class="hash-link" aria-label="Direct link to 推荐解决方案" title="Direct link to 推荐解决方案">​</a></h3>
<p>如果公开底层替代方案至关重要，我们建议在构建时提供消息来指导用户如何将端口复制到私有覆盖中：</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set(USING_DOG 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message(STATUS &quot;This version of LibContoso uses the Kittens backend. To use the Dog backend instead, create an overlay port of this with USING_DOG set to 1 and the `kittens` dependency replaced with `dog`.&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message(STATUS &quot;This recipe is at ${CMAKE_CURRENT_LIST_DIR}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message(STATUS &quot;See the overlay ports documentation at https://gitee.com/kumo-pub/kmpkg/blob/master/docs/specifications/ports-overlay.md&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="构建技术">构建技术<a href="#构建技术" class="hash-link" aria-label="Direct link to 构建技术" title="Direct link to 构建技术">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="不要使用供应商的依赖项">不要使用供应商的依赖项<a href="#不要使用供应商的依赖项" class="hash-link" aria-label="Direct link to 不要使用供应商的依赖项" title="Direct link to 不要使用供应商的依赖项">​</a></h3>
<p>不要使用库的嵌入副本。
所有依赖项都应分开并单独打包，以便可以更新和维护。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="首选使用-cmake">首选使用 CMake<a href="#首选使用-cmake" class="hash-link" aria-label="Direct link to 首选使用 CMake" title="Direct link to 首选使用 CMake">​</a></h3>
<p>当有多个构建  系统可用时，首选使用 CMake。
此外，在适当的情况下，使用“file(GLOB)”指令将替代构建系统重写到 CMake 中会更容易且更易于维护。</p>
<p>示例：<a href="https://gitee.com/kumo-pub/kmpkg/tree/master/ports/abseil/portfile.cmake" target="_blank" rel="noopener noreferrer">abseil</a></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="only-static-or-shared">选择静态或共享二进制文件<a href="#only-static-or-shared" class="hash-link" aria-label="Direct link to 选择静态或共享二进制文件" title="Direct link to 选择静态或共享二进制文件">​</a></h3>
<p>构建 CMake 库时，<a href="/docs/kmpkg/maintainers/functions/kmpkg_cmake_configure"><code>kmpkg_cmake_configure()</code></a> 将根据用户请求的变体传入 <code>BUILD_SHARED_LIBS</code> 的正确值。</p>
<p>您可以使用<code>string(COMPARE EQUAL &quot;${KMPKG_LIBRARY_LINKAGE}&quot; ...)</code>计算替代配置参数。</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># portfile.cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string(COMPARE EQUAL &quot;${KMPKG_LIBRARY_LINKAGE}&quot; &quot;static&quot; KEYSTONE_BUILD_STATIC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string(COMPARE EQUAL &quot;${KMPKG_LIBRARY_LINKAGE}&quot; &quot;dynamic&quot; KEYSTONE_BUILD_SHARED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kmpkg_cmake_configure(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SOURCE_PATH ${SOURCE_PATH}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPTIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -DKEYSTONE_BUILD_STATIC=${KEYSTONE_BUILD_STATIC}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -DKEYSTONE_BUILD_SHARED=${KEYSTONE_BUILD_SHARED}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果库不提供配置选项来选择构建变体，则必须对构建进行修补。当修补构建时，您应该始终尝试最大化端口的未来可维护性。通常，这意味着最大限度地减少解决当前问题所需的行数。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例修补-cmake-库以避免构建不需要的变体">示例：修补 CMake 库以避免构建不需要的变体<a href="#示例修补-cmake-库以避免构建不需要的变体" class="hash-link" aria-label="Direct link to 示例：修补 CMake 库以避免构建不需要的变体" title="Direct link to 示例：修补 CMake 库以避免构建不需要的变体">​</a></h4>
<p>例如，在修补基于 CMake 的库时，将 <a href="https://cmake.org/cmake/help/latest/prop_tgt/EXCLUDE_FROM_ALL.html" target="_blank" rel="noopener noreferrer"><code>EXCLUDE_FROM_ALL</code></a> 添加到不需要的目标并包装<code> install(TARGETS ...)</code> 在 <code>if(BUILD_SHARED_LIBS)</code> 中调用。这比换行或删除提到不需要的变体的每一行要短。</p>
<p>对于包含以下内容的项目<code>CMakeLists.txt</code>：</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">add_library(contoso SHARED contoso.c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_library(contoso_static STATIC contoso.c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install(TARGETS contoso contoso_static EXPORT ContosoTargets)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install(EXPORT ContosoTargets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FILE ContosoTargets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NAMESPACE contoso::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DESTINATION share/contoso)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>仅需要修补“install(TARGETS)”行。</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">add_library(contoso SHARED contoso.c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_library(contoso_static STATIC contoso.c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(BUILD_SHARED_LIBS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set_target_properties(contoso_static PROPERTIES EXCLUDE_FROM_ALL 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  install(TARGETS contoso EXPORT ContosoTargets)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set_target_properties(contoso PROPERTIES EXCLUDE_FROM_ALL 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  install(TARGETS contoso_static EXPORT ContosoTargets)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install(EXPORT ContosoTargets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FILE ContosoTargets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NAMESPACE contoso::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DESTINATION share/contoso)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="定义功能时显式控制依赖关系">定义功能时，显式控制依赖关系<a href="#定义功能时显式控制依赖关系" class="hash-link" aria-label="Direct link to 定义功能时，显式控制依赖关系" title="Direct link to 定义功能时，显式控制依赖关系">​</a></h3>
<p>在定义捕获可选依赖项的功能时，请确保在未显式启用该功能时不会意外使用该依赖项。</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set(CMAKE_DISABLE_FIND_PACKAGE_ZLIB ON)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set(CMAKE_REQUIRE_FIND_PACKAGE_ZLIB OFF)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (&quot;zlib&quot; IN_LIST FEATURES)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set(CMAKE_DISABLE_FIND_PACKAGE_ZLIB OFF)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set(CMAKE_REQUIRE_FIND_PACKAGE_ZLIB ON)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kmpkg_cmake_configure(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SOURCE_PATH ${SOURCE_PATH}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  OPTIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -DCMAKE_DISABLE_FIND_PACKAGE_ZLIB=${CMAKE_DISABLE_FIND_PACKAGE_ZLIB}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -DCMAKE_REQUIRE_FIND_PACKAGE_ZLIB=${CMAKE_REQUIRE_FIND_PACKAGE_ZLIB}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>下面使用 <a href="/docs/kmpkg/maintainers/functions/kmpkg_check_features"><code>kmpkg_check_features()</code></a> 的代码片段是等效的。</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kmpkg_check_features(OUT_FEATURE_OPTIONS FEATURE_OPTIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FEATURES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;zlib&quot;    CMAKE_REQUIRE_FIND_PACKAGE_ZLIB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  INVERTED_FEATURES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;zlib&quot;    CMAKE_DISABLE_FIND_PACKAGE_ZLIB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kmpkg_cmake_configure(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SOURCE_PATH ${SOURCE_PATH}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OPTIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ${FEATURE_OPTIONS}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>代码片段中的“ZLIB”区分大小写。欲了解更多信息，请参阅
<a href="https://cmake.org/cmake/help/v3.22/variable/CMAKE_DISABLE_FIND_PACKAGE_PackageName.html" target="_blank" rel="noopener noreferrer"><code>CMAKE_DISABLE_FIND_PACKAGE_&lt;PackageName&gt;</code></a>
和 <a href="https://cmake.org/cmake/help/v3.22/variable/CMAKE_REQUIRE_FIND_PACKAGE_PackageName.html" target="_blank" rel="noopener noreferrer"><code>CMAKE_REQUIRE_FIND_PACKAGE_&lt;PackageName&gt;</code></a> 文档。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="将冲突的库放在manual-link目录中">将冲突的库放在<code>manual-link</code>目录中<a href="#将冲突的库放在manual-link目录中" class="hash-link" aria-label="Direct link to 将冲突的库放在manual-link目录中" title="Direct link to 将冲突的库放在manual-link目录中">​</a></h3>
<p>如果库执行以下任何操作，则视为冲突：</p>
<ul>
<li>Define <code>main</code></li>
<li>Define malloc</li>
<li>Define symbols that are also declared in other libraries</li>
</ul>
<p>冲突的库通常是设计使然，不被视为缺陷。  由于某些构建系统链接 lib 目录中的所有内容，因此应将它们移动到名为<code>manual-link</code>的子目录中。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="versioning">版本控制<a href="#versioning" class="hash-link" aria-label="Direct link to 版本控制" title="Direct link to 版本控制">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="遵循-version-字段的通用约定">遵循 <code>&quot;version&quot;</code> 字段的通用约定<a href="#遵循-version-字段的通用约定" class="hash-link" aria-label="Direct link to 遵循-version-字段的通用约定" title="Direct link to 遵循-version-字段的通用约定">​</a></h3>
<p>创建新端口时，请遵循包作者使用的版本控制约定。更新端口时，继续使用相同的约定，除非上游另有说明。有关我们约定的完整说明，请参阅我们的<a href="/docs/kmpkg/users/versioning#version-schemes">版本控制文档</a>。</p>
<p>如果上游一段时间没有发布版本，请勿将端口的版本控制方案更改为<code>“version-date”</code>以获得最新更改。这些提交可能包括尚未准备好生产的更改。相反，要求上游存储库发布新版本。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="更新任何修改端口清单文件中的-port-version-字段">更新任何修改端口清单文件中的 <code>&quot;port-version&quot;</code> 字段<a href="#更新任何修改端口清单文件中的-port-version-字段" class="hash-link" aria-label="Direct link to 更新任何修改端口清单文件中的-port-version-字段" title="Direct link to 更新任何修改端口清单文件中的-port-version-字段">​</a></h3>
<p>kmpkg 使用此字段来确定给定端口是否已过时，并且在端口行为发生变化时应进行更改。</p>
<p>我们的约定是使用<code>“port-version”</code>字段来更改端口而不更改上游版本，并在上游版本更新时将<code>“port-version”</code>重置为零制成。</p>
<p>例如：</p>
<ul>
<li>Zlib 的软件包版本当前为 <code>1.2.1</code>，没有显式的 <code>&quot;port-version&quot;</code>（相当于 <code>&quot;port-version&quot;</code> 为 <code>0</code>）。</li>
<li>您  发现部署了错误的版权文件，并在端口文件中修复了该问题。</li>
<li>您应该将清单文件中的<code>&quot;port-version&quot;</code>字段更新为<code>&quot;1&quot;</code>。</li>
</ul>
<p>有关更多信息，请参阅<a href="/docs/kmpkg/users/versioning#port-version">版本控制文档</a>。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="更新任何修改端口的-versions-中的版本文件">更新任何修改端口的 <code>versions/</code> 中的版本文件<a href="#更新任何修改端口的-versions-中的版本文件" class="hash-link" aria-label="Direct link to 更新任何修改端口的-versions-中的版本文件" title="Direct link to 更新任何修改端口的-versions-中的版本文件">​</a></h3>
<p>kmpkg 使用一组元数据文件来支持其版本控制功能。
这些文件位于以下位置：</p>
<ul>
<li><code>${KMPKG_ROOT}/versions/baseline.json</code>，（此文件对于所有端口都是通用的）和</li>
<li><code>${KMPKG_ROOT}/versions/${first-letter-of-portname}-/${portname}.json</code>（每个端口一个）。</li>
</ul>
<p>例如，对于<code>zlib</code>，相关文件是：</p>
<ul>
<li><code>${KMPKG_ROOT}/versions/baseline.json</code></li>
<li><code>${KMPKG_ROOT}/versions/z-/zlib.json</code></li>
</ul>
<p>我们希望您每次更新端口时，也会更新其版本文件。</p>
<p><strong>更新这些文件的推荐方法是运行 <code>x-add-version</code> 命令，例如：</strong></p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kmpkg x-add-version zlib</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果您要同时更新多个端口，则可以运行：</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kmpkg x-add-version --all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>立即更新所有已修改端口的文件。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>NOTE</div><div class="admonitionContent_BuS1"><p>这些命令要求在运行之前已将更改提交到端口。 原因是这些版本文件中需要端口目录的 Git SHA。 但不必担心，如果本地更改尚未提交，<code>x-add-version</code> 命令将发出警告</p></div></div>
<p>有关更多信息，请参阅 <a href="/docs/kmpkg/users/versioning">版本控制参考</a> 和 <a href="/docs/kmpkg/maintainers/registries">创建注册表</a>。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="patching">修补<a href="#patching" class="hash-link" aria-label="Direct link to 修补" title="Direct link to 修补">​</a></h2>
<p>kmpkg 是一个打包解决方案，而不是我们部署的组件的最终所有者。在某些情况下，我们确实需要应用补丁来提高组件与平台的兼容性，或者组件之间的兼容性。</p>
<ul>
<li>我们希望避免出现以下情况的补丁：<!-- -->
<ul>
<li>上游不同意</li>
<li>导致漏洞或崩溃</li>
<li>我们无法维护跨上游版本的更新</li>
<li>足够大，足以导致与 kmpkg 存储库本身的许可证纠缠</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="通知上游所有者上游相关修补程序">通知上游所有者上游相关修补程序<a href="#通知上游所有者上游相关修补程序" class="hash-link" aria-label="Direct link to 通知上游所有者上游相关修补程序" title="Direct link to 通知上游所有者上游相关修补程序">​</a></h3>
<p>如果修补程序可能对上游有用，则必须通知上游该修补程序的内容。 （应用与上游无关的 kmpkg 特定行为的修补程序，例如开发依赖项，不需要通知。）</p>
<p>为了避免上游与修补程序不一致的情况，我们将等待至少 30 天来应用此类修补程序。</p>
<p>如果我们对更改正确充满信心，我们将跳过此等待期。 高置信度修补程序示例包括，但不限于：</p>
<ul>
<li>上游接受作  为修补程序（例如，从上游的拉取请求向后移植特定更改已合并）。</li>
<li>添加缺失的 <code>#include</code>。</li>
<li>小而明显的产品代码修复（例如，初始化未初始化的变量）。</li>
<li>禁用构建的 <code>irrelevant-in-kmpkg</code> 组件，例如测试或示例。</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="首选选项优先于修补">首选选项优先于修补<a href="#首选选项优先于修补" class="hash-link" aria-label="Direct link to 首选选项优先于修补" title="Direct link to 首选选项优先于修补">​</a></h3>
<p>最好在调用<code>kmpkg_configure_xyz()</code>时设置选项，而不是直接修补设置。</p>
<p>允许您避免修补的常见选项：</p>
<ul>
<li>[MSBUILD] 项目文件中的<code>&lt;PropertyGroup&gt;</code>设置可以通过<code>/p:</code>参数覆盖</li>
<li>[CMAKE] 可以通过 <a href="https://cmake.org/cmake/help/v3.15/variable/CMAKE_DISABLE_FIND_PACKAGE_PackageName.html" target="_blank" rel="noopener noreferrer"><code>-DCMAKE_DISABLE_FIND_PACKAGE_XYz=ON</code></a> 禁用对 CMake 脚本中的 <code>find_package(XYz)</code> 的调用</li>
<li>[CMAKE] 缓存变量（声明为 <code>set(VAR &quot;value&quot; CACHE STRING &quot;Documentation&quot;)</code> 或 <code>option(VAR &quot;Documentation&quot; &quot;Default Value&quot;)</code>）只需在命令行中传递即可覆盖它们如 <code>-DVAR:STRING=Foo</code>。一个值得注意的例外是“FORCE”参数是否传递给<code>set()</code>。有关更多信息，请参阅 <a href="https://cmake.org/cmake/help/v3.15/command/set.html" target="_blank" rel="noopener noreferrer">CMake <code>set</code> 文档</a></li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="优先选择修补而不是覆盖mpkg_variable值">优先选择修补而不是覆盖<code>MPKG_&lt;VARIABLE&gt;</code>值<a href="#优先选择修补而不是覆盖mpkg_variable值" class="hash-link" aria-label="Direct link to 优先选择修补而不是 覆盖mpkg_variable值" title="Direct link to 优先选择修补而不是覆盖mpkg_variable值">​</a></h3>
<p>某些以<code>KMPKG_&lt;VARIABLE&gt;</code>为前缀的变量具有等效的<code>CMAKE_&lt;VARIABLE&gt;</code>。
但是，并非所有这些都传递到内部包构建<a href="https://gitee.com/kumo-pub/kmpkg/tree/master/scripts/toolchains/windows.cmake" target="_blank" rel="noopener noreferrer">（请参阅实现：Windows 工具链）</a>。</p>
<p>考虑以下示例：</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set(KMPKG_C_FLAGS &quot;-O2 ${KMPKG_C_FLAGS}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set(KMPKG_CXX_FLAGS &quot;-O2 ${KMPKG_CXX_FLAGS}&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用 <code>kmpkg</code> 的内置工具链，这是可行的，因为 <code>KMPKG_&lt;LANG&gt;_FLAGS</code> 的值被转发到适当的 <code>CMAKE_LANG_FLAGS</code> 变量。但是，不知道 <code>kmpkg</code> 变量的自定义工具链将不会转发它们。</p>
<p>因此，最好在设置 <code>CMAKE_&lt;LANG&gt;_FLAGS</code> 时直接修补构建系统。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="minimize-patches">减少补丁<a href="#minimize-patches" class="hash-link" aria-label="Direct link to 减少补丁" title="Direct link to 减少补丁">​</a></h3>
<p>对库进行更改时，请努力最小化最终差异。这意味着您在进行影响区域的更改时不应重新格式化上游源代码。禁用条件时，最好在条件中添加<code>AND FALSE</code>或<code>&amp;&amp; 0</code>，
而不是删除条件的每一行。如果需要禁用较大区域，则在该区域周围添加<code>if(0)</code>或<code>#if 0</code>比删除补丁中的每一行更短。</p>
<p>如果端口已过时，请勿添加补丁，将端口更新到较新的发布版本可以解决相同的问题。 kmpkg 更喜欢更新端口而不是修补过时的版本。</p>
<p>这有助于缩小 kmpkg 存储库的大小，并提高补丁应用于未来代码版本的可能性。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="请勿在修补程序中实现功能">请勿在修补程序中实现功能<a href="#请勿在修补程序中实现功能" class="hash-link" aria-label="Direct link to 请勿在修补程序中实现功能" title="Direct link to 请勿在修补程序中实现功能">​</a></h3>
<p>在 kmpkg 中修补的目的是实现与编译器、库和平台的兼容性。 其并非要实现新功能取代以下适当的开放源代码过程（提交问题/PR/等）。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="默认情况下不要构建测试文档示例">默认情况下不要构建测试/文档/示例<a href="#默认情况下不要构建测试文档示例" class="hash-link" aria-label="Direct link to 默认情况下不要构建测试/文档/示例" title="Direct link to 默认情况下不要构建测试/文档/示例">​</a></h3>
<p>提交新端口时，请检查<code>BUILD_TESTS</code>或<code>WITH_TESTS</code>或<code>POCO_ENABLE_SAMPLES</code>等任何选项，并确保禁用其他二进制文件。这可以最大限度地减少普通用户的构建时间和依赖性。</p>
<p>或者，您可以添加一个 <code>test</code> 功能来构建测试，但这不应该出现在 <code>Default-Features</code> 列表中。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使库的现有用户能够切换到-kmpkg">使库的现有用户能够切换到 kmpkg<a href="#使库的现有用户能够切换到-kmpkg" class="hash-link" aria-label="Direct link to 使库的现有用户能够切换到 kmpkg" title="Direct link to 使库的现有用户能够切换到 kmpkg">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="do-not-add-cmake_windows_export_all_symbols">不要添加 <code>CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS</code><a href="#do-not-add-cmake_windows_export_all_symbols" class="hash-link" aria-label="Direct link to do-not-add-cmake_windows_export_all_symbols" title="Direct link to do-not-add-cmake_windows_export_all_symbols">​</a></h3>
<p>除非库的作者已经在使用，否则我们不应使用此 CMake 功能，因为它与 C++ 模板交互不佳，并破坏了某些编译器功能。
不提供 .def 文件且不使用 __declspec() 声明的库根本不支持 Windows 的共享版本，应使用 <code>kmpkg_check_linkage(ONLY_STATIC_LIBRARY)</code> 进行标记。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="不要在上游给定的名称之外重命名二进制文件">不要在上游给定的名称之外重命名二进制文件<a href="#不要在上游给定的名称之外重命名二进制文件" class="hash-link" aria-label="Direct link to 不要在上游给定的名称之外重命名二进制文件" title="Direct link to 不要在上游给定的名称之外重命名二进制文件">​</a></h3>
<p>这意味着如果上游库在发布和调试中具有不同的名称（libx 与 libxd），则调试库不应重命名为“libx”。反之亦然，如果上游库在发布和调试中具有相同的名称，我们不应该引入新名称。</p>
<p>重要警告：</p>
<ul>
<li>静态和共享变体通常应重命名为通用方案。这使得消费者能够使用通用名称而无需了解下游链接。这是安全的，因为我们一次只提供一个。</li>
</ul>
<p>如果库生成 CMake 集成文件（<code>foo-config.cmake</code>），则必须通过修补 CMake 构建本身来完成重命名，而不是简单地在输出档案/LIB 上调用<code>file(RENAME)</code>。</p>
<p>最后，Windows 上的 DLL 文件永远不应该在构建后重命名，因为它会破坏生成的 LIB。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="清单">清单<a href="#清单" class="hash-link" aria-label="Direct link to 清单" title="Direct link to 清单">​</a></h3>
<p>我们要求清单文件被格式化。使用以下命令格式化所有清单文件：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kmpkg format-manifest </span><span class="token parameter variable" style="color:#E36209">--all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="三元组">三元组<a href="#三元组" class="hash-link" aria-label="Direct link to 三元组" title="Direct link to 三元组">​</a></h2>
<p>我们目前不接受添加非社区三胞胎的请求。从社区升级到完整三元组状态主要基于测试此类三元组的硬件预算，并将由 kmpkg 提交的指标驱动，以最大限度地提高人们实际使用的内容得到充分测试的可能性。</p>
<p>如果出现以下情况，我们将添加社区三元组：</p>
<ul>
<li>事实证明，人们实际上会使用该社区三元组；和，</li>
<li>我们不知道这样的三元组是否被破坏。</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="实用的实现说明">实用的实现说明<a href="#实用的实现说明" class="hash-link" aria-label="Direct link to 实用的实现说明" title="Direct link to 实用的实现说明">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="端口文件在脚本模式下运行">端口文件在脚本模式下运行<a href="#端口文件在脚本模式下运行" class="hash-link" aria-label="Direct link to 端口文件在脚本模式下运行" title="Direct link to 端口文件在脚本模式下运行">​</a></h3>
<p>虽然<code>portfile.cmake</code>和<code>CMakeLists.txt</code>共享通用语法和核心 CMake 语言结构（又名<code>脚本命令</code>），但 portfiles 在<code>脚本模式</code>下运
行，而<code>CMakeLists.txt</code>文件在<code>脚本模式</code>下运行<code>项目模式</code>。这两种模式最重要的区别是“脚本模式”没有“工具链”、“语言”和“目标”的概念。依
赖于这些构造（例如<code>CMAKE_CXX_COMPILER</code>、<code>CMAKE_EXECUTABLE_SUFFIX</code>、<code>CMAKE_SYSTEM_NAME</code>）的任何行为（包括脚本命令）都将不正确。</p>
<p>端口文件可以直接访问三元组文件中设置的变量，但<code>CMakeLists.txt</code>则不能（尽管经常会发生转换——“KMPKG_LIBRARY_LINKAGE”与“BUILD_SHARED_LIBS”）。</p>
<p>端口文件和端口文件调用的项目构建在不同的进程中运行。从概念上讲：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------+       +------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| CMake.exe                  |       | CMake.exe                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------+       +------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Triplet file               | ====&gt; | Toolchain file                     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| (x64-windows.cmake)        |       | (scripts/buildsystems/kmpkg.cmake) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------+       +------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Portfile                   | ====&gt; | CMakeLists.txt                     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| (ports/foo/portfile.cmake) |       | (buildtrees/../CMakeLists.txt)     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----------------------------+       +------------------------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>要确定端口文件中的主机，标准 CMake 变量就可以了（<code>CMAKE_HOST_WIN32</code>）。</p>
<p>要确定端口文件中的目标，应使用 kmpkg 三元组变量（<code>KMPKG_CMAKE_SYSTEM_NAME</code>）。</p>
<p>另请参阅我们的 <a href="/docs/kmpkg/users/triplets">三元组文档</a> 以获取可能设置的完整枚举。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-05-24T10:16:12.000Z" itemprop="dateModified">May 24, 2025</time></b> by <b>Jeff lothar</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/源代码注册表"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">源代码注册表</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/kmpkg/contributing/cmake-guidelines"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">cmake样式指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#总体注册表设计目标" class="table-of-contents__link toc-highlight">总体注册表设计目标</a><ul><li><a href="#当前基线中的端口必须可同时 安装" class="table-of-contents__link toc-highlight">当前基线中的端口必须可同时安装</a></li></ul></li><li><a href="#pr-结构" class="table-of-contents__link toc-highlight">PR 结构</a><ul><li><a href="#为每个端口发出单独的拉取请求" class="table-of-contents__link toc-highlight">为每个端口发出单独的拉取请求</a></li><li><a href="#避免对未触及的文件进行微小的更改" class="table-of-contents__link toc-highlight">避免对未触及的文件进行微小的更改</a></li><li><a href="#对照其他存储库检查名称" class="table-of-contents__link toc-highlight">对照其他存储库检查名称</a></li></ul></li><li><a href="#portfiles" class="table-of-contents__link toc-highlight">Portfiles</a><ul><li><a href="#avoid-deprecated-helper-functions" class="table-of-contents__link toc-highlight">避免弃用的辅助函数</a></li><li><a href="#avoid-excessive-comments-in-portfiles" class="table-of-contents__link toc-highlight">避免端口文件中过多的注释</a></li><li><a href="#端口不得依赖于路径" class="table-of-contents__link toc-highlight">端口不得依赖于路径</a></li><li><a href="#唯一端口属性规则" class="table-of-contents__link toc-highlight">唯一端口属性规则</a></li><li><a href="#在非官方命名空间中添加-cmake-导出" class="table-of-contents__link toc-highlight">在非官方命名空间中添加 CMake 导出</a></li><li><a href="#install-copyright-file" class="table-of-contents__link toc-highlight">安装版权文件</a></li><li><a href="#端口中的版本限制" class="table-of-contents__link toc-highlight">端口中的版本限制</a></li></ul></li><li><a href="#功能" class="table-of-contents__link toc-highlight">功能</a><ul><li><a href="#请勿使用功能实现备选方案" class="table-of-contents__link toc-highlight">请勿使用功能实现备选方案</a></li><li><a href="#某个功能可能涉及预览版或测试版功能" class="table-of-contents__link toc-highlight">某个功能可能涉及 预览版或测试版功能</a></li><li><a href="#默认功能应该启用行为而不是-api" class="table-of-contents__link toc-highlight">默认功能应该启用行为，而不是 API</a></li><li><a href="#不要使用功能来控制已发布接口中的替代方案" class="table-of-contents__link toc-highlight">不要使用功能来控制已发布接口中的替代方案</a></li><li><a href="#某个功能可以用别名替换-polyfill前提是替换已烘焙到已安装的树中" class="table-of-contents__link toc-highlight">某个功能可以用别名替换 polyfill，前提是替换已烘焙到已安装的树中</a></li><li><a href="#推荐解决方案" class="table-of-contents__link toc-highlight">推荐解决方案</a></li></ul></li><li><a href="#构建技术" class="table-of-contents__link toc-highlight">构建技术</a><ul><li><a href="#不要使用供应商的依赖项" class="table-of-contents__link toc-highlight">不要使用供应商的依赖项</a></li><li><a href="#首选使用-cmake" class="table-of-contents__link toc-highlight">首选使用 CMake</a></li><li><a href="#only-static-or-shared" class="table-of-contents__link toc-highlight">选择静态或共享二进制文件</a></li><li><a href="#定义功能时显式控制依赖关系" class="table-of-contents__link toc-highlight">定义功能时，显式控制依赖关系</a></li><li><a href="#将冲突的库放在manual-link目录中" class="table-of-contents__link toc-highlight">将冲突的库放在<code>manual-link</code>目录中</a></li></ul></li><li><a href="#versioning" class="table-of-contents__link toc-highlight">版本控制</a><ul><li><a href="#遵循-version-字段的通用约定" class="table-of-contents__link toc-highlight">遵循 <code>&quot;version&quot;</code> 字段的通用约定</a></li><li><a href="#更新任何修改端口清单文件中的-port-version-字段" class="table-of-contents__link toc-highlight">更新任何修改端口清单文件中的 <code>&quot;port-version&quot;</code> 字段</a></li><li><a href="#更新  任何修改端口的-versions-中的版本文件" class="table-of-contents__link toc-highlight">更新任何修改端口的 <code>versions/</code> 中的版本文件</a></li></ul></li><li><a href="#patching" class="table-of-contents__link toc-highlight">修补</a><ul><li><a href="#通知上游所有者上游相关修补程序" class="table-of-contents__link toc-highlight">通知上游所有者上游相关修补程序</a></li><li><a href="#首选选项优先于修补" class="table-of-contents__link toc-highlight">首选选项优先于修补</a></li><li><a href="#优先选择修补而不是覆盖mpkg_variable值" class="table-of-contents__link toc-highlight">优先选择修补而不是覆盖<code>MPKG_&lt;VARIABLE&gt;</code>值</a></li><li><a href="#minimize-patches" class="table-of-contents__link toc-highlight">减少补丁</a></li><li><a href="#请勿在修补程序中实现功能" class="table-of-contents__link toc-highlight">请勿在修补程序中实现功能</a></li><li><a href="#默认情况下不要构建测试文档示例" class="table-of-contents__link toc-highlight">默认情况下不要构建测试/文档/示例</a></li></ul></li><li><a href="#使库的现有用户能够切换到-kmpkg" class="table-of-contents__link toc-highlight">使库的现有用户能够切换到 kmpkg</a><ul><li><a href="#do-not-add-cmake_windows_export_all_symbols" class="table-of-contents__link toc-highlight">不要添加 <code>CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS</code></a></li><li><a href="#不要在上游给定的名称之外重命名二进制文件" class="table-of-contents__link toc-highlight">不要在上游给定的名称之外重命名二进制文件</a></li><li><a href="#清单" class="table-of-contents__link toc-highlight">清单</a></li></ul></li><li><a href="#三元组" class="table-of-contents__link toc-highlight">三元组</a></li><li><a href="#实用的实现说明" class="table-of-contents__link toc-highlight">实用的实现说明</a><ul><li><a href="#端口文件在脚本模式下运行" class="table-of-contents__link toc-highlight">端口文件在脚本模式下运行</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">阅读</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">文档</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation">安装</a></li></ul></div><div class="col footer__col"><div class="footer__title">支持与资源</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/feature-requests">Feature Requests</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/community/support">Help</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">博客</a></li><li class="footer__item"><a class="footer__link-item" href="/changelog">更新</a></li><li class="footer__item"><a href="https://gitee.com/kumo-pub" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kumo-ai.tech" target="_blank" rel="noopener noreferrer" class="footer__link-item">网站<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">版权 © 2025 北京科米智创科技有限公司</div></div></div></footer></div>
</body>
</html>