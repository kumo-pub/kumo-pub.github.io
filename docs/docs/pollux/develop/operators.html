<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-1.1.1 docs-doc-page docs-doc-id-pollux/develop/operators" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Plan Nodes and Operators | Kumo AI</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kumo-pub.github.io/img/kumo_logo.svg"><meta data-rh="true" name="twitter:image" content="https://kumo-pub.github.io/img/kumo_logo.svg"><meta data-rh="true" property="og:url" content="https://kumo-pub.github.io/docs/pollux/develop/operators"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.1.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.1.1"><meta data-rh="true" name="docsearch:version" content="1.1.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.1.1"><meta data-rh="true" property="og:title" content="Plan Nodes and Operators | Kumo AI"><meta data-rh="true" name="description" content="Pollux 查询计划是由 PlanNode 组成的树状结构。每个 PlanNode 都有零个或多个子 PlanNode。为了执行查询计划，Pollux 会将其转换为一组管道。"><meta data-rh="true" property="og:description" content="Pollux 查询计划是由 PlanNode 组成的树状结构。每个 PlanNode 都有零个或多个子 PlanNode。为了执行查询计划，Pollux 会将其转换为一组管道。"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://kumo-pub.github.io/docs/pollux/develop/operators"><link data-rh="true" rel="alternate" href="https://kumo-pub.github.io/docs/pollux/develop/operators" hreflang="en"><link data-rh="true" rel="alternate" href="https://kumo-pub.github.io/docs/pollux/develop/operators" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kumo AI RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kumo AI Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Kumo AI JSON Feed">


<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E5CR2Q1NRE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E5CR2Q1NRE",{})</script>


<link rel="alternate" type="application/rss+xml" href="/changelog/rss.xml" title="Docusaurus changelog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/changelog/atom.xml" title="Docusaurus changelog Atom Feed">
<link rel="alternate" type="application/json" href="/changelog/feed.json" title="Docusaurus changelog JSON Feed">



<link rel="icon" href="/img/favicon.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/favicon.png">
<link rel="mask-icon" href="/img/favicon.png" color="rgb(62, 204, 94)">
<meta name="msapplication-TileImage" content="/img/favicon.png">
<meta name="msapplication-TileColor" content="#000">



<link rel="alternate" type="application/rss+xml" href="/tests/blog/rss.xml" title="Docusaurus Tests Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tests/blog/atom.xml" title="Docusaurus Tests Blog Atom Feed">
<link rel="alternate" type="application/json" href="/tests/blog/feed.json" title="Docusaurus Tests Blog JSON Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Kumo AI" href="/opensearch.xml">

<link rel="stylesheet" href="/katex/katex.min.css"><link rel="stylesheet" href="/assets/css/styles.21fbef88.css">
<script src="/assets/js/runtime~main.8e97d312.js" defer="defer"></script>
<script src="/assets/js/main.130eda4d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme-b4f")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss-b4f")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">🎉️ <b><a target="_blank" href="https://docusaurus.io/blog/releases/1.1">Kumo v1.1</a> is out!</b> 🥳️</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/kumo_logo.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE" height="48" width="128"><img src="/img/kumo_logo_white.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="48" width="128"></div><b class="navbar__title text--truncate">主页</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">文档</a><a class="navbar__item navbar__link" href="/docs/category/kmsearch">API</a><a class="navbar__item navbar__link" href="/blog">博客</a><a class="navbar__item navbar__link" href="/changelog">发布</a><a class="navbar__item navbar__link" href="/showcase">应用案例</a><a class="navbar__item navbar__link" href="/community/support">支持与资源</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/pollux/develop/operators">1.1.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next">nightly 🚧</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/pollux/develop/operators">1.1.1</a></li><li><hr class="dropdown-separator"></li><li class="dropdown-archived-versions"><b>Archived versions</b></li><li><a href="https://docusaurus-archive-october-2023.netlify.app/docs/2.3.1" target="_blank" rel="noopener noreferrer" class="dropdown__link">1.0.1<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://v1.docusaurus.io" target="_blank" rel="noopener noreferrer" class="dropdown__link">1.x.x<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr class="dropdown-separator"></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/pollux/develop/operators" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://github.com/facebook/docusaurus/issues/3526" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help Us Translate<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/kumo_logo.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE" height="48" width="128"><img src="/img/kumo_logo_white.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="48" width="128"><b>主页</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">概述</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/基础准备">基础准备</a><button aria-label="Collapse sidebar category &#x27;基础准备&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/env_prepare_be">后端开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/env_prepare_fe">前端开发环境</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/持续集成----kmpkg">持续集成 -- kmpkg</a><button aria-label="Expand sidebar category &#x27;持续集成 -- kmpkg&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/c开发">c++开发</a><button aria-label="Expand sidebar category &#x27;c++开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/搜素基础开发">搜素基础开发</a><button aria-label="Expand sidebar category &#x27;搜素基础开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/搜索应用开发">搜索应用开发</a><button aria-label="Expand sidebar category &#x27;搜索应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/向量数据库教程">向量数据库教程</a><button aria-label="Expand sidebar category &#x27;向量数据库教程&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/搜索统一执行引擎">搜索统一执行引擎</a><button aria-label="Collapse sidebar category &#x27;搜索统一执行引擎&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/overview">pollux</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/presto-functions">Presto Functions</a><button aria-label="Expand sidebar category &#x27;Presto Functions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/开发文档">开发文档</a><button aria-label="Collapse sidebar category &#x27;开发文档&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/types">Types(数据类型)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/vectors">Vectors(向量)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/scalar-functions">如何添加标量函数？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/aggregate-functions">如何添加聚合函数？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/view-and-writer-types">视图和编写器类型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/lambda-functions">如何添加 lambda 函数？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/expression-evaluation">表达式计算 (Expression Evaluation)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/dictionary-encoding">字典编码(Dictionary Encoding)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/arena">Arena Allocation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/hash-table">Hash table</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/aggregations">聚合(Aggregations)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/connectors">Connectors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/joins">Joins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/anti-join">Anti joins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/pollux/develop/operators">Plan Nodes and Operators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/task">What&#x27;s in the Task?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/simd">SIMD Usage in Pollux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/memory">Memory Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/spilling">Spilling</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/serialization">Serialization</a><button aria-label="Expand sidebar category &#x27;Serialization&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/调试">调试</a><button aria-label="Expand sidebar category &#x27;调试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/测试">测试</a><button aria-label="Expand sidebar category &#x27;测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/timestamp">Timestamp and Timezone Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/window">Window functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pollux/develop/dynamic-loading">Dynamic Loading of Pollux Extensions</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/搜索-ui">搜索 UI</a><button aria-label="Expand sidebar category &#x27;搜索 UI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/搜索统一执行引擎"><span itemprop="name">搜索统一执行引擎</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/开发文档"><span itemprop="name">开发文档</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Plan Nodes and Operators</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.1.1</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Plan Nodes and Operators</h1></header>
<p>Pollux 查询计划是由 PlanNode 组成的树状结构。每个 PlanNode 都有零个或多个子 PlanNode。为了执行查询计划，Pollux 会将其转换为一组管道。
每个管道由一系列线性运算符组成，这些运算符对应于计划的一个
线性子树。通过将每个具有两个或多个子节点的节点与所有子节点断开连接，将计划树分解为一组线性子树。</p>
<!-- -->
<img width="400" align="center" src="[object Object]">
<p>计划节点到运算符的转换大多是一对一的。以下情况除外：</p>
<ul>
<li>过滤节点后跟项目节点时，会转换为单个运算符 FilterProject</li>
<li>具  有两个或多个子节点的节点会转换为多个运算符，例如 HashJoin 节点会转换为一对运算符：HashProbe 和 HashBuild。</li>
</ul>
<p>与叶节点对应的运算符称为源运算符。只有一部分计划节点可以位于计划树的叶子节点上。这些节点包括：</p>
<ul>
<li>TableScanNode</li>
<li>ValuesNode</li>
<li>ExchangeNode</li>
<li>MergeExchangeNode</li>
<li>ArrowStreamNode</li>
</ul>
<p>以下是受支持的计划节点和相应操作符的列表。</p>
<table><thead><tr><th>Plan Node</th><th>Operator(s)</th><th>Leaf Node / Source Operator</th></tr></thead><tbody><tr><td>TableScanNode</td><td>TableScan</td><td>Y</td></tr><tr><td>ArrowStreamNode</td><td>ArrowStream</td><td>Y</td></tr><tr><td>FilterNode</td><td>FilterProject</td><td></td></tr><tr><td>ProjectNode</td><td>FilterProject</td><td></td></tr><tr><td>AggregationNode</td><td>HashAggregation or StreamingAggregation</td><td></td></tr><tr><td>GroupIdNode</td><td>GroupId</td><td></td></tr><tr><td>MarkDistinctNode</td><td>MarkDistinct</td><td></td></tr><tr><td>HashJoinNode</td><td>HashProbe and HashBuild</td><td></td></tr><tr><td>MergeJoinNode</td><td>MergeJoin</td><td></td></tr><tr><td>NestedLoopJoinNode</td><td>NestedLoopJoinProbe and NestedLoopJoinBuild</td><td></td></tr><tr><td>OrderByNode</td><td>OrderBy</td><td></td></tr><tr><td>TopNNode</td><td>TopN</td><td></td></tr><tr><td>LimitNode</td><td>Limit</td><td></td></tr><tr><td>UnnestNode</td><td>Unnest</td><td></td></tr><tr><td>TableWriteNode</td><td>TableWrite</td><td></td></tr><tr><td>TableWriteMergeNode</td><td>TableWriteMerge</td><td></td></tr><tr><td>PartitionedOutputNode</td><td>PartitionedOutput</td><td></td></tr><tr><td>ExchangeNode</td><td>Exchange</td><td>Y</td></tr><tr><td>ExpandNode</td><td>Expand</td><td></td></tr><tr><td>MergeExchangeNode</td><td>MergeExchange</td><td>Y</td></tr><tr><td>ValuesNode</td><td>Values</td><td>Y</td></tr><tr><td>LocalMergeNode</td><td>LocalMerge</td><td></td></tr><tr><td>LocalPartitionNode</td><td>LocalPartition and LocalExchange</td><td></td></tr><tr><td>EnforceSingleRowNode</td><td>EnforceSingleRow</td><td></td></tr><tr><td>AssignUniqueIdNode</td><td>AssignUniqueId</td><td></td></tr><tr><td>WindowNode</td><td>Window</td><td></td></tr><tr><td>RowNumberNode</td><td>RowNumber</td><td></td></tr><tr><td>TopNRowNumberNode</td><td>TopNRowNumber</td><td></td></tr></tbody></table>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="plan-nodes">Plan Nodes<a href="#plan-nodes" class="hash-link" aria-label="Direct link to Plan Nodes" title="Direct link to Plan Nodes">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tablescannode">TableScanNode<a href="#tablescannode" class="hash-link" aria-label="Direct link to TableScanNode" title="Direct link to TableScanNode">​</a></h3>
<p>表扫描操作从 <code>connector &lt;/develop/connectors&gt;</code> 读取数据。例如，当与 HiveConnector 一起使用时，表扫描会从 ORC 或 Parquet 文件读取数据。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>outputType</td><td>输出列的列表。这是基础表中可用列的子集。列的顺序可能与表的架构不一致。</td></tr><tr><td>tableHandle</td><td>特定于连接器的表格描述。可能包含下推式过滤器。</td></tr><tr><td>assignments</td><td>从表模式到输出列的连接器特定映射。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="arrowstreamnode">ArrowStreamNode<a href="#arrowstreamnode" class="hash-link" aria-label="Direct link to ArrowStreamNode" title="Direct link to ArrowStreamNode">​</a></h3>
<p>Arrow 流操作从 Arrow 数组流中读取数据。ArrowArrayStream 结构在 Arrow ABI 中定义，并提供与 Arrow 数组流源交互所需的回调。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>arrowStream</td><td>构造的 Arrow 数组流。这是数据块的流式源，每个数据块具有相同的架构。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="filternode">FilterNode<a href="#filternode" class="hash-link" aria-label="Direct link to FilterNode" title="Direct link to FilterNode">​</a></h3>
<p>过滤操作根据布尔过滤表达式从输入数据中剔除一条或多条记录。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>filter</td><td>布尔过滤表达式。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="projectnode">ProjectNode<a href="#projectnode" class="hash-link" aria-label="Direct link to ProjectNode" title="Direct link to ProjectNode">​</a></h3>
<p>投影操作会根据数据集的输入生成一个或多个附加表达式。投影操作还可能删除一个或多个输入列。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>names</td><td>输出表达式的列名。</td></tr><tr><td>expressions</td><td>输出列的表达式。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aggregationnode">AggregationNode<a href="#aggregationnode" class="hash-link" aria-label="Direct link to AggregationNode" title="Direct link to AggregationNode">​</a></h3>
<p>聚合操作根据一组分组键对输入数据进行分组，并计算每个分组键组合对应的度量值。此外，还可以对各个度量值的输入进行排序和去重。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>step</td><td>聚合步骤：部分、最终、中间、单一。</td></tr><tr><td>groupingKeys</td><td>零个或多个分组键。</td></tr><tr><td>preGroupedKeys</td><td>已知输入已按分组键预分组的分组键子集，即所有具有给定预分组键值组合的行将依次出现。输入不按预分组键排序。如果输入已按所有分组键预分组，则执行将使用 StreamingAggregation 运算符。</td></tr><tr><td>aggregateNames</td><td>度量的输出列的名称。</td></tr><tr><td>aggregates</td><td>一个或多个待 计算的度量。每个度量指定一个表达式，例如 count(1)、sum(a)、avg(b)；可选的布尔值输入列（用于屏蔽此特定度量的行）；可选的输入列列表（用于在计算度量之前进行排序）；可选的标志（用于指示在计算度量之前必须对输入进行重复数据删除）。表达式必须采用直接对输入列进行聚合函数调用的形式，例如 sum(c) 可以，但 sum(c + d) 不可以。</td></tr><tr><td>ignoreNullKeys</td><td>一个布尔标志，指示聚合是否应删除任何分组键中为空的行。用于避免对分组键上紧接着内连接的聚合进行不必要的处理。</td></tr><tr><td>globalGroupingSets</td><td>如果 AggregationNode 位于 GroupIdNode 之上，则某些组可能是全局组，这些组仅具有 GroupId 分组键值。这些值表示全局聚合值。</td></tr><tr><td>groupId</td><td>GroupId 是 AggregationNode 中由底层 GroupIdNode 生成的 groupId 列的分组键。它必须是 BIGINT 类型。</td></tr></tbody></table>
<p>各个度量的属性。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>call</td><td>用于计算度量的表达式，例如 count(1)、sum(a)、avg(b)。表达式必须采用直接对输入列调用聚合函数的形式，例如 sum(c) 可以，但 sum(c + d) 不可以。</td></tr><tr><td>rawInputTypes</td><td>聚合函数的原始输入类型列表。用于正确识别聚合函数，例如，在中间聚合的情况下，决定是 min(x) 还是 min(x, n)。当聚合步骤为中间或最终时，这些输入类型可能与“call”中指定的输入类型不同。</td></tr><tr><td>mask</td><td>可选的布尔值输入列，用于屏蔽此特定度量的行。多个度量可以指定相同的输入列作为掩码。</td></tr><tr><td>sortingKeys</td><td>计算度量值之前要排序的输入列的可选列表。如果指定，则必须使用 sortingOrders 来指定每个排序键的排序顺序。</td></tr><tr><td>sortingOrders</td><td>每个排序键 的排序顺序列表。</td></tr><tr><td>distinct</td><td>布尔标志，指示在计算测量值之前必须对输入进行重复数据删除。</td></tr></tbody></table>
<p>请注意，如果度量指定了排序键，HashAggregation 运算符会将所有输入行累加到内存中，然后再对它们进行排序并添加到累加器中。与输入无需排序的情况相比，这需要更多的内存。</p>
<p>同样，如果度量要求对输入进行去重，HashAggregation 运算符会将所有不同的输入行累加到内存中，然后再将它们添加到累加器中。与输入无需去重的情况相比，这需要更多的内存。</p>
<p>此外，许多聚合函数对已排序和未排序的输入都会产生相同的结果，例如：:func:<code>min</code>、:func:<code>max</code>、:func:<code>count</code> 和 :func:<code>sum</code>。
查询规划器应避免为此类聚合函数生成需要已排序输入的计划。对输入顺序敏感的聚合函数的一些示例包括：func:<code>array_agg</code> 和 :func:<code>min_by</code>（存在关系时）。</p>
<p>类似地，某些聚合函数对唯一输入和重复输入都会产生相同的结果，例如：:func:<code>min</code> 和 :func:<code>max</code>。查询规划器应避免为此类聚合函数生成要求去重输入的计划。</p>
<p>最后，请注意，只有当聚合步骤为“单步”时，才可以对已排序的输入进行度量计算。此类计算不能拆分为部分计算和最终计算。</p>
<p>为了说明 globalGroupingSets 和 groupIdColumn 的必要性，我们分析以下 SQL</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#CF222E">SELECT</span><span class="token plain"> orderkey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">total_quantity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">FROM</span><span class="token plain"> orders </span><span class="token keyword" style="color:#CF222E">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">BY</span><span class="token plain"> CUBE </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">orderkey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这相当于以下带有 GROUPING SETS 的 SQL</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#CF222E">SELECT</span><span class="token plain"> orderkey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">total_quantity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">FROM</span><span class="token plain"> orders </span><span class="token keyword" style="color:#CF222E">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">BY</span><span class="token plain"> GROUPING SETS </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">orderkey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>该 SQL 给出了每个 orderkey 的 total_quantity 小计以及全局总和（来自空分组集）。</p>
<p>优化器将上述查询规划为基于 GroupId 节点的聚合。</p>
<p>假设订单表有 5 行：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orderkey   total_quantity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1            5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2            6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2            7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     3            8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     4            9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>分组集 ((orderkey), ()) 的 GroupId 之后，表有以下 10 行</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orderkey   total_quantity    group_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1            5                0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2            6                0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2            7                0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     3            8                0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     4            9                0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     null         5                1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     null         6                1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     null         7                1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     null         8                1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     null         9                1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>随后使用分组键（orderkey、group_id）进行聚合，给出查询的小计</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orderkey   total_quantity     group_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1           5                  0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2           13                 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3           8                  0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4           9                  0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null        35                 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果此 GROUP BY CUBE 语句没有输入行，则预期结果为一行，其中包含全局聚合的默认值。对于上述查询，结果将是：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orderkey   total_quantity      group_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null           null             1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>要生成此特殊行，AggregationNode 需要全局分组集的 groupId（在本例中为 1），并返回一行包含聚合默认值的记录。</p>
<p>注意：Presto 允许在单个 SQL 查询中使用多个全局分组集。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#CF222E">SELECT</span><span class="token plain"> orderkey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">total_quantity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">FROM</span><span class="token plain"> orders </span><span class="token keyword" style="color:#CF222E">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">BY</span><span class="token plain"> GROUPING SETS </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>因此，globalGroupingSets 是 groupIds 的向量。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="expandnode">ExpandNode<a href="#expandnode" class="hash-link" aria-label="Direct link to ExpandNode" title="Direct link to ExpandNode">​</a></h3>
<p>对于每个输入行，根据指定的“projections”生成 N 行 M 列。
“projections”是一个 N x M 的表达式矩阵：一个 N 行 M 列的向量。
每个表达式可以是列引用或常量。常量可以为空，也可以为非空。
“names”是一个包含 M 个新列名的列表。此运算符的语义与 Spark 匹配。可以使用 project 和 unnest 来实
现扩展功能。但是，在 Project 操作中创建数组构造函数时，性能并不理想。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>projections</td><td>一个包含 N 行、每行 M 列的向量。每个表达式要么是列引用，要么是常量。</td></tr><tr><td>names</td><td>新列名的列表。</td></tr></tbody></table>
<p>ExpandNode 通常用于计算 GROUPING SETS、CUBE、ROLLUP 和 COUNT DISTINCT。</p>
<p>为了说明 ExpandNode 的工作原理，让我们检查以下 SQL 查询：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#CF222E">SELECT</span><span class="token plain"> l_orderkey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> l_partkey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">l_suppkey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">FROM</span><span class="token plain"> lineitem </span><span class="token keyword" style="color:#CF222E">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">BY</span><span class="token plain"> ROLLUP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">l_orderkey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> l_partkey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在规划阶段，Spark 会生成一个 Expand 运算符，其投影列表如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [l_suppkey, l_orderkey, l_partkey, 0],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [l_suppkey, l_orderkey, null,      1],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [l_suppkey, null,       null,      3]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意：最后一列用作特殊的组 ID，指示每行所属的分组集。在 Spark 中，此 ID 使用位掩码计算。如果选择了某一列，则该位
值赋值为 0；否则，赋值为 1。因此，第一行的二进制表示为 (000)，结果为 0。第二行的二进制表示为 (001)，结果为 1。第三行的二进制表示为 (011)，结果为 3。</p>
<p>例如，假设输入行如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  l_suppkey l_orderkey l_partkey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  93        1          673</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  75        2          674</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  38        3          22</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>经过 ExpandNode 计算后，每一行都会生成 3 行数据，所以一共有 9 行：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  l_suppkey l_orderkey l_partkey grouping_id_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  93        1          673       0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  93        1          null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  93        null       null      3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  75        2          674       0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  75        2          null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  75        null       null      3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  38        3          22        0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  38        3          null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  38        null       null      3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接下来的聚合运算符将这 9 行按 (l_orderkey、l_partkey、grouping_id_0) 分组，并计算 count(l_suppkey)：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  l_orderkey l_partkey count(l_suppkey)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1          673       1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  null       null      3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1          null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2          null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2          674       1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3          null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3          22        1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>另一个例子是 COUNT DISTINCT 查询。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#CF222E">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">DISTINCT</span><span class="token plain"> l_suppkey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">DISTINCT</span><span class="token plain"> l_partkey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">FROM</span><span class="token plain"> lineitem</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在规划阶段，Spark 会生成一个 Expand 运算符，其投影列表如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [l_suppkey, null,      1],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [null,      l_partkey, 2]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>例如，如果输入行是：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  l_suppkey l_partkey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  93        673     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  75        674      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  38        22</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>经过 ExpandNode 计算后，每一行都会生成 2 行数据，所以一共有 6 行：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  l_suppkey l_partkey grouping_id_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  93        null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  null      673       2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  75        null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  null      674       2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  38        null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  null      22        2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接下来的聚合运算符根据 <code>(l_suppkey, l_partkey, grouping_id_0)</code> 对这些行进行分组并生成：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  l_suppkey l_partkey grouping_id_0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  93        null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  75        null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  38        null      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  null      673       2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  null      674       2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  null      22        2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接下来的另一个聚合运算符计算全局计数（l_suppkey）和计数（l_partkey），产生最终结果：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  COUNT(DISTINCT l_suppkey) COUNT(DISTINCT l_partkey)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  3                         3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="groupidnode">GroupIdNode<a href="#groupidnode" class="hash-link" aria-label="Direct link to GroupIdNode" title="Direct link to GroupIdNode">​</a></h3>
<p>为每个指定的分组键集复制输入。用于
实现分组集的聚合。</p>
<p>输出由分组键、聚合输入和组 ID 列组成。组 ID 列的类型为 BIGINT。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>groupingSets</td><td>分组键集列表。每个集合中的键必须是唯一的，但键可以在集合之间重复。分组键通过其输出名称指定。</td></tr><tr><td>groupingKeyInfos</td><td>输出中分组键列的名称和顺序。</td></tr><tr><td>aggregationInputs</td><td>输入要复制的列。</td></tr><tr><td>groupIdName</td><td>标识分组集的 group-id 列的名称。该列以零为基数，对应于分组集在“groupingSets”列表中的位置。</td></tr></tbody></table>
<p>GroupIdNode 通常用于计算 GROUPING SETS、CUBE 和 ROLLUP。</p>
<p>虽然 GroupingSet 通常不会重复使用相同的分组键列，但在某些情况下可能会出现这种情况。为了说明 GroupingSet 为何会重复使用相同的分组键列，让我们检查以下 SQL 查询：</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#CF222E">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">orderkey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">DISTINCT</span><span class="token plain"> orderkey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">FROM</span><span class="token plain"> orders</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在此查询中，用户希望使用同一列计算全局聚合，无论是否使用 DISTINCT 子句。Presto 采用了一种特殊的优化策略：<code>optimize.mixed-distinct-aggregations &lt;https://www.qubole.com/blog/presto-optimizes-aggregations-over-distinct-values&gt;</code>，并使用 GroupIdNode 来计算这些聚合。</p>
<p>首先，优化器创建一个 GroupIdNode 来复制每一行，并将一份副本分配给组 0，另一份副本分配给组 1。这是通过使用 GroupIdNode 和两个分组集来实现的，每个分组集都使用 orderkey 作为分组键。为了消除组间的歧义，orderkey 列被设置为其中一个分组集的分组键。</p>
<p>假设 orders 表有 5 行：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  orderkey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>GroupIdNode 会将其转换为：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orderkey   orderkey1   group_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1             null        0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2             null        0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2             null        0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3             null        0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4             null        0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null           1          1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null           2          1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null           2          1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null           3          1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null           4          1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后，Presto 使用 (orderkey, group_id) 和 count(orderkey1) 进行聚合。</p>
<p>结果如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    orderkey     group_id     count(orderkey1) as c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1                0         null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2                0         null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3                0         null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4                0         null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    null             1          5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后，Presto 计划进行第二次聚合，其中没有键，并且 count(orderkey)，arbitrarily(c)。
由于这两个聚合都忽略空值，因此可以正确计算不同 orderkey 的数量以及所有 orderkey 的数量。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count(orderkey)     arbitrary(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     4                     5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="hashjoinnode-and-mergejoinnode">HashJoinNode and MergeJoinNode<a href="#hashjoinnode-and-mergejoinnode" class="hash-link" aria-label="Direct link to HashJoinNode and MergeJoinNode" title="Direct link to HashJoinNode and MergeJoinNode">​</a></h3>
<p>连接操作基于连接表达式，将两个独立的输入合并为一个输出。连接的一种常见子类型是等式连接，其中连接表达式被约束为连接的两个输入之间的等式（或等式 + 零等式）条件列表。</p>
<p>HashJoinNode 表示一种实现，它首先将连接右侧的所有行加载到哈希表中，然后流式传输连接左侧，探测哈希表中的匹配行并输出结果。</p>
<p>MergeJoinNode 表示一种实现，它假设两个输入都已按连接键排序，并流式传输连接两侧以查 找匹配的行并输出结果。</p>
<h1>表格转换</h1>
<p>以下是将给定内容转换为Markdown格式的表格：</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>joinType</td><td>Join type: inner, left, right, full, left semi filter, left semi project, right semi filter, right semi project, anti. <a href="https://dataschool.com/how-to-teach-people-sql/sql-join-types-explained-visually/" target="_blank" rel="noopener noreferrer">You can read about different join types in this blog post</a>.</td></tr><tr><td>nullAware</td><td>仅适用于反项目和半项目连接。指示连接语义是 IN（nullAware = true）还是 EXISTS（nullAware = false）。</td></tr><tr><td>leftKeys</td><td>左侧输入中属于相等条件的列。必须至少指定一个。</td></tr><tr><td>rightKeys</td><td>右侧输入中属于相等条件的列。必须至少指定一列。rightKeys 的数量和顺序必须与 leftKeys 的数量和顺序匹配。</td></tr><tr><td>filter</td><td>可选的非相等过滤表达式，可以引用来自两个输入的列。</td></tr><tr><td>outputType</td><td>输出列的列表。这是连接操作的左输入和右输入中可用列的子集。这些列的显示顺序可能与输入中的顺序不同。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nestedloopjoinnode">NestedLoopJoinNode<a href="#nestedloopjoinnode" class="hash-link" aria-label="Direct link to NestedLoopJoinNode" title="Direct link to NestedLoopJoinNode">​</a></h3>
<p>NestedLoopJoinNode 表示一种实现，它从连接左侧迭代每一行，并针对每一行从连接右侧迭代所有行，根据连接条件进行比较以查找匹配的行并发出结果。嵌套循环连接支持非等式连接，并按照与探测输入相同的顺序为每个执行线程发出输出行（对于内连接和左外连接）。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>joinType</td><td>Join type: inner, left, right, full.</td></tr><tr><td>joinCondition</td><td>用作连接条件的表达式可以引用来自两个输入的列。</td></tr><tr><td>outputType</td><td>输出列的列表。这是连接操作的左输入和右输入中可用列的子集。这些列的显示顺序可能与输入中的顺序不同。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="orderbynode">OrderByNode<a href="#orderbynode" class="hash-link" aria-label="Direct link to OrderByNode" title="Direct link to OrderByNode">​</a></h3>
<p>排序或排序依据操作会根据一个或多个已识别的排序字段以及排序顺序对数据集进行重新排序。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>sortingKeys</td><td>用于排序的一个或多个输入列的列表。排序键必须是唯一的。</td></tr><tr><td>sortingOrders</td><td>每个排序键的排序顺序。支持的顺序为：升序空值优先，升序空值最后，降序空值优先，降序空值最后。</td></tr><tr><td>isPartial</td><td>布尔值，指示排序操作是否仅处理数据集的一部分。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="topnnode">TopNNode<a href="#topnnode" class="hash-link" aria-label="Direct link to TopNNode" title="Direct link to TopNNode">​</a></h3>
<p>Top-n 操作会根据一个或多个已确定的排序字段以及排序顺序对数据集进行重新排序。Top-n 操作不会对整个数据集进行排序，而是仅维护确保有限输出所需的记录总数。Top-n 操作是逻辑排序和逻辑限制操作的组合。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>sortingKeys</td><td>用于排序的一个或多个输入列的列表。不得为空，且不得包含重复项。</td></tr><tr><td>sortingOrders</td><td>每个排序键的排序顺序。请参阅 OrderBy 获取支持的排序顺序列表。</td></tr><tr><td>count</td><td>返回的最大行数。</td></tr><tr><td>isPartial</td><td>布尔值指示操作是否仅处理数据集的一部分。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="limitnode">LimitNode<a href="#limitnode" class="hash-link" aria-label="Direct link to LimitNode" title="Direct link to LimitNode">​</a></h3>
<p>限制操作会跳过指定数量的输入行，然后保留指定数量的行并删除其余行。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>offset</td><td>要跳过的输入行数。</td></tr><tr><td>count</td><td>返回的最大行数。</td></tr><tr><td>isPartial</td><td>布尔值指示操作是否仅处理数据集的一部分。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="unnestnode">UnnestNode<a href="#unnestnode" class="hash-link" aria-label="Direct link to UnnestNode" title="Direct link to UnnestNode">​</a></h3>
<p>unnest 操作将数组和映射扩展为单独的列。数组会扩展为单列，映射会扩展为两列（键和值）。可用于扩展多列。在这种情
况下，会生成与基数最高的数组或映射一样多的行（其他列将用 null 填充）。也可以选择生成一个序数列，指定从 1 开始的行号。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>replicateVariables</td><td>未修改地返回的输入列。</td></tr><tr><td>unnestVariables</td><td>输入要扩展的数组或映射类型的列。</td></tr><tr><td>unnestNames</td><td>用于扩展列的名称。每个数组列一个名称。每个映射列两个名称。</td></tr><tr><td>ordinalityName</td><td>序数列的可选名称。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tablewritenode">TableWriteNode<a href="#tablewritenode" class="hash-link" aria-label="Direct link to TableWriteNode" title="Direct link to TableWriteNode">​</a></h3>
<p>表写入操作会消耗一个输出，并通过
:doc:<code>connector &lt;/develop/connectors&gt;</code> 将其写入存储。例如，写入 ORC 或 Parquet 文件。表写入操作会返回一个包含已写入数据元数据的列列表：写入存储的行数、写入器上下文信息、
已写入存储的文件路径以及收集的列统计信息。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>columns</td><td>要写入存储的输入列列表。这可能是不同顺序的输入列的子集。</td></tr><tr><td>columnNames</td><td>写入存储时使用的列名。这些列名可以与输入列名不同。</td></tr><tr><td>aggregationNode</td><td>可选聚合计划节点，用于收集写入存储的数据的列统计信息。</td></tr><tr><td>insertTableHandle</td><td>目标表的连接器特定描述。</td></tr><tr><td>outputType</td><td>包含已写入存储的数据的元数据的输出列的列表。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tablewritemergenode">TableWriteMergeNode<a href="#tablewritemergenode" class="hash-link" aria-label="Direct link to TableWriteMergeNode" title="Direct link to TableWriteMergeNode">​</a></h3>
<p>表写入合并操作聚合多个表写入操作的元数据输出并返回聚合结果。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>outputType</td><td>包含从多个表写入操作聚合的写入数据的元数据的输出列列表。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="partitionedoutputnode">PartitionedOutputNode<a href="#partitionedoutputnode" class="hash-link" aria-label="Direct link to PartitionedOutputNode" title="Direct link to PartitionedOutputNode">​</a></h3>
<p>分区输出操作根据零个或多个分布字段重新分配数据。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>kind</td><td>指定输出缓冲区类型：kPartitioned、kBroadcast 和 kArbitrary。对于 kPartitioned 类型，行会被分区，每行会被发送到相应的目标分区。对于 kBroadcast 类型，行不会被分区，而是会被发送到所有目标分区。对于 kArbitrary 类型，行不会被分区，每行会被发送到任意一个目标分区。</td></tr><tr><td>keys</td><td>用于计算每行分区的零个或多个输入字段。</td></tr><tr><td>numPartitions</td><td>将数据拆分成的分区数。</td></tr><tr><td>replicateNullsAndAny</td><td>布尔值标志，指示是否应将键为空的行发送到所有分区，以及如果不存在这样的行，是否应将任意选择的一行发送到所有分区。用于提供在单个节点上实现反连接语义所需的全局范围信息。</td></tr><tr><td>partitionFunctionFactory</td><td>工厂在计算输入行的分区时使用分区函数。</td></tr><tr><td>outputType</td><td>输出列的列表。这是输入列的子集，可能顺序不同。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="valuesnode">ValuesNode<a href="#valuesnode" class="hash-link" aria-label="Direct link to ValuesNode" title="Direct link to ValuesNode">​</a></h3>
<p>值操作返回指定的数据。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>values</td><td>要返回的行集。</td></tr><tr><td>parallelizable</td><td>如果每个线程（每个驱动程序一个）应产生相同的输入。</td></tr><tr><td>repeatTimes</td><td>每个向量应作为输入产生多少次。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="exchangenode">ExchangeNode<a href="#exchangenode" class="hash-link" aria-label="Direct link to ExchangeNode" title="Direct link to ExchangeNode">​</a></h3>
<p>以任意顺序合并多个流的接收操作。输入流来自远程交换或 shuffle。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>type</td><td>输入流中的列的列表。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mergeexchangenode">MergeExchangeNode<a href="#mergeexchangenode" class="hash-link" aria-label="Direct link to MergeExchangeNode" title="Direct link to MergeExchangeNode">​</a></h3>
<p>合并多个有序流以保持有序性的接收操作。输入流来自远程交换或混洗。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>type</td><td>输入流中的列的列表。</td></tr><tr><td>sortingKeys</td><td>要按其排序的一个或多个输入列的列表。</td></tr><tr><td>sortingOrders</td><td>每个排序键的排序顺序。请参阅 OrderBy 获取支持的排序顺序列表。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="localmergenode">LocalMergeNode<a href="#localmergenode" class="hash-link" aria-label="Direct link to LocalMergeNode" title="Direct link to LocalMergeNode">​</a></h3>
<p>合并多个有序流以保持其有序性的操作。输入流来自本地交换器。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>sortingKeys</td><td>要按其排序的一个或多个输入列的列表。</td></tr><tr><td>sortingOrders</td><td>每个排序键的排序顺序。请参阅 OrderBy 获取支持的排序顺序列表。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="localpartitionnode">LocalPartitionNode<a href="#localpartitionnode" class="hash-link" aria-label="Direct link to LocalPartitionNode" title="Direct link to LocalPartitionNode">​</a></h3>
<p>本地交换操作将输入数据划分为多个流，或将来自多个流的数据合并为一个流。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>Type</td><td>交换类型：收集或重新分配。</td></tr><tr><td>partitionFunctionFactory</td><td>工厂在计算输入行的分区时使用分区函数。</td></tr><tr><td>outputType</td><td>输出列的列表。这是输入列的子集，可能顺序不同。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="enforcesinglerownode">EnforceSingleRowNode<a href="#enforcesinglerownode" class="hash-link" aria-label="Direct link to EnforceSingleRowNode" title="Direct link to EnforceSingleRowNode">​</a></h3>
<p>强制单行操作会检查输入是否最多包含一行，并
返回未修改的该行。如果输入为空，则返回一行，所有值都设置为空。如果输入包含多行，则会引发异常。</p>
<p>用于包含不相关子查询的查询。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="assignuniqueidnode">AssignUniqueIdNode<a href="#assignuniqueidnode" class="hash-link" aria-label="Direct link to AssignUniqueIdNode" title="Direct link to AssignUniqueIdNode">​</a></h3>
<p>分配唯一 ID 操作会在输入列的末尾添加一列，每行都有一个唯一值。此唯一值标记每个输出行在该运算符的所有输出行中都是唯一的。</p>
<p>64 位唯一 ID 的构建方式如下：</p>
<ul>
<li>前 24 位 - 任务唯一 ID</li>
<li>接下来的 40 位 - 运算符计数器值</li>
</ul>
<p>添加任务唯一 ID 是为了确保生成的 ID 在分布式查询执行中执行同一查询阶段的所有节点上都是唯一的。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>idName</td><td>生成的唯一 ID 列的列名。</td></tr><tr><td>taskUniqueId</td><td>一个 24 位整数，用于唯一标识所有节点上的任务 ID。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windownode">WindowNode<a href="#windownode" class="hash-link" aria-label="Direct link to WindowNode" title="Direct link to WindowNode">​</a></h3>
<p>窗口运算符用于评估窗口函数。该运算符在输入列的末尾添加用于窗口函数输出的列。</p>
<p>窗口运算符根据分区列的值将输入数据分组到各个分区中。如果未指定分区列，则所有输入行都被视为位于同一分区中。
在每个分区中，行都按排序列的值排序。
窗口函数会按照此顺序逐行计算。
如果未指定排序列，则  结果的顺序未指定。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>partitionKeys</td><td>按窗口函数的列进行分区。</td></tr><tr><td>sortingKeys</td><td>按窗口函数的列排序。</td></tr><tr><td>sortingOrders</td><td>上述每个排序键的排序顺序。支持的排序顺序为：asc nulls first、asc nulls last、desc nulls first 和 desc nulls last。</td></tr><tr><td>windowColumnNames</td><td>输出下面 windowFunctions 列表中每个窗口函数调用的列名。</td></tr><tr><td>windowFunctions</td><td>带有 frame 子句的窗口函数调用。例如，row_number()、first_value(name) 介于范围 10 的上一行和当前行之间。默认 frame 介于范围无界的上一行和当前行之间。</td></tr><tr><td>inputsSorted</td><td>如果为 true，Window 算子会假定输入按分区键进行聚类，并按排序键按排序顺序进行排序。在这种情况下，算子会在收到数据后立即拆分窗口分区并开始处理。如果为 false，Window 算子会先累积所有输入，然后对数据进行排序，并根据定义的条件拆分窗口分区，最后按顺序处理每个窗口分区。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rownumbernode">RowNumberNode<a href="#rownumbernode" class="hash-link" aria-label="Direct link to RowNumberNode" title="Direct link to RowNumberNode">​</a></h3>
<p>WindowNode 的优化版本，包含单个 row_number 函数、
可选的限制，且不包含排序。</p>
<p>使用指定的分区键对输入进行分区，并为每个分区分配从 1 开始的行号。该运算符以流式模式运行。对于
每一批输入，它都会计算并返回结果，然后再接受下一批输入。</p>
<p>该运算符会累积状态：一个哈希表，将分区键映射到此分区中迄今为止已查看的总行数。将行号作为输出中的一列返回是可选的。该运算符支持溢出。</p>
<p>该运算符相当于一个 WindowNode，后跟 <code>FilterNode(row_number &lt;= limit)</code>，但它占用的内存和 CPU 更少，并且在查看所有输入之前即可获得结果。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>partitionKeys</td><td>按列分区。</td></tr><tr><td>rowNumberColumnName</td><td>可选的行号输出列名。如果指定，则生成的行号将作为输出列返回，该输出列位于所有输入列之后。</td></tr><tr><td>limit</td><td>可选的每个分区限制。如果指定，则此节点生成的任何给定分区的行数都不会超过此值。多余的行将被丢弃。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="topnrownumbernode">TopNRowNumberNode<a href="#topnrownumbernode" class="hash-link" aria-label="Direct link to TopNRowNumberNode" title="Direct link to TopNRowNumberNode">​</a></h3>
<p>WindowNode 的优化版本，带有单个 row_number 函数，并对已排序的分区设置了限制。</p>
<p>使用指定的分区键对输入进行分区，并为每个分区维护最多“限制”行数。接收所有输入后，
从 1 开始为每个分区分配行号。</p>
<p>此运算符累积状态：一个哈希表，将分区键映射到该分区内“限制”行数的列表。将行号作为输出中的一列返回是可选的。此运算符也支持溢出。</p>
<p>此运算符逻辑上等同于 WindowNode 后跟 <code>FilterNode(row_number &lt;= limit)</code>，但它占用的内存和 CPU 更少。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>partitionKeys</td><td>按列分区。</td></tr><tr><td>rowNumberColumnName</td><td>可选的行号输出列名。如果指定，则生成的行号将作为输出列返回，该输出列位于所有输入列之后。</td></tr><tr><td>limit</td><td>可选的每个分区限制。如果指定，则此节点生成的任何给定分区的行数都不会超过此值。多余的行将被丢弃。</td></tr></tbody></table>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="markdistinctnode">MarkDistinctNode<a href="#markdistinctnode" class="hash-link" aria-label="Direct link to MarkDistinctNode" title="Direct link to MarkDistinctNode">​</a></h3>
<p>MarkDistinct 运算符用于生成针对不同值进行聚合的聚合掩码列，例如 agg(DISTINCT a)。
掩码是一个布尔值列，对于一组输入行子集，设置为 true，这些子集共同表示一组“distinctKeys”的唯一值。</p>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>markerName</td><td>输出掩码列的名称。</td></tr><tr><td>distinctKeys</td><td>分组键的名称。</td></tr></tbody></table>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="join">Join<a href="#join" class="hash-link" aria-label="Direct link to Join" title="Direct link to Join">​</a></h3>
<p>带有连接的查询计划包含一个 HashJoinNode。此类计划会被转换为两个管道：构建管道和探测管道。构建管道处理来自连接构建端
的输入，并使用 HashBuild 运算符构建哈希表。探测管道处理来自连接探测端的输入，探测哈希表并生成符合连接条件的行。构建管
道通过一种名为 JoinBridge 的特殊机制将哈希表提供给探测管道。
JoinBridge 就像一个 Future，其中 HashBuild 运算符以 HashTable 作为结果完成 Future，而 HashProbe 运算符在 Future 完成时接收该 HashTable。</p>
<p>每个管道可以以不同的并行度运行。在下面的示例中，探测管道在 2 个线程上运行，而构建管道在 3 个线程上运行。当构建管道以多
线程运行时，每个管道都会处理一部分构建端输入。最后完成处理的管道负责合并来自其他管道的哈希表，并将最终表发布到 JoinBridge。
当右外连接的探测管道以多线程运  行时，最后完成处理的管道负责从构建端发出不符合连接条件的行。</p>
<!-- -->
<img width="400" align="center" src="[object Object]">
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="local-exchange">Local Exchange<a href="#local-exchange" class="hash-link" aria-label="Direct link to Local Exchange" title="Direct link to Local Exchange">​</a></h3>
<p>局部交换操作有多种用途。它可用于将数据处理的并行性从多线程转换为单线程，或反之。例如，局部交换可用于排序操作，其中部分
排序在多线程中运行，然后在单线程上合并结果。局部交换操作也可用于合并多个流水线的结果。例如，合并 UNION 或 UNION ALL 的多个输入。</p>
<p>以下是一些示例。</p>
<p>N 对 1 局部交换可用于合并部分排序的结果，以便最终进行合并排序。</p>
<!-- -->
<img width="400" align="center" src="[object Object]">
<p>在必须单线程运行的操作之后，进行一对多本地交换以增加并行度。</p>
<!-- -->
<img width="400" align="center" src="[object Object]">
<p>本地交换用于合并来自多个管道的数据，例如 UNION ALL。</p>
<!-- -->
<img width="400" align="center" src="[object Object]"></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-05-25T03:28:26.000Z" itemprop="dateModified">May 25, 2025</time></b> by <b>Jeff lothar</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/pollux/develop/anti-join"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Anti joins</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/pollux/develop/task"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">What&#x27;s in the Task?</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#plan-nodes" class="table-of-contents__link toc-highlight">Plan Nodes</a><ul><li><a href="#tablescannode" class="table-of-contents__link toc-highlight">TableScanNode</a></li><li><a href="#arrowstreamnode" class="table-of-contents__link toc-highlight">ArrowStreamNode</a></li><li><a href="#filternode" class="table-of-contents__link toc-highlight">FilterNode</a></li><li><a href="#projectnode" class="table-of-contents__link toc-highlight">ProjectNode</a></li><li><a href="#aggregationnode" class="table-of-contents__link toc-highlight">AggregationNode</a></li><li><a href="#expandnode" class="table-of-contents__link toc-highlight">ExpandNode</a></li><li><a href="#groupidnode" class="table-of-contents__link toc-highlight">GroupIdNode</a></li><li><a href="#hashjoinnode-and-mergejoinnode" class="table-of-contents__link toc-highlight">HashJoinNode and MergeJoinNode</a></li><li><a href="#nestedloopjoinnode" class="table-of-contents__link toc-highlight">NestedLoopJoinNode</a></li><li><a href="#orderbynode" class="table-of-contents__link toc-highlight">OrderByNode</a></li><li><a href="#topnnode" class="table-of-contents__link toc-highlight">TopNNode</a></li><li><a href="#limitnode" class="table-of-contents__link toc-highlight">LimitNode</a></li><li><a href="#unnestnode" class="table-of-contents__link toc-highlight">UnnestNode</a></li><li><a href="#tablewritenode" class="table-of-contents__link toc-highlight">TableWriteNode</a></li><li><a href="#tablewritemergenode" class="table-of-contents__link toc-highlight">TableWriteMergeNode</a></li><li><a href="#partitionedoutputnode" class="table-of-contents__link toc-highlight">PartitionedOutputNode</a></li><li><a href="#valuesnode" class="table-of-contents__link toc-highlight">ValuesNode</a></li><li><a href="#exchangenode" class="table-of-contents__link toc-highlight">ExchangeNode</a></li><li><a href="#mergeexchangenode" class="table-of-contents__link toc-highlight">MergeExchangeNode</a></li><li><a href="#localmergenode" class="table-of-contents__link toc-highlight">LocalMergeNode</a></li><li><a href="#localpartitionnode" class="table-of-contents__link toc-highlight">LocalPartitionNode</a></li><li><a href="#enforcesinglerownode" class="table-of-contents__link toc-highlight">EnforceSingleRowNode</a></li><li><a href="#assignuniqueidnode" class="table-of-contents__link toc-highlight">AssignUniqueIdNode</a></li><li><a href="#windownode" class="table-of-contents__link toc-highlight">WindowNode</a></li><li><a href="#rownumbernode" class="table-of-contents__link toc-highlight">RowNumberNode</a></li><li><a href="#topnrownumbernode" class="table-of-contents__link toc-highlight">TopNRowNumberNode</a></li><li><a href="#markdistinctnode" class="table-of-contents__link toc-highlight">MarkDistinctNode</a></li></ul></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href="#join" class="table-of-contents__link toc-highlight">Join</a></li><li><a href="#local-exchange" class="table-of-contents__link toc-highlight">Local Exchange</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">阅读</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">文档</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation">安装</a></li></ul></div><div class="col footer__col"><div class="footer__title">支持与资源</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/feature-requests">Feature Requests</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/community/support">Help</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">博客</a></li><li class="footer__item"><a class="footer__link-item" href="/changelog">更新</a></li><li class="footer__item"><a href="https://gitee.com/kumo-pub" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kumo-ai.tech" target="_blank" rel="noopener noreferrer" class="footer__link-item">网站<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">版权 © 2025 北京科米智创科技有限公司</div></div></div></footer></div>
</body>
</html>