<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-1.1.1 docs-doc-page docs-doc-id-pollux/develop/tpch-benchmark" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">I/O Optimizations and the TpchBenchmark | Kumo AI</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kumo-pub.github.io/img/kumo_logo.svg"><meta data-rh="true" name="twitter:image" content="https://kumo-pub.github.io/img/kumo_logo.svg"><meta data-rh="true" property="og:url" content="https://kumo-pub.github.io/docs/pollux/develop/tpch-benchmark"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.1.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.1.1"><meta data-rh="true" name="docsearch:version" content="1.1.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.1.1"><meta data-rh="true" property="og:title" content="I/O Optimizations and the TpchBenchmark | Kumo AI"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://kumo-pub.github.io/docs/pollux/develop/tpch-benchmark"><link data-rh="true" rel="alternate" href="https://kumo-pub.github.io/docs/pollux/develop/tpch-benchmark" hreflang="en"><link data-rh="true" rel="alternate" href="https://kumo-pub.github.io/docs/pollux/develop/tpch-benchmark" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kumo AI RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kumo AI Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Kumo AI JSON Feed">


<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E5CR2Q1NRE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E5CR2Q1NRE",{})</script>


<link rel="alternate" type="application/rss+xml" href="/changelog/rss.xml" title="Docusaurus changelog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/changelog/atom.xml" title="Docusaurus changelog Atom Feed">
<link rel="alternate" type="application/json" href="/changelog/feed.json" title="Docusaurus changelog JSON Feed">



<link rel="icon" href="/img/favicon.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/favicon.png">
<link rel="mask-icon" href="/img/favicon.png" color="rgb(62, 204, 94)">
<meta name="msapplication-TileImage" content="/img/favicon.png">
<meta name="msapplication-TileColor" content="#000">



<link rel="alternate" type="application/rss+xml" href="/tests/blog/rss.xml" title="Docusaurus Tests Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tests/blog/atom.xml" title="Docusaurus Tests Blog Atom Feed">
<link rel="alternate" type="application/json" href="/tests/blog/feed.json" title="Docusaurus Tests Blog JSON Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Kumo AI" href="/opensearch.xml">

<link rel="stylesheet" href="/katex/katex.min.css"><link rel="stylesheet" href="/assets/css/styles.21fbef88.css">
<script src="/assets/js/runtime~main.dbfb52d2.js" defer="defer"></script>
<script src="/assets/js/main.94389b5b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme-b4f")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss-b4f")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">üéâÔ∏è <b><a target="_blank" href="https://docusaurus.io/blog/releases/1.1">Kumo v1.1</a> is out!</b> ü•≥Ô∏è</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/kumo_logo.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE" height="48" width="128"><img src="/img/kumo_logo_white.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="48" width="128"></div><b class="navbar__title text--truncate">‰∏ªÈ°µ</b></a><a class="navbar__item navbar__link" href="/docs">ÊñáÊ°£</a><a class="navbar__item navbar__link" href="/docs/category/kmsearch">API</a><a class="navbar__item navbar__link" href="/blog">ÂçöÂÆ¢</a><a class="navbar__item navbar__link" href="/changelog">ÂèëÂ∏É</a><a class="navbar__item navbar__link" href="/showcase">Â∫îÁî®Ê°à‰æã</a><a class="navbar__item navbar__link" href="/community/support">ÊîØÊåÅ‰∏éËµÑÊ∫ê</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/pollux/develop/tpch-benchmark">1.1.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next">nightly üöß</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/pollux/develop/tpch-benchmark">1.1.1</a></li><li><hr class="dropdown-separator"></li><li class="dropdown-archived-versions"><b>Archived versions</b></li><li><a href="https://docusaurus-archive-october-2023.netlify.app/docs/2.3.1" target="_blank" rel="noopener noreferrer" class="dropdown__link">1.0.1<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://v1.docusaurus.io" target="_blank" rel="noopener noreferrer" class="dropdown__link">1.x.x<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><hr class="dropdown-separator"></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/pollux/develop/tpch-benchmark" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://github.com/facebook/docusaurus/issues/3526" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help Us Translate<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 1.1.1</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>I/O Optimizations and the TpchBenchmark</h1></header>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">‚Äã</a></h2>
<p>This document is the outcome from a cycle of benchmarking to determine the best
I/O performance against AWS S3 Parquet data for TPCH. It is intended to describe
the tuning process recommendations and general suggestions for tuning the Pollux
query engine.</p>
<p>Benchmarking in Pollux is made easy with the optionally built TpchBenchmark
(pollux_tpch_benchmark) executable. To build the benchmark executable
(<em>_build/release/pollux/benchamrks/tpch/pollux_tpch_benchmark</em>), use the
following command line to do the build with S3 support:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   $ </span><span class="token function" style="color:#8250DF">make</span><span class="token plain"> benchmarks-build </span><span class="token assign-left variable" style="color:#E36209">EXTRA_CMAKE_FLAGS</span><span class="token operator" style="color:#D73A49">=</span><span class="token string" style="color:#C6105F">&quot;-DPOLLUX_ENABLE_S3=ON&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="use-cases-for-pollux">Use Cases for Pollux<a href="#use-cases-for-pollux" class="hash-link" aria-label="Direct link to Use Cases for Pollux" title="Direct link to Use Cases for Pollux">‚Äã</a></h2>
<p>Pollux is a library so there are multiple ways to use it. This document will
describe two models used by popular applications.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="in-process-multi-threaded-executor-use-case">In-Process Multi-Threaded Executor Use Case<a href="#in-process-multi-threaded-executor-use-case" class="hash-link" aria-label="Direct link to In-Process Multi-Threaded Executor Use Case" title="Direct link to In-Process Multi-Threaded Executor Use Case">‚Äã</a></h2>
<p>This use case is used by <code>Presto &lt;https://github.com/prestodb/presto&gt;</code>_ and, as
it turns out, is the use case used by the <em>Pollux TpchBenchmark Tool</em> below.
This use case uses a single multi-threaded process to perform execution of
queries in parallel. Each query is broken up into threads called <strong>drivers</strong>
via a planning algorithm.  Each <strong>driver</strong> may also have a thread pool to
perform I/O in a parallel manner. In the benchmarking tool both <strong>driver</strong>
thread count, and I/O thread count are exposed as command line configuration
options. In this use case, care must be taken to not create too many threads
since maximum number of threads is a product of <strong>driver</strong> threads and I/O
threads. In this use case, the application owns creating <strong>drivers</strong> and I/O
Thread pools for Pollux. In the case of the benchmark tool, the tool is
responsible for both <strong>driver</strong> threads and I/O threads.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="multiple-process-executor-use-case">Multiple Process Executor Use Case<a href="#multiple-process-executor-use-case" class="hash-link" aria-label="Direct link to Multiple Process Executor Use Case" title="Direct link to Multiple Process Executor Use Case">‚Äã</a></h2>
<p>This use case is used by Spark + <code>Gluten &lt;https://github.com/oap-project/gluten&gt;</code>_
and it differs from the Presto use case where parallelism is concerned. Spark
uses multiple processes where each process is a Gluten+Pollux query processor.
Spark scales by using many Linux processes for query processing. In this case
this means that the <strong>drivers</strong> are outside of Pollux and Gluten and is defined
by the Spark configuration and number of workers. Gluten takes on the role of
creating and exposing the I/O thread pool count to Spark as configuration and
then injecting the I/O thread pool into Pollux for parallel I/O.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="built-in-tpchbenchmark">Built-In TpchBenchmark<a href="#built-in-tpchbenchmark" class="hash-link" aria-label="Direct link to Built-In TpchBenchmark" title="Direct link to Built-In TpchBenchmark">‚Äã</a></h2>
<p>This tool uses the &quot;in-process&quot; multi-threaded executor use case. This tool
exposes quite a few benchmark options as command line options. It also
exposes many Pollux internal options. This document will only cover a subset
of the options and possible best-known values for them.</p>
<p>The setup used in experiments leading to this document was an AWS instance
ri6-8xlarge (32 vCPUs; 256GB RAM). The values (or formulas) below are based on
these experiments.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tpchbenchmark-tool-optimizations-in-pollux">TpchBenchmark Tool Optimizations in Pollux<a href="#tpchbenchmark-tool-optimizations-in-pollux" class="hash-link" aria-label="Direct link to TpchBenchmark Tool Optimizations in Pollux" title="Direct link to TpchBenchmark Tool Optimizations in Pollux">‚Äã</a></h2>
<p>The tool exposes the following options (Note: When passing options for the tool
use a single dash not a double dash; i.e. -option and not --option):</p>
<ul>
<li>
<p><em>num_drivers</em> - As described above this represent the number of drivers or
executors used to process the TPC-H queries.</p>
</li>
<li>
<p><em>num_io_threads</em> - This represents the number of I/O threads used per
<strong>driver</strong> for I/O.</p>
</li>
<li>
<p><em>cache_gb</em> - How much memory is used for caching data locally in this
process. Memory caching cannot be shared in the multiple process executor use
case but works well in the single process, multi-threaded use case.</p>
</li>
<li>
<p><em>num_splits_per_file</em> - This is a row group optimization for the stored
dataset for benchmarking.</p>
</li>
</ul>
<p><strong>NOTE:</strong> *There is a limitation on the implementation of the AWS SDK that
will cause failures (curl error 28) if the <strong>driver</strong> *threads times I/O threads
grow much beyond 350 threads. This only really effects the multi-threaded
<strong>drivers</strong> <em>use case like the benchmark tool. It is only known to be an issue
when running against AWS S3. However, the error is coming from the libcurl
library so it is possible other Cloud storage APIs could also be affected.</em></p>
<p>Pollux exposes other options used for tuning that are of interest:</p>
<ul>
<li>
<p><em>max_coalesce_bytes</em> - Size of coalesced data, has small improvements as size
grows.</p>
</li>
<li>
<p><em>max_coalesce_distance_bytes</em> - Maximum gap bytes between data that can
coalesced. Larger may mean more fetched data but at greater bytes/sec.</p>
</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="top-optimization-recommendations">Top Optimization Recommendations<a href="#top-optimization-recommendations" class="hash-link" aria-label="Direct link to Top Optimization Recommendations" title="Direct link to Top Optimization Recommendations">‚Äã</a></h2>
<p>.. csv-table:: Starting Point for Tuning
:header: &quot;Option Name&quot;, &quot;Single Process&quot;, &quot;Multi-Process&quot;
:widths: auto</p>
<p>&quot;num_drivers&quot;,<code>max(20, vCPUs&lt;super&gt;*&lt;/super&gt; X 3 / 4)</code>,&quot;NA&quot;
&quot;num_io_threads&quot;, <code>max(16, vCPUs&lt;super&gt;*&lt;/super&gt; X 3 / 8)</code>, &quot;vCPUs*&quot;
&quot;cache_gb&quot;, &quot;50% System RAM&quot;, &quot;NA (default = 0)&quot;
&quot;num_splits_per_file&quot;, &quot;Row Group Size of Data&quot;, &quot;Row Group Size of Data&quot;
&quot;max_coalesced_bytes&quot;, &quot;Minimum of 90MB&quot;, &quot;Minimum of 90MB&quot;
&quot;max_coalesced_distance_bytes&quot;, &quot;Workload dependent**&quot;, &quot;Workload dependent**&quot;
&quot;parquet_prefetch_rowgroups&quot;, &quot;Best is 1&quot;, &quot;Best is 1&quot;
&quot;split_preload_per_driver&quot;, &quot;Best is 2&quot;, &quot;Best is 2&quot;
&quot;cache_prefetch_min_pct&quot;, &quot;Best is 80&quot;, &quot;Best is 80&quot;</p>
<p>*  vCPUs = (cores * hyper-threads)</p>
<p>** Wide tables and few columns retrieved per row can lead to many I/O
requests, suggest increasing this value based on testing and the need to
reduce small I/O requests.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="optimizations-for-the-tpchbenchmark-single-process-use-case">Optimizations for the TpchBenchmark (Single Process Use Case)<a href="#optimizations-for-the-tpchbenchmark-single-process-use-case" class="hash-link" aria-label="Direct link to Optimizations for the TpchBenchmark (Single Process Use Case)" title="Direct link to Optimizations for the TpchBenchmark (Single Process Use Case)">‚Äã</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="num_drivers"><strong>num_drivers</strong><a href="#num_drivers" class="hash-link" aria-label="Direct link to num_drivers" title="Direct link to num_drivers">‚Äã</a></h2>
<p>This configuration option describes the number of resources available to
process query plan tasks. This can greatly improve performance of CPU bound
workloads. The recommendation in the table above seems to be optimal for
TPCH-like workloads.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="num_io_threads"><strong>num_io_threads</strong><a href="#num_io_threads" class="hash-link" aria-label="Direct link to num_io_threads" title="Direct link to num_io_threads">‚Äã</a></h2>
<p>This configuration option describes the number of threads available per driver
to retrieve data from the network source. If the workload is I/O bound, then
increasing this number is beneficial if the data is fewer requests of larger
chunks as opposed to many smaller requests.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cache_gb"><strong>cache_gb</strong><a href="#cache_gb" class="hash-link" aria-label="Direct link to cache_gb" title="Direct link to cache_gb">‚Äã</a></h2>
<p>This configuration option is useful for workloads that read the same data
several times per query but only applies to the single process use case.
<em>NOTE: There is a SSD Caching option in Pollux but it to is ONLY useful in
the single process use case.</em></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="num_splits_per_file"><strong>num_splits_per_file</strong><a href="#num_splits_per_file" class="hash-link" aria-label="Direct link to num_splits_per_file" title="Direct link to num_splits_per_file">‚Äã</a></h2>
<p>This configuration option is best when the data set count of row groups
matches this value. The affect in overall performance appears based on
testing to be small, however.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="optimizations-for-all-workloads-both-use-cases">Optimizations for All Workloads (Both Use Cases)<a href="#optimizations-for-all-workloads-both-use-cases" class="hash-link" aria-label="Direct link to Optimizations for All Workloads (Both Use Cases)" title="Direct link to Optimizations for All Workloads (Both Use Cases)">‚Äã</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="max_coalesce_bytes"><strong>max_coalesce_bytes</strong><a href="#max_coalesce_bytes" class="hash-link" aria-label="Direct link to max_coalesce_bytes" title="Direct link to max_coalesce_bytes">‚Äã</a></h3>
<p>This configuration option is the maximum bytes coalesced into a single request
to the data source. This was tested from the default 128MB to 2GB, and the
overall improvement was small as size increased. Capturing request data did
show larger and fewer requests but not enough to vastly improve I/O performance.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="max_coalesce_distance_bytes"><strong>max_coalesce_distance_bytes</strong><a href="#max_coalesce_distance_bytes" class="hash-link" aria-label="Direct link to max_coalesce_distance_bytes" title="Direct link to max_coalesce_distance_bytes">‚Äã</a></h3>
<p>This configuration option is the maximum byte distance between needed data in
the same file at the data source that can be coalesced. Increasing this value
would theoretically reduce the number of requests and increase each request
size. However, if made too large the query will return too many un-needed bytes
and could decrease I/O performance. This plus <strong>max_coalesce_bytes</strong> should be
fine-tuned for the workload being run.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">‚Äã</a></h2>
<p>If a use of Pollux matches the use case of the TcphBenchmark then it is a good
tool to test, I/O and driver performance for specific TCP-H queries. This would
benefit execution of specific production workloads that are like the chosen
queries. If in multi-process use case, like Spark/Gluten/Pollux configuration,
the recommendation is to oversubscribe I/O threads between 2X and 3X vCPUs and
tune the 2 coalesce configurations exposed.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="appendix-a-tpchbenchmark-tool-help-output">Appendix A: TpchBenchmark Tool Help Output<a href="#appendix-a-tpchbenchmark-tool-help-output" class="hash-link" aria-label="Direct link to Appendix A: TpchBenchmark Tool Help Output" title="Direct link to Appendix A: TpchBenchmark Tool Help Output">‚Äã</a></h2>
<p>From the repository root, use the following command line to see all the
available flags in the TpchBenchmark tool.</p>
<p>.. code:: shell</p>
<p>$ ./_build/release/pollux/benchmarks/tpch/pollux_tpch_benchmark -helpon=TpchBenchmark</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-05-25T03:28:26.000Z" itemprop="dateModified">May 25, 2025</time></b> by <b>Jeff lothar</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#use-cases-for-pollux" class="table-of-contents__link toc-highlight">Use Cases for Pollux</a></li><li><a href="#in-process-multi-threaded-executor-use-case" class="table-of-contents__link toc-highlight">In-Process Multi-Threaded Executor Use Case</a></li><li><a href="#multiple-process-executor-use-case" class="table-of-contents__link toc-highlight">Multiple Process Executor Use Case</a></li><li><a href="#built-in-tpchbenchmark" class="table-of-contents__link toc-highlight">Built-In TpchBenchmark</a></li><li><a href="#tpchbenchmark-tool-optimizations-in-pollux" class="table-of-contents__link toc-highlight">TpchBenchmark Tool Optimizations in Pollux</a></li><li><a href="#top-optimization-recommendations" class="table-of-contents__link toc-highlight">Top Optimization Recommendations</a></li><li><a href="#optimizations-for-the-tpchbenchmark-single-process-use-case" class="table-of-contents__link toc-highlight">Optimizations for the TpchBenchmark (Single Process Use Case)</a></li><li><a href="#num_drivers" class="table-of-contents__link toc-highlight"><strong>num_drivers</strong></a></li><li><a href="#num_io_threads" class="table-of-contents__link toc-highlight"><strong>num_io_threads</strong></a></li><li><a href="#cache_gb" class="table-of-contents__link toc-highlight"><strong>cache_gb</strong></a></li><li><a href="#num_splits_per_file" class="table-of-contents__link toc-highlight"><strong>num_splits_per_file</strong></a></li><li><a href="#optimizations-for-all-workloads-both-use-cases" class="table-of-contents__link toc-highlight">Optimizations for All Workloads (Both Use Cases)</a><ul><li><a href="#max_coalesce_bytes" class="table-of-contents__link toc-highlight"><strong>max_coalesce_bytes</strong></a></li><li><a href="#max_coalesce_distance_bytes" class="table-of-contents__link toc-highlight"><strong>max_coalesce_distance_bytes</strong></a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#appendix-a-tpchbenchmark-tool-help-output" class="table-of-contents__link toc-highlight">Appendix A: TpchBenchmark Tool Help Output</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ÈòÖËØª</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">ÊñáÊ°£</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation">ÂÆâË£Ö</a></li></ul></div><div class="col footer__col"><div class="footer__title">ÊîØÊåÅ‰∏éËµÑÊ∫ê</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/feature-requests">Feature Requests</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/community/support">Help</a></li></ul></div><div class="col footer__col"><div class="footer__title">Êõ¥Â§ö</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">ÂçöÂÆ¢</a></li><li class="footer__item"><a class="footer__link-item" href="/changelog">Êõ¥Êñ∞</a></li><li class="footer__item"><a href="https://gitee.com/kumo-pub" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kumo-ai.tech" target="_blank" rel="noopener noreferrer" class="footer__link-item">ÁΩëÁ´ô<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">ÁâàÊùÉ ¬© 2025 Âåó‰∫¨ÁßëÁ±≥Êô∫ÂàõÁßëÊäÄÊúâÈôêÂÖ¨Âè∏</div></div></div></footer></div>
</body>
</html>