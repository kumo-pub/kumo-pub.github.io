"use strict";(self.webpackChunkkumo_website=self.webpackChunkkumo_website||[]).push([[76221],{55040:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>o,frontMatter:()=>s,metadata:()=>c,toc:()=>t});var l=i(74848),r=i(28453);const s={date:"01/10/2024"},a="\u6559\u7a0b\uff1a\u5b89\u88c5\u672c\u5730\u4fee\u6539\u7684\u4f9d\u8d56\u9879",c={id:"kmpkg/consume/install-locally-modified-package",title:"\u6559\u7a0b\uff1a\u5b89\u88c5\u672c\u5730\u4fee\u6539\u7684\u4f9d\u8d56\u9879",description:"\u672c\u6559\u7a0b\u5411\u60a8\u5c55\u793a\u5982\u4f55\u4fee\u6539 kmpkg \u7aef\u53e3\u5e76\u4f7f\u7528\u8986\u76d6\u5b89\u88c5\u5b83",source:"@site/versioned_docs/version-1.1.1/kmpkg/consume/install-locally-modified-package.mdx",sourceDirName:"kmpkg/consume",slug:"/kmpkg/consume/install-locally-modified-package",permalink:"/docs/kmpkg/consume/install-locally-modified-package",draft:!1,unlisted:!1,tags:[],version:"1.1.1",lastUpdatedBy:"Jeff lothar",lastUpdatedAt:1748081772e3,frontMatter:{date:"01/10/2024"},sidebar:"docs",previous:{title:"\u6559\u7a0b\uff1a \u5b89\u88c5\u81ea\u5b9a\u4e49\u4f9d\u8d56\u9879",permalink:"/docs/category/\u6559\u7a0b-\u5b89\u88c5\u81ea\u5b9a\u4e49\u4f9d\u8d56\u9879"},next:{title:"\u6559\u7a0b\uff1a\u4ece\u57fa\u4e8e Git \u7684\u6ce8\u518c\u8868\u5b89\u88c5\u4f9d\u8d56\u9879",permalink:"/docs/kmpkg/consume/git-registries"}},d={},t=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"1 - \u521b\u5efa\u8986\u76d6\u7aef\u53e3",id:"create-an-overlay-port",level:2},{value:"\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\u6765\u4fdd\u5b58\u60a8\u7684\u8986\u76d6\u7aef\u53e3",id:"\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\u6765\u4fdd\u5b58\u60a8\u7684\u8986\u76d6\u7aef\u53e3",level:3},{value:"\u5c06\u7aef\u53e3\u7684\u5185\u5bb9\u590d\u5236\u5230\u8986\u76d6\u7aef\u53e3\u76ee\u5f55\u4e2d",id:"\u5c06\u7aef\u53e3\u7684\u5185\u5bb9\u590d\u5236\u5230\u8986\u76d6\u7aef\u53e3\u76ee\u5f55\u4e2d",level:3},{value:"2 -\u83b7\u53d6\u7aef\u53e3\u7684\u6e90\u4ee3\u7801",id:"get-the-ports-source-code",level:2},{value:"3 - \u521b\u5efa\u4e34\u65f6 Git \u6ce8\u518c\u8868",id:"create-a-temporary-git-registry",level:2},{value:"4 - \u4fee\u6539\u5fc5\u8981\u7684\u6587\u4ef6",id:"modify-the-necessary-files",level:2},{value:"5 -\u751f\u6210\u8865\u4e01\u6587\u4ef6",id:"generate-a-patch-file",level:2},{value:"6 - \u4fee\u6539 <code>portfile.cmake</code> \u4ee5\u5e94\u7528\u8865\u4e01",id:"modify-portfilecmake-to-apply-the-patch",level:2},{value:"7 - \u5b89\u88c5\u60a8\u7684\u8986\u76d6\u7aef\u53e3",id:"install-your-overlay-port",level:2},{value:"\u540e\u7eed\u6b65\u9aa4",id:"\u540e\u7eed\u6b65\u9aa4",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"\u6559\u7a0b\u5b89\u88c5\u672c\u5730\u4fee\u6539\u7684\u4f9d\u8d56\u9879",children:"\u6559\u7a0b\uff1a\u5b89\u88c5\u672c\u5730\u4fee\u6539\u7684\u4f9d\u8d56\u9879"})}),"\n",(0,l.jsx)(n.p,{children:"\u672c\u6559\u7a0b\u5411\u60a8\u5c55\u793a\u5982\u4f55\u4fee\u6539 kmpkg \u7aef\u53e3\u5e76\u4f7f\u7528\u8986\u76d6\u5b89\u88c5\u5b83"}),"\n",(0,l.jsxs)(n.p,{children:["\u672c\u6559\u7a0b\u5c06\u6307\u5bfc\u60a8\u4f7f\u7528\u81ea\u5b9a\u4e49\u8986\u76d6\u4fee\u6539 kmpkg \u7aef\u53e3\u3002\u6211\u4eec\u5efa\u8bae\u60a8\u9605\u8bfb\u6709\u5173",(0,l.jsx)(n.a,{href:"/docs/kmpkg/get_started/get-started-packaging",children:"\u6253\u5305\u5e93"})," \u5728\u7ee7\u7eed\u4e4b\u524d\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c06\u5b66\u4e60\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#create-an-overlay-port",children:"\u521b\u5efa\u8986\u76d6\u7aef\u53e3"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#get-the-ports-source-code",children:"\u83b7\u53d6\u7aef\u53e3\u7684\u6e90\u4ee3\u7801"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#create-a-temporary-git-registry",children:"\u521b\u5efa\u4e34\u65f6 Git \u6ce8\u518c\u8868"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#modify-the-necessary-files",children:"\u4fee\u6539\u5fc5\u8981\u7684\u6587\u4ef6"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#generate-a-patch-file",children:"\u751f\u6210\u8865\u4e01\u6587\u4ef6"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsxs)(n.a,{href:"#modify-portfilecmake-to-apply-the-patch",children:["\u4fee\u6539 ",(0,l.jsx)(n.code,{children:"portfile.cmake"})," \u4ee5\u5e94\u7528\u8865\u4e01"]})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"#install-your-overlay-port",children:"\u5b89\u88c5\u60a8\u7684\u8986\u76d6\u7aef\u53e3"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e00\u4e2a\u7ec8\u7aef"}),"\n",(0,l.jsx)(n.li,{children:"kmpkg"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://git-scm.com/downloads",children:"Git"})}),"\n",(0,l.jsx)(n.li,{children:"C++\u7f16\u8bd1\u5668"}),"\n",(0,l.jsxs)(n.li,{children:["\u5b8c\u6210",(0,l.jsx)(n.a,{href:"/docs/kmpkg/get_started/get-started-packaging",children:"\u6253\u5305\u6559\u7a0b"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"create-an-overlay-port",children:"1 - \u521b\u5efa\u8986\u76d6\u7aef\u53e3"}),"\n",(0,l.jsxs)(n.p,{children:["\u7b2c\u4e00\u6b65\u662f\u521b\u5efa\u4e00\u4e2a ",(0,l.jsx)(n.a,{href:"/docs/kmpkg/concepts/overlay-ports",children:"overlay port"}),"\u60a8\u8981\u4fee\u6539\u7684\u5305\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\u6765\u4fdd\u5b58\u60a8\u7684\u8986\u76d6\u7aef\u53e3",children:"\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\u6765\u4fdd\u5b58\u60a8\u7684\u8986\u76d6\u7aef\u53e3"}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u4ee5\u5728\u60a8\u9009\u62e9\u7684\u4efb\u4f55\u6587\u4ef6\u7cfb\u7edf\u4f4d\u7f6e\u521b\u5efa\u8986\u76d6\u7aef\u53e3\u76ee\u5f55\u3002\u5728\u672c\u6559\u7a0b\u7684\u4efb\u4f55\u6b65\u9aa4\u4e2d\uff0c\u5c06\u201c$OVERLAY_LOCATION\u201d\u66ff\u6362\u4e3a\u60a8\u9009\u62e9\u7684\u4f4d\u7f6e\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'mkdir "$OVERLAY_LOCATION"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u5c06\u7aef\u53e3\u7684\u5185\u5bb9\u590d\u5236\u5230\u8986\u76d6\u7aef\u53e3\u76ee\u5f55\u4e2d",children:"\u5c06\u7aef\u53e3\u7684\u5185\u5bb9\u590d\u5236\u5230\u8986\u76d6\u7aef\u53e3\u76ee\u5f55\u4e2d"}),"\n",(0,l.jsxs)(n.p,{children:["\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u60a8\u5c06\u4fee\u6539 ",(0,l.jsx)(n.code,{children:"kmpkg-sample-library"})," \u7aef\u53e3",(0,l.jsx)(n.a,{href:"/docs/kmpkg/get_started/get-started-packaging",children:"\u6253\u5305\u6559\u7a0b"}),"\u6dfb\u52a0\u52a8\u6001\u5e93\u652f\u6301\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'cp -R <path/to/kmpkg-sample-library> "$OVERLAY_LOCATION"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"get-the-ports-source-code",children:"2 -\u83b7\u53d6\u7aef\u53e3\u7684\u6e90\u4ee3\u7801"}),"\n",(0,l.jsx)(n.p,{children:"\u8981\u83b7\u53d6\u8981\u4fee\u6539\u7684\u7aef\u53e3\u7684\u6e90\u4ee3\u7801\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:'kmpkg install "--overlay-ports=$OVERLAY_LOCATION" kmpkg-sample-library --editable'})}),"\n",(0,l.jsx)(n.p,{children:"\u8f93\u51fa\u5e94\u5305\u542b\u7c7b\u4f3c\u4e8e\u4ee5\u4e0b\u5185\u5bb9\u7684\u884c\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-Console",children:"-- Using source at path/to/kmpkg/buildtrees/kmpkg-sample-library/src/1.0.0-b54c55c215\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8fd9\u662f\u7aef\u53e3\u6e90\u4ee3\u7801\u7684\u4f4d\u7f6e\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"create-a-temporary-git-registry",children:"3 - \u521b\u5efa\u4e34\u65f6 Git \u6ce8\u518c\u8868"}),"\n",(0,l.jsxs)(n.p,{children:["\u5728\u6e90\u4ee3\u7801\u4f4d\u7f6e\u521d\u59cb\u5316\u4e34\u65f6 Git \u5b58\u50a8\u5e93\u3002\u8fd9\u662f\u6309\u987a\u5e8f\u4f7f\u7528 Git \u751f\u6210\u53ef\u4ee5\u5728\u201cportfile.cmake\u201d\u4e2d\u5e94\u7528\u7684\u8865\u4e01\u6587\u4ef6\u811a\u672c\u3002\n\u5c06 ",(0,l.jsx)(n.code,{children:"$SOURCE_PATH"})," \u66ff\u6362\u4e3a\u4e0a\u4e00\u6b65\u4e2d\u83b7\u53d6\u7684\u4f4d\u7f6e\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-console",children:'cd "$SOURCE_PATH"\ngit init\ngit add .\ngit commit -m "Initial commit"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"modify-the-necessary-files",children:"4 - \u4fee\u6539\u5fc5\u8981\u7684\u6587\u4ef6"}),"\n",(0,l.jsxs)(n.p,{children:["\u4fee\u6539\u5982\u4e0b\u6e90\u7801\u6587\u4ef6\uff0c\u6dfb\u52a0\u52a8\u6001\u5e93\u652f\u6301\n",(0,l.jsx)(n.code,{children:"kmpkg-sample-library"}),"."]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"my_sample_lib.h"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:"#pragma once\n\n#include <string>\n\n#if MYLIB_EXPORTS\n__declspec(dllexport)\n#endif\nstd::string greet(const std::string& name);\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"CMakeLists.txt"})}),"\n",(0,l.jsx)(n.p,{children:"\u4ece\u201cadd_library()\u201d\u8c03\u7528\u4e2d\u5220\u9664\u201cSTATIC\u201d\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cmake",children:"add_library(my_sample_lib my_sample_lib.cpp)\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6784\u5efa\u4e3a\u5171\u4eab\u5e93\u65f6\u6dfb\u52a0\u7f16\u8bd1\u5b9a\u4e49\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cmake",children:"if (BUILD_SHARED_LIBS)\n    target_compile_definitions(my_sample_lib PRIVATE MYLIB_EXPORTS)\nendif()\n"})}),"\n",(0,l.jsx)(n.h2,{id:"generate-a-patch-file",children:"5 -\u751f\u6210\u8865\u4e01\u6587\u4ef6"}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u6e90\u7801\u76ee\u5f55\u4e0b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u751f\u6210\u8865\u4e01\u6587\u4ef6\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-Console",children:'git diff > "$OVERLAY_LOCATION/kmpkg-sample-library/add-dynamic-lib-support.patch"\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u8fd9\u4f1a\u5728\u60a8\u7684\u8986\u76d6\u7aef\u53e3\u4e2d\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a\u201cadd-dynamic-lib-support.patch\u201d\u7684\u6587\u4ef6\uff0c\u5185\u5bb9\u7c7b\u4f3c\u4e8e\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-diff",children:"diff --git a/CMakeLists.txt b/CMakeLists.txt\nindex 2b42f71..b347b53 100644\n--- a/CMakeLists.txt\n+++ b/CMakeLists.txt\n@@ -6,11 +6,15 @@ project(my_sample_lib)\n find_package(fmt CONFIG REQUIRED)\n \n # Add your library\n-add_library(my_sample_lib STATIC my_sample_lib.cpp)\n+add_library(my_sample_lib my_sample_lib.cpp)\n \n # Link your library to fmt\n target_link_libraries(my_sample_lib PRIVATE fmt::fmt)\n \n+if (BUILD_SHARED_LIBS)\n+    target_compile_definitions(my_sample_lib PRIVATE MYLIB_EXPORTS)\n+endif()\n+\n # Add include directories\n target_include_directories(my_sample_lib PUBLIC \n     $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>   # for headers when building\ndiff --git a/my_sample_lib.h b/my_sample_lib.h\nindex d6d70b8..0b62141 100644\n--- a/my_sample_lib.h\n+++ b/my_sample_lib.h\n@@ -2,4 +2,7 @@\n \n #include <string>\n \n+#if MYLIB_EXPORTS\n+__declspec(dllexport)\n+#endif\n std::string greet(const std::string& name);\n"})}),"\n",(0,l.jsxs)(n.h2,{id:"modify-portfilecmake-to-apply-the-patch",children:["6 - \u4fee\u6539 ",(0,l.jsx)(n.code,{children:"portfile.cmake"})," \u4ee5\u5e94\u7528\u8865\u4e01"]}),"\n",(0,l.jsx)(n.p,{children:"\u66f4\u6539\u201cportfile.cmake\u201d\u4ee5\u5220\u9664\u201cONLY_STATIC_LIBRARY\u201d\u9650\u5236\u5e76\n\u5c06\u60a8\u7684\u8865\u4e01\u5e94\u7528\u5230\u6e90\u4ee3\u7801\u3002"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"portfile.cmake"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cmake",children:'kmpkg_from_github(\n    OUT_SOURCE_PATH SOURCE_PATH\n    REPO Microsoft/kmpkg-docs\n    REF "${VERSION}"\n    SHA512 3f206cc2fe61d9c97c82b30852e1e4e6df299d93f6159edd1e56c644fa03ccc4670f7681e356d0e3db898a74e099a1ec531821df5430a7b14d61c743c5aa8c30\n    HEAD_REF cmake-sample-lib\n    PATCHES\n      "add-dynamic-lib-support.patch"\n)\n\nkmpkg_cmake_configure(\n    SOURCE_PATH "${SOURCE_PATH}"\n)\n\nkmpkg_cmake_install()\nkmpkg_copy_pdbs()\nkmpkg_cmake_config_fixup(PACKAGE_NAME "my_sample_lib")\n\nfile(REMOVE_RECURSE "${CURRENT_PACKAGES_DIR}/debug/include")\nfile(\n    INSTALL "${SOURCE_PATH}/LICENSE" \n    DESTINATION "${CURRENT_PACKAGES_DIR}/share/${PORT}" \n    RENAME copyright\n)\nconfigure_file("${CMAKE_CURRENT_LIST_DIR}/usage" "${CURRENT_PACKAGES_DIR}/share/${PORT}/usage" COPYONLY)\n\n'})}),"\n",(0,l.jsx)(n.h2,{id:"install-your-overlay-port",children:"7 - \u5b89\u88c5\u60a8\u7684\u8986\u76d6\u7aef\u53e3"}),"\n",(0,l.jsx)(n.p,{children:"\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:'kmpkg install "--overlay-ports=$OVERLAY_LOCATION" kmpkg-sample-library'})}),"\n",(0,l.jsx)(n.p,{children:"\u786e\u4fdd\u5220\u9664\u201c--editable\u201d\u6807\u5fd7\uff0c\u4ee5\u4fbf\u8865\u4e01\u6587\u4ef6\u9002\u7528\u4e8e\u6e90\u4ee3\u7801\u7684\u5e72\u51c0\u526f\u672c\u3002\u60a8\u5e94\u8be5\u770b\u5230\u4e00\u884c\u5173\u4e8e\u5e94\u7528\u8865\u4e01\u7684\u4fe1\u606f\u6587\u4ef6\u5230\u8f93\u51fa\u4e2d\u7684\u6e90\u4ee3\u7801\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-Console",children:"-- Cleaning sources at D:/Work/kmpkg/buildtrees/kmpkg-sample-library/src/1.0.0-8f646312ed.clean. Use --editable to skip cleaning for the packages you specify.\n-- Extracting source D:/Work/kmpkg/downloads/Microsoft-kmpkg-docs-1.0.0.tar.gz\n-- Applying patch add-dynamic-lib-support.patch\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u540e\u7eed\u6b65\u9aa4",children:"\u540e\u7eed\u6b65\u9aa4"}),"\n",(0,l.jsx)(n.p,{children:"\u5c31\u662f\u8fd9\u6837\uff01\u60a8\u5df2\u4f7f\u7528\u8865\u4e01\u5b89\u88c5\u4e86\u672c\u5730\u4fee\u6539\u7684\u4f9d\u8d56\u9879\n\u6587\u4ef6\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u4ee5\u4e0b\u662f\u63a5\u4e0b\u6765\u8981\u5c1d\u8bd5\u7684\u4e00\u4e9b\u4efb\u52a1\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/kmpkg/produce/publish-to-a-git-registry",children:"\u521b\u5efa\u81ea\u5b9a\u4e49 Git \u6ce8\u518c\u8868"})}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(p,{...e})}):p(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>c});var l=i(96540);const r={},s=l.createContext(r);function a(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);