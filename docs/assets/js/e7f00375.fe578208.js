"use strict";(self.webpackChunkkumo_website=self.webpackChunkkumo_website||[]).push([[22102],{85759:(n,e,c)=>{c.r(e),c.d(e,{assets:()=>t,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var s=c(74848),i=c(28453);const l={},r="kmock \u6559\u7a0b",o={id:"cpp/base/testing/kt/kmock_cook_book",title:"kmock \u6559\u7a0b",description:"\u60a8\u53ef\u4ee5\u5728\u6b64\u5904\u627e\u5230\u4f7f\u7528 kMock \u7684\u6559\u7a0b\u3002\u5982\u679c\u60a8\u8fd8\u6ca1\u6709\u9605\u8bfb\u8fc7\uff0c\u8bf7\u9605\u8bfb",source:"@site/docs/cpp/base/testing/kt/kmock_cook_book.mdx",sourceDirName:"cpp/base/testing/kt",slug:"/cpp/base/testing/kt/kmock_cook_book",permalink:"/docs/next/cpp/base/testing/kt/kmock_cook_book",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"kMock \u5165\u95e8\u7248",permalink:"/docs/next/cpp/base/testing/kt/kmock_for_dummies"},next:{title:"kmock \u5907\u5fd8\u5f55",permalink:"/docs/next/cpp/base/testing/kt/kmock_cheat_sheet"}},t={},d=[{value:"\u521b\u5efa\u6a21\u62df\u7c7b",id:"creating-mock-classes",level:2},{value:"\u5904\u7406\u4e0d\u53d7\u4fdd\u62a4\u7684\u9017\u53f7",id:"dealing-with-unprotected-commas",level:3},{value:"\u6a21\u62df\u79c1\u6709\u6216\u53d7\u4fdd\u62a4\u7684\u65b9\u6cd5",id:"mocking-private-or-protected-methods",level:3},{value:"\u6a21\u62df\u91cd\u8f7d\u65b9\u6cd5",id:"mocking-overloaded-methods",level:3},{value:"\u6a21\u62df\u7c7b\u6a21\u677f",id:"mocking-class-templates",level:3},{value:"\u6a21\u62df\u975e\u865a\u62df\u65b9\u6cd5",id:"MockingNonVirtualMethods",level:3},{value:"\u6a21\u62df\u51fd\u6570",id:"mocking-free-functions",level:3},{value:"\u5584\u826f\u3001\u4e25\u683c\u548c\u65e0\u8da3\u7684\u8c03\u7528",id:"NiceStrictNaggy",level:3},{value:"\u7b80\u5316\u754c\u9762\u800c\u4e0d\u7834\u574f\u73b0\u6709\u4ee3\u7801",id:"SimplerInterfaces",level:3},{value:"\u6a21\u62df\u5177\u4f53\u7c7b\u7684\u66ff\u4ee3\u65b9\u6848",id:"alternative-to-mocking-concrete-classes",level:3},{value:"\u5c06\u547c\u53eb\u59d4\u6258\u7ed9fake",id:"DelegatingToFake",level:3},{value:"\u5c06\u8c03\u7528\u59d4\u6258\u7ed9\u771f\u5b9e\u5bf9\u8c61",id:"\u5c06\u8c03\u7528\u59d4\u6258\u7ed9\u771f\u5b9e\u5bf9\u8c61",level:3},{value:"\u5c06\u8c03\u7528\u59d4\u6258\u7ed9\u7236\u7c7b",id:"delegating-calls-to-a-parent-class",level:3},{value:"\u4f7f\u7528\u5339\u914d\u5668",id:"using-matchers",level:2},{value:"\u7cbe\u786e\u5339\u914d\u53c2\u6570\u503c",id:"matching-argument-values-exactly",level:3},{value:"\u4f7f\u7528\u7b80\u5355\u5339\u914d\u5668",id:"using-simple-matchers",level:3},{value:"\u7ec4\u5408\u5339\u914d\u5668",id:"CombiningMatchers",level:3},{value:"\u9009\u89d2\u5339\u914d\u5668",id:"SafeMatcherCast",level:3},{value:"\u5728\u91cd\u8f7d\u51fd\u6570\u4e4b\u95f4\u8fdb\u884c\u9009\u62e9",id:"SelectOverload",level:3},{value:"\u6839\u636e\u53c2\u6570\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c",id:"\u6839\u636e\u53c2\u6570\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c",level:3},{value:"\u5c06\u591a\u4e2a\u53c2\u6570\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u8fdb\u884c\u5339\u914d",id:"\u5c06\u591a\u4e2a\u53c2\u6570\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u8fdb\u884c\u5339\u914d",level:3},{value:"\u4f7f\u7528\u5339\u914d\u5668\u4f5c\u4e3a\u8c13\u8bcd",id:"\u4f7f\u7528\u5339\u914d\u5668\u4f5c\u4e3a\u8c13\u8bcd",level:3},{value:"\u5728 ktest \u65ad\u8a00\u4e2d\u4f7f\u7528\u5339\u914d\u5668",id:"\u5728-ktest-\u65ad\u8a00\u4e2d\u4f7f\u7528\u5339\u914d\u5668",level:3},{value:"\u4f7f\u7528\u8c13\u8bcd\u4f5c\u4e3a\u5339\u914d\u5668",id:"\u4f7f\u7528\u8c13\u8bcd\u4f5c\u4e3a\u5339\u914d\u5668",level:3},{value:"\u5339\u914d\u4e0d\u53ef\u590d\u5236\u7684\u53c2\u6570",id:"\u5339\u914d\u4e0d\u53ef\u590d\u5236\u7684\u53c2\u6570",level:3},{value:"\u9a8c\u8bc1\u5bf9\u8c61\u7684\u6210\u5458",id:"\u9a8c\u8bc1\u5bf9\u8c61\u7684\u6210\u5458",level:3},{value:"\u9a8c\u8bc1\u6307\u9488\u53c2\u6570\u6307\u5411\u7684\u503c",id:"\u9a8c\u8bc1\u6307\u9488\u53c2\u6570\u6307\u5411\u7684\u503c",level:3},{value:"\u5b9a\u4e49\u81ea\u5b9a\u4e49\u5339\u914d\u5668\u7c7b",id:"CustomMatcherClass",level:3},{value:"\u914d\u5957\u5bb9\u5668",id:"\u914d\u5957\u5bb9\u5668",level:3},{value:"\u5171\u4eab\u5339\u914d\u5668",id:"\u5171\u4eab\u5339\u914d\u5668",level:3},{value:"\u5339\u914d\u5668\u5fc5\u987b\u6ca1\u6709\u526f\u4f5c\u7528",id:"PureMatchers",level:3},{value:"\u8bbe\u5b9a\u671f\u671b",id:"setting-expectations",level:2},{value:"\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u53ef\u4ee5\u671f\u5f85",id:"UseOnCall",level:3},{value:"\u5ffd\u7565\u65e0\u8da3\u7684\u8c03\u7528",id:"\u5ffd\u7565\u65e0\u8da3\u7684\u8c03\u7528",level:3},{value:"\u7981\u6b62\u610f\u5916<code>call</code>",id:"\u7981\u6b62\u610f\u5916call",level:3},{value:"\u4e86\u89e3\u65e0\u8da3\u4e0e\u610f\u5916\u7684<code>call</code>",id:"uninteresting-vs-unexpected",level:3},{value:"\u5ffd\u7565\u65e0\u8da3\u7684\u53c2\u6570",id:"ParameterlessExpectations",level:3},{value:"\u671f\u5f85\u6709\u5e8f\u8c03\u7528",id:"OrderedCalls",level:3},{value:"\u671f\u5f85\u90e8\u5206\u6709\u5e8f\u7684\u8c03\u7528",id:"PartialOrder",level:3},{value:"\u63a7\u5236\u671f\u671b\u4f55\u65f6\u6d88\u5931",id:"\u63a7\u5236\u671f\u671b\u4f55\u65f6\u6d88\u5931",level:3},{value:"\u4f7f\u7528 Actions",id:"using-actions",level:2},{value:"\u4ece\u6a21\u62df\u65b9\u6cd5\u8fd4\u56de\u5f15\u7528",id:"\u4ece\u6a21\u62df\u65b9\u6cd5\u8fd4\u56de\u5f15\u7528",level:3},{value:"\u4ece\u6a21\u62df\u65b9\u6cd5\u8fd4\u56de\u5b9e\u65f6\u503c",id:"\u4ece\u6a21\u62df\u65b9\u6cd5\u8fd4\u56de\u5b9e\u65f6\u503c",level:3},{value:"\u7ec4\u5408actions",id:"\u7ec4\u5408actions",level:3},{value:"\u9a8c\u8bc1\u590d\u6742\u7684\u53c2\u6570",id:"SaveArgVerify",level:3},{value:"\u6a21\u62df\u526f\u4f5c\u7528",id:"mocking-side-effects",level:3},{value:"\u6839\u636e\u72b6\u6001\u66f4\u6539\u6a21\u62df\u5bf9\u8c61\u7684\u884c\u4e3a",id:"\u6839\u636e\u72b6\u6001\u66f4\u6539\u6a21\u62df\u5bf9\u8c61\u7684\u884c\u4e3a",level:3},{value:"\u8bbe\u7f6e\u8fd4\u56de\u7c7b\u578b\u7684\u9ed8\u8ba4\u503c",id:"DefaultValue",level:3},{value:"\u8bbe\u7f6e\u6a21\u62df\u65b9\u6cd5\u7684\u9ed8\u8ba4\u64cd\u4f5c",id:"\u8bbe\u7f6e\u6a21\u62df\u65b9\u6cd5\u7684\u9ed8\u8ba4\u64cd\u4f5c",level:3},{value:"\u4f7f\u7528\u51fd\u6570/\u65b9\u6cd5/\u51fd\u5b50/Lambda \u4f5c\u4e3aactions",id:"FunctionsAsActions",level:3},{value:"Invoking a Function/Method/Functor/Lambda/Callback Without Arguments",id:"invoking-a-functionmethodfunctorlambdacallback-without-arguments",level:3},{value:"\u8c03\u7528 Mock \u51fd\u6570\u7684\u53c2\u6570",id:"\u8c03\u7528-mock-\u51fd\u6570\u7684\u53c2\u6570",level:3},{value:"\u5ffd\u7565\u64cd\u4f5c\u7684\u7ed3\u679c",id:"\u5ffd\u7565\u64cd\u4f5c\u7684\u7ed3\u679c",level:3},{value:"\u9009\u62e9\u64cd\u4f5c\u7684\u53c2\u6570",id:"SelectingArgs",level:3},{value:"\u5ffd\u7565\u64cd\u4f5c\u51fd\u6570\u4e2d\u7684\u53c2\u6570",id:"\u5ffd\u7565\u64cd\u4f5c\u51fd\u6570\u4e2d\u7684\u53c2\u6570",level:3},{value:"Sharing Actions",id:"sharing-actions",level:3},{value:"\u6d4b\u8bd5\u5f02\u6b65\u884c\u4e3a",id:"\u6d4b\u8bd5\u5f02\u6b65\u884c\u4e3a",level:3},{value:"\u6709\u5173\u4f7f\u7528 kMock \u7684\u6742\u9879",id:"misc-recipes-on-using-kmock",level:2},{value:"\u4f7f\u7528\u4ec5\u79fb\u52a8\u7c7b\u578b\u7684\u6a21\u62df\u65b9\u6cd5",id:"\u4f7f\u7528\u4ec5\u79fb\u52a8\u7c7b\u578b\u7684\u6a21\u62df\u65b9\u6cd5",level:3},{value:"\u4ec5\u79fb\u52a8\u7c7b\u578b\u7684\u65e7\u89e3\u51b3\u65b9\u6cd5",id:"LegacyMoveOnly",level:4},{value:"\u4f7f\u7f16\u8bd1\u66f4\u5feb",id:"\u4f7f\u7f16\u8bd1\u66f4\u5feb",level:3},{value:"\u5f3a\u5236\u9a8c\u8bc1",id:"\u5f3a\u5236\u9a8c\u8bc1",level:3},{value:"Using Checkpoints",id:"UsingCheckPoints",level:3},{value:"\u6a21\u62df\u6790\u6784\u51fd\u6570",id:"\u6a21\u62df\u6790\u6784\u51fd\u6570",level:3},{value:"\u4f7f\u7528 kMock \u548c\u7ebf\u7a0b",id:"UsingThreads",level:3},{value:"\u63a7\u5236 kMock \u6253\u5370\u7684\u4fe1\u606f\u91cf",id:"\u63a7\u5236-kmock-\u6253\u5370\u7684\u4fe1\u606f\u91cf",level:3},{value:"\u5728\u6a21\u62df\u901a\u8bdd\u4e2d\u83b7\u5f97\u8d85\u7ea7\u89c6\u89c9",id:"\u5728\u6a21\u62df\u901a\u8bdd\u4e2d\u83b7\u5f97\u8d85\u7ea7\u89c6\u89c9",level:3},{value:"\u6269\u5c55 kMock",id:"extending-kmock",level:2},{value:"\u5feb\u901f\u7f16\u5199\u65b0\u7684\u5339\u914d\u5668",id:"NewMatchers",level:3},{value:"\u5feb\u901f\u7f16\u5199\u65b0\u7684\u53c2\u6570\u5316\u5339\u914d\u5668",id:"\u5feb\u901f\u7f16\u5199\u65b0\u7684\u53c2\u6570\u5316\u5339\u914d\u5668",level:3},{value:"\u7f16\u5199\u65b0\u7684\u5355\u6001\u5339\u914d\u5668",id:"\u7f16\u5199\u65b0\u7684\u5355\u6001\u5339\u914d\u5668",level:3},{value:"\u7f16\u5199\u65b0\u7684\u591a\u6001\u5339\u914d\u5668",id:"\u7f16\u5199\u65b0\u7684\u591a\u6001\u5339\u914d\u5668",level:3},{value:"\u9057\u7559\u5339\u914d\u5668\u5b9e\u65bd",id:"\u9057\u7559\u5339\u914d\u5668\u5b9e\u65bd",level:3},{value:"\u7f16\u5199\u65b0\u7684\u57fa\u6570",id:"\u7f16\u5199\u65b0\u7684\u57fa\u6570",level:3},{value:"\u7f16\u5199\u65b0\u52a8\u4f5c",id:"QuickNewActions",level:3},{value:"\u65e7\u7684\u57fa\u4e8e\u5b8f\u7684\u64cd\u4f5c",id:"\u65e7\u7684\u57fa\u4e8e\u5b8f\u7684\u64cd\u4f5c",level:4},{value:"\u4f20\u7edf\u7684\u57fa\u4e8e\u5b8f\u7684\u53c2\u6570\u5316\u64cd\u4f5c",id:"\u4f20\u7edf\u7684\u57fa\u4e8e\u5b8f\u7684\u53c2\u6570\u5316\u64cd\u4f5c",level:4},{value:"\u9650\u5236 ACTION \u4e2d\u53c2\u6570\u6216\u53c2\u6570\u7684\u7c7b\u578b",id:"\u9650\u5236-action-\u4e2d\u53c2\u6570\u6216\u53c2\u6570\u7684\u7c7b\u578b",level:3},{value:"Writing New Action Templates Quickly",id:"writing-new-action-templates-quickly",level:3},{value:"Using the ACTION Object&#39;s Type",id:"using-the-action-objects-type",level:3},{value:"\u7f16\u5199\u65b0\u7684\u5355\u6001\u52a8\u4f5c",id:"NewMonoActions",level:3},{value:"\u7f16\u5199\u65b0\u7684\u591a\u6001\u52a8\u4f5c",id:"NewPolyActions",level:3},{value:"Teaching kMock How to Print Your Values",id:"teaching-kmock-how-to-print-your-values",level:3},{value:"\u4f7f\u7528 kMock \u521b\u5efa\u6709\u7528\u7684\u6a21\u62df",id:"useful-mocks-created-using-kmock",level:2},{value:"Mock std::function",id:"MockFunction",level:3}];function a(n){const e={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"kmock-\u6559\u7a0b",children:"kmock \u6559\u7a0b"})}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u53ef\u4ee5\u5728\u6b64\u5904\u627e\u5230\u4f7f\u7528 kMock \u7684\u6559\u7a0b\u3002\u5982\u679c\u60a8\u8fd8\u6ca1\u6709\u9605\u8bfb\u8fc7\uff0c\u8bf7\u9605\u8bfb\n",(0,s.jsx)(e.a,{href:"/docs/next/cpp/base/testing/kt/kmock_for_dummies",children:"\u5165\u95e8\u6559\u7a0b"})," \u9996\u5148\u786e\u4fdd\u60a8\u4e86\u89e3\n\u57fa\u7840\u77e5\u8bc6\u3002"]}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6ce8\u610f\uff1a"})," kMock \u5b58\u5728\u4e8e ",(0,s.jsx)(e.code,{children:"testing"})," \u547d\u540d\u7a7a\u95f4\u4e2d\u3002\u4e3a\u4e86\u53ef\u8bfb\u6027\uff0c\u5b83\u662f\n\u5efa\u8bae\u5728\u4f7f\u7528\u4e4b\u524d\u5728\u6587\u4ef6\u4e2d\u5199\u5165\u4e00\u6b21",(0,s.jsx)(e.code,{children:"using ::testing::Foo;"}),"\n\u540d\u79f0 ",(0,s.jsx)(e.code,{children:"Foo"})," \u7531 kMock \u5b9a\u4e49\u3002\u6211\u4eec\u5728\u672c\u8282\u4e2d\u7701\u7565\u6b64\u7c7b\u201cusing\u201d\u8bed\u53e5\n\u7b80\u6d01\uff0c\u4f46\u60a8\u5e94\u8be5\u5728\u81ea\u5df1\u7684\u4ee3\u7801\u4e2d\u6267\u884c\u6b64\u64cd\u4f5c\u3002"]})}),"\n",(0,s.jsx)(e.h2,{id:"creating-mock-classes",children:"\u521b\u5efa\u6a21\u62df\u7c7b"}),"\n",(0,s.jsxs)(e.p,{children:["\u6a21\u62df\u7c7b\u88ab\u5b9a\u4e49\u4e3a\u666e\u901a\u7c7b\uff0c\u4f7f\u7528",(0,s.jsx)(e.code,{children:"MOCK_METHOD"}),"\u5b8f\u6765\n\u751f\u6210\u6a21\u62df\u65b9\u6cd5\u3002\u8be5\u5b8f\u6709 3 \u6216 4 \u4e2a\u53c2\u6570\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MyMock {\n public:\n  MOCK_METHOD(ReturnType, MethodName, (Args...));\n  MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));\n};\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u524d 3 \u4e2a\u53c2\u6570\u53ea\u662f\u65b9\u6cd5\u58f0\u660e\uff0c\u5206\u4e3a 3 \u90e8\u5206\u3002\n\u7b2c\u56db\u4e2a\u53c2\u6570\u63a5\u53d7\u9650\u5b9a\u7b26\u7684\u5c01\u95ed\u5217\u8868\uff0c\u8fd9\u4f1a\u5f71\u54cd\n\u751f\u6210\u65b9\u6cd5\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"const"})})," - \u4f7f\u6a21\u62df\u65b9\u6cd5\u6210\u4e3a\u201cconst\u201d\u65b9\u6cd5\u3002\u5fc5\u9700\u7684\uff0c\u5982\u679c\n\u91cd\u5199 ",(0,s.jsx)(e.code,{children:"const"})," \u65b9\u6cd5\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"override"})})," - \u7528\u201coverride\u201d\u6807\u8bb0\u65b9\u6cd5\u3002\u5982\u679c\u8986\u76d6\u5219\u63a8\u8350\n\u4e00\u4e2a\u201c\u865a\u62df\u201d\u65b9\u6cd5\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"noexcept"})})," - \u7528\u201cnoexcept\u201d\u6807\u8bb0\u65b9\u6cd5\u3002\u5982\u679c\u8986\u76d6\u5219\u9700\u8981\n",(0,s.jsx)(e.code,{children:"noexcept"})," \u65b9\u6cd5\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"Calltype(...)"})})," - \u8bbe\u7f6e\u65b9\u6cd5\u7684\u8c03\u7528\u7c7b\u578b\uff08\u4f8b\u5982\n",(0,s.jsx)(e.code,{children:"STDMETHODCALLTYPE"}),")\uff0c\u5728 Windows \u4e2d\u5f88\u6709\u7528\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"ref(...)"})})," - \u4f7f\u7528\u53c2\u8003\u9650\u5b9a\u6807\u8bb0\u65b9\u6cd5\n\u6307\u5b9a\u7684\u3002\u5982\u679c\u91cd\u5199\u5177\u6709\u5f15\u7528\u7684\u65b9\u6cd5\uff0c\u5219\u4e3a\u5fc5\u9700\n\u8d44\u683c\u3002\u4f8b\u5982\u201cref(&)\u201d\u6216\u201cref(&&)\u201d\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"dealing-with-unprotected-commas",children:"\u5904\u7406\u4e0d\u53d7\u4fdd\u62a4\u7684\u9017\u53f7"}),"\n",(0,s.jsxs)(e.p,{children:["\u4e0d\u53d7\u4fdd\u62a4\u7684\u9017\u53f7\uff0c\u5373\u6ca1\u6709\u88ab\u62ec\u53f7\u5305\u56f4\u7684\u9017\u53f7\uff0c\u53ef\u4ee5\u9632\u6b62\n\u6b63\u786e\u89e3\u6790\u5176\u53c2\u6570\u7684",(0,s.jsx)(e.code,{children:"MOCK_METHOD"}),"\uff1a"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"{: .bad}"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MockFoo {\n public:\n  MOCK_METHOD(std::pair<bool, int>, GetPair, ());  // Won't compile!\n  MOCK_METHOD(bool, CheckMap, (std::map<int, double>, bool));  // Won't compile!\n};\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u89e3\u51b3\u65b9\u6848 1 - \u7528\u62ec\u53f7\u62ec\u8d77\u6765\uff1a"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"{: .good}"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MockFoo {\n public:\n  MOCK_METHOD((std::pair<bool, int>), GetPair, ());\n  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u7528\u62ec\u53f7\u5305\u88c5\u8fd4\u56de\u6216\u53c2\u6570\u7c7b\u578b\u662f\uff1a\n\u65e0\u6548\u7684 C++\u3002 ",(0,s.jsx)(e.code,{children:"MOCK_METHOD"})," \u5220\u9664\u62ec\u53f7\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u89e3\u51b3\u65b9\u6848 2 - \u5b9a\u4e49\u522b\u540d\uff1a"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.code,{children:"{: .good}"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MockFoo {\n public:\n  using BoolAndInt = std::pair<bool, int>;\n  MOCK_METHOD(BoolAndInt, GetPair, ());\n  using MapIntDouble = std::map<int, double>;\n  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));\n};\n"})}),"\n",(0,s.jsx)(e.h3,{id:"mocking-private-or-protected-methods",children:"\u6a21\u62df\u79c1\u6709\u6216\u53d7\u4fdd\u62a4\u7684\u65b9\u6cd5"}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u5fc5\u987b\u59cb\u7ec8\u5c06\u6a21\u62df\u65b9\u6cd5\u5b9a\u4e49\uff08",(0,s.jsx)(e.code,{children:"MOCK_METHOD"}),"\uff09\u653e\u5728",(0,s.jsx)(e.code,{children:"public\uff1a"}),"\u4e2d\n\u6a21\u62df\u7c7b\u7684\u90e8\u5206\uff0c\u65e0\u8bba\u88ab\u6a21\u62df\u7684\u65b9\u6cd5\u662f",(0,s.jsx)(e.code,{children:"public"}),"\uff0c\n\u57fa\u7c7b\u4e2d\u7684",(0,s.jsx)(e.code,{children:"protected"}),"\u6216",(0,s.jsx)(e.code,{children:"private"}),"\u3002\u8fd9\u5141\u8bb8",(0,s.jsx)(e.code,{children:"ON_CALL"}),"\u548c\n",(0,s.jsx)(e.code,{children:"EXPECT_CALL"})," \u4ece\u6a21\u62df\u7c7b\u5916\u90e8\u5f15\u7528\u6a21\u62df\u51fd\u6570\u3002\n\uff08\u662f\u7684\uff0cC++ \u5141\u8bb8\u5b50\u7c7b\u66f4\u6539\u865a\u51fd\u6570\u7684\u8bbf\u95ee\u7ea7\u522b\n\u57fa\u7c7b\u3002\uff09\u793a\u4f8b\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class Foo {\n public:\n  ...\n  virtual bool Transform(Gadget* g) = 0;\n\n protected:\n  virtual void Resume();\n\n private:\n  virtual int GetTimeOut();\n};\n\nclass MockFoo : public Foo {\n public:\n  ...\n  MOCK_METHOD(bool, Transform, (Gadget* g), (override));\n\n  // The following must be in the public section, even though the\n  // methods are protected or private in the base class.\n  MOCK_METHOD(void, Resume, (), (override));\n  MOCK_METHOD(int, GetTimeOut, (), (override));\n};\n"})}),"\n",(0,s.jsx)(e.h3,{id:"mocking-overloaded-methods",children:"\u6a21\u62df\u91cd\u8f7d\u65b9\u6cd5"}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u53ef\u4ee5\u50cf\u5f80\u5e38\u4e00\u6837\u6a21\u62df\u91cd\u8f7d\u51fd\u6570\u3002\u4e0d\u9700\u8981\u7279\u522b\u6ce8\u610f\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class Foo {\n  ...\n\n  // Must be virtual as we'll inherit from Foo.\n  virtual ~Foo();\n\n  // Overloaded on the types and/or numbers of arguments.\n  virtual int Add(Element x);\n  virtual int Add(int times, Element x);\n\n  // Overloaded on the const-ness of this object.\n  virtual Bar& GetBar();\n  virtual const Bar& GetBar() const;\n};\n\nclass MockFoo : public Foo {\n  ...\n  MOCK_METHOD(int, Add, (Element x), (override));\n  MOCK_METHOD(int, Add, (int times, Element x), (override));\n\n  MOCK_METHOD(Bar&, GetBar, (), (override));\n  MOCK_METHOD(const Bar&, GetBar, (), (const, override));\n};\n"})}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6ce8\u610f\uff1a"})," \u5982\u679c\u4f60\u4e0d\u6a21\u62df\u91cd\u8f7d\u65b9\u6cd5\u7684\u6240\u6709\u7248\u672c\uff0c\u7f16\u8bd1\u5668\n\u5c06\u4f1a\u5411\u60a8\u53d1\u51fa\u6709\u5173\u57fa\u7c7b\u4e2d\u67d0\u4e9b\u65b9\u6cd5\u88ab\u9690\u85cf\u7684\u8b66\u544a\u3002\u5230\n\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f7f\u7528",(0,s.jsx)(e.code,{children:"using"}),"\u5c06\u5b83\u4eec\u7eb3\u5165\u8303\u56f4\uff1a"]})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MockFoo : public Foo {\n  ...\n  using Foo::Add;\n  MOCK_METHOD(int, Add, (Element x), (override));\n  // We don't want to mock int Add(int times, Element x);\n  ...\n};\n"})}),"\n",(0,s.jsx)(e.h3,{id:"mocking-class-templates",children:"\u6a21\u62df\u7c7b\u6a21\u677f"}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u53ef\u4ee5\u50cf\u4efb\u4f55\u7c7b\u4e00\u6837\u6a21\u62df\u7c7b\u6a21\u677f\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"template <typename Elem>\nclass StackInterface {\n  ...\n  // Must be virtual as we'll inherit from StackInterface.\n  virtual ~StackInterface();\n\n  virtual int GetSize() const = 0;\n  virtual void Push(const Elem& x) = 0;\n};\n\ntemplate <typename Elem>\nclass MockStack : public StackInterface<Elem> {\n  ...\n  MOCK_METHOD(int, GetSize, (), (override));\n  MOCK_METHOD(void, Push, (const Elem& x), (override));\n};\n"})}),"\n",(0,s.jsx)(e.h3,{id:"MockingNonVirtualMethods",children:"\u6a21\u62df\u975e\u865a\u62df\u65b9\u6cd5"}),"\n",(0,s.jsx)(e.p,{children:"kMock \u53ef\u4ee5\u6a21\u62df\u7528\u4e8e Hi-perf \u4f9d\u8d56\u6ce8\u5165\u7684\u975e\u865a\u62df\u51fd\u6570\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u60a8\u7684\u4e0d\u662f\u4e0e\u771f\u5b9e\u7c7b\u5171\u4eab\u516c\u5171\u57fa\u7c7b\uff0c\u800c\u662f\n\u6a21\u62df\u7c7b\u5c06\u4e0e\u771f\u5b9e\u7c7b",(0,s.jsx)(e.strong,{children:"\u65e0\u5173"}),"\uff0c\u4f46\u5305\u542b\u5e26\u6709\n\u76f8\u540c\u7684\u7b7e\u540d\u3002\u6a21\u62df\u975e\u865a\u62df\u65b9\u6cd5\u7684\u8bed\u6cd5\u4e0e\u4ee5\u4e0b",(0,s.jsx)(e.em,{children:"\u76f8\u540c"}),"\n\u6a21\u62df\u865a\u62df\u65b9\u6cd5\uff08\u53ea\u662f\u4e0d\u8981\u6dfb\u52a0",(0,s.jsx)(e.code,{children:"override"}),"\uff09\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"// A simple packet stream class.  None of its members is virtual.\nclass ConcretePacketStream {\n public:\n  void AppendPacket(Packet* new_packet);\n  const Packet* GetPacket(size_t packet_number) const;\n  size_t NumberOfPackets() const;\n  ...\n};\n\n// A mock packet stream class.  It inherits from no other, but defines\n// GetPacket() and NumberOfPackets().\nclass MockPacketStream {\n public:\n  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));\n  MOCK_METHOD(size_t, NumberOfPackets, (), (const));\n  ...\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u4e0e\u771f\u5b9e\u7c7b\u4e0d\u540c\uff0c\u6a21\u62df\u7c7b\u6ca1\u6709\u5b9a\u4e49",(0,s.jsx)(e.code,{children:"AppendPacket()"}),"\u3002\n\u53ea\u8981\u6d4b\u8bd5\u4e0d\u9700\u8981\u8c03\u7528\u5b83\u5c31\u53ef\u4ee5\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u63a5\u4e0b\u6765\uff0c\u60a8\u9700\u8981\u4e00\u79cd\u65b9\u5f0f\u6765\u8868\u660e\u60a8\u60f3\u8981\u5728\u4e2d\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"ConcretePacketStream"}),"\n\u751f\u4ea7\u4ee3\u7801\uff0c\u5e76\u5728\u6d4b\u8bd5\u4e2d\u4f7f\u7528",(0,s.jsx)(e.code,{children:"MockPacketStream"}),"\u3002\u7531\u4e8e\u51fd\u6570\u662f\n\u4e0d\u662f\u865a\u62df\u7684\uff0c\u5e76\u4e14\u4e24\u4e2a\u7c7b\u4e0d\u76f8\u5173\uff0c\u60a8\u5fc5\u987b\u5728\u4ee5\u4e0b\u4f4d\u7f6e\u6307\u5b9a\u60a8\u7684\u9009\u62e9\n",(0,s.jsx)(e.em,{children:"\u7f16\u8bd1\u65f6"}),"\uff08\u76f8\u5bf9\u4e8e\u8fd0\u884c\u65f6\uff09\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4e00\u79cd\u65b9\u6cd5\u662f\u5c06\u9700\u8981\u4f7f\u7528\u6570\u636e\u5305\u6d41\u7684\u4ee3\u7801\u6a21\u677f\u5316\u3002\n\u66f4\u5177\u4f53\u5730\u8bf4\uff0c\u60a8\u5c06\u4e3a\u4ee3\u7801\u63d0\u4f9b\u8be5\u7c7b\u578b\u7684\u6a21\u677f\u7c7b\u578b\u53c2\u6570\n\u6570\u636e\u5305\u6d41\u7684\u3002\u5728\u751f\u4ea7\u4e2d\uff0c\u60a8\u5c06\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u5b9e\u4f8b\u5316\u60a8\u7684\u6a21\u677f\n",(0,s.jsx)(e.code,{children:"ConcretePacketStream"})," \u4f5c\u4e3a\u7c7b\u578b\u53c2\u6570\u3002\u5728\u6d4b\u8bd5\u4e2d\uff0c\u60a8\u5c06\u5b9e\u4f8b\u5316\n\u4e0e",(0,s.jsx)(e.code,{children:"MockPacketStream"}),"\u76f8\u540c\u7684\u6a21\u677f\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u5199\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"template <class PacketStream>\nvoid CreateConnection(PacketStream* stream) { ... }\n\ntemplate <class PacketStream>\nclass PacketReader {\n public:\n  void ReadPackets(PacketStream* stream, size_t packet_num);\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u7136\u540e\u4f60\u53ef\u4ee5\u4f7f\u7528",(0,s.jsx)(e.code,{children:"CreateConnection<ConcretePacketStream>()"}),"\u5e76\u4e14\n\u751f\u4ea7\u4ee3\u7801\u4e2d\u7684",(0,s.jsx)(e.code,{children:"PacketReader<ConcretePacketStream>"}),"\uff0c\u5e76\u4f7f\u7528\n",(0,s.jsx)(e.code,{children:"CreateConnection<MockPacketStream>()"})," \u548c ",(0,s.jsx)(e.code,{children:"PacketReader<MockPacketStream>"})," \u4e2d\n\u6d4b\u8bd5\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  MockPacketStream mock_stream;\n  EXPECT_CALL(mock_stream, ...)...;\n  .. set more expectations on mock_stream ...\n  PacketReader<MockPacketStream> reader(&mock_stream);\n  ... exercise reader ...\n"})}),"\n",(0,s.jsx)(e.h3,{id:"mocking-free-functions",children:"\u6a21\u62df\u51fd\u6570"}),"\n",(0,s.jsx)(e.p,{children:"\u4e0d\u53ef\u80fd\u76f4\u63a5\u6a21\u62df\u81ea\u7531\u51fd\u6570\uff08\u5373 C \u98ce\u683c\u51fd\u6570\u6216\n\u9759\u6001\u65b9\u6cd5\uff09\u3002\u5982\u679c\u9700\u8981\uff0c\u60a8\u53ef\u4ee5\u91cd\u5199\u4ee3\u7801\u4ee5\u4f7f\u7528\u63a5\u53e3\n\uff08\u62bd\u8c61\u7c7b\uff09\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u4e0d\u8981\u76f4\u63a5\u8c03\u7528\u81ea\u7531\u51fd\u6570\uff08\u4f8b\u5982",(0,s.jsx)(e.code,{children:"OpenFile"}),"\uff09\uff0c\u800c\u662f\u5f15\u5165\u4e00\u4e2a\n\u5b83\u7684\u63a5\u53e3\uff0c\u5e76\u6709\u4e00\u4e2a\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"free"})," \u51fd\u6570\u7684\u5177\u4f53\u5b50\u7c7b\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class FileInterface {\n public:\n  ...\n  virtual bool Open(const char* path, const char* mode) = 0;\n};\n\nclass File : public FileInterface {\n public:\n  ...\n  bool Open(const char* path, const char* mode) override {\n     return OpenFile(path, mode);\n  }\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u7684\u4ee3\u7801\u5e94\u8be5\u4e0e",(0,s.jsx)(e.code,{children:"FileInterface"}),"\u5bf9\u8bdd\u4ee5\u6253\u5f00\u6587\u4ef6\u3002\u73b0\u5728\u5f88\u5bb9\u6613\u5632\u7b11\n\u51fa\u51fd\u6570\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u770b\u8d77\u6765\u4f3c\u4e4e\u5f88\u9ebb\u70e6\uff0c\u4f46\u5b9e\u9645\u4e0a\u4f60\u7ecf\u5e38\u4f1a\u9047\u5230\u591a\u4e2a\u95ee\u9898\u60a8\u53ef\u4ee5\u5c06\u76f8\u5173\u51fd\u6570\u653e\u5165\u540c\u4e00\u754c\u9762\u4e2d\uff0c\u56e0\u6b64\u6bcf\u4e2a\u51fd\u6570\n\u8bed\u6cd5\u5f00\u9500\u4f1a\u4f4e\u5f97\u591a\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u62c5\u5fc3\u865a\u62df\u5316\u5e26\u6765\u7684\u6027\u80fd\u5f00\u9500\u529f\u80fd\uff0c\u5e76\u4e14\u5206\u6790\u8bc1\u5b9e\u4e86\u60a8\u7684\u62c5\u5fe7\uff0c\u60a8\u53ef\u4ee5\u5c06\u5176\u4e0e\n",(0,s.jsx)(e.a,{href:"#MockingNonVirtualMethods",children:"\u6a21\u62df\u975e\u865a\u62df\u65b9\u6cd5"})," \u7684\u914d\u65b9\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"NiceStrictNaggy",children:"\u5584\u826f\u3001\u4e25\u683c\u548c\u65e0\u8da3\u7684\u8c03\u7528"}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u6a21\u62df\u65b9\u6cd5\u6ca1\u6709",(0,s.jsx)(e.code,{children:"EXPECT_CALL"}),"\u89c4\u8303\u4f46\u88ab\u8c03\u7528\uff0c\u6211\u4eec\u8bf4\u5b83\u662f\u4e00\u4e2a\n\u201c\u65e0\u8da3\u7684\u8c03\u7528\u201d\uff0c\u4ee5\u53ca\u9ed8\u8ba4\u64cd\u4f5c\uff08\u53ef\u4ee5\u4f7f\u7528\u6307\u5b9a\n\u5c06\u91c7\u7528\u8be5\u65b9\u6cd5\u7684",(0,s.jsx)(e.code,{children:"ON_CALL()"}),")\u3002\u76ee\u524d\uff0c\u4e00\u4e2a\u65e0\u8da3\u7684\u547c\u53eb\u5c06\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e5f\u4f1a\u5bfc\u81f4 kMock \u6253\u5370\u8b66\u544a\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u7136\u800c\uff0c\u6709\u65f6\u60a8\u53ef\u80fd\u60f3\u5ffd\u7565\u8fd9\u4e9b\u65e0\u8da3\u7684\u8c03\u7528\uff0c\u5e76\u4e14\n\u6709\u65f6\u60a8\u53ef\u80fd\u60f3\u5c06\u5b83\u4eec\u89c6\u4e3a\u9519\u8bef\u3002 kMock \u8ba9\u60a8\u505a\u51fa\u51b3\u5b9a\n\u57fa\u4e8e\u6bcf\u4e2a\u6a21\u62df\u5bf9\u8c61\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u5047\u8bbe\u60a8\u7684\u6d4b\u8bd5\u4f7f\u7528\u6a21\u62df\u7c7b",(0,s.jsx)(e.code,{children:"MockFoo"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"TEST(...) {\n  MockFoo mock_foo;\n  EXPECT_CALL(mock_foo, DoThis());\n  ... code that uses mock_foo ...\n}\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"DoThis()"})," \u4e4b\u5916\u7684 ",(0,s.jsx)(e.code,{children:"mock_foo"})," \u65b9\u6cd5\uff0c\u60a8\u5c06\u5f97\u5230\u4e00\u4e2a\n\u8b66\u544a\u3002\u4f46\u662f\uff0c\u5982\u679c\u60a8\u91cd\u5199\u6d4b\u8bd5\u4ee5\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"NiceMock<MockFoo>"})," \u4ee3\u66ff\uff0c\n\u60a8\u53ef\u4ee5\u6291\u5236\u8b66\u544a\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::NiceMock;\n\nTEST(...) {\n  NiceMock<MockFoo> mock_foo;\n  EXPECT_CALL(mock_foo, DoThis());\n  ... code that uses mock_foo ...\n}\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"NiceMock<MockFoo>"})," \u662f ",(0,s.jsx)(e.code,{children:"MockFoo"})," \u7684\u5b50\u7c7b\uff0c\u6240\u4ee5\u5b83\u53ef\u4ee5\u5728\u4efb\u4f55\u5730\u65b9\u4f7f\u7528\n",(0,s.jsx)(e.code,{children:"MockFoo"})," \u88ab\u63a5\u53d7\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c ",(0,s.jsx)(e.code,{children:"MockFoo"})," \u7684\u6784\u9020\u51fd\u6570\u63a5\u53d7\u4e00\u4e9b\u53c2\u6570\uff0c\u5b83\u4e5f\u53ef\u4ee5\u5de5\u4f5c\uff0c\u5982\n",(0,s.jsx)(e.code,{children:"NiceMock<MockFoo>"})," \u201c\u7ee7\u627f\u201d ",(0,s.jsx)(e.code,{children:"MockFoo"})," \u7684\u6784\u9020\u51fd\u6570\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::NiceMock;\n\nTEST(...) {\n  NiceMock<MockFoo> mock_foo(5, "hi");  // Calls MockFoo(5, "hi").\n  EXPECT_CALL(mock_foo, DoThis());\n  ... code that uses mock_foo ...\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"StrictMock"})," \u7684\u7528\u6cd5\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u5b83\u8ba9\u4e00\u5207\u53d8\u5f97\u65e0\u8da3\n\u8c03\u7528\u5931\u8d25\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::StrictMock;\n\nTEST(...) {\n  StrictMock<MockFoo> mock_foo;\n  EXPECT_CALL(mock_foo, DoThis());\n  ... code that uses mock_foo ...\n\n  // The test will fail if a method of mock_foo other than DoThis()\n  // is called.\n}\n"})}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:["\u6ce8\u610f\uff1a",(0,s.jsx)(e.code,{children:"NiceMock"}),"\u548c",(0,s.jsx)(e.code,{children:"StrictMock"}),"\u4ec5\u5f71\u54cd",(0,s.jsx)(e.em,{children:"\u65e0\u8da3\u7684"}),"\u8c03\u7528\uff08\n",(0,s.jsx)(e.em,{children:"\u65b9\u6cd5"}),"\u6ca1\u6709\u4efb\u4f55\u671f\u671b\uff09\uff1b\u5b83\u4eec\u4e0d\u4f1a\u5f71\u54cd",(0,s.jsx)(e.em,{children:"\u610f\u5916"}),"\u8c03\u7528\uff08\n\u65b9\u6cd5\u7b26\u5408\u9884\u671f\uff0c\u4f46\u5b83\u4eec\u4e0d\u5339\u914d\uff09\u3002\u770b\n",(0,s.jsx)(e.a,{href:"#uninteresting-vs-unexpected",children:"\u4e86\u89e3\u65e0\u8da3\u4e0e\u610f\u5916\u7684\u547c\u53eb"}),"\u3002"]})}),"\n",(0,s.jsx)(e.p,{children:"\u4f46\u6709\u4e00\u4e9b\u8b66\u544a\uff08\u9057\u61be\u7684\u662f\u5b83\u4eec\u662f C++ \u7684\u526f\u4f5c\u7528\uff09\n\u9650\u5236\uff09\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"NiceMock<MockFoo>"})," \u548c ",(0,s.jsx)(e.code,{children:"StrictMock<MockFoo>"})," \u4ec5\u9002\u7528\u4e8e\u6a21\u62df\u65b9\u6cd5\n",(0,s.jsx)(e.strong,{children:"\u76f4\u63a5"}),"\u5728",(0,s.jsx)(e.code,{children:"MockFoo"}),"\u7c7b\u4e2d\u4f7f\u7528",(0,s.jsx)(e.code,{children:"MOCK_METHOD"}),"\u5b8f\u5b9a\u4e49\u3002\n\u5982\u679c\u5728 ",(0,s.jsx)(e.code,{children:"MockFoo"})," \u7684 ",(0,s.jsx)(e.strong,{children:"\u57fa\u7c7b"})," \u4e2d\u5b9a\u4e49\u4e86\u6a21\u62df\u65b9\u6cd5\uff0c\u5219\u201cnice\u201d\u6216\n\u201cstrict\u201d\u4fee\u9970\u7b26\u53ef\u80fd\u4e0d\u4f1a\u5f71\u54cd\u5b83\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u7f16\u8bd1\u5668\u3002\u5728\n\u7279\u522b\u662f\uff0c\u5d4c\u5957\u201cNiceMock\u201d\u548c\u201cStrictMock\u201d\uff08\u4f8b\u5982\n",(0,s.jsx)(e.strong,{children:"\u4e0d"}),"\u652f\u6301 ",(0,s.jsx)(e.code,{children:"NiceMock<StrictMock<MockFoo> >"}),")\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"NiceMock<MockFoo>"})," \u548c ",(0,s.jsx)(e.code,{children:"StrictMock<MockFoo>"})," \u53ef\u80fd\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\uff0c\u5982\u679c\n",(0,s.jsx)(e.code,{children:"MockFoo"})," \u7684\u6790\u6784\u51fd\u6570\u4e0d\u662f\u865a\u62df\u7684\u3002\u6211\u4eec\u60f3\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u662f\n\u9700\u8981\u6e05\u7406\u73b0\u6709\u7684\u6d4b\u8bd5\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u6700\u540e\uff0c\u60a8\u5e94\u8be5",(0,s.jsx)(e.strong,{children:"\u975e\u5e38\u8c28\u614e"}),"\u4f55\u65f6\u4f7f\u7528 naggy \u6216 strict\n\u6a21\u62df\uff0c\u56e0\u4e3a\u5b83\u4eec\u5f80\u5f80\u4f1a\u4f7f\u6d4b\u8bd5\u53d8\u5f97\u66f4\u8106\u5f31\u4e14\u66f4\u96be\u4ee5\u7ef4\u62a4\u3002\u5f53\u4f60\n\u91cd\u6784\u60a8\u7684\u4ee3\u7801\u800c\u4e0d\u6539\u53d8\u5176\u5916\u90e8\u53ef\u89c1\u7684\u884c\u4e3a\uff0c\u7406\u60f3\u60c5\u51b5\u4e0b\u60a8\n\u4e0d\u9700\u8981\u66f4\u65b0\u4efb\u4f55\u6d4b\u8bd5\u3002\u5982\u679c\u4f60\u7684\u4ee3\u7801\u4e0e\u70e6\u4eba\u7684\u6a21\u62df\u4ea4\u4e92\uff0c\n\u4f46\u662f\uff0c\u7531\u4e8e\u60a8\u7684\u64cd\u4f5c\uff0c\u60a8\u53ef\u80fd\u4f1a\u5f00\u59cb\u6536\u5230\u8b66\u544a\u5783\u573e\u90ae\u4ef6\n\u6539\u53d8\u3002\u66f4\u7cdf\u7cd5\u7684\u662f\uff0c\u5982\u679c\u60a8\u7684\u4ee3\u7801\u4e0e\u4e25\u683c\u7684\u6a21\u62df\u4ea4\u4e92\uff0c\u60a8\u7684\u6d4b\u8bd5\u53ef\u80fd\u4f1a\u5f00\u59cb\n\u5931\u8d25\uff0c\u4f60\u5c06\u88ab\u8feb\u4fee\u590d\u5b83\u4eec\u3002\u6211\u4eec\u7684\u4e00\u822c\u5efa\u8bae\u662f\u4f7f\u7528\n\u6f02\u4eae\u7684\u6a21\u62df\uff08\u8fd8\u4e0d\u662f\u9ed8\u8ba4\u7684\uff09\u5927\u591a\u6570\u65f6\u5019\uff0c\u4f7f\u7528 naggy \u6a21\u62df\uff08\u5f53\u524d\u7684\n\u9ed8\u8ba4\uff09\u5728\u5f00\u53d1\u6216\u8c03\u8bd5\u6d4b\u8bd5\u65f6\uff0c\u5e76\u4e14\u4ec5\u4f7f\u7528\u4e25\u683c\u6a21\u62df\u4f5c\u4e3a\n\u6700\u540e\u7684\u624b\u6bb5\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"SimplerInterfaces",children:"\u7b80\u5316\u754c\u9762\u800c\u4e0d\u7834\u574f\u73b0\u6709\u4ee3\u7801"}),"\n",(0,s.jsx)(e.p,{children:"Sometimes a method has a long list of arguments that is mostly uninteresting.\nFor example:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class LogSink {\n public:\n  ...\n  virtual void send(LogSeverity severity, const char* full_filename,\n                    const char* base_filename, int line,\n                    const struct tm* tm_time,\n                    const char* message, size_t message_len) = 0;\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u6b64\u65b9\u6cd5\u7684\u53c2\u6570\u5217\u8868\u5f88\u957f\u4e14\u96be\u4ee5\u4f7f\u7528\uff08",(0,s.jsx)(e.code,{children:"message"}),"\n\u53c2\u6570\u751a\u81f3\u4e0d\u662f 0 \u7ec8\u6b62\u7684\uff09\u3002\u5982\u679c\u6211\u4eec\u6309\u539f\u6837\u6a21\u62df\u5b83\uff0c\u5219\u4f7f\u7528\u6a21\u62df\u5c06\u662f\n\u5c34\u5c2c\u7684\u3002\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u5c1d\u8bd5\u7b80\u5316\u6b64\u754c\u9762\uff0c\u5219\u9700\u8981\u4fee\u590d\u6240\u6709\u95ee\u9898\n\u5ba2\u6237\u4f9d\u8d56\u5b83\uff0c\u8fd9\u901a\u5e38\u662f\u4e0d\u53ef\u884c\u7684\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8bc0\u7a8d\u662f\u91cd\u65b0\u8c03\u5ea6\u6a21\u62df\u7c7b\u4e2d\u7684\u65b9\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class ScopedMockLog : public LogSink {\n public:\n  ...\n  void send(LogSeverity severity, const char* full_filename,\n                    const char* base_filename, int line, const tm* tm_time,\n                    const char* message, size_t message_len) override {\n    // We are only interested in the log severity, full file name, and\n    // log message.\n    Log(severity, full_filename, std::string(message, message_len));\n  }\n\n  // Implements the mock method:\n  //\n  //   void Log(LogSeverity severity,\n  //            const string& file_path,\n  //            const string& message);\n  MOCK_METHOD(void, Log,\n              (LogSeverity severity, const string& file_path,\n               const string& message));\n};\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u901a\u8fc7\u4f7f\u7528\u4fee\u526a\u8fc7\u7684\u53c2\u6570\u5217\u8868\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684\u6a21\u62df\u65b9\u6cd5\uff0c\u6211\u4eec\u4f7f\u6a21\u62df\n\u7c7b\u66f4\u52a0\u4eba\u6027\u5316\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u8be5\u6280\u672f\u4e5f\u53ef\u7528\u4e8e\u4f7f\u91cd\u8f7d\u65b9\u6cd5\u66f4\u9002\u5408\n\u5632\u7b11\u3002\u4f8b\u5982\uff0c\u5f53\u4f7f\u7528\u91cd\u8f7d\u6765\u5b9e\u73b0\u9ed8\u8ba4\u503c\u65f6\n\u8bba\u70b9\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MockTurtleFactory : public TurtleFactory {\n public:\n  Turtle* MakeTurtle(int length, int weight) override { ... }\n  Turtle* MakeTurtle(int length, int weight, int speed) override { ... }\n\n  // the above methods delegate to this one:\n  MOCK_METHOD(Turtle*, DoMakeTurtle, ());\n};\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u5141\u8bb8\u4e0d\u5173\u5fc3\u8c03\u7528\u54ea\u4e2a\u91cd\u8f7d\u7684\u6d4b\u8bd5\u6765\u907f\u514d\u6307\u5b9a\n\u53c2\u6570\u5339\u914d\u5668\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ON_CALL(factory, DoMakeTurtle)\n    .WillByDefault(Return(MakeMockTurtle()));\n"})}),"\n",(0,s.jsx)(e.h3,{id:"alternative-to-mocking-concrete-classes",children:"\u6a21\u62df\u5177\u4f53\u7c7b\u7684\u66ff\u4ee3\u65b9\u6848"}),"\n",(0,s.jsxs)(e.p,{children:["\u901a\u5e38\uff0c\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\u81ea\u5df1\u4f7f\u7528\u4e0d\u5b9e\u73b0\u63a5\u53e3\u7684\u7c7b\u3002\u5728\n\u4e3a\u4e86\u6d4b\u8bd5\u4f7f\u7528\u6b64\u7c7b\u7684\u4ee3\u7801\uff08\u6211\u4eec\u79f0\u4e4b\u4e3a",(0,s.jsx)(e.code,{children:"Concrete"}),"\uff09\uff0c\u60a8\n\u53ef\u80fd\u4f1a\u60f3\u5c06 ",(0,s.jsx)(e.code,{children:"Concrete"})," \u7684\u65b9\u6cd5\u865a\u62df\u5316\uff0c\u7136\u540e\u6a21\u62df\u5b83\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u5c3d\u91cf\u4e0d\u8981\u8fd9\u6837\u505a\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5c06\u975e\u865a\u62df\u51fd\u6570\u8bbe\u4e3a\u865a\u62df\u662f\u4e00\u4e2a\u91cd\u5927\u51b3\u5b9a\u3002\u5b83\u521b\u5efa\u4e86\u4e00\u4e2a\u6269\u5c55\n\u5b50\u7c7b\u53ef\u4ee5\u8c03\u6574\u7c7b\u7684\u884c\u4e3a\u3002\u8fd9\u4f1a\u524a\u5f31\u4f60\u7684\u63a7\u5236\u529b\n\u5728\u7c7b\u4e0a\uff0c\u56e0\u4e3a\u73b0\u5728\u7ef4\u62a4\u7c7b\u4e0d\u53d8\u91cf\u53d8\u5f97\u66f4\u52a0\u56f0\u96be\u3002\u4f60\n\u4ec5\u5f53\u6709\u6b63\u5f53\u7406\u7531\u9700\u8981\u5b50\u7c7b\u65f6\u624d\u5e94\u5c06\u51fd\u6570\u8bbe\u4e3a\u865a\u62df\n\u8986\u76d6\u5b83\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u76f4\u63a5\u6a21\u62df\u5177\u4f53\u7c7b\u662f\u6709\u95ee\u9898\u7684\uff0c\u56e0\u4e3a\u5b83\u4f1a\u4ea7\u751f\u7d27\u5bc6\u8026\u5408\n\u5728\u8bfe\u5802\u548c\u6d4b\u8bd5\u4e4b\u95f4 - \u8bfe\u5802\u4e0a\u7684\u4efb\u4f55\u5fae\u5c0f\u53d8\u5316\u90fd\u53ef\u80fd\u65e0\u6548\n\u60a8\u7684\u6d4b\u8bd5\u5e76\u4f7f\u6d4b\u8bd5\u7ef4\u62a4\u53d8\u5f97\u75db\u82e6\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u4e3a\u4e86\u907f\u514d\u6b64\u7c7b\u95ee\u9898\uff0c\u8bb8\u591a\u7a0b\u5e8f\u5458\u4e00\u76f4\u5728\u7ec3\u4e60",(0,s.jsx)(e.code,{children:'\u7f16\u7801\u5230 \u63a5\u53e3("coding to interfaces")'}),"\uff1a\u60a8\u7684\u4ee3\u7801\u5c06\u5b9a\u4e49\u800c\u4e0d\u662f\u4e0e",(0,s.jsx)(e.code,{children:"Concrete"}),"\u7c7b\u5bf9\u8bdd\n\u4e00\u4e2a\u754c\u9762\u5e76\u4e0e\u4e4b\u4ea4\u8c08\u3002\u7136\u540e\u4f60\u5c06\u8be5\u63a5\u53e3\u5b9e\u73b0\u4e3a\u9002\u914d\u5668\n",(0,s.jsx)(e.code,{children:"Concrete"}),"\u7684\u9876\u90e8\u3002\u5728\u6d4b\u8bd5\u4e2d\uff0c\u60a8\u53ef\u4ee5\u8f7b\u677e\u6a21\u62df\u8be5\u754c\u9762\u4ee5\u89c2\u5bdf\u5982\u4f55\n\u4f60\u7684\u4ee3\u7801\u6b63\u5728\u505a\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u79cd\u6280\u672f\u4f1a\u4ea7\u751f\u4e00\u4e9b\u5f00\u9500\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u60a8\u652f\u4ed8\u865a\u51fd\u6570\u8c03\u7528\u7684\u6210\u672c\uff08\u901a\u5e38\u4e0d\u662f\u95ee\u9898\uff09\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u6709\u66f4\u591a\u7684\u62bd\u8c61\u53ef\u4f9b\u7a0b\u5e8f\u5458\u5b66\u4e60\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u7136\u800c\uff0c\u9664\u4e86\u66f4\u597d\u7684\u6548\u679c\u4e4b\u5916\uff0c\u5b83\u8fd8\u53ef\u4ee5\u5e26\u6765\u663e\u7740\u7684\u597d\u5904\u3002\n\u53ef\u6d4b\u8bd5\u6027\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"Concrete"})," \u7684 API \u53ef\u80fd\u4e0d\u592a\u9002\u5408\u60a8\u7684\u95ee\u9898\u9886\u57df\uff0c\u56e0\u4e3a\u60a8\u53ef\u80fd\u4e0d\u9002\u5408\n\u6210\u4e3a\u5b83\u8bd5\u56fe\u670d\u52a1\u7684\u552f\u4e00\u5ba2\u6237\u3002\u901a\u8fc7\u8bbe\u8ba1\u81ea\u5df1\u7684\u754c\u9762\uff0c\u60a8\n\u6709\u673a\u4f1a\u6839\u636e\u60a8\u7684\u9700\u8981\u5b9a\u5236\u5b83 - \u60a8\u53ef\u4ee5\u6dfb\u52a0\u66f4\u9ad8\u7ea7\u522b\u7684\n\u529f\u80fd\u3001\u91cd\u547d\u540d\u7b49\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u4fee\u526a\u7c7b\u3002\u8fd9\n\u5141\u8bb8\u60a8\u4ee5\u66f4\u81ea\u7136\u7684\u65b9\u5f0f\u7f16\u5199\u4ee3\u7801\uff08\u754c\u9762\u7684\u7528\u6237\uff09\uff0c\n\u8fd9\u610f\u5473\u7740\u5b83\u5c06\u66f4\u5177\u53ef\u8bfb\u6027\uff0c\u66f4\u6613\u4e8e\u7ef4\u62a4\uff0c\u5e76\u4e14\u60a8\u4f1a\u66f4\u5bb9\u6613\n\u5bcc\u6709\u6210\u6548\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5982\u679c ",(0,s.jsx)(e.code,{children:"Concrete"})," \u7684\u5b9e\u73b0\u9700\u8981\u6539\u53d8\uff0c\u4f60\u4e0d\u5fc5\u91cd\u5199\n\u5b83\u65e0\u5904\u4e0d\u5728\u3002\u76f8\u53cd\uff0c\u4f60\u53ef\u4ee5\u5438\u6536\u4f60\u7684\u53d8\u5316\n\u63a5\u53e3\u7684\u5b9e\u73b0\uff0c\u4ee5\u53ca\u60a8\u7684\u5176\u4ed6\u4ee3\u7801\u548c\u6d4b\u8bd5\u5c06\u662f\n\u514d\u53d7\u8fd9\u79cd\u53d8\u5316\u7684\u5f71\u54cd\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u6709\u4eba\u62c5\u5fc3\uff0c\u5982\u679c\u6bcf\u4e2a\u4eba\u90fd\u7ec3\u4e60\u8fd9\u79cd\u6280\u672f\uff0c\u4ed6\u4eec\u5c31\u4f1a\u7ed3\u675f\n\u5199\u4e86\u5f88\u591a\u5197\u4f59\u4ee3\u7801\u3002\u8fd9\u79cd\u62c5\u5fe7\u662f\u5b8c\u5168\u53ef\u4ee5\u7406\u89e3\u7684\u3002\n\u7136\u800c\uff0c\u6709\u4e24\u4e2a\u539f\u56e0\u53ef\u80fd\u5bfc\u81f4\u60c5\u51b5\u5e76\u975e\u5982\u6b64\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u4e0d\u540c\u7684\u9879\u76ee\u53ef\u80fd\u9700\u8981\u4ee5\u4e0d\u540c\u7684\u65b9\u5f0f\u4f7f\u7528",(0,s.jsx)(e.code,{children:"Concrete"}),"\uff0c\u6240\u4ee5\u6700\u597d\n\u4ed6\u4eec\u7684\u754c\u9762\u4f1a\u6709\u6240\u4e0d\u540c\u3002\u56e0\u6b64\uff0c\u4ed6\u4eec\u6bcf\u4e2a\u4eba\u90fd\u4f1a\u6709\u81ea\u5df1\u7684\n\u5728\u201cConcrete\u201d\u4e4b\u4e0a\u62e5\u6709\u81ea\u5df1\u7684\u7279\u5b9a\u4e8e\u9886\u57df\u7684\u63a5\u53e3\uff0c\u5e76\u4e14\u5b83\u4eec\u4e0d\u4f1a\u662f\n\u76f8\u540c\u7684\u4ee3\u7801\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5982\u679c\u6709\u8db3\u591f\u591a\u7684\u9879\u76ee\u60f3\u8981\u4f7f\u7528\u76f8\u540c\u7684\u63a5\u53e3\uff0c\u4ed6\u4eec\u603b\u662f\u53ef\u4ee5\u5171\u4eab\u5b83\uff0c\n\u5c31\u50cf\u4ed6\u4eec\u4e00\u76f4\u5728\u5206\u4eab\u201c\u6df7\u51dd\u571f\u201d\u4e00\u6837\u3002\u60a8\u53ef\u4ee5\u5728\u754c\u9762\u4e2d\u67e5\u770b\n\u9002\u914d\u5668\u4f4d\u4e8e ",(0,s.jsx)(e.code,{children:"Concrete"})," \u9644\u8fd1\uff08\u53ef\u80fd\u5728 ",(0,s.jsx)(e.code,{children:"contrib"})," \u4e2d\uff09\n\u5b50\u76ee\u5f55\uff09\u5e76\u8ba9\u8bb8\u591a\u9879\u76ee\u4f7f\u7528\u5b83\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u9700\u8981\u9488\u5bf9\u60a8\u7684\u7279\u5b9a\u95ee\u9898\u4ed4\u7ec6\u6743\u8861\u5229\u5f0a\uff0c\u4f46\u662f\n\u6211\u60f3\u5411\u60a8\u4fdd\u8bc1\uff0cJava \u793e\u533a\u5df2\u7ecf\u5b9e\u8df5\u8fd9\u4e00\u70b9\u5f88\u4e45\u4e86\n\u7ecf\u8fc7\u5f88\u957f\u65f6\u95f4\u7684\u8003\u9a8c\uff0c\u8fd9\u662f\u4e00\u79cd\u884c\u4e4b\u6709\u6548\u7684\u6280\u672f\uff0c\u9002\u7528\u4e8e\u591a\u79cd\u9886\u57df\n\u60c5\u51b5\u3002 :-)"}),"\n",(0,s.jsx)(e.h3,{id:"DelegatingToFake",children:"\u5c06\u547c\u53eb\u59d4\u6258\u7ed9fake"}),"\n",(0,s.jsx)(e.p,{children:"\u6709\u65f6\uff0c\u60a8\u6709\u4e00\u4e2a\u4e0d\u5e73\u51e1\u7684\u5047\u63a5\u53e3\u5b9e\u73b0\u3002\u4e3a\u4e86\n\u4f8b\u5b50\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class Foo {\n public:\n  virtual ~Foo() {}\n  virtual char DoThis(int n) = 0;\n  virtual void DoThat(const char* s, int* p) = 0;\n};\n\nclass FakeFoo : public Foo {\n public:\n  char DoThis(int n) override {\n    return (n > 0) ? '+' :\n           (n < 0) ? '-' : '0';\n  }\n\n  void DoThat(const char* s, int* p) override {\n    *p = strlen(s);\n  }\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u73b0\u5728\u60a8\u60f3\u8981\u6a21\u62df\u6b64\u63a5\u53e3\uff0c\u4ee5\u4fbf\u60a8\u53ef\u4ee5\u5bf9\u5176\u8bbe\u7f6e\u671f\u671b\u3002\n\u4f46\u662f\uff0c\u60a8\u8fd8\u60f3\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"FakeFoo"})," \u4f5c\u4e3a\u9ed8\u8ba4\u884c\u4e3a\uff0c\u56e0\u4e3a\u590d\u5236\n\u5b83\u5728\u6a21\u62df\u5bf9\u8c61\u4e2d\u662f\uff0c\u55ef\uff0c\u5f88\u591a\u5de5\u4f5c\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u60a8\u4f7f\u7528 kMock \u5b9a\u4e49\u6a21\u62df\u7c7b\u65f6\uff0c\u60a8\u53ef\u4ee5\u8ba9\u5b83\u59d4\u6258\u5176\u9ed8\u8ba4\u503c\n\u4f7f\u7528\u4ee5\u4e0b\u6a21\u5f0f\u5bf9\u60a8\u5df2\u7ecf\u62e5\u6709\u7684\u5047\u7c7b\u6267\u884c\u64cd\u4f5c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MockFoo : public Foo {\n public:\n  // Normal mock method definitions using kMock.\n  MOCK_METHOD(char, DoThis, (int n), (override));\n  MOCK_METHOD(void, DoThat, (const char* s, int* p), (override));\n\n  // Delegates the default actions of the methods to a FakeFoo object.\n  // This must be called *before* the custom ON_CALL() statements.\n  void DelegateToFake() {\n    ON_CALL(*this, DoThis).WillByDefault([this](int n) {\n      return fake_.DoThis(n);\n    });\n    ON_CALL(*this, DoThat).WillByDefault([this](const char* s, int* p) {\n      fake_.DoThat(s, p);\n    });\n  }\n\n private:\n  FakeFoo fake_;  // Keeps an instance of the fake in the mock.\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u6837\uff0c\u60a8\u5c31\u53ef\u4ee5\u50cf\u5f80\u5e38\u4e00\u6837\u5728\u6d4b\u8bd5\u4e2d\u4f7f\u7528",(0,s.jsx)(e.code,{children:"MockFoo"}),"\u4e86\u3002\u53ea\u8981\u8bb0\u4f4f\uff0c\u5982\u679c\n\u60a8\u6ca1\u6709\u5728",(0,s.jsx)(e.code,{children:"ON_CALL()"}),"\u6216",(0,s.jsx)(e.code,{children:"EXPECT_CALL()"}),"\u4e2d\u663e\u5f0f\u8bbe\u7f6e\u64cd\u4f5c\uff0c\n\u5047\u8d27\u5c06\u88ab\u8981\u6c42\u8fd9\u6837\u505a\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\n\nTEST(AbcTest, Xyz) {\n  MockFoo foo;\n\n  foo.DelegateToFake();  // Enables the fake for delegation.\n\n  // Put your ON_CALL(foo, ...)s here, if any.\n\n  // No action specified, meaning to use the default action.\n  EXPECT_CALL(foo, DoThis(5));\n  EXPECT_CALL(foo, DoThat(_, _));\n\n  int n = 0;\n  EXPECT_EQ('+', foo.DoThis(5));  // FakeFoo::DoThis() is invoked.\n  foo.DoThat(\"Hi\", &n);  // FakeFoo::DoThat() is invoked.\n  EXPECT_EQ(2, n);\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u4e00\u4e9b\u63d0\u793a\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u9700\u8981\uff0c\u60a8\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7\u63d0\u4f9b\u81ea\u5df1\u7684\u64cd\u4f5c\u6765\u8986\u76d6\u9ed8\u8ba4\u64cd\u4f5c\n",(0,s.jsx)(e.code,{children:"ON_CALL()"})," \u6216\u5728 ",(0,s.jsx)(e.code,{children:"EXPECT_CALL()"})," \u4e2d\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:".WillOnce()"})," / ",(0,s.jsx)(e.code,{children:".WillRepeatedly()"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u5728",(0,s.jsx)(e.code,{children:"DelegateToFake()"}),"\u4e2d\uff0c\u53ea\u9700\u8981\u59d4\u6258\u90a3\u4e9bfake\u7684\u65b9\u6cd5\n\u60a8\u6253\u7b97\u4f7f\u7528\u7684\u5b9e\u73b0\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u91cc\u8ba8\u8bba\u7684\u4e00\u822c\u6280\u672f\u9002\u7528\u4e8e\u91cd\u8f7d\u65b9\u6cd5\uff0c\u4f46\u662f\n\u60a8\u9700\u8981\u544a\u8bc9\u7f16\u8bd1\u5668\u60a8\u6307\u7684\u662f\u54ea\u4e2a\u7248\u672c\u3002\u4e3a\u4e86\u6d88\u9664\u6b67\u4e49\n\u6a21\u62df\u51fd\u6570\uff08\u60a8\u5728",(0,s.jsx)(e.code,{children:"ON_CALL()"}),"\u62ec\u53f7\u5185\u6307\u5b9a\u7684\u51fd\u6570\uff09\uff0c\n\u4f7f\u7528",(0,s.jsx)(e.a,{href:"#SelectOverload",children:"\u6b64\u6280\u672f"}),"\uff1b\u6d88\u9664\u4f2a\u51fd\u6570\u7684\u6b67\u4e49\uff08\n\u653e\u7f6e\u5728 ",(0,s.jsx)(e.code,{children:"Invoke()"})," \u4e2d\u7684\u4e00\u4e2a\uff09\uff0c\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"static_cast"})," \u6765\u6307\u5b9a\n\u51fd\u6570\u7684\u7c7b\u578b\u3002\u4f8b\u5982\uff0c\u5982\u679c\u7c7b ",(0,s.jsx)(e.code,{children:"Foo"})," \u6709\u65b9\u6cd5 ",(0,s.jsx)(e.code,{children:"char DoThis(int n)"})," \u548c ",(0,s.jsx)(e.code,{children:"bool DoThis(double x) const"}),"\uff0c\u5e76\u4e14\u60a8\u60f3\u8c03\u7528\u540e\u8005\uff0c\n\u4f60\u9700\u8981\u5199",(0,s.jsx)(e.code,{children:"Invoke(&fake_, static_cast<bool (FakeFoo::*)(double) const>(&FakeFoo::DoThis))"})," \u800c\u4e0d\u662f ",(0,s.jsx)(e.code,{children:"Invoke(&fake_, &FakeFoo::DoThis)"}),"\n\uff08",(0,s.jsx)(e.code,{children:"static_cast"})," \u5c16\u62ec\u53f7\u5185\u770b\u8d77\u6765\u5947\u602a\u7684\u4e1c\u897f\u662f\n\u6307\u5411\u7b2c\u4e8c\u4e2a ",(0,s.jsx)(e.code,{children:"DoThis()"})," \u65b9\u6cd5\u7684\u51fd\u6570\u6307\u9488\u7684\u7c7b\u578b\u3002\uff09\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u5fc5\u987b\u6df7\u5408\u6a21\u62df\u548c\u5047\u901a\u5e38\u662f\u51fa\u73b0\u95ee\u9898\u7684\u8ff9\u8c61\u3002\n\u4e5f\u8bb8\u60a8\u8fd8\u6ca1\u6709\u4e60\u60ef\u57fa\u4e8e\u4ea4\u4e92\u7684\u6d4b\u8bd5\u65b9\u5f0f\u3002\u6216\u8005\n\u4e5f\u8bb8\u4f60\u7684\u754c\u9762\u627f\u62c5\u4e86\u592a\u591a\u7684\u89d2\u8272\uff0c\u5e94\u8be5\u5206\u5f00\u3002\n\u56e0\u6b64\uff0c",(0,s.jsx)(e.strong,{children:"\u4e0d\u8981\u6ee5\u7528\u8fd9\u4e2a"}),"\u3002\u6211\u4eec\u53ea\u5efa\u8bae\u5c06\u5176\u4f5c\u4e3a\n\u91cd\u6784\u4ee3\u7801\u65f6\u7684\u4e2d\u95f4\u6b65\u9aa4\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5173\u4e8e\u6df7\u5408\u6a21\u62df\u548c\u5047\u7684\u6280\u5de7\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u4f8b\u5b50\u8bf4\u660e\u4e3a\u4ec0\u4e48\u5b83\u53ef\u80fd\n\u8fd9\u662f\u4e00\u4e2a\u574f\u5146\u5934\uff1a\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u7528\u4e8e\u4f4e\u7ea7\u7cfb\u7edf\u7684\u7c7b",(0,s.jsx)(e.code,{children:"System"}),"\n\u8fd0\u8425\u3002\u7279\u522b\u662f\uff0c\u5b83\u6267\u884c\u6587\u4ef6\u548c I/O \u64cd\u4f5c\u3002\u5047\u8bbe\u4f60\u60f3\u8981\n\u6d4b\u8bd5\u4f60\u7684\u4ee3\u7801\u5982\u4f55\u4f7f\u7528",(0,s.jsx)(e.code,{children:"System"}),"\u8fdb\u884c I/O\uff0c\u800c\u4f60\u53ea\u9700\u8981\u8be5\u6587\u4ef6\n\u64cd\u4f5c\u624d\u80fd\u6b63\u5e38\u8fdb\u884c\u3002\u5982\u679c\u4f60\u6a21\u62df\u6574\u4e2a",(0,s.jsx)(e.code,{children:"System"}),"\u7c7b\uff0c\u4f60\u4f1a\n\u5fc5\u987b\u4e3a\u6587\u4ef6\u64cd\u4f5c\u90e8\u5206\u63d0\u4f9b\u4e00\u4e2a\u5047\u7684\u5b9e\u73b0\uff0c\n\u8868\u660e\u201cSystem\u201d\u626e\u6f14\u4e86\u592a\u591a\u89d2\u8272\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u76f8\u53cd\uff0c\u60a8\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a",(0,s.jsx)(e.code,{children:"FileOps"}),"\u63a5\u53e3\u548c\u4e00\u4e2a",(0,s.jsx)(e.code,{children:"IOOps"}),"\u63a5\u53e3\uff0c\u5e76\u5c06",(0,s.jsx)(e.code,{children:"System"}),"\u7684\u529f\u80fd\u62c6\u5206\u4e3a\u4e24\u4e2a\u63a5\u53e3\u3002\u7136\u540e\u4f60\u53ef\u4ee5\u6a21\u62df",(0,s.jsx)(e.code,{children:"IOOps"}),"\u800c\u4e0d\u6a21\u62df",(0,s.jsx)(e.code,{children:"FileOps"}),"\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u5c06\u8c03\u7528\u59d4\u6258\u7ed9\u771f\u5b9e\u5bf9\u8c61",children:"\u5c06\u8c03\u7528\u59d4\u6258\u7ed9\u771f\u5b9e\u5bf9\u8c61"}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u4f7f\u7528\u6d4b\u8bd5\u66ff\u8eab\uff08mocks\u3001fakes\u3001stubs \u7b49\uff09\u65f6\uff0c\u6709\u65f6\u4ed6\u4eec\u7684\n\u884c\u4e3a\u5c06\u4e0e\u771f\u5b9e\u5bf9\u8c61\u7684\u884c\u4e3a\u6709\u6240\u4e0d\u540c\u3002\u8fd9\u4e2a\u5dee\u5f02\u53ef\u80fd\u662f\n\u8981\u4e48\u662f\u6545\u610f\u7684\uff08\u4f8b\u5982\u6a21\u62df\u9519\u8bef\uff0c\u4ee5\u4fbf\u60a8\u53ef\u4ee5\u6d4b\u8bd5\u9519\u8bef\n\u5904\u7406\u4ee3\u7801\uff09\u6216\u65e0\u610f\u7684\u3002\u5982\u679c\u4f60\u7684\u6a21\u62df\u6709\u4e0d\u540c\u7684\u884c\u4e3a\n\u5982\u679c\u9519\u8bef\u5730\u4f7f\u7528\u771f\u5b9e\u7684\u5bf9\u8c61\uff0c\u60a8\u6700\u7ec8\u53ef\u80fd\u4f1a\u5f97\u5230\u901a\u8fc7\u6d4b\u8bd5\u7684\u4ee3\u7801\uff0c\u4f46\u662f\n\u751f\u4ea7\u5931\u8d25\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u53ef\u4ee5\u4f7f\u7528 ",(0,s.jsx)(e.em,{children:"delegating-to-real"})," \u6280\u672f\u6765\u786e\u4fdd\u60a8\u7684\u6a21\u62df\u5177\u6709\n\u4e0e\u771f\u5b9e\u5bf9\u8c61\u5177\u6709\u76f8\u540c\u7684\u884c\u4e3a\uff0c\u540c\u65f6\u4fdd\u7559\u9a8c\u8bc1\u8c03\u7528\u7684\u80fd\u529b\u3002\n\u8fd9\u79cd\u6280\u672f\u4e0e ",(0,s.jsx)(e.a,{href:"#DelegatingToFake",children:"delegating-to-fake"})," \u975e\u5e38\u76f8\u4f3c\n\u6280\u672f\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u6211\u4eec\u4f7f\u7528\u771f\u5b9e\u7684\u7269\u4f53\u800c\u4e0d\u662f\u5047\u7684\u3002\n\u8fd9\u662f\u4e00\u4e2a\u4f8b\u5b50\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::AtLeast;\n\nclass MockFoo : public Foo {\n public:\n  MockFoo() {\n    // By default, all calls are delegated to the real object.\n    ON_CALL(*this, DoThis).WillByDefault([this](int n) {\n      return real_.DoThis(n);\n    });\n    ON_CALL(*this, DoThat).WillByDefault([this](const char* s, int* p) {\n      real_.DoThat(s, p);\n    });\n    ...\n  }\n  MOCK_METHOD(char, DoThis, ...);\n  MOCK_METHOD(void, DoThat, ...);\n  ...\n private:\n  Foo real_;\n};\n\n...\n  MockFoo mock;\n  EXPECT_CALL(mock, DoThis())\n      .Times(3);\n  EXPECT_CALL(mock, DoThat("Hi"))\n      .Times(AtLeast(1));\n  ... use mock in test ...\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u6837\uff0ckMock \u5c06\u9a8c\u8bc1\u60a8\u7684\u4ee3\u7801\u662f\u5426\u8fdb\u884c\u4e86\u6b63\u786e\u7684\u8c03\u7528\uff08\u4f7f\u7528\u6b63\u786e\u7684\n\u53c2\u6570\uff0c\u4ee5\u6b63\u786e\u7684\u987a\u5e8f\uff0c\u8c03\u7528\u6b63\u786e\u7684\u6b21\u6570\u7b49\uff09\uff0c\u4ee5\u53ca\n\u771f\u5b9e\u5bf9\u8c61\u5c06\u5e94\u7b54\u8c03\u7528\uff08\u56e0\u6b64\u884c\u4e3a\u5c06\u4e0e\n\u751f\u4ea7\uff09\u3002\u8fd9\u8ba9\u60a8\u4e24\u5168\u5176\u7f8e\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"delegating-calls-to-a-parent-class",children:"\u5c06\u8c03\u7528\u59d4\u6258\u7ed9\u7236\u7c7b"}),"\n",(0,s.jsx)(e.p,{children:"\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u60a8\u5e94\u8be5\u5bf9\u63a5\u53e3\u8fdb\u884c\u7f16\u7801\uff0c\u5176\u65b9\u6cd5\u90fd\u662f\u7eaf\u865a\u62df\u7684\u3002\u5728\n\u73b0\u5b9e\u4e2d\uff0c\u6709\u65f6\u4f60\u786e\u5b9e\u9700\u8981\u6a21\u62df\u4e00\u4e2a\u4e0d\u7eaf\u7684\u865a\u62df\u65b9\u6cd5\uff08\u5373\uff0c\n\u5b83\u5df2\u7ecf\u6709\u4e00\u4e2a\u5b9e\u73b0\uff09\u3002\u4f8b\u5982\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class Foo {\n public:\n  virtual ~Foo();\n\n  virtual void Pure(int n) = 0;\n  virtual int Concrete(const char* str) { ... }\n};\n\nclass MockFoo : public Foo {\n public:\n  // Mocking a pure method.\n  MOCK_METHOD(void, Pure, (int n), (override));\n  // Mocking a concrete method.  Foo::Concrete() is shadowed.\n  MOCK_METHOD(int, Concrete, (const char* str), (override));\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u6709\u65f6\u4f60\u53ef\u80fd\u60f3\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"Foo::Concrete()"})," \u800c\u4e0d\u662f\n",(0,s.jsx)(e.code,{children:"MockFoo::Concrete()"}),"\u3002\u4e5f\u8bb8\u60a8\u60f3\u5c06\u5176\u4f5c\u4e3a\u5b58\u6839\u64cd\u4f5c\u7684\u4e00\u90e8\u5206\u6765\u6267\u884c\uff0c\u6216\u8005\n\u4e5f\u8bb8\u4f60\u7684\u6d4b\u8bd5\u6839\u672c\u4e0d\u9700\u8981\u6a21\u62df ",(0,s.jsx)(e.code,{children:"Concrete()"})," \uff08\u4f46\u5b83\u4f1a\u662f\n\u54e6\uff0c\u5f53\u4f60\u4e0d\u9700\u8981\u6a21\u62df\u65f6\uff0c\u5fc5\u987b\u5b9a\u4e49\u4e00\u4e2a\u65b0\u7684\u6a21\u62df\u7c7b\uff0c\u771f\u662f\u592a\u75db\u82e6\u4e86\n\u5176\u65b9\u6cd5\u4e4b\u4e00\uff09\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5728\u64cd\u4f5c\u5185\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"Foo::Concrete()"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"...\n  EXPECT_CALL(foo, Concrete).WillOnce([&foo](const char* str) {\n    return foo.Foo::Concrete(str);\n  });\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u6216\u8005\u544a\u8bc9\u6a21\u62df\u5bf9\u8c61\u60a8\u4e0d\u60f3\u6a21\u62df ",(0,s.jsx)(e.code,{children:"Concrete()"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"...\n  ON_CALL(foo, Concrete).WillByDefault([&foo](const char* str) {\n    return foo.Foo::Concrete(str);\n  });\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\uff08\u4e3a\u4ec0\u4e48\u6211\u4eec\u4e0d\u76f4\u63a5\u5199 ",(0,s.jsx)(e.code,{children:"{ return foo.Concrete(str); }"}),"\uff1f\u5982\u679c\u4f60\u8fd9\u6837\u505a\uff0c\n",(0,s.jsx)(e.code,{children:"MockFoo::Concrete()"})," \u5c06\u88ab\u8c03\u7528\uff08\u5e76\u5bfc\u81f4\u65e0\u9650\u9012\u5f52\uff09\uff0c\u56e0\u4e3a\n",(0,s.jsx)(e.code,{children:"Foo::Concrete()"})," \u662f\u865a\u62df\u7684\u3002\u8fd9\u5c31\u662f C++ \u7684\u5de5\u4f5c\u539f\u7406\u3002\uff09"]}),"\n",(0,s.jsx)(e.h2,{id:"using-matchers",children:"\u4f7f\u7528\u5339\u914d\u5668"}),"\n",(0,s.jsx)(e.h3,{id:"matching-argument-values-exactly",children:"\u7cbe\u786e\u5339\u914d\u53c2\u6570\u503c"}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u53ef\u4ee5\u51c6\u786e\u6307\u5b9a\u6a21\u62df\u65b9\u6cd5\u9700\u8981\u54ea\u4e9b\u53c2\u6570\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::Return;\n...\n  EXPECT_CALL(foo, DoThis(5))\n      .WillOnce(Return('a'));\n  EXPECT_CALL(foo, DoThat(\"Hello\", bar));\n"})}),"\n",(0,s.jsx)(e.h3,{id:"using-simple-matchers",children:"\u4f7f\u7528\u7b80\u5355\u5339\u914d\u5668"}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u53ef\u4ee5\u4f7f\u7528\u5339\u914d\u5668\u6765\u5339\u914d\u5177\u6709\u7279\u5b9a\u5c5e\u6027\u7684\u53c2\u6570\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::NotNull;\nusing ::testing::Return;\n...\n  EXPECT_CALL(foo, DoThis(Ge(5)))  // The argument must be >= 5.\n      .WillOnce(Return('a'));\n  EXPECT_CALL(foo, DoThat(\"Hello\", NotNull()));\n      // The second argument must not be NULL.\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5e38\u7528\u7684\u5339\u914d\u5668\u662f",(0,s.jsx)(e.code,{children:"_"}),"\uff0c\u5b83\u53ef\u4ee5\u5339\u914d\u4efb\u4f55\u5185\u5bb9\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  EXPECT_CALL(foo, DoThat(_, NotNull()));\n"})}),"\n",(0,s.jsx)(e.h3,{id:"CombiningMatchers",children:"\u7ec4\u5408\u5339\u914d\u5668"}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u53ef\u4ee5\u4f7f\u7528",(0,s.jsx)(e.code,{children:"AllOf()"}),"\u4ece\u73b0\u6709\u5339\u914d\u5668\u6784\u5efa\u590d\u6742\u7684\u5339\u914d\u5668\uff0c\n",(0,s.jsx)(e.code,{children:"AllOfArray()"}),"\u3001",(0,s.jsx)(e.code,{children:"AnyOf()"}),"\u3001",(0,s.jsx)(e.code,{children:"AnyOfArray()"})," \u548c ",(0,s.jsx)(e.code,{children:"Not()"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::AllOf;\nusing ::testing::Gt;\nusing ::testing::HasSubstr;\nusing ::testing::Ne;\nusing ::testing::Not;\n...\n  // The argument must be > 5 and != 10.\n  EXPECT_CALL(foo, DoThis(AllOf(Gt(5),\n                                Ne(10))));\n\n  // The first argument must not contain sub-string "blah".\n  EXPECT_CALL(foo, DoThat(Not(HasSubstr("blah")),\n                          NULL));\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5339\u914d\u5668\u662f\u51fd\u6570\u5bf9\u8c61\uff0c\u53c2\u6570\u5316\u5339\u914d\u5668\u53ef\u4ee5\u76f4\u63a5\u7ec4\u6210\n\u5c31\u50cf\u4efb\u4f55\u5176\u4ed6\u529f\u80fd\u4e00\u6837\u3002\u7136\u800c\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u7c7b\u578b\u53ef\u80fd\u5f88\u957f\u5e76\u4e14\u5f88\u5c11\n\u63d0\u4f9b\u6709\u610f\u4e49\u7684\u4fe1\u606f\uff0c\u7528C++14\u53ef\u4ee5\u66f4\u5bb9\u6613\u5730\u8868\u8fbe\u5b83\u4eec\n\u6cdb\u578b lambda \u4ee5\u907f\u514d\u6307\u5b9a\u7c7b\u578b\u3002\u4f8b\u5982\uff0c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::Contains;\nusing ::testing::Property;\n\ninline constexpr auto HasFoo = [](const auto& f) {\n  return Property(&MyClass::foo, Contains(f));\n};\n...\n  EXPECT_THAT(x, HasFoo("blah"));\n'})}),"\n",(0,s.jsx)(e.h3,{id:"SafeMatcherCast",children:"\u9009\u89d2\u5339\u914d\u5668"}),"\n",(0,s.jsxs)(e.p,{children:["kMock \u5339\u914d\u5668\u662f\u9759\u6001\u7c7b\u578b\u7684\uff0c\u8fd9\u610f\u5473\u7740\u7f16\u8bd1\u5668\u53ef\u4ee5\u6355\u83b7\u60a8\u7684\n\u5982\u679c\u60a8\u4f7f\u7528\u9519\u8bef\u7c7b\u578b\u7684\u5339\u914d\u5668\uff0c\u5219\u4f1a\u51fa\u9519\uff08\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4f7f\u7528",(0,s.jsx)(e.code,{children:"Eq(5)"}),"\n\u5339\u914d",(0,s.jsx)(e.code,{children:"string"}),"\u53c2\u6570\uff09\u3002\u5bf9\u4f60\u6709\u597d\u5904\uff01"]}),"\n",(0,s.jsxs)(e.p,{children:["\u7136\u800c\uff0c\u6709\u65f6\uff0c\u60a8\u77e5\u9053\u81ea\u5df1\u5728\u505a\u4ec0\u4e48\uff0c\u5e76\u5e0c\u671b\u7f16\u8bd1\u5668\u4e3a\u60a8\u63d0\u4f9b\n\u6709\u4e9b\u61c8\u6020\u3002\u4e00\u4e2a\u4f8b\u5b50\u662f\u4f60\u6709\u4e00\u4e2a\u201clong\u201d\u5339\u914d\u5668\u548c\u53c2\u6570\n\u4f60\u60f3\u8981\u5339\u914d\u7684\u662f",(0,s.jsx)(e.code,{children:"int"}),"\u3002\u867d\u7136\u8fd9\u4e24\u79cd\u7c7b\u578b\u5e76\u4e0d\u5b8c\u5168\u76f8\u540c\uff0c\u4f46\n\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"Matcher<long>"})," \u6765\u5339\u914d ",(0,s.jsx)(e.code,{children:"int"})," \u5e76\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898 - \u4e4b\u540e\n\u6240\u6709\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u5c06",(0,s.jsx)(e.code,{children:"int"}),"\u53c2\u6570\u65e0\u635f\u5730\u8f6c\u6362\u4e3a",(0,s.jsx)(e.code,{children:"long"}),"\n\u5c06\u5176\u4ea4\u7ed9\u5339\u914d\u5668\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4e3a\u4e86\u652f\u6301\u8fd9\u79cd\u9700\u6c42\uff0ckMock \u4e3a\u60a8\u63d0\u4f9b\u4e86",(0,s.jsx)(e.code,{children:"SafeMatcherCast<T>(m)"}),"\u51fd\u6570\u3002\u5b83\n\u5c06\u5339\u914d\u5668 ",(0,s.jsx)(e.code,{children:"m"})," \u8f6c\u6362\u4e3a\u7c7b\u578b ",(0,s.jsx)(e.code,{children:"Matcher<T>"}),"\u3002\u4e3a\u4e86\u786e\u4fdd\u5b89\u5168\uff0ckMock \u4f1a\u68c0\u67e5\n\uff08\u4ee4\u201cU\u201d\u4e3a\u201cm\u201d\u63a5\u53d7\u7684\u7c7b\u578b\uff1a"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\u7c7b\u578b ",(0,s.jsx)(e.code,{children:"T"})," \u53ef\u4ee5",(0,s.jsx)(e.em,{children:"\u9690\u5f0f"}),"\u8f6c\u6362\u4e3a\u7c7b\u578b ",(0,s.jsx)(e.code,{children:"U"}),"\uff1b"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5f53 ",(0,s.jsx)(e.code,{children:"T"})," \u548c ",(0,s.jsx)(e.code,{children:"U"})," \u90fd\u662f\u5185\u7f6e\u7b97\u672f\u7c7b\u578b\uff08",(0,s.jsx)(e.code,{children:"bool"}),"\u3001\u6574\u6570\u548c\n\u6d6e\u70b9\u6570\uff09\uff0c\u4ece",(0,s.jsx)(e.code,{children:"T"}),"\u5230",(0,s.jsx)(e.code,{children:"U"}),"\u7684\u8f6c\u6362\u662f\u6ca1\u6709\u635f\u8017\u7684\uff08\u5728\n\u6362\u53e5\u8bdd\u8bf4\uff0c\u4efb\u4f55\u53ef\u4ee5\u7528",(0,s.jsx)(e.code,{children:"T"}),"\u8868\u793a\u7684\u503c\u4e5f\u53ef\u4ee5\u7528",(0,s.jsx)(e.code,{children:"U"}),"\u8868\u793a\uff09\uff1b\n\u548c"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5f53",(0,s.jsx)(e.code,{children:"U"}),"\u662f\u5f15\u7528\u65f6\uff0c",(0,s.jsx)(e.code,{children:"T"}),"\u4e5f\u5fc5\u987b\u662f\u5f15\u7528\uff08\u4f5c\u4e3a\u5e95\u5c42\n\u5339\u914d\u5668\u53ef\u80fd\u5bf9\u201cU\u201d\u503c\u7684\u5730\u5740\u611f\u5174\u8da3\uff09\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u4e0d\u6ee1\u8db3\u5176\u4e2d\u4efb\u4f55\u6761\u4ef6\uff0c\u5219\u4ee3\u7801\u5c06\u65e0\u6cd5\u7f16\u8bd1\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u662f\u4e00\u4e2a\u4f8b\u5b50\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::SafeMatcherCast;\n\n// A base class and a child class.\nclass Base { ... };\nclass Derived : public Base { ... };\n\nclass MockFoo : public Foo {\n public:\n  MOCK_METHOD(void, DoThis, (Derived* derived), (override));\n};\n\n...\n  MockFoo foo;\n  // m is a Matcher<Base*> we got from somewhere.\n  EXPECT_CALL(foo, DoThis(SafeMatcherCast<Derived*>(m)));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u53d1\u73b0 ",(0,s.jsx)(e.code,{children:"SafeMatcherCast<T>(m)"})," \u592a\u6709\u9650\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c\u7684\u51fd\u6570\n",(0,s.jsx)(e.code,{children:"MatcherCast<T>(m)"}),"\u3002\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u53ea\u8981\u60a8\u6709\u65f6\u95f4\uff0c",(0,s.jsx)(e.code,{children:"MatcherCast"}),"\u5c31\u53ef\u4ee5\u5de5\u4f5c\n\u53ef\u4ee5\u901a\u8fc7\u201cstatic_cast\u201d\u5c06\u201cT\u201d\u7c7b\u578b\u8f6c\u6362\u4e3a",(0,s.jsx)(e.code,{children:"U"}),"\u7c7b\u578b\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"MatcherCast"})," \u672c\u8d28\u4e0a\u53ef\u4ee5\u8ba9\u4f60\u7ed5\u8fc7 C++ \u7684\u7c7b\u578b\u7cfb\u7edf\uff08",(0,s.jsx)(e.code,{children:"static_cast"})," \u4e0d\u662f\n\u603b\u662f\u5b89\u5168\u7684\uff0c\u56e0\u4e3a\u5b83\u53ef\u80fd\u4f1a\u4e22\u5f03\u4fe1\u606f\uff0c\u4f8b\u5982\uff09\uff0c\u6240\u4ee5\u8981\u5c0f\u5fc3\u4e0d\u8981\n\u8bef\u7528/\u6ee5\u7528\u5b83\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"SelectOverload",children:"\u5728\u91cd\u8f7d\u51fd\u6570\u4e4b\u95f4\u8fdb\u884c\u9009\u62e9"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u60a8\u671f\u671b\u8c03\u7528\u91cd\u8f7d\u51fd\u6570\uff0c\u7f16\u8bd1\u5668\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\n\u5e2e\u52a9\u4e86\u89e3\u5b83\u662f\u54ea\u4e2a\u91cd\u8f7d\u7248\u672c\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u8981\u6d88\u9664\u5728\u6b64\u5bf9\u8c61\u7684\u5e38\u91cf\u4e0a\u91cd\u8f7d\u7684\u51fd\u6570\u7684\u6b67\u4e49\uff0c\u8bf7\u4f7f\u7528\n",(0,s.jsx)(e.code,{children:"Const()"})," \u53c2\u6570\u5305\u88c5\u5668\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::ReturnRef;\n\nclass MockFoo : public Foo {\n  ...\n  MOCK_METHOD(Bar&, GetBar, (), (override));\n  MOCK_METHOD(const Bar&, GetBar, (), (const, override));\n};\n\n...\n  MockFoo foo;\n  Bar bar1, bar2;\n  EXPECT_CALL(foo, GetBar())         // The non-const GetBar().\n      .WillOnce(ReturnRef(bar1));\n  EXPECT_CALL(Const(foo), GetBar())  // The const GetBar().\n      .WillOnce(ReturnRef(bar2));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\uff08",(0,s.jsx)(e.code,{children:"Const()"})," \u7531 kMock \u5b9a\u4e49\uff0c\u5e76\u8fd4\u56de\u5bf9\u5176\u53c2\u6570\u7684 ",(0,s.jsx)(e.code,{children:"const"})," \u5f15\u7528\u3002\uff09"]}),"\n",(0,s.jsxs)(e.p,{children:["\u6d88\u9664\u53c2\u6570\u6570\u91cf\u76f8\u540c\u4f46\u91cd\u8f7d\u51fd\u6570\u7684\u6b67\u4e49\u4e0d\u540c\u7684\u53c2\u6570\u7c7b\u578b\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u6307\u5b9a\u5339\u914d\u5668\u7684\u786e\u5207\u7c7b\u578b\uff0c\n\u901a\u8fc7\u5c06\u5339\u914d\u5668\u5305\u88c5\u5728 ",(0,s.jsx)(e.code,{children:"Matcher<type>()"})," \u4e2d\uff0c\u6216\u8005\u4f7f\u7528\u5176\u5339\u914d\u5668\u7c7b\u578b\u662f\u56fa\u5b9a\u7684\uff08",(0,s.jsx)(e.code,{children:"TypedEq<type>"}),"\u3001",(0,s.jsx)(e.code,{children:"An<type>()"}),"\u7b49\uff09\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::An;\nusing ::testing::Matcher;\nusing ::testing::TypedEq;\n\nclass MockPrinter : public Printer {\n public:\n  MOCK_METHOD(void, Print, (int n), (override));\n  MOCK_METHOD(void, Print, (char c), (override));\n};\n\nTEST(PrinterTest, Print) {\n  MockPrinter printer;\n\n  EXPECT_CALL(printer, Print(An<int>()));            // void Print(int);\n  EXPECT_CALL(printer, Print(Matcher<int>(Lt(5))));  // void Print(int);\n  EXPECT_CALL(printer, Print(TypedEq<char>('a')));   // void Print(char);\n\n  printer.Print(3);\n  printer.Print(6);\n  printer.Print('a');\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u6839\u636e\u53c2\u6570\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c",children:"\u6839\u636e\u53c2\u6570\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c"}),"\n",(0,s.jsxs)(e.p,{children:["\u5f53\u8c03\u7528\u6a21\u62df\u65b9\u6cd5\u65f6\uff0c",(0,s.jsx)(e.em,{children:"\u6700\u540e"}),"\u5339\u914d\u7684\u671f\u671b\u4ecd\u7136\u662f\n\u5c06\u9009\u62e9\u6d3b\u52a8\uff08\u8ba4\u4e3a\u201c\u8f83\u65b0\u7684\u8986\u76d6\u8f83\u65e7\u7684\u201d\uff09\u3002\u6240\u4ee5\uff0c\u4f60\u53ef\u4ee5\u505a\u4e00\u4e2a\n\u65b9\u6cd5\u6839\u636e\u5176\u53c2\u6570\u503c\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u5982\u4e0b\u6240\u793a\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::Lt;\nusing ::testing::Return;\n...\n  // The default case.\n  EXPECT_CALL(foo, DoThis(_))\n      .WillRepeatedly(Return('b'));\n  // The more specific case.\n  EXPECT_CALL(foo, DoThis(Lt(5)))\n      .WillRepeatedly(Return('a'));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u73b0\u5728\uff0c\u5982\u679c\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"foo.DoThis()"})," \u7684\u503c\u5c0f\u4e8e 5\uff0c\u5219 ",(0,s.jsx)(e.code,{children:"'a'"})," \u5c06\u662f\n\u8fd4\u56de\uff1b\u5426\u5219\u5c06\u8fd4\u56de",(0,s.jsx)(e.code,{children:"b"}),"\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u5c06\u591a\u4e2a\u53c2\u6570\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u8fdb\u884c\u5339\u914d",children:"\u5c06\u591a\u4e2a\u53c2\u6570\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u8fdb\u884c\u5339\u914d"}),"\n",(0,s.jsxs)(e.p,{children:["\u6709\u65f6\u5355\u72ec\u5339\u914d\u53c2\u6570\u662f\u4e0d\u591f\u7684\u3002\u4f8b\u5982\uff0c\u6211\u4eec\n\u53ef\u80fd\u60f3\u8bf4\u7b2c\u4e00\u4e2a\u53c2\u6570\u5fc5\u987b\u5c0f\u4e8e\u7b2c\u4e8c\u4e2a\u53c2\u6570\u3002\n",(0,s.jsx)(e.code,{children:"With()"})," \u5b50\u53e5\u5141\u8bb8\u6211\u4eec\u5c06\u6a21\u62df\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\u5339\u914d\u4e3a\n\u6240\u6709\u7684\u3002\u4f8b\u5982\uff0c"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::Ne;\nusing ::testing::Lt;\n...\n  EXPECT_CALL(foo, InRange(Ne(0), _))\n      .With(Lt());\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8868\u793a ",(0,s.jsx)(e.code,{children:"InRange()"})," \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e0d\u80fd\u4e3a 0\uff0c\u5e76\u4e14\u5fc5\u987b\u5c0f\u4e8e\n\u7b2c\u4e8c\u4e2a\u53c2\u6570\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"With()"})," \u4e2d\u7684\u8868\u8fbe\u5f0f\u5fc5\u987b\u662f ",(0,s.jsx)(e.code,{children:"Matcher<std::tuple<A1, ..., An>>"}),"\uff0c\u5176\u4e2d ",(0,s.jsx)(e.code,{children:"A1"}),"\u3001...\u3001",(0,s.jsx)(e.code,{children:"An"})," \u662f\u51fd\u6570\u53c2\u6570\u7684\u7c7b\u578b\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u8fd8\u53ef\u4ee5\u5728 ",(0,s.jsx)(e.code,{children:".With()"})," \u4e2d\u7f16\u5199 ",(0,s.jsx)(e.code,{children:"AllArgs(m)"})," \u800c\u4e0d\u662f ",(0,s.jsx)(e.code,{children:"m"}),"\u3002\u4e24\u79cd\u5f62\u5f0f\n\u662f\u7b49\u4ef7\u7684\uff0c\u4f46\u662f ",(0,s.jsx)(e.code,{children:".With(AllArgs(Lt()))"})," \u6bd4 ",(0,s.jsx)(e.code,{children:".With(Lt())"})," \u66f4\u5177\u53ef\u8bfb\u6027\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u53ef\u4ee5\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"Args<k1, ..., kn>(m)"})," \u6765\u5339\u914d ",(0,s.jsx)(e.code,{children:"n"})," \u9009\u5b9a\u7684\u53c2\u6570\uff08\u4f5c\u4e3a\n\u5143\u7ec4\uff09\u9488\u5bf9",(0,s.jsx)(e.code,{children:"m"}),"\u3002\u4f8b\u5982\uff0c"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::AllOf;\nusing ::testing::Args;\nusing ::testing::Lt;\n...\n  EXPECT_CALL(foo, Blah)\n      .With(AllOf(Args<0, 1>(Lt()), Args<1, 2>(Lt())));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8868\u793a\u5c06\u4f7f\u7528\u53c2\u6570",(0,s.jsx)(e.code,{children:"x"}),"\u3001",(0,s.jsx)(e.code,{children:"y"}),"\u548c",(0,s.jsx)(e.code,{children:"z"}),"\u8c03\u7528",(0,s.jsx)(e.code,{children:"Blah"}),"\uff0c\u5176\u4e2d",(0,s.jsx)(e.code,{children:"x < y < z"}),"\u3002\u8bf7\u6ce8\u610f\uff0c\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u65e0\u9700\u6307\u5b9a\u4f4d\u7f6e\u5339\u914d\u5668\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4f5c\u4e3a\u65b9\u4fbf\u548c\u793a\u4f8b\uff0ckMock \u63d0\u4f9b\u4e86\u4e00\u4e9b 2 \u5143\u7ec4\u7684\u5339\u914d\u5668\uff0c\u5305\u62ec\u4e0a\u9762\u7684\u201cLt()\u201d\u5339\u914d\u5668\u3002\u6709\u5173\u5b8c\u6574\u5217\u8868\uff0c\u8bf7\u53c2\u9605",(0,s.jsx)(e.a,{href:"/docs/next/cpp/base/testing/kt/reference/matchers#MultiArgMatchers",children:"\u591a\u53c2\u6570\u5339\u914d\u5668"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u60a8\u60f3\u5c06\u53c2\u6570\u4f20\u9012\u7ed9\u60a8\u81ea\u5df1\u7684\u8c13\u8bcd\uff08\u4f8b\u5982 ",(0,s.jsx)(e.code,{children:".With(Args<0, 1>(Truly(&MyPredicate)))"}),"\uff09\uff0c\u5219\u8be5\u8c13\u8bcd\u5fc5\u987b\u7f16\u5199\u4e3a\u91c7\u7528 ",(0,s.jsx)(e.code,{children:"std::tuple "})," \u4f5c\u4e3a\u5176\u53c2\u6570\uff1b kMock \u4f1a\u5c06\u201cn\u201d\u4e2a\u9009\u5b9a\u53c2\u6570\u4f5c\u4e3a",(0,s.jsx)(e.em,{children:"\u4e00\u4e2a"}),"\u5355\u4e2a\u5143\u7ec4\u4f20\u9012\u7ed9\u8c13\u8bcd\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u4f7f\u7528\u5339\u914d\u5668\u4f5c\u4e3a\u8c13\u8bcd",children:"\u4f7f\u7528\u5339\u914d\u5668\u4f5c\u4e3a\u8c13\u8bcd"}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u662f\u5426\u6ce8\u610f\u5230\u5339\u914d\u5668\u53ea\u662f\u4e00\u4e2a\u5947\u7279\u7684\u8c13\u8bcd\uff0c\u5b83\u4e5f\u77e5\u9053\u5982\u4f55\n\u63cf\u8ff0\u81ea\u5df1\uff1f\u8bb8\u591a\u73b0\u6709\u7b97\u6cd5\u5c06\u8c13\u8bcd\u4f5c\u4e3a\u53c2\u6570\uff08\u4f8b\u5982\n\u90a3\u4e9b\u5728 STL \u7684 ",(0,s.jsx)(e.code,{children:"<algorithm>"})," \u5934\u4e2d\u5b9a\u4e49\u7684\uff09\uff0c\u5982\u679c kMock\n\u4e0d\u5141\u8bb8\u5339\u914d\u8005\u53c2\u4e0e\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5e78\u8fd0\u7684\u662f\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u5339\u914d\u5668\uff0c\u5176\u4e2d\u9700\u8981\u4e00\u5143\u8c13\u8bcd\u51fd\u5b50\n\u5c06\u5176\u5305\u88c5\u5728 ",(0,s.jsx)(e.code,{children:"Matches()"})," \u51fd\u6570\u4e2d\u3002\u4f8b\u5982\uff0c"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"#include <algorithm>\n#include <vector>\n\nusing ::testing::Matches;\nusing ::testing::Ge;\n\nvector<int> v;\n...\n// How many elements in v are >= 10?\nconst int count = count_if(v.begin(), v.end(), Matches(Ge(10)));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u7531\u4e8e\u60a8\u53ef\u4ee5\u4f7f\u7528 kMock \u8f7b\u677e\u5730\u4ece\u7b80\u5355\u7684\u5339\u914d\u5668\u6784\u5efa\u590d\u6742\u7684\u5339\u914d\u5668\uff0c\u56e0\u6b64\u4e3a\u60a8\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u4fbf\u5730\u6784\u9020\u590d\u5408\u8c13\u8bcd\u7684\u65b9\u6cd5\uff08\u6267\u884c\u76f8\u540c\u7684\u64cd\u4f5c\n\u4f7f\u7528 STL \u7684 ",(0,s.jsx)(e.code,{children:"<function>"})," \u6807\u5934\u975e\u5e38\u75db\u82e6\uff09\u3002\u4f8b\u5982\uff0c\u8fd9\u662f\u4e00\u4e2a\u4efb\u4f55\u6ee1\u8db3 ",(0,s.jsx)(e.code,{children:">="})," 0\u3001",(0,s.jsx)(e.code,{children:"<="})," 100 \u548c ",(0,s.jsx)(e.code,{children:"!="})," 50 \u7684\u8c13\u8bcd\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using testing::AllOf;\nusing testing::Ge;\nusing testing::Le;\nusing testing::Matches;\nusing testing::Ne;\n...\nMatches(AllOf(Ge(0), Le(100), Ne(50)))\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u5728-ktest-\u65ad\u8a00\u4e2d\u4f7f\u7528\u5339\u914d\u5668",children:"\u5728 ktest \u65ad\u8a00\u4e2d\u4f7f\u7528\u5339\u914d\u5668"}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u53c2\u9605\u65ad\u8a00\u4e2d\u7684 ",(0,s.jsx)(e.a,{href:"/docs/next/cpp/base/testing/kt/reference/assertions#EXPECT_THAT",children:(0,s.jsx)(e.code,{children:"EXPECT_THAT"})}),"\n\u53c2\u8003\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u4f7f\u7528\u8c13\u8bcd\u4f5c\u4e3a\u5339\u914d\u5668",children:"\u4f7f\u7528\u8c13\u8bcd\u4f5c\u4e3a\u5339\u914d\u5668"}),"\n",(0,s.jsxs)(e.p,{children:["kMock \u63d0\u4f9b\u4e86\u4e00\u7ec4\u5185\u7f6e\u5339\u914d\u5668\uff0c\u7528\u4e8e\u5c06\u53c2\u6570\u4e0e\u9884\u671f\u5339\u914d\n\u503c - \u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605",(0,s.jsx)(e.a,{href:"/docs/next/cpp/base/testing/kt/reference/matchers",children:"\u5339\u914d\u5668\u53c2\u8003"}),"\u3002\n\u5982\u679c\u60a8\u53d1\u73b0\u7f3a\u5c11\u5185\u7f6e\u96c6\u5408\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u610f\u4e00\u5143\n\u8c13\u8bcd\u51fd\u6570\u6216\u51fd\u5b50\u4f5c\u4e3a\u5339\u914d\u5668 - \u53ea\u8981\u8c13\u8bcd\u63a5\u53d7\n\u60a8\u60f3\u8981\u7684\u7c7b\u578b\u7684\u503c\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5c06\u8c13\u8bcd\u5305\u88c5\u5728\n",(0,s.jsx)(e.code,{children:"Truly()"})," \u51fd\u6570\uff0c\u4f8b\u5982\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::Truly;\n\nint IsEven(int n) { return (n % 2) == 0 ? 1 : 0; }\n...\n  // Bar() must be called with an even number.\n  EXPECT_CALL(foo, Bar(Truly(IsEven)));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u8c13\u8bcd\u51fd\u6570/\u4eff\u51fd\u6570\u4e0d\u5fc5\u8fd4\u56de",(0,s.jsx)(e.code,{children:"bool"}),"\u3002\u5b83\n\u53ea\u8981\u8fd4\u56de\u503c\u53ef\u4ee5\u7528\u4f5c in \u8bed\u53e5\u4e2d\u7684\u6761\u4ef6\u5373\u53ef\n",(0,s.jsx)(e.code,{children:"\u5982\u679c\uff08\u6761\u4ef6\uff09..."}),"\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u5339\u914d\u4e0d\u53ef\u590d\u5236\u7684\u53c2\u6570",children:"\u5339\u914d\u4e0d\u53ef\u590d\u5236\u7684\u53c2\u6570"}),"\n",(0,s.jsxs)(e.p,{children:["\u5f53\u4f60\u6267\u884c\u201cEXPECT_CALL(mock_obj, Foo(bar))\u201d\u65f6\uff0ckMock \u4f1a\u4fdd\u5b58\u4e00\u4efd\u526f\u672c\n",(0,s.jsx)(e.code,{children:"\u9152\u5427"}),"\u3002\u5f53\u7a0d\u540e\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"Foo()"})," \u65f6\uff0ckMock \u5c06\u53c2\u6570\u4e0e ",(0,s.jsx)(e.code,{children:"Foo()"})," \u8fdb\u884c\u6bd4\u8f83\n",(0,s.jsx)(e.code,{children:"bar"})," \u7684\u4fdd\u5b58\u526f\u672c\u3002\u8fd9\u6837\uff0c\u60a8\u5c31\u4e0d\u5fc5\u62c5\u5fc3",(0,s.jsx)(e.code,{children:"bar"}),"\u88ab\n\u6267\u884c",(0,s.jsx)(e.code,{children:"EXPECT_CALL()"}),"\u540e\u4fee\u6539\u6216\u9500\u6bc1\u3002\u540c\u6837\u7684\u9053\u7406\n\u5f53\u60a8\u4f7f\u7528",(0,s.jsx)(e.code,{children:"Eq(bar)"}),"\u3001",(0,s.jsx)(e.code,{children:"Le(bar)"}),"\u7b49\u5339\u914d\u5668\u65f6\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4f46\u662f\u5982\u679c\u201cbar\u201d\u65e0\u6cd5\u590d\u5236\uff08\u5373\u6ca1\u6709\u590d\u5236\u6784\u9020\u51fd\u6570\uff09\u600e\u4e48\u529e\uff1f\u4f60\u53ef\u4ee5\n\u5b9a\u4e49\u60a8\u81ea\u5df1\u7684\u5339\u914d\u5668\u51fd\u6570\u6216\u56de\u8c03\u5e76\u5c06\u5176\u4e0e",(0,s.jsx)(e.code,{children:"Truly()"}),"\u4e00\u8d77\u4f7f\u7528\uff0c\u4f5c\u4e3a\n\u524d\u9762\u7684\u51e0\u4e2a\u98df\u8c31\u5df2\u7ecf\u663e\u793a\u3002\u6216\u8005\uff0c\u4f60\u4e5f\u8bb8\u80fd\u591f\u6446\u8131\u5b83\n\u5982\u679c\u4f60\u80fd\u4fdd\u8bc1\u5728",(0,s.jsx)(e.code,{children:"EXPECT_CALL()"}),"\u4e4b\u540e",(0,s.jsx)(e.code,{children:"bar"}),"\u4e0d\u4f1a\u6539\u53d8\n\u88ab\u6267\u884c\u3002\u53ea\u9700\u544a\u8bc9 kMock \u5b83\u5e94\u8be5\u4fdd\u5b58\u5bf9",(0,s.jsx)(e.code,{children:"bar"}),"\u7684\u5f15\u7528\uff0c\u800c\u4e0d\u662f\n\u5b83\u7684\u526f\u672c\u3002\u65b9\u6cd5\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::Eq;\nusing ::testing::Lt;\n...\n  // Expects that Foo()'s argument == bar.\n  EXPECT_CALL(mock_obj, Foo(Eq(std::ref(bar))));\n\n  // Expects that Foo()'s argument < bar.\n  EXPECT_CALL(mock_obj, Foo(Lt(std::ref(bar))));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u8bb0\u4f4f\uff1a\u5982\u679c\u60a8\u8fd9\u6837\u505a\uff0c\u8bf7\u4e0d\u8981\u5728",(0,s.jsx)(e.code,{children:"EXPECT_CALL()"}),"\u4e4b\u540e\u66f4\u6539",(0,s.jsx)(e.code,{children:"bar"}),"\uff0c\u6216\u8005\n\u7ed3\u679c\u672a\u5b9a\u4e49\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u9a8c\u8bc1\u5bf9\u8c61\u7684\u6210\u5458",children:"\u9a8c\u8bc1\u5bf9\u8c61\u7684\u6210\u5458"}),"\n",(0,s.jsxs)(e.p,{children:["\u6a21\u62df\u51fd\u6570\u901a\u5e38\u4f1a\u5c06\u5bf9\u8c61\u7684\u5f15\u7528\u4f5c\u4e3a\u53c2\u6570\u3002\u5339\u914d\u65f6\n\u53c2\u6570\uff0c\u60a8\u53ef\u80fd\u4e0d\u60f3\u5c06\u6574\u4e2a\u5bf9\u8c61\u4e0e\u56fa\u5b9a\u7684\u8fdb\u884c\u6bd4\u8f83\n\u5bf9\u8c61\uff0c\u56e0\u4e3a\u8fd9\u53ef\u80fd\u662f\u8fc7\u5ea6\u89c4\u8303\u7684\u3002\u76f8\u53cd\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u9a8c\u8bc1\n\u67d0\u4e2a\u6210\u5458\u53d8\u91cf\u6216\u5bf9\u8c61\u7684\u67d0\u4e2a getter \u65b9\u6cd5\u7684\u7ed3\u679c\u3002\n\u60a8\u53ef\u4ee5\u4f7f\u7528",(0,s.jsx)(e.code,{children:"Field()"}),"\u548c",(0,s.jsx)(e.code,{children:"Property()"}),"\u6765\u5b8c\u6210\u6b64\u64cd\u4f5c\u3002\u66f4\u5177\u4f53\u5730\u8bf4\uff0c"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"Field(&Foo::bar, m)\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u662f\u5339\u914d\u4e00\u4e2a",(0,s.jsx)(e.code,{children:"Foo"}),"\u5bf9\u8c61\u7684\u5339\u914d\u5668\uff0c\u8be5\u5bf9\u8c61\u7684",(0,s.jsx)(e.code,{children:"bar"}),"\u6210\u5458\u53d8\u91cf\u6ee1\u8db3\u5339\u914d\u5668",(0,s.jsx)(e.code,{children:"m"}),"\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"Property(&Foo::baz, m)\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u662f\u5339\u914d",(0,s.jsx)(e.code,{children:"Foo"}),"\u5bf9\u8c61\u7684\u5339\u914d\u5668\uff0c\u8be5\u5bf9\u8c61\u7684",(0,s.jsx)(e.code,{children:"baz()"}),"\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u503c\n\u6ee1\u8db3\u5339\u914d\u5668",(0,s.jsx)(e.code,{children:"m"}),"\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"For example:"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{style:{textAlign:"left"},children:"\u8868\u8fbe\u5f0f"}),(0,s.jsx)(e.th,{style:{textAlign:"left"},children:"\u63cf\u8ff0"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.code,{children:"Field(&Foo::number, Ge(3))"})}),(0,s.jsxs)(e.td,{style:{textAlign:"left"},children:["\u5f53 ",(0,s.jsx)(e.code,{children:"x.number >= 3"}),"\u5339\u914d ",(0,s.jsx)(e.code,{children:"x"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.code,{children:'Property(&Foo::name,  StartsWith("John "))'})}),(0,s.jsxs)(e.td,{style:{textAlign:"left"},children:["\u5339\u914d ",(0,s.jsx)(e.code,{children:"x"}),"\uff0c\u5176\u4e2d ",(0,s.jsx)(e.code,{children:"x.name()"})," \u4ee5 ",(0,s.jsx)(e.code,{children:'"John "'})," \u5f00\u5934\u3002"]})]})]})]}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u5728",(0,s.jsx)(e.code,{children:"Property(&Foo::baz, ...)"}),"\u4e2d\uff0c\u65b9\u6cd5",(0,s.jsx)(e.code,{children:"baz()"}),"\u4e0d\u80fd\u5e26\u4efb\u4f55\u53c2\u6570\n\u5e76\u58f0\u660e\u4e3a",(0,s.jsx)(e.code,{children:"const"}),"\u3002\u4e0d\u8981\u5bf9\u4ee5\u4e0b\u6210\u5458\u51fd\u6570\u4f7f\u7528",(0,s.jsx)(e.code,{children:"Property()"}),"\n\u4f60\u4e0d\u62e5\u6709\uff0c\u56e0\u4e3a\u83b7\u53d6\u51fd\u6570\u7684\u5730\u5740\u662f\u8106\u5f31\u7684\u5e76\u4e14\u901a\u5e38\n\u4e0d\u662f\u51fd\u6570\u5408\u540c\u7684\u4e00\u90e8\u5206\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"Field()"})," \u548c ",(0,s.jsx)(e.code,{children:"Property()"})," \u4e5f\u53ef\u4ee5\u5339\u914d\u6307\u5411\u5bf9\u8c61\u7684\u666e\u901a\u6307\u9488\u3002\u4e3a\u4e86\n\u5b9e\u4f8b\uff0c"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::Field;\nusing ::testing::Ge;\n...\nField(&Foo::number, Ge(3))\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5339\u914d\u666e\u901a\u6307\u9488",(0,s.jsx)(e.code,{children:"p"}),"\uff0c\u5176\u4e2d",(0,s.jsx)(e.code,{children:"p->number >= 3"}),"\u3002\u5982\u679c",(0,s.jsx)(e.code,{children:"p"}),"\u4e3a",(0,s.jsx)(e.code,{children:"NULL"}),"\uff0c\u5219\u5339\u914d\n\u65e0\u8bba\u5185\u90e8\u5339\u914d\u5668\u5982\u4f55\uff0c\u603b\u4f1a\u5931\u8d25\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u60f3\u540c\u65f6\u9a8c\u8bc1\u591a\u4e2a\u6210\u5458\u600e\u4e48\u529e\uff1f\u8bb0\u4f4f\n\u6709 ",(0,s.jsxs)(e.a,{href:"#CombiningMatchers",children:[(0,s.jsx)(e.code,{children:"AllOf()"})," \u548c ",(0,s.jsx)(e.code,{children:"AllOfArray()"})]}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u6700\u540e ",(0,s.jsx)(e.code,{children:"Field()"})," \u548c ",(0,s.jsx)(e.code,{children:"Property()"})," \u63d0\u4f9b\u4e86\u91c7\u7528\u5b57\u6bb5\u6216\n\u5c5e\u6027\u540d\u79f0\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u5c06\u5176\u5305\u542b\u5728\u9519\u8bef\u6d88\u606f\u4e2d\u3002\u8fd9\n\u521b\u5efa\u7ec4\u5408\u5339\u914d\u5668\u65f6\u975e\u5e38\u6709\u7528\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::AllOf;\nusing ::testing::Field;\nusing ::testing::Matcher;\nusing ::testing::SafeMatcherCast;\n\nMatcher<Foo> IsFoo(const Foo& foo) {\n  return AllOf(Field("some_field", &Foo::some_field, foo.some_field),\n               Field("other_field", &Foo::other_field, foo.other_field),\n               Field("last_field", &Foo::last_field, foo.last_field));\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u9a8c\u8bc1\u6307\u9488\u53c2\u6570\u6307\u5411\u7684\u503c",children:"\u9a8c\u8bc1\u6307\u9488\u53c2\u6570\u6307\u5411\u7684\u503c"}),"\n",(0,s.jsxs)(e.p,{children:["C++ \u51fd\u6570\u901a\u5e38\u91c7\u7528\u6307\u9488\u4f5c\u4e3a\u53c2\u6570\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u50cf\u8fd9\u6837\u7684\u5339\u914d\u5668\n",(0,s.jsx)(e.code,{children:"IsNull()"}),"\u3001",(0,s.jsx)(e.code,{children:"NotNull()"})," \u548c\u5176\u4ed6\u6bd4\u8f83\u5339\u914d\u5668\u6765\u5339\u914d\u6307\u9488\uff0c\u4f46\u662f\n\u5982\u679c\u4f60\u60f3\u786e\u4fdd\u6307\u9488",(0,s.jsx)(e.em,{children:"\u6307\u5411"}),"\u7684\u503c\uff0c\u800c\u4e0d\u662f\n\u6307\u9488\u672c\u8eab\uff0c\u5177\u6709\u4e00\u5b9a\u7684\u5c5e\u6027\u5417\uff1f\u597d\u5427\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528",(0,s.jsx)(e.code,{children:"Pointee(m)"}),"\n\u5339\u914d\u5668\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5f53\u4e14\u4ec5\u5f53",(0,s.jsx)(e.code,{children:"m"}),"\u4e0e\u6307\u9488\u7684\u503c\u5339\u914d\u65f6\uff0c",(0,s.jsx)(e.code,{children:"Pointee(m)"}),"\u624d\u5339\u914d\u6307\u9488\n\u6307\u5411.\u4f8b\u5982\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::Ge;\nusing ::testing::Pointee;\n...\n  EXPECT_CALL(foo, Bar(Pointee(Ge(3))));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u671f\u671b\u4f7f\u7528\u6307\u5411\u66f4\u5927\u503c\u7684\u6307\u9488\u6765\u8c03\u7528",(0,s.jsx)(e.code,{children:"foo.Bar()"}),"\n\u5927\u4e8e\u6216\u7b49\u4e8e3\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"Pointee()"}),"\u7684\u4e00\u4e2a\u597d\u5904\u662f\u5b83\u5c06",(0,s.jsx)(e.code,{children:"NULL"}),"\u6307\u9488\u89c6\u4e3a\u5339\u914d\u9879\n\u5931\u8d25\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u5199 ",(0,s.jsx)(e.code,{children:"Pointee(m)"})," \u800c\u4e0d\u662f"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::AllOf;\nusing ::testing::NotNull;\nusing ::testing::Pointee;\n...\n  AllOf(NotNull(), Pointee(m))\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4e0d\u7528\u62c5\u5fc3",(0,s.jsx)(e.code,{children:"NULL"}),"\u6307\u9488\u4f1a\u4f7f\u60a8\u7684\u6d4b\u8bd5\u5d29\u6e83\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u53e6\u5916\uff0c\u6211\u4eec\u662f\u5426\u544a\u8bc9\u8fc7\u60a8",(0,s.jsx)(e.code,{children:"Pointee()"}),"\u9002\u7528\u4e8e\u539f\u59cb\u6307\u9488 ** \u548c **\n\u667a\u80fd\u6307\u9488\uff08",(0,s.jsx)(e.code,{children:"std::unique_ptr"}),"\u3001",(0,s.jsx)(e.code,{children:"std::shared_ptr"}),"\u7b49\uff09\uff1f"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u6307\u5411\u6307\u9488\u7684\u6307\u9488\u600e\u4e48\u529e\uff1f\u4f60\u731c\u5bf9\u4e86 - \u4f60\u53ef\u4ee5\u4f7f\u7528\u5d4c\u5957\n",(0,s.jsx)(e.code,{children:"Pointee()"})," \u53ef\u4ee5\u66f4\u6df1\u5165\u5730\u63a2\u7a76\u503c\u7684\u5185\u90e8\u3002\u4f8b\u5982\uff0c\n",(0,s.jsx)(e.code,{children:"Pointee(Pointee(Lt(3)))"})," \u5339\u914d\u4e00\u4e2a\u6307\u5411\u53e6\u4e00\u4e2a\u6307\u9488\u7684\u6307\u9488\n\u5c0f\u4e8e 3 \u7684\u6570\u5b57\uff08\u771f\u662f\u62d7\u53e3\u2026\u2026\uff09\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"CustomMatcherClass",children:"\u5b9a\u4e49\u81ea\u5b9a\u4e49\u5339\u914d\u5668\u7c7b"}),"\n",(0,s.jsxs)(e.p,{children:["\u5927\u591a\u6570\u5339\u914d\u5668\u53ef\u4ee5\u4f7f\u7528 ",(0,s.jsx)(e.a,{href:"#NewMatchers",children:"MATCHER* \u5b8f"})," \u7b80\u5355\u5730\u5b9a\u4e49\uff0c\n\u5b83\u4eec\u7b80\u6d01\u7075\u6d3b\uff0c\u5e76\u80fd\u4ea7\u751f\u826f\u597d\u7684\u9519\u8bef\u6d88\u606f\u3002\u7136\u800c\uff0c\u8fd9\u4e9b\n\u5b8f\u5bf9\u4e8e\u5b83\u4eec\u521b\u5efa\u7684\u63a5\u53e3\u4e0d\u662f\u5f88\u660e\u786e\uff0c\u800c\u4e14\u5e76\u4e0d\u603b\u662f\n\u9002\u5408\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u5c06\u88ab\u5e7f\u6cdb\u91cd\u7528\u7684\u5339\u914d\u5668\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u5bf9\u4e8e\u66f4\u9ad8\u7ea7\u7684\u60c5\u51b5\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u5b9a\u4e49\u81ea\u5df1\u7684\u5339\u914d\u5668\u7c7b\u3002\u5b9a\u5236\n\u5339\u914d\u5668\u5141\u8bb8\u60a8\u6d4b\u8bd5\u8be5\u5bf9\u8c61\u7684\u7279\u5b9a\u4e0d\u53d8\u5c5e\u6027\u3002\u8ba9\u6211\u4eec\n\u770b\u770b\u5982\u4f55\u505a\u5230\u8fd9\u4e00\u70b9\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u60f3\u8c61\u4e00\u4e0b\uff0c\u4f60\u6709\u4e00\u4e2a\u6a21\u62df\u51fd\u6570\uff0c\u5b83\u63a5\u53d7\u4e00\u4e2a",(0,s.jsx)(e.code,{children:"Foo"}),"\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u5176\u4e2d\u6709\n\u4e00\u4e2a",(0,s.jsx)(e.code,{children:"int bar()"}),"\u65b9\u6cd5\u548c\u4e00\u4e2a",(0,s.jsx)(e.code,{children:"int baz()"}),"\u65b9\u6cd5\u3002\u4f60\u60f3\u8981\u9650\u5236\n\u53c2\u6570\u7684\u201cbar()\u201d\u503c\u52a0\u4e0a\u5176\u201cbaz()\u201d\u503c\u662f\u7ed9\u5b9a\u7684\u6570\u5b57\u3002 \uff08\u8fd9\u662f\u4e00\u4e2a\n\u4e0d\u53d8\u3002\uff09\u4ee5\u4e0b\u662f\u6211\u4eec\u5982\u4f55\u7f16\u5199\u548c\u4f7f\u7528\u5339\u914d\u5668\u7c7b\u6765\u6267\u884c\u6b64\u64cd\u4f5c\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'class BarPlusBazEqMatcher {\n public:\n  using is_ktest_matcher = void;\n\n  explicit BarPlusBazEqMatcher(int expected_sum)\n      : expected_sum_(expected_sum) {}\n\n  bool MatchAndExplain(const Foo& foo,\n                       std::ostream* /* listener */) const {\n    return (foo.bar() + foo.baz()) == expected_sum_;\n  }\n\n  void DescribeTo(std::ostream* os) const {\n    *os << "bar() + baz() equals " << expected_sum_;\n  }\n\n  void DescribeNegationTo(std::ostream* os) const {\n    *os << "bar() + baz() does not equal " << expected_sum_;\n  }\n private:\n  const int expected_sum_;\n};\n\n::testing::Matcher<const Foo&> BarPlusBazEq(int expected_sum) {\n  return BarPlusBazEqMatcher(expected_sum);\n}\n\n...\n  Foo foo;\n  EXPECT_CALL(foo, BarPlusBazEq(5))...;\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u914d\u5957\u5bb9\u5668",children:"\u914d\u5957\u5bb9\u5668"}),"\n",(0,s.jsxs)(e.p,{children:["\u6709\u65f6\uff0cSTL \u5bb9\u5668\uff08\u4f8b\u5982\u5217\u8868\u3001\u5411\u91cf\u3001\u5730\u56fe...\uff09\u4f1a\u4f20\u9012\u7ed9\u6a21\u62df\n\u51fd\u6570\uff0c\u60a8\u53ef\u80fd\u60f3\u9a8c\u8bc1\u5b83\u3002\u7531\u4e8e\u5927\u591a\u6570 STL \u5bb9\u5668\u90fd\u652f\u6301\n",(0,s.jsx)(e.code,{children:"=="})," \u8fd0\u7b97\u7b26\uff0c\u4f60\u53ef\u4ee5\u5199 ",(0,s.jsx)(e.code,{children:"Eq(expected_container)"})," \u6216\u7b80\u5355\u5730\u5199\n",(0,s.jsx)(e.code,{children:"expected_container"})," \u4e0e\u5bb9\u5668\u5b8c\u5168\u5339\u914d\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u4f46\u6709\u65f6\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u66f4\u52a0\u7075\u6d3b\uff08\u4f8b\u5982\uff0c\u7b2c\u4e00\u4e2a\n\u5143\u7d20\u5fc5\u987b\u5b8c\u5168\u5339\u914d\uff0c\u4f46\u7b2c\u4e8c\u4e2a\u5143\u7d20\u53ef\u4ee5\u662f\u4efb\u610f\u6b63\u6570\n\u53f7\u7b49\uff09\u3002\u6b64\u5916\uff0c\u6d4b\u8bd5\u4e2d\u4f7f\u7528\u7684\u5bb9\u5668\u901a\u5e38\u5177\u6709\u5c11\u91cf\n\u5143\u7d20\uff0c\u5e76\u4e14\u5fc5\u987b\u5b9a\u4e49\u9884\u671f\u7684\u5bb9\u5668\uff0c\u8fd9\u6709\u70b9\u9ebb\u70e6\n\u9ebb\u70e6\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u53ef\u4ee5\u5728\u6b64\u7c7b\u4e2d\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"ElementsAre()"})," \u6216 ",(0,s.jsx)(e.code,{children:"UnorderedElementsAre()"})," \u5339\u914d\u5668\n\u6848\u4f8b\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::ElementsAre;\nusing ::testing::Gt;\n...\n  MOCK_METHOD(void, Foo, (const vector<int>& numbers), (override));\n...\n  EXPECT_CALL(mock, Foo(ElementsAre(1, Gt(0), _, 5)));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e0a\u9762\u7684\u5339\u914d\u5668\u8bf4\u5bb9\u5668\u5fc5\u987b\u67094\u4e2a\u5143\u7d20\uff0c\u5176\u4e2d\u5fc5\u987b\u662f1\uff0c\u5206\u522b\u5927\u4e8e 0\u3001\u4efb\u610f\u503c\u548c 5\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u4f60\u6539\u4e3a\u5199\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::Gt;\nusing ::testing::UnorderedElementsAre;\n...\n  MOCK_METHOD(void, Foo, (const vector<int>& numbers), (override));\n...\n  EXPECT_CALL(mock, Foo(UnorderedElementsAre(1, Gt(0), _, 5)));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u610f\u5473\u7740\u5bb9\u5668\u5fc5\u987b\u6709 4 \u4e2a\u5143\u7d20\uff0c\u5176\u4e2d\uff08\u5728\u67d0\u4e9b\u6392\u5217\u4e0b\uff09\u5fc5\u987b\u5206\u522b\u4e3a 1\u3001\u5927\u4e8e 0\u3001\u4efb\u610f\u503c\u548c 5\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u4f5c\u4e3a\u66ff\u4ee3\u65b9\u6848\uff0c\u60a8\u53ef\u4ee5\u5c06\u53c2\u6570\u653e\u5165 C \u6837\u5f0f\u6570\u7ec4\u4e2d\u5e76\u4f7f\u7528\n\u6539\u4e3a ",(0,s.jsx)(e.code,{children:"ElementsAreArray()"})," \u6216 ",(0,s.jsx)(e.code,{children:"UnorderedElementsAreArray()"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::ElementsAreArray;\n...\n  // ElementsAreArray accepts an array of element values.\n  const int expected_vector1[] = {1, 5, 2, 4, ...};\n  EXPECT_CALL(mock, Foo(ElementsAreArray(expected_vector1)));\n\n  // Or, an array of element matchers.\n  Matcher<int> expected_vector2[] = {1, Gt(2), _, 3, ...};\n  EXPECT_CALL(mock, Foo(ElementsAreArray(expected_vector2)));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u9700\u8981\u52a8\u6001\u521b\u5efa\u6570\u7ec4\uff08\u56e0\u6b64\u6570\u7ec4\u5927\u5c0f\u7f16\u8bd1\u5668\u65e0\u6cd5\u63a8\u65ad\uff09\uff0c\u4f60\u53ef\u4ee5\u7ed9 ",(0,s.jsx)(e.code,{children:"ElementsAreArray()"})," \u4e00\u4e2a\n\u7528\u4e8e\u6307\u5b9a\u6570\u7ec4\u5927\u5c0f\u7684\u9644\u52a0\u53c2\u6570\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::ElementsAreArray;\n...\n  int* const expected_vector3 = new int[count];\n  ... fill expected_vector3 with values ...\n  EXPECT_CALL(mock, Foo(ElementsAreArray(expected_vector3, count)));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6bd4\u8f83\u5730\u56fe\u6216\u5176\u4ed6\u5173\u8054\u5bb9\u5668\u65f6\u4f7f\u7528\u201cPair\u201d\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using testing::ElementsAre;\nusing testing::Pair;\n...\n  std::map<string, int> m = {{"a", 1}, {"b", 2}, {"c", 3}};\n  EXPECT_THAT(m, ElementsAre(Pair("a", 1), Pair("b", 2), Pair("c", 3)));\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u5efa\u8bae:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"ElementsAre*()"})," \u53ef\u7528\u4e8e\u5339\u914d ",(0,s.jsx)(e.em,{children:"\u4efb\u4f55"})," \u5b9e\u73b0 STL \u8fed\u4ee3\u5668\u6a21\u5f0f\u7684\u5bb9\u5668\uff08\u5373\u5b83\u5177\u6709 ",(0,s.jsx)(e.code,{children:"const_iterator"})," \u7c7b\u578b\u5e76\u652f\u6301 ",(0,s.jsx)(e.code,{children:"begin()/end()"}),"\uff09\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f \u4e2d\u5b9a\u4e49\u7684\u5bb9\u5668STL\u3002\u5b83\u751a\u81f3\u53ef\u4ee5\u4e0e\u5c1a\u672a\u7f16\u5199\u7684\u5bb9\u5668\u7c7b\u578b\u4e00\u8d77\u4f7f\u7528 - \u53ea\u8981\u5b83\u4eec\u9075\u5faa\u4e0a\u8ff0\u6a21\u5f0f\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:["\u60a8\u53ef\u4ee5\u4f7f\u7528\u5d4c\u5957\u7684 ",(0,s.jsx)(e.code,{children:"ElementsAre*()"})," \u6765\u5339\u914d\u5d4c\u5957\uff08\u591a\u7ef4\uff09\u5bb9\u5668\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5982\u679c\u5bb9\u5668\u662f\u901a\u8fc7\u6307\u9488\u800c\u4e0d\u662f\u5f15\u7528\u4f20\u9012\u7684\uff0c\u53ea\u9700\u7f16\u5199",(0,s.jsx)(e.code,{children:"Pointee(ElementsAre*(...))"}),"\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5bf9\u4e8e ",(0,s.jsx)(e.code,{children:"ElementsAre*()"})," \u6765\u8bf4\uff0c\u5143\u7d20\u7684\u987a\u5e8f",(0,s.jsx)(e.em,{children:"\u91cd\u8981"}),"\u3002\u5982\u679c\u60a8\u5c06\u5176\u4e0e\u5143\u7d20\u987a\u5e8f\u672a\u5b9a\u4e49\u7684\u5bb9\u5668\uff08\u4f8b\u5982",(0,s.jsx)(e.code,{children:"hash_map"}),"\uff09\u4e00\u8d77\u4f7f\u7528\uff0c\u5219\u5e94\u8be5\u5728",(0,s.jsx)(e.code,{children:"ElementsAre"}),"\u5468\u56f4\u4f7f\u7528",(0,s.jsx)(e.code,{children:"WhenSorted"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u5171\u4eab\u5339\u914d\u5668",children:"\u5171\u4eab\u5339\u914d\u5668"}),"\n",(0,s.jsx)(e.p,{children:"\u5728\u5e95\u5c42\uff0ckMock \u5339\u914d\u5668\u5bf9\u8c61\u7531\u4e00\u4e2a\u6307\u5411\u5f15\u7528\u8ba1\u6570\u7684\u6307\u9488\u7ec4\u6210\n\u5b9e\u65bd\u5bf9\u8c61\u3002\u590d\u5236\u5339\u914d\u5668\u662f\u5141\u8bb8\u7684\u5e76\u4e14\u975e\u5e38\u6709\u6548\uff0c\u56e0\u4e3a\u53ea\u6709\n\u6307\u9488\u88ab\u590d\u5236\u3002\u5f53\u5f15\u7528\u5b9e\u73b0\u7684\u6700\u540e\u4e00\u4e2a\u5339\u914d\u5668\n\u5bf9\u8c61\u6b7b\u4ea1\u65f6\uff0c\u5b9e\u73b0\u5bf9\u8c61\u5c06\u88ab\u5220\u9664\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u56e0\u6b64\uff0c\u5982\u679c\u60a8\u60f3\u518d\u6b21\u4f7f\u7528\u4e00\u4e9b\u590d\u6742\u7684\u5339\u914d\u5668\u5e76\u4e14\n\u518d\u6b21\u5f3a\u8c03\uff0c\u4e0d\u9700\u8981\u6bcf\u6b21\u90fd\u6784\u5efa\u5b83\u3002\u53ea\u9700\u5c06\u5176\u5206\u914d\u7ed9\u5339\u914d\u5668\u5373\u53ef\n\u53d8\u91cf\u5e76\u91cd\u590d\u4f7f\u7528\u8be5\u53d8\u91cf\uff01\u4f8b\u5982\uff0c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::AllOf;\nusing ::testing::Gt;\nusing ::testing::Le;\nusing ::testing::Matcher;\n...\n  Matcher<int> in_range = AllOf(Gt(5), Le(10));\n  ... use in_range as a matcher in multiple EXPECT_CALLs ...\n"})}),"\n",(0,s.jsx)(e.h3,{id:"PureMatchers",children:"\u5339\u914d\u5668\u5fc5\u987b\u6ca1\u6709\u526f\u4f5c\u7528"}),"\n",(0,s.jsx)(e.admonition,{title:"\u8b66\u544a",type:"warning",children:(0,s.jsx)(e.p,{children:"kMock \u4e0d\u4fdd\u8bc1\u5339\u914d\u5668\u4f55\u65f6\u6216\u591a\u5c11\u6b21\n\u8c03\u7528\u3002\u56e0\u6b64\uff0c\u6240\u6709\u5339\u914d\u5668\u90fd\u5fc5\u987b\u662f\u201c\u7eaf\u529f\u80fd\u6027\u7684\u201d\uff1a\u5b83\u4eec\u4e0d\u80fd\u5177\u6709\n\u4efb\u4f55\u526f\u4f5c\u7528\uff0c\u5e76\u4e14\u6bd4\u8d5b\u7ed3\u679c\u4e0d\u80fd\u4f9d\u8d56\u4e8e\u9664\n\u5339\u914d\u5668\u7684\u53c2\u6570\u548c\u88ab\u5339\u914d\u7684\u503c\u3002"})}),"\n",(0,s.jsx)(e.p,{children:"\u65e0\u8bba\u5339\u914d\u5668\u5982\u4f55\u5b9a\u4e49\uff08\u4f8b\u5982\uff0c\u5982\u679c\u5b83\u662f\u6807\u51c6\u5339\u914d\u5668\u4e4b\u4e00\uff0c\u6216\u81ea\u5b9a\u4e49\u5339\u914d\u5668\uff09\u3002\u7279\u522b\u662f\uff0c\u4e00\u4e2a\nmatcher \u6c38\u8fdc\u4e0d\u80fd\u8c03\u7528\u6a21\u62df\u51fd\u6570\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u5f71\u54cd\u6a21\u62df\u5bf9\u8c61\u548c kMock\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"setting-expectations",children:"\u8bbe\u5b9a\u671f\u671b"}),"\n",(0,s.jsx)(e.h3,{id:"UseOnCall",children:"\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u53ef\u4ee5\u671f\u5f85"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"ON_CALL"})})," \u53ef\u80fd\u662f kMock \u4e2d",(0,s.jsx)(e.em,{children:"\u672a\u88ab\u5145\u5206\u5229\u7528\u7684\u6784\u9020"}),"\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u5b9a\u4e49\u6a21\u62df\u5bf9\u8c61\u7684\u884c\u4e3a\u57fa\u672c\u4e0a\u6709\u4e24\u79cd\u6784\u9020\uff1a"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"ON_CALL"}),"\u548c",(0,s.jsx)(e.code,{children:"EXPECT_CALL"}),"\u3002\u533a\u522b\uff1f ",(0,s.jsx)(e.code,{children:"ON_CALL"}),"\u5b9a\u4e49\u4e86\u8c03\u7528\u6a21\u62df\u65b9\u6cd5\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48\uff0c\n\u4f46\u5e76\u4e0d\u610f\u5473\u7740\u5bf9\u88ab\u8c03\u7528\u7684\u65b9\u6cd5\u6709\u4efb\u4f55\u671f\u671b\u3002 ",(0,s.jsx)(e.code,{children:"EXPECT_CALL"}),"\u4e0d\u4ec5\u5b9a\u4e49\u4e86\u884c\u4e3a\uff0c\u8fd8\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u671f\u671b\uff0c\n\u5373",(0,s.jsx)("em",{children:"\u5c06\u4f7f\u7528\u7ed9\u5b9a\u7684\u53c2\u6570\u8c03\u7528\u8be5\u65b9\u6cd5\u7ed9\u5b9a\u7684\u6b21\u6570"}),"\uff08\u5e76\u4e14",(0,s.jsx)(e.em,{children:"\u6309\u7ed9\u5b9a\u7684\u987a\u5e8f"}),"\u5f53\u60a8\u6307\u5b9a\u4e5f\u8ba2\u8d2d\uff09\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u65e2\u7136",(0,s.jsx)(e.code,{children:"EXPECT_CALL"}),"\u505a\u4e86\u66f4\u591a\u7684\u4e8b\u60c5\uff0c\u90a3\u4e48\u5b83\u4e0d\u662f\u6bd4",(0,s.jsx)(e.code,{children:"ON_CALL"}),"\u66f4\u597d\u5417\uff1f\u4e8b\u5b9e\u5e76\u4e0d\u662f\u8fd9\u6837\u3002\u6bcf\u4e2a",(0,s.jsx)(e.code,{children:"EXPECT_CALL"}),"\u90fd\u4f1a\u5bf9\u88ab\u6d4b\u4ee3\u7801\u7684\u884c\u4e3a\u6dfb\u52a0\u7ea6\u675f\u3002\u62e5\u6709\u8fc7\u591a\u7684\u7ea6\u675f\u662f",(0,s.jsx)(e.em,{children:"baaad"})," - \u751a\u81f3\u6bd4\u6ca1\u6709\u8db3\u591f\u7684\u7ea6\u675f\u66f4\u7cdf\u7cd5\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u53ef\u80fd\u662f\u8fdd\u53cd\u76f4\u89c9\u7684\u3002\u9a8c\u8bc1\u66f4\u591a\u7684\u6d4b\u8bd5\u600e\u4e48\u53ef\u80fd\u6bd4\u9a8c\u8bc1\u8f83\u5c11\u7684\u6d4b\u8bd5\uff1f\u9a8c\u8bc1\u4e0d\u662f\u6d4b\u8bd5\u7684\u5168\u90e8\u76ee\u7684\u5417\uff1f"}),"\n",(0,s.jsx)(e.p,{children:"\u7b54\u6848\u5728\u4e8e\u6d4b\u8bd5\u5e94\u8be5\u9a8c\u8bc1\u201c\u4ec0\u4e48\u201d\u3002 **\u826f\u597d\u7684\u6d4b\u8bd5\u9a8c\u8bc1\u4e86\n\u4ee3\u7801\u7684\u5951\u7ea6\u3002**\u5982\u679c\u6d4b\u8bd5\u8fc7\u5ea6\u6307\u5b9a\uff0c\u5219\u4e0d\u4f1a\u7559\u4e0b\u8db3\u591f\u7684\u5185\u5bb9\n\u5b9e\u65bd\u7684\u81ea\u7531\u5ea6\u3002\u56e0\u6b64\uff0c\u65e0\u9700\u6539\u53d8\u5b9e\u73b0\n\u8fdd\u53cd\u5951\u7ea6\uff08\u4f8b\u5982\u91cd\u6784\u548c\u4f18\u5316\uff09\uff0c\u8fd9\u5e94\u8be5\u662f\n\u505a\u5f97\u5f88\u597d\uff0c\u53ef\u4ee5\u6253\u7834\u8fd9\u6837\u7684\u6d4b\u8bd5\u3002\u7136\u540e\u4f60\u5c31\u5f97\u82b1\u65f6\u95f4\u53bb\u4fee\u590d\n\u4ed6\u4eec\uff0c\u53ea\u4f1a\u5728\u4e0b\u6b21\u5b9e\u65bd\u66f4\u6539\u65f6\u770b\u5230\u5b83\u4eec\u518d\u6b21\u635f\u574f\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u8bf7\u8bb0\u4f4f\uff0c\u65e0\u9700\u5728\u4e00\u9879\u6d4b\u8bd5\u4e2d\u9a8c\u8bc1\u591a\u4e2a\u5c5e\u6027\u3002\n\u4e8b\u5b9e\u4e0a\uff0c**\u5728\u4e00\u6b21\u6d4b\u8bd5\u4e2d\u4ec5\u9a8c\u8bc1\u4e00\u4ef6\u4e8b\u662f\u4e00\u79cd\u5f88\u597d\u7684\u98ce\u683c\u3002**\u5982\u679c\u60a8\u8fd9\u6837\u505a\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u9519\u8bef\u53ef\u80fd\u53ea\u4f1a\u7834\u574f\u4e00\u4e24\u4e2a\u6d4b\u8bd5\uff0c\u800c\u4e0d\u662f\u51e0\u5341\u4e2a\uff08\u5176\u4e2d\n\u60a8\u613f\u610f\u8c03\u8bd5\u7684\u60c5\u51b5\u5417\uff1f\uff09\u3002\u5982\u679c\u60a8\u4e5f\u6709\u8fdb\u884c\u6d4b\u8bd5\u7684\u4e60\u60ef\n\u63cf\u8ff0\u6027\u540d\u79f0\u544a\u8bc9\u4ed6\u4eec\u9a8c\u8bc1\u7684\u5185\u5bb9\uff0c\u60a8\u901a\u5e38\u53ef\u4ee5\u8f7b\u677e\u731c\u51fa\u662f\u4ec0\u4e48\n\u4ec5\u4ece\u6d4b\u8bd5\u65e5\u5fd7\u672c\u8eab\u6765\u770b\u5c31\u662f\u9519\u8bef\u7684\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u56e0\u6b64\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528",(0,s.jsx)(e.code,{children:"ON_CALL"}),"\uff0c\u5e76\u4e14\u4ec5\u5728\u60a8\u771f\u6b63\u60f3\u8981\u65f6\u624d\u4f7f\u7528",(0,s.jsx)(e.code,{children:"EXPECT_CALL"}),"\n\u4ee5\u9a8c\u8bc1\u662f\u5426\u5df2\u8fdb\u884c\u547c\u53eb\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u80fd\u6709\u4e00\u5806",(0,s.jsx)(e.code,{children:"ON_CALL"}),"\n\u5728\u60a8\u7684\u6d4b\u8bd5\u88c5\u7f6e\u4e2d\u8bbe\u7f6e\u6240\u6709\u6d4b\u8bd5\u5171\u4eab\u7684\u901a\u7528\u6a21\u62df\u884c\u4e3a\n\u540c\u4e00\u7ec4\uff0c\u5e76\u5728\u4e0d\u540c\u7684",(0,s.jsx)(e.code,{children:"TEST_F"}),"\u4e2d\u5199\u5165\uff08\u51e0\u4e4e\uff09\u4e0d\u540c\u7684",(0,s.jsx)(e.code,{children:"EXPECT_CALL"}),"\n\u9a8c\u8bc1\u4ee3\u7801\u884c\u4e3a\u7684\u4e0d\u540c\u65b9\u9762\u3002\u4e0e\u98ce\u683c\u76f8\u6bd4\n\u5176\u4e2d\u6bcf\u4e2a",(0,s.jsx)(e.code,{children:"TEST"}),"\u90fd\u6709\u8bb8\u591a",(0,s.jsx)(e.code,{children:"EXPECT_CALL"}),"\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u6d4b\u8bd5\u66f4\u591a\n\u80fd\u591f\u9002\u5e94\u5b9e\u65bd\u53d8\u5316\uff08\u56e0\u6b64\u4e0d\u592a\u53ef\u80fd\u9700\u8981\n\u7ef4\u62a4\uff09\u5e76\u4f7f\u6d4b\u8bd5\u7684\u610f\u56fe\u66f4\u52a0\u660e\u663e\uff08\u56e0\u6b64\u5b83\u4eec\u66f4\u5bb9\u6613\n\u5f53\u60a8\u786e\u5b9e\u9700\u8981\u7ef4\u62a4\u5b83\u4eec\u65f6\u8fdb\u884c\u7ef4\u62a4\uff09\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u5bf9\u6253\u5370\u7684\u201c\u65e0\u8da3\u7684\u6a21\u62df\u51fd\u6570\u8c03\u7528\u201d\u6d88\u606f\u611f\u5230\u56f0\u6270\n\u5f53\u8c03\u7528\u6ca1\u6709 EXPECT_CALL \u7684\u6a21\u62df\u65b9\u6cd5\u65f6\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 NiceMock\n\u76f8\u53cd\uff0c\u8981\u6291\u5236\u6a21\u62df\u5bf9\u8c61\u7684\u6240\u6709\u6b64\u7c7b\u6d88\u606f\uff0c\u6216\u8005\u6291\u5236\n\u901a\u8fc7\u6dfb\u52a0",(0,s.jsx)(e.code,{children:"EXPECT_CALL(...).Times(AnyNumber())"}),"\u6765\u663e\u793a\u7279\u5b9a\u65b9\u6cd5\u7684\u6d88\u606f\u3002\u505a\n\u4e0d\u8981\u901a\u8fc7\u76f2\u76ee\u6dfb\u52a0",(0,s.jsx)(e.code,{children:"EXPECT_CALL(...)"}),"\u6765\u6291\u5236\u5b83\uff0c\u5426\u5219\u60a8\u5c06\u8fdb\u884c\u6d4b\u8bd5\n\u7ef4\u62a4\u8d77\u6765\u5f88\u75db\u82e6\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u5ffd\u7565\u65e0\u8da3\u7684\u8c03\u7528",children:"\u5ffd\u7565\u65e0\u8da3\u7684\u8c03\u7528"}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u5bf9\u6a21\u62df\u65b9\u6cd5\u7684\u8c03\u7528\u65b9\u5f0f\u4e0d\u611f\u5174\u8da3\uff0c\u8bf7\u4e0d\u8981\u8bf4\n\u5173\u4e8e\u5b83\u7684\u4efb\u4f55\u4e8b\u60c5\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u8be5\u65b9\u6cd5\u88ab\u8c03\u7528\uff0ckMock \u5c06\n\u6267\u884c\u5176\u9ed8\u8ba4\u64cd\u4f5c\u4ee5\u5141\u8bb8\u6d4b\u8bd5\u7a0b\u5e8f\u7ee7\u7eed\u3002\u5982\u679c\u4f60\u4e0d\u662f\n\u5bf9 kMock \u91c7\u53d6\u7684\u9ed8\u8ba4\u64cd\u4f5c\u611f\u5230\u6ee1\u610f\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8986\u76d6\u5b83\n",(0,s.jsx)(e.code,{children:"DefaultValue<T>::Set()"}),"\uff08",(0,s.jsx)(e.a,{href:"#DefaultValue",children:"\u6b64\u5904"})," \u63cf\u8ff0\uff09\u6216 ",(0,s.jsx)(e.code,{children:"ON_CALL()"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u4e00\u65e6\u60a8\u8868\u8fbe\u4e86\u5bf9\u7279\u5b9a\u6a21\u62df\u65b9\u6cd5\u7684\u5174\u8da3\uff08\u901a\u8fc7\n",(0,s.jsx)(e.code,{children:"EXPECT_CALL()"}),")\uff0c\u5bf9\u5176\u7684\u6240\u6709\u8c03\u7528\u90fd\u5fc5\u987b\u7b26\u5408\u67d0\u4e9b\u671f\u671b\u3002\u5982\u679c\u8fd9\u4e2a\n\u51fd\u6570\u88ab\u8c03\u7528\u4f46\u53c2\u6570\u4e0e\u4efb\u4f55\u201cEXPECT_CALL()\u201d\u8bed\u53e5\u4e0d\u5339\u914d\uff0c\n\u8fd9\u5c06\u662f\u4e00\u4e2a\u9519\u8bef\u3002"]}),"\n",(0,s.jsxs)(e.h3,{id:"\u7981\u6b62\u610f\u5916call",children:["\u7981\u6b62\u610f\u5916",(0,s.jsx)(e.code,{children:"call"})]}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u6839\u672c\u4e0d\u5e94\u8be5\u8c03\u7528\u6a21\u62df\u65b9\u6cd5\uff0c\u8bf7\u660e\u786e\u8bf4\u660e\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\n...\n  EXPECT_CALL(foo, Bar(_))\n      .Times(0);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u5141\u8bb8\u5bf9\u8be5\u65b9\u6cd5\u7684\u67d0\u4e9b\u8c03\u7528\uff0c\u4f46\u5176\u4f59\u7684\u5219\u4e0d\u5141\u8bb8\uff0c\u5219\u53ea\u9700\u5217\u51fa\u6240\u6709\n\u9884\u671f\u6765\u7535\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::AnyNumber;\nusing ::testing::Gt;\n...\n  EXPECT_CALL(foo, Bar(5));\n  EXPECT_CALL(foo, Bar(Gt(10)))\n      .Times(AnyNumber());\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5bf9",(0,s.jsx)(e.code,{children:"foo.Bar()"}),"\u7684\u8c03\u7528\u4e0e\u4efb\u4f55",(0,s.jsx)(e.code,{children:"EXPECT_CALL()"}),"\u8bed\u53e5\u90fd\u4e0d\u5339\u914d\n\u5c06\u4f1a\u51fa\u73b0\u9519\u8bef\u3002"]}),"\n",(0,s.jsxs)(e.h3,{id:"uninteresting-vs-unexpected",children:["\u4e86\u89e3\u65e0\u8da3\u4e0e\u610f\u5916\u7684",(0,s.jsx)(e.code,{children:"call"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.em,{children:"\u65e0\u8da3"}),"\u8c03\u7528\u548c",(0,s.jsx)(e.em,{children:"\u610f\u5916"}),"\u8c03\u7528\u5728 kMock \u4e2d\u662f\u4e0d\u540c\u7684\u6982\u5ff5\u3002\n",(0,s.jsx)(e.em,{children:"\u975e\u5e38"}),"\u4e0d\u540c\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c",(0,s.jsx)(e.em,{children:"\u751a\u81f3\u6ca1\u6709\u4e00\u4e2a"}),"\uff0c\u90a3\u4e48\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"x.Y(...)"})," \u5c31\u662f",(0,s.jsx)(e.strong,{children:"\u65e0\u8da3"}),"\n",(0,s.jsx)(e.code,{children:"EXPECT_CALL(x, Y(...))"})," \u8bbe\u7f6e\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6d4b\u8bd5\u4e0d\u611f\u5174\u8da3\n\u6839\u672c\u6ca1\u6709 ",(0,s.jsx)(e.code,{children:"x.Y()"})," \u65b9\u6cd5\uff0c\u5f88\u660e\u663e\u6d4b\u8bd5\u5e76\u4e0d\u5728\u4e4e\u8bf4\u4ec0\u4e48\n\u5173\u4e8e\u5b83\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u6709 ",(0,s.jsx)(e.em,{children:"\u4e00\u4e9b"})," ",(0,s.jsx)(e.code,{children:"EXPECT_CALL(x, Y(...)) \u5df2\u8bbe\u7f6e\uff0c\u4f46\u6ca1\u6709\u4e00\u4e2a\u4e0e\u8c03\u7528\u5339\u914d\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6d4b\u8bd5\u662f \u5bf9 "}),"x.Y()",(0,s.jsx)(e.code,{children:"\u65b9\u6cd5\u611f\u5174\u8da3\uff08\u56e0\u6b64\u5b83\u660e\u786e\u8bbe\u7f6e\u4e86\u4e00\u4e9b"}),"EXPECT_CALL` \u6765\u9a8c\u8bc1\u5b83\u662f\u5982\u4f55\u8c03\u7528\u7684\uff09\uff1b\u4f46\u662f\uff0c\u9a8c\u8bc1\u5931\u8d25\uff0c\u56e0\u4e3a\ntest \u9884\u8ba1\u4e0d\u4f1a\u53d1\u751f\u6b64\u7279\u5b9a\u8c03\u7528\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"**\u610f\u5916\u7684\u8c03\u7528\u59cb\u7ec8\u662f\u4e00\u4e2a\u9519\u8bef\uff0c**\u56e0\u4e3a\u88ab\u6d4b\u8bd5\u7684\u4ee3\u7801\u6ca1\u6709\u884c\u4e3a\n\u6d4b\u8bd5\u671f\u671b\u5b83\u7684\u884c\u4e3a\u65b9\u5f0f\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["**\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u65e0\u8da3\u7684\u8c03\u7528\u4e0d\u662f\u9519\u8bef\uff0c**\u56e0\u4e3a\u5b83\u8fdd\u53cd\u4e86\n\u6d4b\u8bd5\u6307\u5b9a\u7684\u7ea6\u675f\u3002 \uff08kMock \u7684\u7406\u5ff5\u662f\uff0c\u4ec0\u4e48\u90fd\u4e0d\u8bf4\n\u610f\u5473\u7740\u6ca1\u6709\u9650\u5236\u3002\uff09\u4f46\u662f\uff0c\u5b83\u4f1a\u5bfc\u81f4\u8b66\u544a\uff0c\u56e0\u4e3a\u5b83",(0,s.jsx)(e.em,{children:"\u53ef\u80fd"}),"\n\u6307\u51fa\u4e00\u4e2a\u95ee\u9898\uff08\u4f8b\u5982\uff0c\u6d4b\u8bd5\u4f5c\u8005\u53ef\u80fd\u5fd8\u8bb0\u6307\u5b9a\u4e00\u4e2a\n\u7ea6\u675f\uff09\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5728 kMock \u4e2d\uff0c",(0,s.jsx)(e.code,{children:"NiceMock"})," \u548c ",(0,s.jsx)(e.code,{children:"StrictMock"})," \u53ef\u7528\u4e8e\u4f7f\u6a21\u62df\u7c7b\u201cnice\u201d\u6216\n\u201c\u4e25\u683c\u7684\u201d\u3002\u8fd9\u5bf9\u65e0\u8da3\u7684\u547c\u53eb\u548c\u610f\u5916\u7684\u547c\u53eb\u6709\u4f55\u5f71\u54cd\uff1f"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"nice\u7684\u6a21\u62df"}),"\u6291\u5236\u65e0\u8da3\u7684\u8c03\u7528",(0,s.jsx)(e.em,{children:"\u8b66\u544a"}),"\u3002\u5b83\u6bd4\u4e0d\u90a3\u4e48\u5065\u8c08\n\u9ed8\u8ba4\u6a21\u62df\uff0c\u4f46\u5176\u4ed6\u65b9\u9762\u662f\u76f8\u540c\u7684\u3002\u5982\u679c\u6d4b\u8bd5\u56e0\u9ed8\u8ba4\u800c\u5931\u8d25\n\u6a21\u62df\uff0c\u4f7f\u7528\u6f02\u4eae\u7684\u6a21\u62df\u4ee3\u66ff\u4e5f\u4f1a\u5931\u8d25\u3002\u53cd\u4e4b\u4ea6\u7136\u3002\u522b\u6307\u671b\n\u8fdb\u884c\u6a21\u62df\u53ef\u4ee5\u5f88\u597d\u5730\u6539\u53d8\u6d4b\u8bd5\u7ed3\u679c\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4e25\u683c\u7684\u6a21\u62df"}),"\u4f1a\u5c06\u65e0\u8da3\u7684\u8c03\u7528\u8b66\u544a\u53d8\u6210\u9519\u8bef\u3002\u6240\u4ee5\u5236\u4f5c\u4e00\u4e2a\n\u6a21\u62df\u4e25\u683c\u53ef\u80fd\u4f1a\u6539\u53d8\u6d4b\u8bd5\u7684\u7ed3\u679c\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u4f8b\u5b50\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'TEST(...) {\n  NiceMock<MockDomainRegistry> mock_registry;\n  EXPECT_CALL(mock_registry, GetDomainOwner("google.com"))\n          .WillRepeatedly(Return("Larry Page"));\n\n  // Use mock_registry in code under test.\n  ... &mock_registry ...\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u91cc\u552f\u4e00\u7684\u201cEXPECT_CALL\u201d\u8868\u793a\u5bf9\u201cGetDomainOwner()\u201d\u7684\u6240\u6709\u8c03\u7528\u90fd\u5fc5\u987b\u5177\u6709\n\u201cgoogle.com\u201d\u4f5c\u4e3a\u53c2\u6570\u3002\u5982\u679c\u8c03\u7528",(0,s.jsx)(e.code,{children:'GetDomainOwner("yahoo.com")'}),"\uff0c\u5b83\n\u5c06\u662f\u4e00\u4e2a\u610f\u5916\u7684\u8c03\u7528\uff0c\u56e0\u6b64\u4f1a\u51fa\u73b0\u9519\u8bef\u3002 ",(0,s.jsx)(e.em,{children:"\u6709\u4e00\u4e2a\u5f88\u597d\u7684\u6a21\u62df\u5e76\u4e0d\n\u66f4\u6539\u610f\u5916\u547c\u53eb\u7684\u4e25\u91cd\u7a0b\u5ea6\u3002"})]}),"\n",(0,s.jsxs)(e.p,{children:["\u90a3\u4e48\u6211\u4eec\u5982\u4f55\u544a\u8bc9 kMock \u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"GetDomainOwner()"}),"\n\u8bba\u70b9\u4e5f\u662f\u5982\u6b64\uff1f\u6807\u51c6\u6280\u672f\u662f\u6dfb\u52a0\u201ccatch all\u201d\u201cEXPECT_CALL\u201d\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'  EXPECT_CALL(mock_registry, GetDomainOwner(_))\n        .Times(AnyNumber());  // catches all other calls to this method.\n  EXPECT_CALL(mock_registry, GetDomainOwner("google.com"))\n        .WillRepeatedly(Return("Larry Page"));\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u8bb0\u4f4f\uff0c\u201c_\u201d\u662f\u5339\u914d\u4efb\u4f55\u5185\u5bb9\u7684\u901a\u914d\u7b26\u5339\u914d\u5668\u3002\u6709\u4e86\u8fd9\u4e2a\uff0c\u5982\u679c\n\u8c03\u7528 ",(0,s.jsx)(e.code,{children:'GetDomainOwner("google.com")'})," \uff0c\u5b83\u5c06\u6267\u884c\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\n",(0,s.jsx)(e.code,{children:"EXPECT_CALL"})," \u8bf4\uff1b\u5982\u679c\u7528\u4e0d\u540c\u7684\u53c2\u6570\u8c03\u7528\u5b83\uff0c\u5b83\u4f1a\u505a\u4ec0\u4e48\n\u7b2c\u4e00\u4e2a\u201cEXPECT_CALL\u201d\u8bf4\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u4e24\u4e2a\u201cEXPECT_CALL\u201d\u7684\u987a\u5e8f\u5f88\u91cd\u8981\uff0c\u56e0\u4e3a\u4f5c\u4e3a\u8f83\u65b0\u7684\n",(0,s.jsx)(e.code,{children:"EXPECT_CALL"})," \u4f18\u5148\u4e8e\u65e7\u7684\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u6709\u5173\u65e0\u8da3\u7684\u8c03\u7528\u3001\u6f02\u4eae\u7684\u6a21\u62df\u548c\u4e25\u683c\u7684\u6a21\u62df\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u9605\u8bfb\n",(0,s.jsx)(e.a,{href:"#NiceStrictNaggy",children:"\u201c\u53cb\u5584\u3001\u4e25\u683c\u548c\u5520\u53e8\u201d"}),"\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"ParameterlessExpectations",children:"\u5ffd\u7565\u65e0\u8da3\u7684\u53c2\u6570"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u4f60\u7684\u6d4b\u8bd5\u4e0d\u5173\u5fc3\u53c2\u6570\uff08\u5b83\u53ea\u5173\u5fc3\u6570\u5b57\n\u6216\u8c03\u7528\u987a\u5e8f\uff09\uff0c\u60a8\u901a\u5e38\u53ef\u4ee5\u7b80\u5355\u5730\u7701\u7565\u53c2\u6570\u5217\u8868\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  // Expect foo.Bar( ... ) twice with any arguments.\n  EXPECT_CALL(foo, Bar).Times(2);\n\n  // Delegate to the given method whenever the factory is invoked.\n  ON_CALL(foo_factory, MakeFoo)\n      .WillByDefault(&BuildFooForTest);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6b64\u529f\u80fd\u4ec5\u5728\u65b9\u6cd5\u672a\u91cd\u8f7d\u65f6\u53ef\u7528\uff1b\u9632\u6b62\n\u610f\u5916\u884c\u4e3a\u5c1d\u8bd5\u8bbe\u7f6e\u671f\u671b\u662f\u4e00\u4e2a\u7f16\u8bd1\u9519\u8bef\n\u7279\u5b9a\u91cd\u8f7d\u4e0d\u660e\u786e\u7684\u65b9\u6cd5\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u89e3\u51b3\u6b64\u95ee\u9898\n\u63d0\u4f9b\u6bd4\u6a21\u62df\u7c7b\u66f4\u7b80\u5355\u7684\u6a21\u62df\u63a5\u53e3\uff08#SimplerInterfaces\uff09\n\u63d0\u4f9b\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u5f53\u53c2\u6570\u5f88\u6709\u8da3\u4f46\u5339\u914d\u903b\u8f91\u65f6\uff0c\u6b64\u6a21\u5f0f\u4e5f\u5f88\u6709\u7528\n\u76f8\u5f53\u590d\u6742\u3002\u60a8\u53ef\u4ee5\u4e0d\u6307\u5b9a\u53c2\u6570\u5217\u8868\u5e76\u4f7f\u7528\nSaveArg \u64cd\u4f5c",(0,s.jsx)(e.a,{href:"#SaveArgVerify",children:"\u4fdd\u5b58\u503c\u4ee5\u4f9b\u4ee5\u540e\u9a8c\u8bc1"}),"\u3002\u5982\u679c\n\u4f60\u8fd9\u6837\u505a\uff0c\u4f60\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u533a\u5206\u8c03\u7528\u8be5\u65b9\u6cd5\u7684\u9519\u8bef\u6570\u91cf\n\u4f7f\u7528\u9519\u8bef\u7684\u53c2\u6570\u8c03\u7528\u5b83\u7684\u6b21\u6570\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"OrderedCalls",children:"\u671f\u5f85\u6709\u5e8f\u8c03\u7528"}),"\n",(0,s.jsxs)(e.p,{children:["\u5c3d\u7ba1 kMock \u65f6\u7a0d\u540e\u5b9a\u4e49\u7684",(0,s.jsx)(e.code,{children:"EXPECT_CALL()"}),"\u8bed\u53e5\u4f18\u5148\n\u5c1d\u8bd5\u5c06\u51fd\u6570\u8c03\u7528\u4e0e\u671f\u671b\u76f8\u5339\u914d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8c03\u7528\u6ca1\u6709\n\u6309\u7167\u7f16\u5199",(0,s.jsx)(e.code,{children:"EXPECT_CALL()"}),"\u8bed\u53e5\u7684\u987a\u5e8f\u53d1\u751f\u3002\u4f8b\u5982\uff0c\u5982\u679c\n\u53c2\u6570\u4e0e\u7b2c\u4e8c\u4e2a",(0,s.jsx)(e.code,{children:"EXPECT_CALL()"}),"\u4e2d\u7684\u5339\u914d\u5668\u5339\u914d\uff0c\u4f46\u4e0e\n\u7b2c\u4e00\u4e2a\u548c\u7b2c\u4e09\u4e2a\uff0c\u7136\u540e\u5c06\u4f7f\u7528\u7b2c\u4e8c\u4e2a\u671f\u671b\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u5e0c\u671b\u6240\u6709\u8c03\u7528\u90fd\u6309\u7167\u671f\u671b\u7684\u987a\u5e8f\u53d1\u751f\uff0c\u8bf7\u8f93\u5165\n\u5b9a\u4e49\u7c7b\u578b\u53d8\u91cf\u7684\u5757\u4e2d\u7684\u201cEXPECT_CALL()\u201d\u8bed\u53e5\n",(0,s.jsx)(e.code,{children:"\u6309\u987a\u5e8f"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::InSequence;\n\n  {\n    InSequence s;\n\n    EXPECT_CALL(foo, DoThis(5));\n    EXPECT_CALL(bar, DoThat(_))\n        .Times(2);\n    EXPECT_CALL(foo, DoThis(6));\n  }\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u671f\u671b\u8c03\u7528",(0,s.jsx)(e.code,{children:"foo.DoThis(5)"}),"\uff0c\u7136\u540e\u8c03\u7528\u4e24\u6b21\n",(0,s.jsx)(e.code,{children:"bar.DoThat()"})," \u53c2\u6570\u53ef\u4ee5\u662f\u4efb\u4f55\u4e1c\u897f\uff0c\u540e\u9762\u4f9d\u6b21\u662f\n\u5bf9 ",(0,s.jsx)(e.code,{children:"foo.DoThis(6)"})," \u7684\u8c03\u7528\u3002\u5982\u679c\u53d1\u751f\u65e0\u5e8f\u8c03\u7528\uff0ckMock \u5c06\u62a5\u544a\n\u9519\u8bef\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"PartialOrder",children:"\u671f\u5f85\u90e8\u5206\u6709\u5e8f\u7684\u8c03\u7528"}),"\n",(0,s.jsxs)(e.p,{children:["\u6709\u65f6\u8981\u6c42\u4e00\u5207\u6309\u9884\u5b9a\u987a\u5e8f\u53d1\u751f\u53ef\u80fd\u4f1a\u5bfc\u81f4\n\u8106\u6027\u6d4b\u8bd5\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u80fd\u5173\u5fc3",(0,s.jsx)(e.code,{children:"A"}),"\u51fa\u73b0\u5728",(0,s.jsx)(e.code,{children:"B"}),"\u548c",(0,s.jsx)(e.code,{children:"B"}),"\u4e4b\u524d\n",(0,s.jsx)(e.code,{children:"C"}),"\uff0c\u4f46\u5bf9",(0,s.jsx)(e.code,{children:"B"}),"\u548c",(0,s.jsx)(e.code,{children:"C"}),"\u7684\u76f8\u5bf9\u987a\u5e8f\u4e0d\u611f\u5174\u8da3\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\n\u6d4b\u8bd5\u5e94\u8be5\u53cd\u6620\u6211\u4eec\u7684\u771f\u5b9e\u610f\u56fe\uff0c\u800c\u4e0d\u662f\u8fc7\u5ea6\u9650\u5236\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["kMock \u5141\u8bb8\u60a8\u5728\u6a21\u578b\u4e0a\u65bd\u52a0\u4efb\u610f DAG\uff08\u6709\u5411\u65e0\u73af\u56fe\uff09\n\u6765\u7535\u3002\u8868\u8fbe DAG \u7684\u4e00\u79cd\u65b9\u6cd5\u662f\u4f7f\u7528\n",(0,s.jsx)(e.code,{children:"EXPECT_CALL"})," \u7684 ",(0,s.jsxs)(e.a,{href:"/docs/next/cpp/base/testing/kt/reference/mocking#EXPECT_CALL.After",children:[(0,s.jsx)(e.code,{children:"After"})," \u5b50\u53e5"]}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u901a\u8fc7\u201cInSequence()\u201d\u5b50\u53e5\uff08\u4e0e\u201cInSequence\u201d\u4e0d\u540c\uff09\nclass)\uff0c\u6211\u4eec\u4ece jMock 2 \u501f\u6765\u7684\u3002\u5b83\u4e0d\u5982 ",(0,s.jsx)(e.code,{children:"After()"})," \u7075\u6d3b\uff0c\u4f46\u662f\n\u5f53\u60a8\u6709\u5f88\u957f\u7684\u8fde\u7eed\u8c03\u7528\u94fe\u65f6\u4f1a\u66f4\u65b9\u4fbf\uff0c\u56e0\u4e3a\u5b83\u6ca1\u6709\n\u8981\u6c42\u4f60\u4e3a\u94fe\u4e2d\u7684\u671f\u671b\u60f3\u51fa\u4e0d\u540c\u7684\u540d\u79f0\u3002\n\u5b83\u7684\u5de5\u4f5c\u539f\u7406\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u6211\u4eec\u5c06\u201cEXPECT_CALL()\u201d\u8bed\u53e5\u89c6\u4e3a\u56fe\u4e2d\u7684\u8282\u70b9\uff0c\u5e76\u4ece\n\u8282\u70b9A\u5230\u8282\u70b9B\uff0c\u53ea\u8981A\u5fc5\u987b\u51fa\u73b0\u5728B\u4e4b\u524d\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2aDAG\u3002\u6211\u4eec\u4f7f\u7528\n\u672f\u8bed\u201c\u5e8f\u5217\u201d\u8868\u793a\u8be5 DAG \u4e2d\u7684\u6709\u5411\u8def\u5f84\u3002\u73b0\u5728\uff0c\u5982\u679c\u6211\u4eec\u5206\u89e3\nDAG \u8f6c\u5316\u4e3a\u5e8f\u5217\uff0c\u6211\u4eec\u53ea\u9700\u8981\u77e5\u9053\u6bcf\u4e2a\u201cEXPECT_CALL()\u201d\u662f\u54ea\u4e9b\u5e8f\u5217\n\u5c5e\u4e8e\u4e3a\u4e86\u80fd\u591f\u91cd\u5efa\u539f\u59cb\u7684DAG\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u56e0\u6b64\uff0c\u8981\u6307\u5b9a\u671f\u671b\u7684\u504f\u5e8f\uff0c\u6211\u4eec\u9700\u8981\u505a\u4e24\u4ef6\u4e8b\uff1a\n\u9996\u5148\u5b9a\u4e49\u4e00\u4e9b\u201cSequence\u201d\u5bf9\u8c61\uff0c\u7136\u540e\u4e3a\u6bcf\u4e2a\u201cEXPECT_CALL()\u201d\u8bf4\n\u5b83\u5c5e\u4e8e\u54ea\u4e2a\u201cSequence\u201d\u5bf9\u8c61\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u76f8\u540c\u987a\u5e8f\u7684\u671f\u671b\u5fc5\u987b\u6309\u7167\u5b83\u4eec\u7684\u4e66\u5199\u987a\u5e8f\u51fa\u73b0\u3002\u4e3a\u4e86\n\u4f8b\u5b50\uff0c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::Sequence;\n...\n  Sequence s1, s2;\n\n  EXPECT_CALL(foo, A())\n      .InSequence(s1, s2);\n  EXPECT_CALL(bar, B())\n      .InSequence(s1);\n  EXPECT_CALL(bar, C())\n      .InSequence(s2);\n  EXPECT_CALL(foo, D())\n      .InSequence(s2);\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6307\u5b9a\u4ee5\u4e0b DAG\uff08\u5176\u4e2d\u201cs1\u201d\u662f\u201cA -> B\u201d\uff0c\u201cs2\u201d\u662f\u201cA -> C -> D\u201d\uff09\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-text",children:"       +---\x3e B\n       |\n  A ---|\n       |\n       +---\x3e C ---\x3e D\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u610f\u5473\u7740 A \u5fc5\u987b\u51fa\u73b0\u5728 B \u548c C \u4e4b\u524d\uff0c\u5e76\u4e14 C \u5fc5\u987b\u51fa\u73b0\u5728 D \u4e4b\u524d\u3002\n\u9664\u6b64\u4e4b\u5916\uff0c\u6ca1\u6709\u5176\u4ed6\u987a\u5e8f\u9650\u5236\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u63a7\u5236\u671f\u671b\u4f55\u65f6\u6d88\u5931",children:"\u63a7\u5236\u671f\u671b\u4f55\u65f6\u6d88\u5931"}),"\n",(0,s.jsxs)(e.p,{children:["\u5f53\u8c03\u7528\u6a21\u62df\u65b9\u6cd5\u65f6\uff0ckMock \u53ea\u8003\u8651\u4ecd\u7136\u5b58\u5728\u7684\u671f\u671b\n\u79ef\u6781\u7684\u3002\u671f\u671b\u5728\u521b\u5efa\u65f6\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\uff0c\u7136\u540e\u53d8\u4e3a\u975e\u6d3b\u52a8\u72b6\u6001\uff08\u53c8\u540d\n",(0,s.jsx)(e.em,{children:"\u9000\u4f11"}),"\uff09\u5f53\u53d1\u751f\u7a0d\u540e\u5fc5\u987b\u53d1\u751f\u7684\u547c\u53eb\u65f6\u3002\u4f8b\u5982\uff0c\u5728"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::_;\nusing ::testing::Sequence;\n...\n  Sequence s1, s2;\n\n  EXPECT_CALL(log, Log(WARNING, _, "File too large."))      // #1\n      .Times(AnyNumber())\n      .InSequence(s1, s2);\n  EXPECT_CALL(log, Log(WARNING, _, "Data set is empty."))   // #2\n      .InSequence(s1);\n  EXPECT_CALL(log, Log(WARNING, _, "User not found."))      // #3\n      .InSequence(s2);\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u4e00\u65e6 #2 \u6216 #3 \u5339\u914d\uff0c#1 \u5c06\u9000\u51fa\u3002\u5982\u679c\u5728\u6b64\u4e4b\u540e\u8bb0\u5f55\u8b66\u544a",(0,s.jsx)(e.code,{children:'"File too large."'}),"\uff0c\u5219\u8fd9\u5c06\u662f\u4e00\u4e2a\u9519\u8bef\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8bf7\u6ce8\u610f\uff0c\u671f\u671b\u5728\u9971\u548c\u65f6\u4e0d\u4f1a\u81ea\u52a8\u6d88\u5931\u3002\u4e3a\u4e86\n\u4f8b\u5b50\uff0c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::_;\n...\n  EXPECT_CALL(log, Log(WARNING, _, _));                     // #1\n  EXPECT_CALL(log, Log(WARNING, _, "File too large."));     // #2\n'})}),"\n",(0,s.jsx)(e.p,{children:'\u8868\u793a\u5c06\u4f1a\u51fa\u73b0\u4e00\u4e2a\u8b66\u544a\uff0c\u5176\u4e2d\u5305\u542b\u6d88\u606f\u201c\u201cFile too\u201d\nlarge."`\u3002\u5982\u679c\u7b2c\u4e8c\u4e2a\u8b66\u544a\u4e5f\u5305\u542b\u6b64\u6d88\u606f\uff0c#2 \u5c06\u518d\u6b21\u5339\u914d\n\u5e76\u5bfc\u81f4\u8fdd\u53cd\u4e0a\u9650\u7684\u9519\u8bef\u3002'}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u8fd9\u4e0d\u662f\u4f60\u60f3\u8981\u7684\uff0c\u4f60\u53ef\u4ee5\u8981\u6c42\u671f\u671b\u5c3d\u5feb\u9000\u4f11\n\u53d8\u5f97\u9971\u548c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::_;\n...\n  EXPECT_CALL(log, Log(WARNING, _, _));                     // #1\n  EXPECT_CALL(log, Log(WARNING, _, "File too large."))      // #2\n      .RetiresOnSaturation();\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u91cc #2 \u53ea\u80fd\u4f7f\u7528\u4e00\u6b21\uff0c\u6240\u4ee5\u5982\u679c\u60a8\u6709\u4e24\u4e2a\u8b66\u544a\u6d88\u606f",(0,s.jsx)(e.code,{children:'"File too large."'}),"\uff0c\u7b2c\u4e00\u4e2a\u5c06\u5339\u914d #2\uff0c\u7b2c\u4e8c\u4e2a\u5c06\u5339\u914d #1 -\n\u4e0d\u4f1a\u6709\u9519\u8bef\u3002"]}),"\n",(0,s.jsx)(e.h2,{id:"using-actions",children:"\u4f7f\u7528 Actions"}),"\n",(0,s.jsx)(e.h3,{id:"\u4ece\u6a21\u62df\u65b9\u6cd5\u8fd4\u56de\u5f15\u7528",children:"\u4ece\u6a21\u62df\u65b9\u6cd5\u8fd4\u56de\u5f15\u7528"}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u6a21\u62df\u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b\u662f\u5f15\u7528\uff0c\u5219\u9700\u8981\u4f7f\u7528\u201cReturnRef()\u201d\n\u800c\u4e0d\u662f ",(0,s.jsx)(e.code,{children:"Return()"})," \u8fd4\u56de\u7ed3\u679c\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::ReturnRef;\n\nclass MockFoo : public Foo {\n public:\n  MOCK_METHOD(Bar&, GetBar, (), (override));\n};\n...\n  MockFoo foo;\n  Bar bar;\n  EXPECT_CALL(foo, GetBar())\n      .WillOnce(ReturnRef(bar));\n...\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u4ece\u6a21\u62df\u65b9\u6cd5\u8fd4\u56de\u5b9e\u65f6\u503c",children:"\u4ece\u6a21\u62df\u65b9\u6cd5\u8fd4\u56de\u5b9e\u65f6\u503c"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"Return(x)"}),"\u64cd\u4f5c\u5728\u521b\u5efa\u64cd\u4f5c\u65f6\u4fdd\u5b58",(0,s.jsx)(e.code,{children:"x"}),"\u7684\u526f\u672c\uff0c\u5e76\u4e14\n\u6bcf\u5f53\u6267\u884c\u65f6\u603b\u662f\u8fd4\u56de\u76f8\u540c\u7684\u503c\u3002\u6709\u65f6\u60a8\u53ef\u80fd\u60f3\u8981\n\u76f8\u53cd\uff0c\u8fd4\u56de ",(0,s.jsx)(e.code,{children:"x"})," \u7684 ",(0,s.jsx)(e.em,{children:"live"})," \u503c\uff08\u5373\uff0c\u5f53\n\u64cd\u4f5c\u5df2",(0,s.jsx)(e.em,{children:"\u6267\u884c"}),"\u3002\uff09\u3002\u4e3a\u6b64\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"ReturnRef()"})," \u6216 ",(0,s.jsx)(e.code,{children:"ReturnPointee()"}),"\n\u76ee\u7684\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u6a21\u62df\u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b\u662f\u5f15\u7528\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\n",(0,s.jsx)(e.code,{children:"ReturnRef(x)"}),"\uff0c\u5982\u524d\u9762\u7684\u83dc\u8c31\u6240\u793a\uff08\u201c\u4ece\u6a21\u62df\u8fd4\u56de\u5f15\u7528\n\u65b9\u6cd5\u201d\uff09\u3002\u4f46\u662f\uff0ckMock \u4e0d\u5141\u8bb8\u60a8\u5728\u6a21\u62df\u51fd\u6570\u4e2d\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"ReturnRef()"}),"\n\u5176\u8fd4\u56de\u7c7b\u578b\u4e0d\u662f\u5f15\u7528\uff0c\u56e0\u4e3a\u8fd9\u6837\u505a\u901a\u5e38\u8868\u660e\u7528\u6237\n\u9519\u8bef\u3002\u90a3\u4e48\uff0c\u4f60\u8be5\u600e\u4e48\u529e\uff1f"]}),"\n",(0,s.jsx)(e.p,{children:"\u5c3d\u7ba1\u60a8\u53ef\u80fd\u4f1a\u53d7\u5230\u8bf1\u60d1\uff0c\u4f46\u8bf7\u52ff\u4f7f\u7528\u201cstd::ref()\u201d\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using testing::Return;\n\nclass MockFoo : public Foo {\n public:\n  MOCK_METHOD(int, GetValue, (), (override));\n};\n...\n  int x = 0;\n  MockFoo foo;\n  EXPECT_CALL(foo, GetValue())\n      .WillRepeatedly(Return(std::ref(x)));  // Wrong!\n  x = 42;\n  EXPECT_EQ(42, foo.GetValue());\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e0d\u5e78\u7684\u662f\uff0c\u5b83\u5728\u8fd9\u91cc\u4e0d\u8d77\u4f5c\u7528\u3002\u4e0a\u9762\u7684\u4ee3\u7801\u5c06\u5931\u8d25\u5e76\u51fa\u73b0\u9519\u8bef\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-text",children:"Value of: foo.GetValue()\n  Actual: 0\nExpected: 42\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u539f\u56e0\u662f ",(0,s.jsx)(e.code,{children:"Return(*value*)"})," \u5c06 ",(0,s.jsx)(e.code,{children:"value"})," \u8f6c\u6362\u4e3a\u5b9e\u9645\u7684\u8fd4\u56de\u7c7b\u578b\n\u5f53\u52a8\u4f5c\u88ab",(0,s.jsx)(e.em,{children:"\u521b\u5efa"}),"\u65f6\uff0c\u800c\u4e0d\u662f\u5f53\u5b83\u88ab\u521b\u5efa\u65f6\uff0c\u6a21\u62df\u51fd\u6570\u7684\n",(0,s.jsx)(e.em,{children:"\u5df2\u6267\u884c"}),"\u3002 \uff08\u9009\u62e9\u6b64\u884c\u4e3a\u662f\u4e3a\u4e86\u5728\u201cvalue\u201d\u4e3a\n\u5f15\u7528\u4e00\u4e9b\u4e34\u65f6\u5bf9\u8c61\u7684\u4ee3\u7406\u5bf9\u8c61\u3002\uff09\u56e0\u6b64\uff0c\n\u5f53\u4ee5\u4e0b\u60c5\u51b5\u65f6\uff0c",(0,s.jsx)(e.code,{children:"std::ref(x)"})," \u4f1a\u8f6c\u6362\u4e3a ",(0,s.jsx)(e.code,{children:"int"})," \u503c\uff08\u800c\u4e0d\u662f ",(0,s.jsx)(e.code,{children:"const int&"}),"\uff09\n\u671f\u671b\u5df2\u8bbe\u5b9a\uff0c\u201cReturn(std::ref(x))\u201d\u5c06\u59cb\u7ec8\u8fd4\u56de 0\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"ReturnPointee(pointer)"}),"\u5c31\u662f\u4e13\u95e8\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u800c\u63d0\u4f9b\u7684\u3002\u5b83\n\u8fd4\u56de\u64cd\u4f5c\u6267\u884c\u65f6\u201cpointer\u201d\u6307\u5411\u7684\u503c\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using testing::ReturnPointee;\n...\n  int x = 0;\n  MockFoo foo;\n  EXPECT_CALL(foo, GetValue())\n      .WillRepeatedly(ReturnPointee(&x));  // Note the & here.\n  x = 42;\n  EXPECT_EQ(42, foo.GetValue());  // This will succeed now.\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u7ec4\u5408actions",children:"\u7ec4\u5408actions"}),"\n",(0,s.jsxs)(e.p,{children:["\u60f3\u8981\u5728\u8c03\u7528\u51fd\u6570\u65f6\u505a\u4e0d\u6b62\u4e00\u4ef6\u4e8b\u5417\uff1f\u6ca1\u5173\u7cfb\u3002 ",(0,s.jsx)(e.code,{children:"DoAll()"}),"\n\u5141\u8bb8\u60a8\u6bcf\u6b21\u6267\u884c\u4e00\u7cfb\u5217\u64cd\u4f5c\u3002\u4ec5\u8fd4\u56de\u503c\n\u5c06\u4f7f\u7528\u5e8f\u5217\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u64cd\u4f5c\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::DoAll;\n\nclass MockFoo : public Foo {\n public:\n  MOCK_METHOD(bool, Bar, (int n), (override));\n};\n...\n  EXPECT_CALL(foo, Bar(_))\n      .WillOnce(DoAll(action_1,\n                      action_2,\n                      ...\n                      action_n));\n"})}),"\n",(0,s.jsx)(e.h3,{id:"SaveArgVerify",children:"\u9a8c\u8bc1\u590d\u6742\u7684\u53c2\u6570"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u60a8\u60f3\u9a8c\u8bc1\u662f\u5426\u4f7f\u7528\u7279\u5b9a\u53c2\u6570\u8c03\u7528\u4e86\u65b9\u6cd5\uff0c\u4f46\n\u5339\u914d\u6807\u51c6\u5f88\u590d\u6742\uff0c\u5f88\u96be\u533a\u5206\n\u57fa\u6570\u5931\u8d25\uff08\u8c03\u7528\u65b9\u6cd5\u7684\u6b21\u6570\u9519\u8bef\uff09\u548c\u53c2\u6570\n\u5339\u914d\u5931\u8d25\u3002\u540c\u6837\uff0c\u5982\u679c\u60a8\u5339\u914d\u591a\u4e2a\u53c2\u6570\uff0c\u5219\u53ef\u80fd\u4e0d\u4f1a\n\u5f88\u5bb9\u6613\u533a\u5206\u54ea\u4e2a\u53c2\u6570\u672a\u80fd\u5339\u914d\u3002\u4f8b\u5982\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  // Not ideal: this could fail because of a problem with arg1 or arg2, or maybe\n  // just the method wasn't called.\n  EXPECT_CALL(foo, SendValues(_, ElementsAre(1, 4, 4, 7), EqualsProto( ... )));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u53ef\u4ee5\u4fdd\u5b58\u53c2\u6570\u5e76\u5355\u72ec\u6d4b\u8bd5\u5b83\u4eec\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  EXPECT_CALL(foo, SendValues)\n      .WillOnce(DoAll(SaveArg<1>(&actual_array), SaveArg<2>(&actual_proto)));\n  ... run the test\n  EXPECT_THAT(actual_array, ElementsAre(1, 4, 4, 7));\n  EXPECT_THAT(actual_proto, EqualsProto( ... ));\n"})}),"\n",(0,s.jsx)(e.h3,{id:"mocking-side-effects",children:"\u6a21\u62df\u526f\u4f5c\u7528"}),"\n",(0,s.jsxs)(e.p,{children:["\u6709\u65f6\uff0c\u65b9\u6cd5\u4e0d\u662f\u901a\u8fc7\u8fd4\u56de\u503c\u800c\u662f\u901a\u8fc7\u4fa7\u9762\u6765\u5c55\u793a\u5176\u6548\u679c\n\u5f71\u54cd\u3002\u4f8b\u5982\uff0c\u5b83\u53ef\u80fd\u4f1a\u66f4\u6539\u67d0\u4e9b\u5168\u5c40\u72b6\u6001\u6216\u4fee\u6539\u8f93\u51fa\n\u4e89\u8bba\u3002\u8981\u6a21\u62df\u526f\u4f5c\u7528\uff0c\u901a\u5e38\u60a8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9a\u4e49\u81ea\u5df1\u7684\u64cd\u4f5c\n\u5b9e\u73b0 ",(0,s.jsx)(e.code,{children:"::testing::ActionInterface"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u9700\u8981\u505a\u7684\u53ea\u662f\u66f4\u6539\u8f93\u51fa\u53c2\u6570\uff0c\u5219\u5185\u7f6e\n",(0,s.jsx)(e.code,{children:"SetArgPointee()"})," \u64cd\u4f5c\u5f88\u65b9\u4fbf\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::SetArgPointee;\n\nclass MockMutator : public Mutator {\n public:\n  MOCK_METHOD(void, Mutate, (bool mutate, int* value), (override));\n  ...\n}\n...\n  MockMutator mutator;\n  EXPECT_CALL(mutator, Mutate(true, _))\n      .WillOnce(SetArgPointee<1>(5));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u5f53\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"mutator.Mutate()"})," \u65f6\uff0c\u6211\u4eec\u4f1a\u5c06 5 \u5206\u914d\u7ed9\n",(0,s.jsx)(e.code,{children:"int"})," \u53d8\u91cf\u7531\u53c2\u6570 #1 \u6307\u5411\uff08\u4ece 0 \u5f00\u59cb\uff09\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"SetArgPointee()"})," \u65b9\u4fbf\u5730\u521b\u5efa\u60a8\u4f20\u9012\u7ed9\u7684\u503c\u7684\u5185\u90e8\u526f\u672c\n\u5b83\uff0c\u6d88\u9664\u4e86\u4fdd\u6301\u4ef7\u503c\u5728\u8303\u56f4\u5185\u5e76\u4fdd\u6301\u6d3b\u529b\u7684\u9700\u8981\u3002\u5176\u542b\u4e49\n\u7136\u800c\uff0c\u8be5\u503c\u5fc5\u987b\u5177\u6709\u590d\u5236\u6784\u9020\u51fd\u6570\u548c\u8d4b\u503c\u8fd0\u7b97\u7b26\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u6a21\u62df\u65b9\u6cd5\u4e5f\u9700\u8981\u8fd4\u56de\u4e00\u4e2a\u503c\uff0c\u60a8\u53ef\u4ee5\u94fe\u63a5\n",(0,s.jsx)(e.code,{children:"SetArgPointee()"})," \u548c ",(0,s.jsx)(e.code,{children:"Return()"})," \u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"DoAll()"}),"\uff0c\u8bb0\u5f97\u628a\n\u6700\u540e ",(0,s.jsx)(e.code,{children:"Return()"})," \u8bed\u53e5\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::DoAll;\nusing ::testing::Return;\nusing ::testing::SetArgPointee;\n\nclass MockMutator : public Mutator {\n public:\n  ...\n  MOCK_METHOD(bool, MutateInt, (int* value), (override));\n}\n...\n  MockMutator mutator;\n  EXPECT_CALL(mutator, MutateInt(_))\n      .WillOnce(DoAll(SetArgPointee<0>(5),\n                      Return(true)));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4f46\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u60a8\u4f7f\u7528",(0,s.jsx)(e.code,{children:"ReturnOKWith()"}),"\u65b9\u6cd5\uff0c\u5b83\u5c06\u8986\u76d6\n\u51fd\u6570\u7684\u54cd\u5e94\u53c2\u6570\u4e2d\u7531 ",(0,s.jsx)(e.code,{children:"SetArgPointee()"})," \u63d0\u4f9b\u7684\u503c\n\u79f0\u547c\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u8f93\u51fa\u53c2\u6570\u662f\u6570\u7ec4\uff0c\u8bf7\u4f7f\u7528",(0,s.jsx)(e.code,{children:"SetArrayArgument<N>(first, last)"}),"\n\u884c\u52a8\u4ee3\u66ff\u3002\u5b83\u5c06\u6e90\u8303\u56f4",(0,s.jsx)(e.code,{children:"[first,last)"}),"\u4e2d\u7684\u5143\u7d20\u590d\u5236\u5230\n\u7b2c N \u4e2a\uff08\u4ece 0 \u5f00\u59cb\uff09\u53c2\u6570\u6307\u5411\u7684\u6570\u7ec4\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::NotNull;\nusing ::testing::SetArrayArgument;\n\nclass MockArrayMutator : public ArrayMutator {\n public:\n  MOCK_METHOD(void, Mutate, (int* values, int num_values), (override));\n  ...\n}\n...\n  MockArrayMutator mutator;\n  int values[5] = {1, 2, 3, 4, 5};\n  EXPECT_CALL(mutator, Mutate(NotNull(), 5))\n      .WillOnce(SetArrayArgument<0>(values, values + 5));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u53c2\u6570\u662f\u8f93\u51fa\u8fed\u4ee3\u5668\u65f6\uff0c\u8fd9\u4e5f\u9002\u7528\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::_;\nusing ::testing::SetArrayArgument;\n\nclass MockRolodex : public Rolodex {\n public:\n  MOCK_METHOD(void, GetNames, (std::back_insert_iterator<vector<string>>),\n              (override));\n  ...\n}\n...\n  MockRolodex rolodex;\n  vector<string> names = {"George", "John", "Thomas"};\n  EXPECT_CALL(rolodex, GetNames(_))\n      .WillOnce(SetArrayArgument<0>(names.begin(), names.end()));\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u6839\u636e\u72b6\u6001\u66f4\u6539\u6a21\u62df\u5bf9\u8c61\u7684\u884c\u4e3a",children:"\u6839\u636e\u72b6\u6001\u66f4\u6539\u6a21\u62df\u5bf9\u8c61\u7684\u884c\u4e3a"}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u5e0c\u671b\u8c03\u7528\u6539\u53d8\u6a21\u62df\u5bf9\u8c61\u7684\u884c\u4e3a\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\n",(0,s.jsx)(e.code,{children:"::testing::InSequence"})," \u6307\u5b9a\u4e4b\u524d\u548c\u4e4b\u540e\u7684\u4e0d\u540c\u884c\u4e3a\n\u79f0\u547c\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::InSequence;\nusing ::testing::Return;\n\n...\n  {\n     InSequence seq;\n     EXPECT_CALL(my_mock, IsDirty())\n         .WillRepeatedly(Return(true));\n     EXPECT_CALL(my_mock, Flush());\n     EXPECT_CALL(my_mock, IsDirty())\n         .WillRepeatedly(Return(false));\n  }\n  my_mock.FlushIfDirty();\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u4f7f\u5f97",(0,s.jsx)(e.code,{children:"my_mock.IsDirty()"}),"\u5728\u8c03\u7528",(0,s.jsx)(e.code,{children:"my_mock.Flush()"}),"\u4e4b\u524d\u8fd4\u56de",(0,s.jsx)(e.code,{children:"true"}),"\n\u7136\u540e\u8fd4\u56de",(0,s.jsx)(e.code,{children:"false"}),"\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u884c\u4e3a\u53d8\u5316\u66f4\u590d\u6742\uff0c\u60a8\u53ef\u4ee5\u5c06\u6548\u679c\u5b58\u50a8\u5728\u53d8\u91cf\u4e2d\n\u5e76\u4f7f\u6a21\u62df\u65b9\u6cd5\u4ece\u8be5\u53d8\u91cf\u83b7\u53d6\u5176\u8fd4\u56de\u503c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::SaveArg;\nusing ::testing::Return;\n\nACTION_P(ReturnPointee, p) { return *p; }\n...\n  int previous_value = 0;\n  EXPECT_CALL(my_mock, GetPrevValue)\n      .WillRepeatedly(ReturnPointee(&previous_value));\n  EXPECT_CALL(my_mock, UpdateValue)\n      .WillRepeatedly(SaveArg<0>(&previous_value));\n  my_mock.DoSomethingToUpdateValue();\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u91cc ",(0,s.jsx)(e.code,{children:"my_mock.GetPrevValue()"})," \u5c06\u59cb\u7ec8\u8fd4\u56de\u6700\u540e\u4e00\u4e2a\u7684\u53c2\u6570\n",(0,s.jsx)(e.code,{children:"UpdateValue()"})," \u8c03\u7528\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"DefaultValue",children:"\u8bbe\u7f6e\u8fd4\u56de\u7c7b\u578b\u7684\u9ed8\u8ba4\u503c"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u6a21\u62df\u65b9\u6cd5\u7684\u8fd4\u56de\u7c7b\u578b\u662f\u5185\u7f6e\u7684 C++ \u7c7b\u578b\u6216\u6307\u9488\uff0c\u5219\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5b83\n\u8c03\u7528\u65f6\u5c06\u8fd4\u56de 0\u3002\u53e6\u5916\uff0c\u5728 C++ 11 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\uff0c\u6a21\u62df\u65b9\u6cd5\u7684\n\u8fd4\u56de\u7c7b\u578b\u5177\u6709\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u5c06\u8fd4\u56de\u9ed8\u8ba4\u6784\u9020\u7684\u503c\n\u9ed8\u8ba4\u3002\u5982\u679c\u6b64\u9ed8\u8ba4\u503c\u4e0d\u8d77\u4f5c\u7528\uff0c\u60a8\u53ea\u9700\u6307\u5b9a\u4e00\u4e2a\u64cd\u4f5c\n\u4e3a\u4f60\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u6709\u65f6\uff0c\u60a8\u53ef\u80fd\u60f3\u8981\u66f4\u6539\u6b64\u9ed8\u8ba4\u503c\uff0c\u6216\u8005\u60a8\u53ef\u80fd\u60f3\u8981\u6307\u5b9a\nkMock \u4e0d\u77e5\u9053\u7684\u7c7b\u578b\u7684\u9ed8\u8ba4\u503c\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\n",(0,s.jsx)(e.code,{children:"::testing::DefaultValue"})," \u7c7b\u6a21\u677f\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::DefaultValue;\n\nclass MockFoo : public Foo {\n public:\n  MOCK_METHOD(Bar, CalculateBar, (), (override));\n};\n\n\n...\n  Bar default_bar;\n  // Sets the default return value for type Bar.\n  DefaultValue<Bar>::Set(default_bar);\n\n  MockFoo foo;\n\n  // We don't need to specify an action here, as the default\n  // return value works for us.\n  EXPECT_CALL(foo, CalculateBar());\n\n  foo.CalculateBar();  // This should return default_bar.\n\n  // Unsets the default return value.\n  DefaultValue<Bar>::Clear();\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8bf7\u6ce8\u610f\uff0c\u66f4\u6539\u7c7b\u578b\u7684\u9ed8\u8ba4\u503c\u53ef\u80fd\u4f1a\u4f7f\u60a8\u7684\u6d4b\u8bd5\u53d8\u5f97\u56f0\u96be\n\u53bb\u7406\u89e3\u3002\u6211\u4eec\u5efa\u8bae\u60a8\u8c28\u614e\u4f7f\u7528\u6b64\u529f\u80fd\u3002\u4f8b\u5982\uff0c\n\u60a8\u53ef\u80fd\u9700\u8981\u786e\u4fdd\u201cSet()\u201d\u548c\u201cClear()\u201d\u8c03\u7528\u5c31\u5728\n\u4f7f\u7528\u60a8\u7684\u6a21\u62df\u7684\u4ee3\u7801\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u8bbe\u7f6e\u6a21\u62df\u65b9\u6cd5\u7684\u9ed8\u8ba4\u64cd\u4f5c",children:"\u8bbe\u7f6e\u6a21\u62df\u65b9\u6cd5\u7684\u9ed8\u8ba4\u64cd\u4f5c"}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u5df2\u7ecf\u4e86\u89e3\u4e86\u5982\u4f55\u66f4\u6539\u7ed9\u5b9a\u7c7b\u578b\u7684\u9ed8\u8ba4\u503c\u3002\u7136\u800c\uff0c\u8fd9\n\u5bf9\u4e8e\u60a8\u7684\u76ee\u7684\u6765\u8bf4\u53ef\u80fd\u592a\u7c97\u7cd9\uff1a\u4e5f\u8bb8\u60a8\u6709\u4e24\u4e2a\u6a21\u62df\u65b9\u6cd5\n\u76f8\u540c\u7684\u8fd4\u56de\u7c7b\u578b\uff0c\u5e76\u4e14\u60a8\u5e0c\u671b\u5b83\u4eec\u5177\u6709\u4e0d\u540c\u7684\u884c\u4e3a\u3002 ",(0,s.jsx)(e.code,{children:"ON_CALL()"}),"\n\u5b8f\u5141\u8bb8\u60a8\u5728\u65b9\u6cd5\u7ea7\u522b\u81ea\u5b9a\u4e49\u6a21\u62df\u7684\u884c\u4e3a\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::AnyNumber;\nusing ::testing::Gt;\nusing ::testing::Return;\n...\n  ON_CALL(foo, Sign(_))\n      .WillByDefault(Return(-1));\n  ON_CALL(foo, Sign(0))\n      .WillByDefault(Return(0));\n  ON_CALL(foo, Sign(Gt(0)))\n      .WillByDefault(Return(1));\n\n  EXPECT_CALL(foo, Sign(_))\n      .Times(AnyNumber());\n\n  foo.Sign(5);   // This should return 1.\n  foo.Sign(-9);  // This should return -1.\n  foo.Sign(0);   // This should return 0.\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u6b63\u5982\u60a8\u53ef\u80fd\u5df2\u7ecf\u731c\u5230\u7684\uff0c\u5f53\u6709\u591a\u4e2a\u201cON_CALL()\u201d\u8bed\u53e5\u65f6\uff0c\n\u987a\u5e8f\u4e2d\u8f83\u65b0\u7684\u4f18\u5148\u4e8e\u8f83\u65e7\u7684\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\n\u5c06\u4f7f\u7528\u4e0e\u51fd\u6570\u53c2\u6570\u5339\u914d\u7684",(0,s.jsx)(e.strong,{children:"\u6700\u540e\u4e00\u4e2a"}),"\u3002\u8fd9\u4e2a\u642d\u914d\norder \u5141\u8bb8\u60a8\u5728\u6a21\u62df\u5bf9\u8c61\u7684\u6784\u9020\u51fd\u6570\u4e2d\u8bbe\u7f6e\u5e38\u89c1\u884c\u4e3a\u6216\n\u6d4b\u8bd5\u88c5\u7f6e\u7684\u8bbe\u7f6e\u9636\u6bb5\uff0c\u5e76\u5728\u7a0d\u540e\u4e13\u95e8\u5316\u6a21\u62df\u7684\u884c\u4e3a\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c",(0,s.jsx)(e.code,{children:"ON_CALL"})," \u548c ",(0,s.jsx)(e.code,{children:"EXPECT_CALL"})," \u90fd\u6709\u76f8\u540c\u7684\u201c\u540e\u9762\u7684\u8bed\u53e5\n\u4f18\u5148\u201d\u89c4\u5219\uff0c\u4f46\u5b83\u4eec\u4e0d\u4ea4\u4e92\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c",(0,s.jsx)(e.code,{children:"EXPECT_CALL"})," \u6709\u5b83\u4eec\u7684\n\u81ea\u5df1\u7684\u4f18\u5148\u987a\u5e8f\u4e0e\u201cON_CALL\u201d\u4f18\u5148\u987a\u5e8f\u4e0d\u540c\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"FunctionsAsActions",children:"\u4f7f\u7528\u51fd\u6570/\u65b9\u6cd5/\u51fd\u5b50/Lambda \u4f5c\u4e3aactions"}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u5185\u7f6e\u64cd\u4f5c\u4e0d\u9002\u5408\u60a8\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u73b0\u6709\u7684\u53ef\u8c03\u7528\u64cd\u4f5c\n(function, ",(0,s.jsx)(e.code,{children:"std::function"}),", method, functor, lambda) \u4f5c\u4e3a\u4e00\u4e2a\u52a8\u4f5c\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_; using ::testing::Invoke;\n\nclass MockFoo : public Foo {\n public:\n  MOCK_METHOD(int, Sum, (int x, int y), (override));\n  MOCK_METHOD(bool, ComplexJob, (int x), (override));\n};\n\nint CalculateSum(int x, int y) { return x + y; }\nint Sum3(int x, int y, int z) { return x + y + z; }\n\nclass Helper {\n public:\n  bool ComplexJob(int x);\n};\n\n...\n  MockFoo foo;\n  Helper helper;\n  EXPECT_CALL(foo, Sum(_, _))\n      .WillOnce(&CalculateSum)\n      .WillRepeatedly(Invoke(NewPermanentCallback(Sum3, 1)));\n  EXPECT_CALL(foo, ComplexJob(_))\n      .WillOnce(Invoke(&helper, &Helper::ComplexJob))\n      .WillOnce([] { return true; })\n      .WillRepeatedly([](int x) { return x > 0; });\n\n  foo.Sum(5, 6);         // Invokes CalculateSum(5, 6).\n  foo.Sum(2, 3);         // Invokes Sum3(1, 2, 3).\n  foo.ComplexJob(10);    // Invokes helper.ComplexJob(10).\n  foo.ComplexJob(-1);    // Invokes the inline lambda.\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u552f\u4e00\u7684\u8981\u6c42\u662f\u51fd\u6570\u7684\u7c7b\u578b\u7b49\u5fc5\u987b",(0,s.jsx)(e.em,{children:"\u517c\u5bb9"}),"\n\u5e26\u6709\u6a21\u62df\u51fd\u6570\u7684\u7b7e\u540d\uff0c\u610f\u5473\u7740\u540e\u8005\u7684\u53c2\u6570\uff08\u5982\u679c\n\u5b83\u9700\u8981\u4efb\u4f55\uff09\u53ef\u4ee5\u9690\u5f0f\u8f6c\u6362\u4e3a\u76f8\u5e94\u7684\u53c2\u6570\n\u524d\u8005\u7684\u8fd4\u56de\u7c7b\u578b\u53ef\u4ee5\u9690\u5f0f\u8f6c\u6362\u4e3a\n\u540e\u8005\u3002\u56e0\u6b64\uff0c\u60a8\u53ef\u4ee5\u8c03\u7528\u4e0e\u7c7b\u578b",(0,s.jsx)(e.em,{children:"\u4e0d"}),"\u5b8c\u5168\u76f8\u540c\u7684\u4e1c\u897f\n\u6a21\u62df\u51fd\u6570\uff0c\u53ea\u8981\u8fd9\u6837\u505a\u662f\u5b89\u5168\u7684 - \u5f88\u597d\uff0c\u5bf9\u5427\uff1f"]}),"\n",(0,s.jsx)(e.p,{children:"\u6ce8\u610f\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u8be5\u64cd\u4f5c\u62e5\u6709\u56de\u8c03\u7684\u6240\u6709\u6743\uff0c\u5e76\u4e14\u5f53\n\u884c\u52a8\u672c\u8eab\u5c31\u88ab\u7834\u574f\u4e86\u3002"}),"\n",(0,s.jsxs)(e.li,{children:["\u5982\u679c\u56de\u8c03\u7684\u7c7b\u578b\u6d3e\u751f\u81ea\u57fa\u672c\u56de\u8c03\u7c7b\u578b\u201cC\u201d\uff0c\u5219\u9700\u8981\n\u5c06\u5176\u9690\u5f0f\u8f6c\u6362\u4e3a\u201cC\u201d\u4ee5\u89e3\u51b3\u91cd\u8f7d\u95ee\u9898\uff0c\u4f8b\u5982","\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::Invoke;\n...\n  ResultCallback<bool>* is_ok = ...;\n  ... Invoke(is_ok) ...;  // This works.\n\n  BlockingClosure* done = new BlockingClosure;\n  ... Invoke(implicit_cast<Closure*>(done)) ...;  // The cast is necessary.\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"###\u4f7f\u7528\u5e26\u6709\u989d\u5916\u4fe1\u606f\u7684\u51fd\u6570\u4f5c\u4e3aactions"}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528 Invoke() \u8c03\u7528\u7684\u51fd\u6570\u6216\u51fd\u5b50\u5fc5\u987b\u5177\u6709\u76f8\u540c\u6570\u91cf\u7684\n\u53c2\u6570\u4f5c\u4e3a\u60a8\u4f7f\u7528\u5b83\u7684\u6a21\u62df\u51fd\u6570\u3002\u6709\u65f6\u4f60\u53ef\u80fd\u6709\u4e00\u4e2a\u529f\u80fd\n\u8fd9\u9700\u8981\u66f4\u591a\u53c2\u6570\uff0c\u5e76\u4e14\u60a8\u613f\u610f\u4f20\u9012\u989d\u5916\u7684\u53c2\u6570\n\u81ea\u5df1\u6765\u586b\u8865\u8fd9\u4e2a\u7a7a\u767d\u3002\u60a8\u53ef\u4ee5\u5728 kMock \u4e2d\u4f7f\u7528\u56de\u8c03\u6765\u6267\u884c\u6b64\u64cd\u4f5c\n\u9884\u5148\u7ed1\u5b9a\u7684\u53c2\u6570\u3002\u8fd9\u662f\u4e00\u4e2a\u4f8b\u5b50\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::Invoke;\n\nclass MockFoo : public Foo {\n public:\n  MOCK_METHOD(char, DoThis, (int n), (override));\n};\n\nchar SignOfSum(int x, int y) {\n  const int sum = x + y;\n  return (sum > 0) ? '+' : (sum < 0) ? '-' : '0';\n}\n\nTEST_F(FooTest, Test) {\n  MockFoo foo;\n\n  EXPECT_CALL(foo, DoThis(2))\n      .WillOnce(Invoke(NewPermanentCallback(SignOfSum, 5)));\n  EXPECT_EQ('+', foo.DoThis(2));  // Invokes SignOfSum(5, 2).\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"invoking-a-functionmethodfunctorlambdacallback-without-arguments",children:"Invoking a Function/Method/Functor/Lambda/Callback Without Arguments"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"Invoke()"})," \u5c06\u6a21\u62df\u51fd\u6570\u7684\u53c2\u6570\u4f20\u9012\u7ed9\u51fd\u6570\uff0c\u7b49\u7b49\n\u8c03\u7528\uff0c\u4ee5\u4fbf\u88ab\u8c03\u7528\u8005\u5177\u6709\u8981\u4f7f\u7528\u7684\u8c03\u7528\u7684\u5b8c\u6574\u4e0a\u4e0b\u6587\u3002\u5982\u679c\n\u88ab\u8c03\u7528\u7684\u51fd\u6570\u5bf9\u90e8\u5206\u6216\u5168\u90e8\u53c2\u6570\u4e0d\u611f\u5174\u8da3\uff0c\u5b83\u53ef\u4ee5\n\u7b80\u5355\u5730\u5ffd\u7565\u5b83\u4eec\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u7136\u800c\uff0c\u4e00\u4e2a\u5e38\u89c1\u7684\u6a21\u5f0f\u662f\u6d4b\u8bd5\u4f5c\u8005\u60f3\u8981\u8c03\u7528\u4e00\u4e2a\u51fd\u6570\u800c\u4e0d\u9700\u8981\n\u6a21\u62df\u51fd\u6570\u7684\u53c2\u6570\u3002\u5979\u53ef\u4ee5\u4f7f\u7528\u5305\u88c5\u51fd\u6570\u6765\u505a\u5230\u8fd9\u4e00\u70b9\n\u5728\u8c03\u7528\u4e0b\u5212\u7ebf\u7a7a\u51fd\u6570\u4e4b\u524d\u4e22\u5f03\u53c2\u6570\u3002\n\u4e0d\u7528\u8bf4\uff0c\u8fd9\u53ef\u80fd\u5f88\u4e4f\u5473\u5e76\u4e14\u6a21\u7cca\u4e86\u6d4b\u8bd5\u7684\u610f\u56fe\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u4e2a\u95ee\u9898\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\u3002\u9996\u5148\uff0c\u60a8\u53ef\u4ee5\u4f20\u9012\u4efb\u4f55\u53ef\u8c03\u7528\u7684\n\u96f6\u53c2\u6570\u4f5c\u4e3a\u52a8\u4f5c\u3002\u6216\u8005\uff0c\u4f7f\u7528\u201cInvokeWithoutArgs()\u201d\uff0c\u5c31\u50cf\n",(0,s.jsx)(e.code,{children:"Invoke()"})," \u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u5b83\u4e0d\u4f1a\u5c06\u6a21\u62df\u51fd\u6570\u7684\u53c2\u6570\u4f20\u9012\u7ed9\n\u88ab\u8c03\u7528\u8005\u3002\u4e0b\u9762\u662f\u6bcf\u4e2a\u7684\u793a\u4f8b\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::InvokeWithoutArgs;\n\nclass MockFoo : public Foo {\n public:\n  MOCK_METHOD(bool, ComplexJob, (int n), (override));\n};\n\nbool Job1() { ... }\nbool Job2(int n, char c) { ... }\n\n...\n  MockFoo foo;\n  EXPECT_CALL(foo, ComplexJob(_))\n      .WillOnce([] { Job1(); });\n      .WillOnce(InvokeWithoutArgs(NewPermanentCallback(Job2, 5, 'a')));\n\n  foo.ComplexJob(10);  // Invokes Job1().\n  foo.ComplexJob(20);  // Invokes Job2(5, 'a').\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6ce8\u610f\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u8be5\u64cd\u4f5c\u62e5\u6709\u56de\u8c03\u7684\u6240\u6709\u6743\uff0c\u5e76\u4e14\u5f53\n\u884c\u52a8\u672c\u8eab\u5c31\u88ab\u7834\u574f\u4e86\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u56de\u8c03\u7684\u7c7b\u578b\u6d3e\u751f\u81ea\u57fa\u672c\u56de\u8c03\u7c7b\u578b\u201cC\u201d\uff0c\u5219\u9700\u8981\n\u5c06\u5176\u9690\u5f0f\u8f6c\u6362\u4e3a\u201cC\u201d\u4ee5\u89e3\u51b3\u91cd\u8f7d\u95ee\u9898\uff0c\u4f8b\u5982"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::InvokeWithoutArgs;\n...\n  ResultCallback<bool>* is_ok = ...;\n  ... InvokeWithoutArgs(is_ok) ...;  // This works.\n\n  BlockingClosure* done = ...;\n  ... InvokeWithoutArgs(implicit_cast<Closure*>(done)) ...;\n  // The cast is necessary.\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u8c03\u7528-mock-\u51fd\u6570\u7684\u53c2\u6570",children:"\u8c03\u7528 Mock \u51fd\u6570\u7684\u53c2\u6570"}),"\n",(0,s.jsx)(e.p,{children:"\u6709\u65f6\uff0c\u6a21\u62df\u51fd\u6570\u4f1a\u63a5\u6536\u4e00\u4e2a\u51fd\u6570\u6307\u9488\u3001\u4e00\u4e2a\u51fd\u5b50\uff08\u5728\u5176\u4ed6\u60c5\u51b5\u4e0b\uff09\n\u8bcd\uff0c\u201c\u53ef\u8c03\u7528\u201d\uff09\u4f5c\u4e3a\u53c2\u6570\uff0c\u4f8b\u5982"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MockFoo : public Foo {\n public:\n  MOCK_METHOD(bool, DoThis, (int n, (ResultCallback1<bool, int>* callback)),\n              (override));\n};\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4f60\u53ef\u80fd\u60f3\u8c03\u7528\u8fd9\u4e2a\u53ef\u8c03\u7528\u53c2\u6570\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\n...\n  MockFoo foo;\n  EXPECT_CALL(foo, DoThis(_, _))\n      .WillOnce(...);\n      // Will execute callback->Run(5), where callback is the\n      // second argument DoThis() receives.\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u5ffd\u7565\u64cd\u4f5c\u7684\u7ed3\u679c",children:"\u5ffd\u7565\u64cd\u4f5c\u7684\u7ed3\u679c"}),"\n",(0,s.jsxs)(e.p,{children:["\u6709\u65f6\u4f60\u6709\u4e00\u4e2a\u8fd4\u56de",(0,s.jsx)(e.em,{children:"\u67d0\u4e9b\u4e1c\u897f"}),"\u7684\u64cd\u4f5c\uff0c\u4f46\u4f60\u9700\u8981\u4e00\u4e2a\u64cd\u4f5c\n\u8fd4\u56de",(0,s.jsx)(e.code,{children:"void"}),"\uff08\u4e5f\u8bb8\u60a8\u60f3\u5728\u8fd4\u56de\u7684\u6a21\u62df\u51fd\u6570\u4e2d\u4f7f\u7528\u5b83\n",(0,s.jsx)(e.code,{children:"void"}),"\uff0c\u6216\u8005\u53ef\u80fd\u9700\u8981\u5728 ",(0,s.jsx)(e.code,{children:"DoAll()"})," \u4e2d\u4f7f\u7528\u5b83\uff0c\u5e76\u4e14\u5b83\u4e0d\u662f\u6700\u540e\u4e00\u4e2a\n\u5217\u8868\uff09\u3002 ",(0,s.jsx)(e.code,{children:"IgnoreResult()"})," \u53ef\u4ee5\u8ba9\u4f60\u505a\u5230\u8fd9\u4e00\u70b9\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::DoAll;\nusing ::testing::IgnoreResult;\nusing ::testing::Return;\n\nint Process(const MyData& data);\nstring DoSomething();\n\nclass MockFoo : public Foo {\n public:\n  MOCK_METHOD(void, Abc, (const MyData& data), (override));\n  MOCK_METHOD(bool, Xyz, (), (override));\n};\n\n  ...\n  MockFoo foo;\n  EXPECT_CALL(foo, Abc(_))\n      // .WillOnce(Invoke(Process));\n      // The above line won't compile as Process() returns int but Abc() needs\n      // to return void.\n      .WillOnce(IgnoreResult(Process));\n  EXPECT_CALL(foo, Xyz())\n      .WillOnce(DoAll(IgnoreResult(DoSomething),\n                      // Ignores the string DoSomething() returns.\n                      Return(true)));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u60a8",(0,s.jsx)(e.strong,{children:"\u4e0d\u80fd"}),"\u5bf9\u5df2\u8fd4\u56de\u7684\u64cd\u4f5c\u4f7f\u7528\u201cIgnoreResult()\u201d\n\u2018\u65e0\u6548\u2019\u3002\u8fd9\u6837\u505a\u4f1a\u5bfc\u81f4\u96be\u770b\u7684\u7f16\u8bd1\u5668\u9519\u8bef\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"SelectingArgs",children:"\u9009\u62e9\u64cd\u4f5c\u7684\u53c2\u6570"}),"\n",(0,s.jsx)(e.p,{children:"\u5047\u8bbe\u60a8\u6709\u4e00\u4e2a\u5e26\u6709\u4e03\u4e2a\u53c2\u6570\u7684\u6a21\u62df\u51fd\u6570\u201cFoo()\u201d\uff0c\u5e76\u4e14\u60a8\u6709\u4e00\u4e2a\n\u8c03\u7528\u201cFoo()\u201d\u65f6\u8981\u8c03\u7528\u7684\u81ea\u5b9a\u4e49\u64cd\u4f5c\u3002\u95ee\u9898\u662f\uff0c\n\u81ea\u5b9a\u4e49\u64cd\u4f5c\u53ea\u9700\u8981\u4e09\u4e2a\u53c2\u6570\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::Invoke;\n...\n  MOCK_METHOD(bool, Foo,\n              (bool visible, const string& name, int x, int y,\n               (const map<pair<int, int>>), double& weight, double min_weight,\n               double max_wight));\n...\nbool IsVisibleInQuadrant1(bool visible, int x, int y) {\n  return visible && x >= 0 && y >= 0;\n}\n...\n  EXPECT_CALL(mock, Foo)\n      .WillOnce(Invoke(IsVisibleInQuadrant1));  // Uh, won't compile. :-(\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4e3a\u4e86\u53d6\u60a6\u7f16\u8bd1\u5668\u4e0a\u5e1d\uff0c\u4f60\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u5177\u6709\u76f8\u540c\u529f\u80fd\u7684\u201c\u9002\u914d\u5668\u201d\n\u7b7e\u540d\u4e3a ",(0,s.jsx)(e.code,{children:"Foo()"})," \u5e76\u4f7f\u7528\u6b63\u786e\u7684\u53c2\u6570\u8c03\u7528\u81ea\u5b9a\u4e49\u64cd\u4f5c\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::Invoke;\n...\nbool MyIsVisibleInQuadrant1(bool visible, const string& name, int x, int y,\n                            const map<pair<int, int>, double>& weight,\n                            double min_weight, double max_wight) {\n  return IsVisibleInQuadrant1(visible, x, y);\n}\n...\n  EXPECT_CALL(mock, Foo)\n      .WillOnce(Invoke(MyIsVisibleInQuadrant1));  // Now it works.\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4f46\u8fd9\u4e0d\u662f\u5f88\u5c34\u5c2c\u5417\uff1f"}),"\n",(0,s.jsx)(e.p,{children:"kMock \u63d0\u4f9b\u4e86\u4e00\u4e2a\u901a\u7528\u7684\u201c\u52a8\u4f5c\u9002\u914d\u5668\u201d\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u82b1\u65f6\u95f4\u5173\u6ce8\n\u6bd4\u7f16\u5199\u81ea\u5df1\u7684\u9002\u914d\u5668\u66f4\u91cd\u8981\u7684\u4e8b\u60c5\u3002\u8bed\u6cd5\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"WithArgs<N1, N2, ..., Nk>(action)\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u521b\u5efa\u4e00\u4e2a\u52a8\u4f5c\uff0c\u5728\u7ed9\u5b9a\u7684\u4f4d\u7f6e\u4f20\u9012\u6a21\u62df\u51fd\u6570\u7684\u53c2\u6570\n\u5bf9\u5185\u90e8\u201caction\u201d\u8fdb\u884c\u7d22\u5f15\uff08\u4ece 0 \u5f00\u59cb\uff09\u5e76\u6267\u884c\u5b83\u3002\u4f7f\u7528\u201cWithArgs\u201d\uff0c\u6211\u4eec\u7684\n\u539f\u6765\u7684\u4f8b\u5b50\u53ef\u4ee5\u5199\u6210\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::Invoke;\nusing ::testing::WithArgs;\n...\n  EXPECT_CALL(mock, Foo)\n      .WillOnce(WithArgs<0, 2, 3>(Invoke(IsVisibleInQuadrant1)));  // No need to define your own adaptor.\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3a\u4e86\u66f4\u597d\u7684\u53ef\u8bfb\u6027\uff0ckMock \u8fd8\u4e3a\u60a8\u63d0\u4f9b\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"WithoutArgs(action)"})," \u5f53\u5185\u90e8 ",(0,s.jsx)(e.code,{children:"action"})," \u6ca1\u6709*\u53c2\u6570\u65f6\uff0c\u5e76\u4e14"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5f53\u5185\u90e8\u201caction\u201d\u6267\u884c\u65f6\uff0c",(0,s.jsx)(e.code,{children:"WithArg<N>(action)"}),"\uff08",(0,s.jsx)(e.code,{children:"Arg"}),"\u4e4b\u540e\u6ca1\u6709",(0,s.jsx)(e.code,{children:"s"}),"\uff09\n",(0,s.jsx)(e.em,{children:"\u4e00\u4e2a"}),"\u53c2\u6570\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u53ef\u80fd\u5df2\u7ecf\u610f\u8bc6\u5230\uff0c\u201cInvokeWithoutArgs(...)\u201d\u53ea\u662f\u8bed\u6cd5\u7cd6\n",(0,s.jsx)(e.code,{children:"WithoutArgs(Invoke(...))"}),"\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u4ee5\u4e0b\u662f\u66f4\u591a\u63d0\u793a\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"WithArgs"})," \u548c\u670b\u53cb\u4e2d\u4f7f\u7528\u7684\u5185\u90e8\u52a8\u4f5c\u4e0d\u5fc5\u662f\n",(0,s.jsx)(e.code,{children:"Invoke()"}),"\u2014\u2014\u5b83\u53ef\u4ee5\u662f\u4efb\u4f55\u4e1c\u897f\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5982\u679c\u9700\u8981\uff0c\u60a8\u53ef\u4ee5\u5728\u53c2\u6570\u5217\u8868\u4e2d\u91cd\u590d\u4e00\u4e2a\u53c2\u6570\uff0c\u4f8b\u5982\n",(0,s.jsx)(e.code,{children:"WithArgs<2, 3, 3, 5>(...)"}),"\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:["\u60a8\u53ef\u4ee5\u66f4\u6539\u53c2\u6570\u7684\u987a\u5e8f\uff0c\u4f8b\u5982",(0,s.jsx)(e.code,{children:"WithArgs<3, 2, 1>(...)"}),"\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:["\u6240\u9009\u53c2\u6570\u7684\u7c7b\u578b",(0,s.jsx)(e.em,{children:"\u4e0d\u5fc5"}),"\u5fc5\u987b\u4e0e\n\u5185\u5728\u7684\u52a8\u4f5c\u5b8c\u5168\u4e00\u6837\u3002\u53ea\u8981\u5b83\u4eec\u53ef\u4ee5\u9690\u5f0f\u5730\u5b58\u5728\uff0c\u5b83\u5c31\u6709\u6548\n\u8f6c\u6362\u4e3a\u5185\u90e8\u64cd\u4f5c\u7684\u76f8\u5e94\u53c2\u6570\u3002\u4f8b\u5982\uff0c\n\u5982\u679c\u6a21\u62df\u51fd\u6570\u7684\u7b2c\u56db\u4e2a\u53c2\u6570\u662f\u201cint\u201d\u5e76\u4e14\u201cmy_action\u201d\u91c7\u7528\n",(0,s.jsx)(e.code,{children:"double"}),"\u3001",(0,s.jsx)(e.code,{children:"WithArg<4>(my_action)"})," \u90fd\u53ef\u4ee5\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u5ffd\u7565\u64cd\u4f5c\u51fd\u6570\u4e2d\u7684\u53c2\u6570",children:"\u5ffd\u7565\u64cd\u4f5c\u51fd\u6570\u4e2d\u7684\u53c2\u6570"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:"#SelectingArgs",children:"\u9009\u62e9\u64cd\u4f5c\u7684\u53c2\u6570"})," \u914d\u65b9\u5411\u6211\u4eec\u5c55\u793a\u4e86\u4e00\u79cd\u65b9\u6cd5\n\u4f7f\u6a21\u62df\u51fd\u6570\u548c\u5177\u6709\u4e0d\u517c\u5bb9\u53c2\u6570\u5217\u8868\u7684\u64cd\u4f5c\u9002\u5408\n\u4e00\u8d77\u3002\u7f3a\u70b9\u662f\uff0c\u5c06\u64cd\u4f5c\u5305\u88c5\u5728 ",(0,s.jsx)(e.code,{children:"WithArgs<...>()"})," \u4e2d\u4f1a\u5f97\u5230\n\u5bf9\u4e8e\u7f16\u5199\u6d4b\u8bd5\u7684\u4eba\u6765\u8bf4\u5f88\u4e4f\u5473\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u6b63\u5728\u5b9a\u4e49\u8981\u4f7f\u7528\u7684\u51fd\u6570\uff08\u6216\u65b9\u6cd5\u3001\u51fd\u5b50\u3001lambda\u3001\u56de\u8c03\uff09\n\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"Invoke*()"}),"\uff0c\u5e76\u4e14\u60a8\u5bf9\u5176\u67d0\u4e9b\u53c2\u6570\u4e0d\u611f\u5174\u8da3\uff0c\n",(0,s.jsx)(e.code,{children:"WithArgs"})," \u7684\u66ff\u4ee3\u65b9\u6cd5\u662f\u5c06\u65e0\u7528\u7684\u53c2\u6570\u58f0\u660e\u4e3a ",(0,s.jsx)(e.code,{children:"Unused"}),"\u3002\n\u8fd9\u4f7f\u5f97\u5b9a\u4e49\u5728\u4ee5\u4e0b\u7c7b\u578b\u7684\u60c5\u51b5\u4e0b\u4e0d\u90a3\u4e48\u6df7\u4e71\u548c\u4e0d\u90a3\u4e48\u8106\u5f31\uff1a\n\u65e0\u8da3\u7684\u4e89\u8bba\u53d1\u751f\u4e86\u53d8\u5316\u3002\u5b83\u8fd8\u53ef\u4ee5\u589e\u52a0\u884c\u52a8\u7684\u673a\u4f1a\n\u529f\u80fd\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u3002\u4f8b\u5982\uff0c\u7ed9\u5b9a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:" public:\n  MOCK_METHOD(double, Foo, double(const string& label, double x, double y),\n              (override));\n  MOCK_METHOD(double, Bar, (int index, double x, double y), (override));\n"})}),"\n",(0,s.jsx)(e.p,{children:"instead of"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::_;\nusing ::testing::Invoke;\n\ndouble DistanceToOriginWithLabel(const string& label, double x, double y) {\n  return sqrt(x*x + y*y);\n}\ndouble DistanceToOriginWithIndex(int index, double x, double y) {\n  return sqrt(x*x + y*y);\n}\n...\n  EXPECT_CALL(mock, Foo("abc", _, _))\n      .WillOnce(Invoke(DistanceToOriginWithLabel));\n  EXPECT_CALL(mock, Bar(5, _, _))\n      .WillOnce(Invoke(DistanceToOriginWithIndex));\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u4f60\u53ef\u4ee5\u5199"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::_;\nusing ::testing::Invoke;\nusing ::testing::Unused;\n\ndouble DistanceToOrigin(Unused, double x, double y) {\n  return sqrt(x*x + y*y);\n}\n...\n  EXPECT_CALL(mock, Foo("abc", _, _))\n      .WillOnce(Invoke(DistanceToOrigin));\n  EXPECT_CALL(mock, Bar(5, _, _))\n      .WillOnce(Invoke(DistanceToOrigin));\n'})}),"\n",(0,s.jsx)(e.h3,{id:"sharing-actions",children:"Sharing Actions"}),"\n",(0,s.jsx)(e.p,{children:"\u5c31\u50cf\u5339\u914d\u5668\u4e00\u6837\uff0ckMock \u52a8\u4f5c\u5bf9\u8c61\u7531\u4e00\u4e2a\u6307\u5411\u5f15\u7528\u8ba1\u6570\u7684\u6307\u9488\u7ec4\u6210\n\u5b9e\u65bd\u5bf9\u8c61\u3002\u56e0\u6b64\u590d\u5236\u64cd\u4f5c\u4e5f\u662f\u5141\u8bb8\u7684\u5e76\u4e14\u975e\u5e38\n\u9ad8\u6548\u7684\u3002\u5f53\u5f15\u7528\u5b9e\u73b0\u5bf9\u8c61\u7684\u6700\u540e\u4e00\u4e2a\u64cd\u4f5c\u7ec8\u6b62\u65f6\uff0c\n\u5b9e\u73b0\u5bf9\u8c61\u5c06\u88ab\u5220\u9664\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u60a8\u6709\u4e00\u4e9b\u590d\u6742\u7684\u64cd\u4f5c\u60f3\u8981\u53cd\u590d\u4f7f\u7528\uff0c\u60a8\u53ef\u4ee5\n\u4e0d\u5fc5\u6bcf\u6b21\u90fd\u4ece\u5934\u5f00\u59cb\u6784\u5efa\u3002\u5982\u679c\u8be5\u64cd\u4f5c\u6ca1\u6709\n\u5185\u90e8\u72b6\u6001\uff08\u5373\uff0c\u65e0\u8bba\u591a\u5c11\u6b21\u5b83\u603b\u662f\u505a\u540c\u6837\u7684\u4e8b\u60c5\n\u5b83\u5df2\u88ab\u8c03\u7528\uff09\uff0c\u60a8\u53ef\u4ee5\u5c06\u5176\u5206\u914d\u7ed9\u64cd\u4f5c\u53d8\u91cf\u5e76\u4f7f\u7528\u5b83\n\u53cd\u590d\u53d8\u5316\u3002\u4f8b\u5982\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::Action;\nusing ::testing::DoAll;\nusing ::testing::Return;\nusing ::testing::SetArgPointee;\n...\n  Action<bool(int*)> set_flag = DoAll(SetArgPointee<0>(5),\n                                      Return(true));\n  ... use set_flag in .WillOnce() and .WillRepeatedly() ...\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4f46\u662f\uff0c\u5982\u679c\u8be5\u64cd\u4f5c\u6709\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u90a3\u4e48\u5982\u679c\u60a8\u5171\u4eab\u8be5\u64cd\u4f5c\uff0c\u60a8\u53ef\u80fd\u4f1a\u611f\u5230\u60ca\u8bb6\n\u52a8\u4f5c\u5bf9\u8c61\u3002\u5047\u8bbe\u60a8\u6709\u4e00\u4e2a\u64cd\u4f5c\u5de5\u5382\u201cIncrementCounter(init)\u201d\uff0c\u5176\u4e2d\n\u521b\u5efa\u4e00\u4e2a\u9012\u589e\u5e76\u8fd4\u56de\u4e00\u4e2a\u8ba1\u6570\u5668\u7684\u64cd\u4f5c\uff0c\u5176\u521d\u59cb\u503c\u4e3a\n",(0,s.jsx)(e.code,{children:"init"}),"\uff0c\u4f7f\u7528\u4ece\u540c\u4e00\u8868\u8fbe\u5f0f\u521b\u5efa\u7684\u4e24\u4e2a\u64cd\u4f5c\u5e76\u4f7f\u7528\u5171\u4eab\n\u52a8\u4f5c\u4f1a\u8868\u73b0\u51fa\u4e0d\u540c\u7684\u884c\u4e3a\u3002\u4f8b\u5b50\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  EXPECT_CALL(foo, DoThis())\n      .WillRepeatedly(IncrementCounter(0));\n  EXPECT_CALL(foo, DoThat())\n      .WillRepeatedly(IncrementCounter(0));\n  foo.DoThis();  // Returns 1.\n  foo.DoThis();  // Returns 2.\n  foo.DoThat();  // Returns 1 - Blah() uses a different\n                 // counter than Bar()'s.\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u76f8\u5bf9"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::Action;\n...\n  Action<int()> increment = IncrementCounter(0);\n  EXPECT_CALL(foo, DoThis())\n      .WillRepeatedly(increment);\n  EXPECT_CALL(foo, DoThat())\n      .WillRepeatedly(increment);\n  foo.DoThis();  // Returns 1.\n  foo.DoThis();  // Returns 2.\n  foo.DoThat();  // Returns 3 - the counter is shared.\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u6d4b\u8bd5\u5f02\u6b65\u884c\u4e3a",children:"\u6d4b\u8bd5\u5f02\u6b65\u884c\u4e3a"}),"\n",(0,s.jsxs)(e.p,{children:["kMock \u7ecf\u5e38\u9047\u5230\u7684\u95ee\u9898\u4e4b\u4e00\u662f\u5b83\u5f88\u96be\u6d4b\u8bd5\n\u5f02\u6b65\u884c\u4e3a\u3002\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u4f60\u60f3\u8981\u7684",(0,s.jsx)(e.code,{children:"EventQueue"}),"\u7c7b\n\u6d4b\u8bd5\uff0c\u5e76\u4e14\u60a8\u521b\u5efa\u4e86\u4e00\u4e2a\u5355\u72ec\u7684\u201cEventDispatcher\u201d\u63a5\u53e3\uff0c\u4ee5\u4fbf\u60a8\u53ef\u4ee5\n\u8f7b\u677e\u6a21\u62df\u5b83\u3002\u7136\u800c\uff0c\u8be5\u7c7b\u7684\u5b9e\u73b0\u6fc0\u53d1\u4e86\u6240\u6709\n\u540e\u53f0\u7ebf\u7a0b\u4e0a\u7684\u4e8b\u4ef6\uff0c\u8fd9\u4f7f\u5f97\u6d4b\u8bd5\u8ba1\u65f6\u53d8\u5f97\u56f0\u96be\u3002\u4f60\u53ef\u4ee5\u53ea\u662f\n\u63d2\u5165 ",(0,s.jsx)(e.code,{children:"sleep()"})," \u8bed\u53e5\u5e76\u5e0c\u671b\u5f97\u5230\u6700\u597d\u7684\u7ed3\u679c\uff0c\u4f46\u8fd9\u4f1a\u8ba9\u4f60\u7684\u6d4b\u8bd5\n\u884c\u4e3a\u4e0d\u786e\u5b9a\u3002\u66f4\u597d\u7684\u65b9\u6cd5\u662f\u4f7f\u7528 kMock \u64cd\u4f5c\u548c\n",(0,s.jsx)(e.code,{children:"Notification"})," \u5bf9\u8c61\u5f3a\u5236\u5f02\u6b65\u6d4b\u8bd5\u540c\u6b65\u8fd0\u884c\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MockEventDispatcher : public EventDispatcher {\n  MOCK_METHOD(bool, DispatchEvent, (int32), (override));\n};\n\nTEST(EventQueueTest, EnqueueEventTest) {\n  MockEventDispatcher mock_event_dispatcher;\n  EventQueue event_queue(&mock_event_dispatcher);\n\n  const int32 kEventId = 321;\n  absl::Notification done;\n  EXPECT_CALL(mock_event_dispatcher, DispatchEvent(kEventId))\n      .WillOnce([&done] { done.Notify(); });\n\n  event_queue.EnqueueEvent(kEventId);\n  done.WaitForNotification();\n}\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u8bbe\u7f6e\u4e86\u6b63\u5e38\u7684 kMock \u671f\u671b\uff0c\u4f46\u968f\u540e\u6dfb\u52a0\u4e86\u4e00\u4e2a\n\u901a\u77e5\u201cNotification\u201d\u5bf9\u8c61\u7684\u9644\u52a0\u64cd\u4f5c\u3002\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u8c03\u7528\n",(0,s.jsx)(e.code,{children:"Notification::WaitForNotification()"})," \u5728\u4e3b\u7ebf\u7a0b\u4e2d\u7b49\u5f85\n\u5f02\u6b65\u8c03\u7528\u5b8c\u6210\u3002\u4e4b\u540e\uff0c\u6211\u4eec\u7684\u6d4b\u8bd5\u5957\u4ef6\u5c31\u5b8c\u6210\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\n\u5b89\u5168\u9000\u51fa\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"{: .callout .note}"}),"\n\u6ce8\u610f\uff1a\u8fd9\u4e2a\u4f8b\u5b50\u6709\u4e00\u4e2a\u7f3a\u70b9\uff1a\u5373\uff0c\u5982\u679c\u671f\u671b\u6ca1\u6709\u5f97\u5230\u6ee1\u8db3\uff0c\n\u6211\u4eec\u7684\u6d4b\u8bd5\u5c06\u6c38\u8fdc\u8fd0\u884c\u3002\u5b83\u6700\u7ec8\u4f1a\u8d85\u65f6\u5e76\u5931\u8d25\uff0c\u4f46\u5b83\u4f1a\n\u9700\u8981\u66f4\u957f\u7684\u65f6\u95f4\u5e76\u4e14\u8c03\u8bd5\u8d77\u6765\u7a0d\u5fae\u56f0\u96be\u4e00\u4e9b\u3002\u4e3a\u4e86\u7f13\u89e3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f60\u53ef\u4ee5\n\u4f7f\u7528\u201cWaitForNotificationWithTimeout(ms)\u201d\u800c\u4e0d\u662f\u201cWaitForNotification()\u201d\u3002"]}),"\n",(0,s.jsx)(e.h2,{id:"misc-recipes-on-using-kmock",children:"\u6709\u5173\u4f7f\u7528 kMock \u7684\u6742\u9879"}),"\n",(0,s.jsx)(e.h3,{id:"\u4f7f\u7528\u4ec5\u79fb\u52a8\u7c7b\u578b\u7684\u6a21\u62df\u65b9\u6cd5",children:"\u4f7f\u7528\u4ec5\u79fb\u52a8\u7c7b\u578b\u7684\u6a21\u62df\u65b9\u6cd5"}),"\n",(0,s.jsxs)(e.p,{children:["C++11 \u5f15\u5165\u4e86",(0,s.jsx)(e.em,{children:"\u4ec5\u79fb\u52a8\u7c7b\u578b"}),"\u3002\u4ec5\u79fb\u52a8\u7c7b\u578b\u7684\u503c\u53ef\u4ee5\u4ece\n\u4e00\u4e2a\u5bf9\u8c61\u53ef\u4ee5\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4f46\u65e0\u6cd5\u590d\u5236\u3002 ",(0,s.jsx)(e.code,{children:"std::unique_ptr<T>"})," \u53ef\u80fd\u662f\n\u6700\u5e38\u7528\u7684\u4ec5\u79fb\u52a8\u7c7b\u578b\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u6a21\u62df\u91c7\u7528\u548c/\u6216\u8fd4\u56de\u4ec5\u79fb\u52a8\u7c7b\u578b\u7684\u65b9\u6cd5\u4f1a\u5e26\u6765\u4e00\u4e9b\u5f71\u54cd\n\u6311\u6218\uff0c\u4f46\u6ca1\u6709\u4ec0\u4e48\u662f\u4e0d\u53ef\u514b\u670d\u7684\u3002\u8fd9\u4e2a\u98df\u8c31\u5411\u60a8\u5c55\u793a\u4e86\u5982\u4f55\u505a\u5230\u8fd9\u4e00\u70b9\u3002\n\u8bf7\u6ce8\u610f\uff0c\u4ec5\u5f15\u5165\u5bf9\u4ec5\u79fb\u52a8\u65b9\u6cd5\u53c2\u6570\u7684\u652f\u6301\n2017 \u5e74 4 \u6708 kMock\uff1b\u5728\u8f83\u65e7\u7684\u4ee3\u7801\u4e2d\uff0c\u60a8\u53ef\u80fd\u4f1a\u53d1\u73b0\u66f4\u590d\u6742\n",(0,s.jsx)(e.a,{href:"#LegacyMoveOnly",children:"\u89e3\u51b3\u65b9\u6cd5"})," \u7f3a\u4e4f\u6b64\u529f\u80fd\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u5047\u8bbe\u6211\u4eec\u6b63\u5728\u5f00\u53d1\u4e00\u4e2a\u865a\u6784\u7684\u9879\u76ee\uff0c\u5141\u8bb8\u4e00\u4e2a\u4eba\u53d1\u5e16\u548c\u5206\u4eab\n\u79f0\u4e3a\u201c\u55e1\u55e1\u58f0\u201d\u7684\u7247\u6bb5\u3002\u60a8\u7684\u4ee3\u7801\u4f7f\u7528\u8fd9\u4e9b\u7c7b\u578b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"enum class AccessLevel { kInternal, kPublic };\n\nclass Buzz {\n public:\n  explicit Buzz(AccessLevel access) { ... }\n  ...\n};\n\nclass Buzzer {\n public:\n  virtual ~Buzzer() {}\n  virtual std::unique_ptr<Buzz> MakeBuzz(StringPiece text) = 0;\n  virtual bool ShareBuzz(std::unique_ptr<Buzz> buzz, int64_t timestamp) = 0;\n  ...\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u201cBuzz\u201d\u5bf9\u8c61\u8868\u793a\u6b63\u5728\u53d1\u5e03\u7684\u7247\u6bb5\u3002\u4e00\u4e2a\u7c7b\u5b9e\u73b0\u4e86\n\u201cBuzzer\u201d\u754c\u9762\u80fd\u591f\u521b\u5efa\u548c\u5171\u4eab\u201cBuzz\u201d\u3002\u4e2d\u7684\u65b9\u6cd5\n",(0,s.jsx)(e.code,{children:"Buzzer"})," \u53ef\u80fd\u4f1a\u8fd4\u56de\u4e00\u4e2a ",(0,s.jsx)(e.code,{children:"unique_ptr<Buzz>"})," \u6216\u63a5\u53d7\u4e00\u4e2a ",(0,s.jsx)(e.code,{children:"unique_ptr<Buzz>"}),"\u3002\u73b0\u5728\u6211\u4eec\n\u9700\u8981\u5728\u6211\u4eec\u7684\u6d4b\u8bd5\u4e2d\u6a21\u62df\u201cBuzzer\u201d\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8981\u6a21\u62df\u63a5\u53d7\u6216\u8fd4\u56de\u4ec5\u79fb\u52a8\u7c7b\u578b\u7684\u65b9\u6cd5\uff0c\u60a8\u53ea\u9700\u4f7f\u7528\n\u50cf\u5f80\u5e38\u4e00\u6837\u719f\u6089\u7684\u201cMOCK_METHOD\u201d\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MockBuzzer : public Buzzer {\n public:\n  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));\n  MOCK_METHOD(bool, ShareBuzz, (std::unique_ptr<Buzz> buzz, int64_t timestamp),\n              (override));\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u5b9a\u4e49\u4e86\u6a21\u62df\u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6d4b\u8bd5\u4e2d\u4f7f\u7528\u5b83\u3002\u5728\n\u4e0b\u9762\u7684\u4ee3\u7801\u793a\u4f8b\uff0c\u6211\u4eec\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u5b9a\u4e49\u4e86\u4e00\u4e2a ",(0,s.jsx)(e.code,{children:"MockBuzzer"})," \u5bf9\u8c61\n\u540d\u4e3a\u201cmock_buzzer_\u201d\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  MockBuzzer mock_buzzer_;\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u9996\u5148\u8ba9\u6211\u4eec\u770b\u770b\u5982\u4f55\u8bbe\u7f6e\u5bf9",(0,s.jsx)(e.code,{children:"MakeBuzz()"}),"\u65b9\u6cd5\u7684\u671f\u671b\uff0c\u8be5\u65b9\u6cd5\n\u8fd4\u56de\u4e00\u4e2a",(0,s.jsx)(e.code,{children:"unique_ptr<Buzz>"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u50cf\u5f80\u5e38\u4e00\u6837\uff0c\u5982\u679c\u60a8\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u671f\u671b\u4f46\u6ca1\u6709\u6267\u884c\u4efb\u4f55\u64cd\u4f5c\uff08\u5373\u201c.WillOnce()\u201d\u6216\n",(0,s.jsx)(e.code,{children:".WillRepeatedly()"})," \u5b50\u53e5\uff09\uff0c\u5f53\u8be5\u671f\u671b\u89e6\u53d1\u65f6\uff0c\u9ed8\u8ba4\u64cd\u4f5c\n\u5c06\u91c7\u7528\u8be5\u65b9\u6cd5\u3002\u7531\u4e8e ",(0,s.jsx)(e.code,{children:"unique_ptr<>"})," \u6709\u4e00\u4e2a\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\n\u8fd4\u56de\u4e00\u4e2a\u7a7a\u7684",(0,s.jsx)(e.code,{children:"unique_ptr"}),"\uff0c\u5982\u679c\u4f60\u4e0d\u6307\u5b9a\u4e00\u4e2a\uff0c\u4f60\u4f1a\u5f97\u5230\u8fd9\u4e2a\n\u884c\u52a8\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'  // Use the default action.\n  EXPECT_CALL(mock_buzzer_, MakeBuzz("hello"));\n\n  // Triggers the previous EXPECT_CALL.\n  EXPECT_EQ(nullptr, mock_buzzer_.MakeBuzz("hello"));\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u5bf9\u9ed8\u8ba4\u64cd\u4f5c\u4e0d\u6ee1\u610f\uff0c\u53ef\u4ee5\u7167\u5e38\u8fdb\u884c\u8c03\u6574\uff1b\u53c2\u8003\n",(0,s.jsx)(e.a,{href:"#UseOnCall",children:"\u8bbe\u7f6e\u9ed8\u8ba4\u64cd\u4f5c"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u53ea\u9700\u8981\u8fd4\u56de\u9884\u5b9a\u4e49\u7684\u4ec5\u79fb\u52a8\u503c\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\n",(0,s.jsx)(e.code,{children:"Return(ByMove(...))"})," \u64cd\u4f5c\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'  // When this fires, the unique_ptr<> specified by ByMove(...) will\n  // be returned.\n  EXPECT_CALL(mock_buzzer_, MakeBuzz("world"))\n      .WillOnce(Return(ByMove(MakeUnique<Buzz>(AccessLevel::kInternal))));\n\n  EXPECT_NE(nullptr, mock_buzzer_.MakeBuzz("world"));\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u8bf7\u6ce8\u610f\uff0c\u201cByMove()\u201d\u5728\u8fd9\u91cc\u81f3\u5173\u91cd\u8981 - \u5982\u679c\u5220\u9664\u5b83\uff0c\u4ee3\u7801\u5c06\u65e0\u6cd5\u7f16\u8bd1\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u6d4b\u9a8c\u65f6\u95f4\uff01\u5982\u679c\u6267\u884c\u201cReturn(ByMove(...))\u201d\u64cd\u4f5c\uff0c\u60a8\u8ba4\u4e3a\u4f1a\u53d1\u751f\u4ec0\u4e48\n\u6267\u884c\u591a\u6b21\uff08\u4f8b\u5982\uff0c\u60a8\u5199\u201c...\n.WillRepeatedly(Return(ByMove(...)));`)?\u60f3\u60f3\u5427\uff0c\u7b2c\u4e00\u6b21\u4e4b\u540e\n\u64cd\u4f5c\u8fd0\u884c\u65f6\uff0c\u6e90\u503c\u5c06\u88ab\u6d88\u8017\uff08\u56e0\u4e3a\u5b83\u662f\u4ec5\u79fb\u52a8\u7684\n\u503c\uff09\uff0c\u6240\u4ee5\u4e0b\u4e00\u6b21\uff0c\u6ca1\u6709\u4efb\u4f55\u53ef\u4ee5\u79fb\u52a8\u7684\u503c\u2014\u2014\u4f60\u4f1a\u5f97\u5230\u4e00\u4e2a\n\u8fd0\u884c\u65f6\u9519\u8bef\u201cReturn(ByMove(...))\u201d\u53ea\u80fd\u8fd0\u884c\u4e00\u6b21\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u60a8\u9700\u8981\u6a21\u62df\u65b9\u6cd5\u505a\u7684\u4e0d\u4ec5\u4ec5\u662f\u79fb\u52a8\u9884\u5b9a\u4e49\u503c\uff0c\n\u8bf7\u8bb0\u4f4f\uff0c\u60a8\u59cb\u7ec8\u53ef\u4ee5\u4f7f\u7528 lambda \u6216\u53ef\u8c03\u7528\u5bf9\u8c61\uff0c\u8fd9\u53ef\u4ee5\u505a\u5230\n\u51e0\u4e4e\u4efb\u4f55\u4f60\u60f3\u8981\u7684\u4e1c\u897f\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'  EXPECT_CALL(mock_buzzer_, MakeBuzz("x"))\n      .WillRepeatedly([](StringPiece text) {\n        return MakeUnique<Buzz>(AccessLevel::kInternal);\n      });\n\n  EXPECT_NE(nullptr, mock_buzzer_.MakeBuzz("x"));\n  EXPECT_NE(nullptr, mock_buzzer_.MakeBuzz("x"));\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u6bcf\u6b21\u201cEXPECT_CALL\u201d\u89e6\u53d1\u65f6\uff0c\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684",(0,s.jsx)(e.code,{children:"unique_ptr<Buzz>"}),"\n\u7136\u540e\u56de\u6765\u4e86\u3002\u60a8\u4e0d\u80fd\u4f7f\u7528\u201cReturn(ByMove(...))\u201d\u6765\u6267\u884c\u6b64\u64cd\u4f5c\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u5305\u62ec\u8fd4\u56de\u4ec5\u79fb\u52a8\u503c\uff1b\u4f46\u6211\u4eec\u5982\u4f55\u4f7f\u7528\u65b9\u6cd5\n\u63a5\u53d7\u4ec5\u79fb\u52a8\u53c2\u6570\uff1f\u7b54\u6848\u662f\u5b83\u4eec\u5de5\u4f5c\u6b63\u5e38\uff0c\u5c3d\u7ba1\n\u5f53\u4efb\u4f55\u65b9\u6cd5\u7684\u53c2\u6570\u662f\u4ec5\u79fb\u52a8\u65f6\uff0c\u67d0\u4e9b\u64cd\u4f5c\u5c06\u65e0\u6cd5\u7f16\u8bd1\u3002\u4f60\n\u59cb\u7ec8\u53ef\u4ee5\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"Return"})," \u6216 ",(0,s.jsx)(e.a,{href:"#FunctionsAsActions",children:"lambda \u6216\u51fd\u5b50"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  using ::testing::Unused;\n\n  EXPECT_CALL(mock_buzzer_, ShareBuzz(NotNull(), _)).WillOnce(Return(true));\n  EXPECT_TRUE(mock_buzzer_.ShareBuzz(MakeUnique<Buzz>(AccessLevel::kInternal)),\n              0);\n\n  EXPECT_CALL(mock_buzzer_, ShareBuzz(_, _)).WillOnce(\n      [](std::unique_ptr<Buzz> buzz, Unused) { return buzz != nullptr; });\n  EXPECT_FALSE(mock_buzzer_.ShareBuzz(nullptr, 0));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8bb8\u591a\u5185\u7f6e\u64cd\u4f5c\uff08",(0,s.jsx)(e.code,{children:"WithArgs"}),"\uff0c",(0,s.jsx)(e.code,{children:"WithoutArgs"}),"\uff0c",(0,s.jsx)(e.code,{children:"DeleteArg"}),"\uff0c",(0,s.jsx)(e.code,{children:"SaveArg"}),"\uff0c...\uff09\n\u539f\u5219\u4e0a\u53ef\u4ee5\u652f\u6301\u4ec5\u79fb\u52a8\u53c2\u6570\uff0c\u4f46\u5bf9\u6b64\u7684\u652f\u6301\u5e76\u4e0d\n\u5c1a\u672a\u5b9e\u65bd\u3002\u5982\u679c\u8fd9\u963b\u788d\u4e86\u60a8\uff0c\u8bf7\u63d0\u4ea4\u9519\u8bef\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4e00\u4e9b\u64cd\u4f5c\uff08\u4f8b\u5982",(0,s.jsx)(e.code,{children:"DoAll"}),"\uff09\u5728\u5185\u90e8\u590d\u5236\u5b83\u4eec\u7684\u53c2\u6570\uff0c\u6240\u4ee5\u5b83\u4eec\u6c38\u8fdc\u4e0d\u80fd\n\u4f7f\u7528\u4e0d\u53ef\u590d\u5236\u7684\u5bf9\u8c61\uff1b\u4f60\u5fc5\u987b\u4f7f\u7528\u51fd\u5b50\u6765\u4ee3\u66ff\u3002"]}),"\n",(0,s.jsx)(e.h4,{id:"LegacyMoveOnly",children:"\u4ec5\u79fb\u52a8\u7c7b\u578b\u7684\u65e7\u89e3\u51b3\u65b9\u6cd5"}),"\n",(0,s.jsx)(e.p,{children:"kMock \u4e8e 4 \u6708\u4efd\u624d\u5f15\u5165\u5bf9\u4ec5\u79fb\u52a8\u51fd\u6570\u53c2\u6570\u7684\u652f\u6301\n2017 \u5e74\u7684\u7248\u672c\u3002\u5728\u8f83\u65e7\u7684\u4ee3\u7801\u4e2d\uff0c\u60a8\u53ef\u80fd\u4f1a\u9047\u5230\u4ee5\u4e0b\u89e3\u51b3\u65b9\u6cd5\uff1a\n\u6b64\u529f\u80fd\uff08\u4e0d\u518d\u9700\u8981 - \u6211\u4eec\u5c06\u5176\u5305\u62ec\u5728\u5185\u53ea\u662f\u4e3a\u4e86\n\u53c2\u8003\uff09\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MockBuzzer : public Buzzer {\n public:\n  MOCK_METHOD(bool, DoShareBuzz, (Buzz* buzz, Time timestamp));\n  bool ShareBuzz(std::unique_ptr<Buzz> buzz, Time timestamp) override {\n    return DoShareBuzz(buzz.get(), timestamp);\n  }\n};\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8bc0\u7a8d\u662f\u5c06\u201cShareBuzz()\u201d\u65b9\u6cd5\u59d4\u6258\u7ed9\u6a21\u62df\u65b9\u6cd5\uff08\u8ba9\u6211\u4eec\u8c03\u7528\n\u5b83\u4e0d\u91c7\u7528\u4ec5\u79fb\u52a8\u53c2\u6570\u7684\u201cDoShareBuzz()\u201d)\u3002\u7136\u540e\uff0c\u4ee3\u66ff\n\u8bbe\u7f6e\u5bf9\u201cShareBuzz()\u201d\u7684\u671f\u671b\uff0c\u60a8\u53ef\u4ee5\u5728\u201cDoShareBuzz()\u201d\u6a21\u62df\u4e0a\u8bbe\u7f6e\u5b83\u4eec\n\u65b9\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  MockBuzzer mock_buzzer_;\n  EXPECT_CALL(mock_buzzer_, DoShareBuzz(NotNull(), _));\n\n  // When one calls ShareBuzz() on the MockBuzzer like this, the call is\n  // forwarded to DoShareBuzz(), which is mocked.  Therefore this statement\n  // will trigger the above EXPECT_CALL.\n  mock_buzzer_.ShareBuzz(MakeUnique<Buzz>(AccessLevel::kInternal), 0);\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u4f7f\u7f16\u8bd1\u66f4\u5feb",children:"\u4f7f\u7f16\u8bd1\u66f4\u5feb"}),"\n",(0,s.jsx)(e.p,{children:"\u4e0d\u7ba1\u4f60\u76f8\u4fe1\u4e0e\u5426\uff0c\u201c\u7edd\u5927\u591a\u6570\u201d\u65f6\u95f4\u90fd\u82b1\u5728\u7f16\u8bd1\u6a21\u62df\u4e0a\n\u7c7b\u6b63\u5728\u751f\u6210\u5176\u6784\u9020\u51fd\u6570\u548c\u6790\u6784\u51fd\u6570\uff0c\u56e0\u4e3a\u5b83\u4eec\u6267\u884c\n\u91cd\u8981\u7684\u4efb\u52a1\uff08\u4f8b\u5982\u9a8c\u8bc1\u671f\u671b\uff09\u3002\u66f4\u4f55\u51b5\u8fd8\u5632\u8bbd\n\u5177\u6709\u4e0d\u540c\u7b7e\u540d\u7684\u65b9\u6cd5\u5177\u6709\u4e0d\u540c\u7684\u7c7b\u578b\uff0c\u56e0\u6b64\u5b83\u4eec\u7684\n\u6784\u9020\u51fd\u6570/\u6790\u6784\u51fd\u6570\u9700\u8981\u7531\u7f16\u8bd1\u5668\u5355\u72ec\u751f\u6210\u3002\u4f5c\u4e3a\u4e00\u4e2a\n\u7ed3\u679c\uff0c\u5982\u679c\u60a8\u6a21\u62df\u8bb8\u591a\u4e0d\u540c\u7c7b\u578b\u7684\u65b9\u6cd5\uff0c\u8bf7\u7f16\u8bd1\u60a8\u7684\u6a21\u62df\u7c7b\n\u4f1a\u53d8\u5f97\u975e\u5e38\u6162\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u9047\u5230\u7f16\u8bd1\u7f13\u6162\u7684\u60c5\u51b5\uff0c\u60a8\u53ef\u4ee5\u79fb\u52a8\u60a8\u7684\u5b9a\u4e49\n\u6a21\u62df\u7c7b\u7684\u6784\u9020\u51fd\u6570\u548c\u6790\u6784\u51fd\u6570\u4ece\u7c7b\u4f53\u4e2d\u51fa\u6765\u5e76\u8fdb\u5165\u201c.cc\u201d\n\u6587\u4ef6\u3002\u8fd9\u6837\uff0c\u5373\u4f7f\u4f60\u5728 N \u4e2a\u6587\u4ef6\u4e2d ",(0,s.jsx)(e.code,{children:"#include"})," \u4f60\u7684\u6a21\u62df\u7c7b\uff0c\u7f16\u8bd1\u5668\u4e5f\u4f1a\n\u53ea\u9700\u8981\u751f\u6210\u5b83\u7684\u6784\u9020\u51fd\u6570\u548c\u6790\u6784\u51fd\u6570\u4e00\u6b21\uff0c\u4ece\u800c\u4ea7\u751f\u5f88\u591a\n\u66f4\u5feb\u7684\u7f16\u8bd1\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8ba9\u6211\u4eec\u7528\u4e00\u4e2a\u4f8b\u5b50\u6765\u8bf4\u660e\u8fd9\u4e2a\u60f3\u6cd5\u3002\u8fd9\u662f\u6a21\u62df\u7684\u5b9a\u4e49\n\u5e94\u7528\u6b64\u98df\u8c31\u4e4b\u524d\u7684\u8bfe\u7a0b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"// File mock_foo.h.\n...\nclass MockFoo : public Foo {\n public:\n  // Since we don't declare the constructor or the destructor,\n  // the compiler will generate them in every translation unit\n  // where this mock class is used.\n\n  MOCK_METHOD(int, DoThis, (), (override));\n  MOCK_METHOD(bool, DoThat, (const char* str), (override));\n  ... more mock methods ...\n};\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u66f4\u6539\u540e\uff0c\u5b83\u770b\u8d77\u6765\u50cf\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"// File mock_foo.h.\n...\nclass MockFoo : public Foo {\n public:\n  // The constructor and destructor are declared, but not defined, here.\n  MockFoo();\n  virtual ~MockFoo();\n\n  MOCK_METHOD(int, DoThis, (), (override));\n  MOCK_METHOD(bool, DoThat, (const char* str), (override));\n  ... more mock methods ...\n};\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u548c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'// File mock_foo.cc.\n#include "path/to/mock_foo.h"\n\n// The definitions may appear trivial, but the functions actually do a\n// lot of things through the constructors/destructors of the member\n// variables used to implement the mock methods.\nMockFoo::MockFoo() {}\nMockFoo::~MockFoo() {}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u5f3a\u5236\u9a8c\u8bc1",children:"\u5f3a\u5236\u9a8c\u8bc1"}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u5b83\u88ab\u9500\u6bc1\u65f6\uff0c\u60a8\u7684\u53cb\u597d\u6a21\u62df\u5bf9\u8c61\u5c06\u81ea\u52a8\u9a8c\u8bc1\n\u5bf9\u5b83\u7684\u6240\u6709\u671f\u671b\u90fd\u5df2\u5f97\u5230\u6ee1\u8db3\uff0c\u5e76\u5c06\u751f\u6210 googletest\n\u5982\u679c\u6ca1\u6709\u5219\u5931\u8d25\u3002\u8fd9\u5f88\u65b9\u4fbf\uff0c\u56e0\u4e3a\u5b83\u8ba9\u60a8\u5c11\u4e86\u4e00\u4ef6\u4e8b\u60c5\n\u62c5\u5fc3\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u9664\u975e\u60a8\u4e0d\u786e\u5b9a\u60a8\u7684\u6a21\u62df\u5bf9\u8c61\u662f\u5426\u4f1a\u662f\n\u88ab\u6bc1\u4e86\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u4f60\u7684\u6a21\u62df\u5bf9\u8c61\u600e\u4e48\u53ef\u80fd\u6700\u7ec8\u4e0d\u4f1a\u88ab\u9500\u6bc1\u5462\uff1f\u55ef\uff0c\u5b83\n\u53ef\u80fd\u5728\u5806\u4e0a\u521b\u5efa\u5e76\u7531\u60a8\u6b63\u5728\u6d4b\u8bd5\u7684\u4ee3\u7801\u62e5\u6709\u3002\u8ba4\u4e3a\n\u8be5\u4ee3\u7801\u4e2d\u6709\u4e00\u4e2a\u9519\u8bef\uff0c\u5b83\u6ca1\u6709\u6b63\u786e\u5220\u9664\u6a21\u62df\u5bf9\u8c61 - \u4f60\n\u5f53\u5b9e\u9645\u4e0a\u5b58\u5728\u9519\u8bef\u65f6\uff0c\u6700\u7ec8\u53ef\u80fd\u4f1a\u901a\u8fc7\u6d4b\u8bd5\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u4f7f\u7528\u5806\u68c0\u67e5\u5668\u662f\u4e00\u4e2a\u597d\u4e3b\u610f\uff0c\u53ef\u4ee5\u51cf\u8f7b\u8fd9\u79cd\u62c5\u5fe7\uff0c\u4f46\u5b83\n\u5b9e\u65bd\u5e76\u975e 100% \u53ef\u9760\u3002\u6240\u4ee5\uff0c\u6709\u65f6\u4f60\u786e\u5b9e\u60f3",(0,s.jsx)(e.em,{children:"\u5f3a\u5236"})," kMock\n\u5728\uff08\u5e0c\u671b\uff09\u9500\u6bc1\u6a21\u62df\u5bf9\u8c61\u4e4b\u524d\u5bf9\u5176\u8fdb\u884c\u9a8c\u8bc1\u3002\u4f60\u53ef\u4ee5\u8fd9\u6837\u505a\n\u4f7f\u7528\u201cMock::VerifyAndClearExpectations(&mock_object)\u201d\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"TEST(MyServerTest, ProcessesRequest) {\n  using ::testing::Mock;\n\n  MockFoo* const foo = new MockFoo;\n  EXPECT_CALL(*foo, ...)...;\n  // ... other expectations ...\n\n  // server now owns foo.\n  MyServer server(foo);\n  server.ProcessRequest(...);\n\n  // In case that server's destructor will forget to delete foo,\n  // this will verify the expectations anyway.\n  Mock::VerifyAndClearExpectations(foo);\n}  // server is destroyed when it goes out of scope here.\n"})}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u63d0\u793a\uff1a"})," ",(0,s.jsx)(e.code,{children:"Mock::VerifyAndClearExpectations()"})," \u51fd\u6570\u8fd4\u56de\u4e00\u4e2a ",(0,s.jsx)(e.code,{children:"bool"}),"\n\u6307\u793a\u9a8c\u8bc1\u662f\u5426\u6210\u529f\uff08\u201ctrue\u201d\u8868\u793a\u662f\uff09\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\n\u5982\u679c\u6ca1\u6709\u610f\u4e49\uff0c\u5219\u5c06\u8be5\u51fd\u6570\u8c03\u7528\u5305\u88c5\u5728\u201cASSERT_TRUE()\u201d\u5185\n\u5f53\u9a8c\u8bc1\u5931\u8d25\u65f6\u8fdb\u4e00\u6b65\u3002"]})}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u4f7f\u7528\u540e\u9a8c\u8bc1\u5e76\u6e05\u9664\u6a21\u62df\u540e\uff0c\u4e0d\u8981\u8bbe\u5b9a\u65b0\u7684\u671f\u671b\u3002\n\u5728\u6267\u884c\u6a21\u62df\u7684\u4ee3\u7801\u4e4b\u540e\u8bbe\u7f6e\u671f\u671b\u5177\u6709\u672a\u5b9a\u4e49\u7684\u884c\u4e3a\u3002\n\u6709\u5173\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605",(0,s.jsx)(e.a,{href:"/docs/next/cpp/base/testing/kt/kmock_for_dummies#using-mocks-in-tests",children:"\u5728\u6d4b\u8bd5\u4e2d\u4f7f\u7528 Mock"}),"\n\u4fe1\u606f\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"UsingCheckPoints",children:"Using Checkpoints"}),"\n",(0,s.jsx)(e.p,{children:"\u6709\u65f6\u60a8\u53ef\u80fd\u60f3\u5206\u9636\u6bb5\u6d4b\u8bd5\u6a21\u62df\u5bf9\u8c61\u7684\u884c\u4e3a\uff0c\u5176\u5927\u5c0f\n\u90fd\u662f\u53ef\u4ee5\u7ba1\u7406\u7684\uff0c\u6216\u8005\u60a8\u53ef\u80fd\u60f3\u8981\u8bbe\u5b9a\u66f4\u8be6\u7ec6\u7684\u671f\u671b\n\u54ea\u4e9b API \u8c03\u7528\u4f1a\u8c03\u7528\u54ea\u4e9b\u6a21\u62df\u51fd\u6570\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u53ef\u4ee5\u4f7f\u7528\u7684\u4e00\u79cd\u6280\u672f\u662f\u5c06\u671f\u671b\u653e\u5165\u5e8f\u5217\u4e2d\u5e76\u63d2\u5165\n\u5728\u7279\u5b9a\u4f4d\u7f6e\u8c03\u7528\u865a\u62df\u201c\u68c0\u67e5\u70b9\u201d\u51fd\u6570\u3002\u7136\u540e\u4f60\u53ef\u4ee5\u9a8c\u8bc1\n\u6a21\u62df\u51fd\u6570\u8c03\u7528\u786e\u5b9e\u5728\u6b63\u786e\u7684\u65f6\u95f4\u53d1\u751f\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\n\u6b63\u5728\u6267\u884c\u4ee3\u7801\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  Foo(1);\n  Foo(2);\n  Foo(3);\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5e76\u60f3\u8981\u9a8c\u8bc1 ",(0,s.jsx)(e.code,{children:"Foo(1)"})," \u548c ",(0,s.jsx)(e.code,{children:"Foo(3)"})," \u90fd\u8c03\u7528 ",(0,s.jsx)(e.code,{children:'mock.Bar("a")'}),"\uff0c\u4f46\u662f\n",(0,s.jsx)(e.code,{children:"Foo(2)"})," \u4e0d\u4f1a\u8c03\u7528\u4efb\u4f55\u4e1c\u897f\uff0c\u4f60\u53ef\u4ee5\u5199\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::MockFunction;\n\nTEST(FooTest, InvokesBarCorrectly) {\n  MyMock mock;\n  // Class MockFunction<F> has exactly one mock method.  It is named\n  // Call() and has type F.\n  MockFunction<void(string check_point_name)> check;\n  {\n    InSequence s;\n\n    EXPECT_CALL(mock, Bar("a"));\n    EXPECT_CALL(check, Call("1"));\n    EXPECT_CALL(check, Call("2"));\n    EXPECT_CALL(mock, Bar("a"));\n  }\n  Foo(1);\n  check.Call("1");\n  Foo(2);\n  check.Call("2");\n  Foo(3);\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u671f\u671b\u89c4\u8303\u89c4\u5b9a\u7b2c\u4e00\u4e2a ",(0,s.jsx)(e.code,{children:'Bar("a")'})," \u8c03\u7528\u5fc5\u987b\u53d1\u751f\u5728\n\u68c0\u67e5\u70b9\u201c1\u201d\uff0c\u7b2c\u4e8c\u4e2a ",(0,s.jsx)(e.code,{children:'Bar("a")'})," \u8c03\u7528\u5fc5\u987b\u5728\u68c0\u67e5\u70b9\u201c2\u201d\u4e4b\u540e\u53d1\u751f\uff0c\u5e76\u4e14\n\u4e24\u4e2a\u68c0\u67e5\u70b9\u4e4b\u95f4\u4e0d\u5e94\u53d1\u751f\u4efb\u4f55\u4e8b\u60c5\u3002\u663e\u5f0f\u68c0\u67e5\u70b9\u4f7f\n\u6e05\u695a\u54ea\u4e2a ",(0,s.jsx)(e.code,{children:"Foo()"})," \u8c03\u7528\u4e86\u54ea\u4e2a ",(0,s.jsx)(e.code,{children:'Bar("a")'}),"\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u6a21\u62df\u6790\u6784\u51fd\u6570",children:"\u6a21\u62df\u6790\u6784\u51fd\u6570"}),"\n",(0,s.jsxs)(e.p,{children:["\u6709\u65f6\u4f60\u60f3\u786e\u4fdd\u6a21\u62df\u5bf9\u8c61\u5728\u6b63\u786e\u7684\u65f6\u95f4\u88ab\u7834\u574f\uff0c\n\u4f8b\u5982\u5728\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"bar->A()"})," \u4e4b\u540e\u4f46\u5728\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"bar->B()"})," \u4e4b\u524d\u3002\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\n\u60a8\u53ef\u4ee5\u6307\u5b9a\u6a21\u62df\u51fd\u6570\u7684 ",(0,s.jsx)(e.a,{href:"#OrderedCalls",children:"order"})," \u7ea6\u675f\n\u8c03\u7528\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u505a\u7684\u5c31\u662f\u6a21\u62dfmock\u51fd\u6570\u7684\u6790\u6784\u51fd\u6570\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u542c\u8d77\u6765\u5f88\u7b80\u5355\uff0c\u9664\u4e86\u4e00\u4e2a\u95ee\u9898\uff1a\u6790\u6784\u51fd\u6570\u662f\u4e00\u79cd\u7279\u6b8a\u51fd\u6570\n\u5177\u6709\u7279\u6b8a\u7684\u8bed\u6cd5\u548c\u7279\u6b8a\u7684\u8bed\u4e49\uff0c\u800c\u201cMOCK_METHOD\u201d\u5b8f\u5219\u6ca1\u6709\n\u4e3a\u4e4b\u5de5\u4f5c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"MOCK_METHOD(void, ~MockFoo, ());  // Won't compile!\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u597d\u6d88\u606f\u662f\u60a8\u53ef\u4ee5\u4f7f\u7528\u7b80\u5355\u7684\u6a21\u5f0f\u6765\u8fbe\u5230\u76f8\u540c\u7684\u6548\u679c\u3002\n\u9996\u5148\uff0c\u5c06\u6a21\u62df\u51fd\u6570 ",(0,s.jsx)(e.code,{children:"Die()"})," \u6dfb\u52a0\u5230\u60a8\u7684\u6a21\u62df\u7c7b\u4e2d\u5e76\u5728\n\u6790\u6784\u51fd\u6570\uff0c\u50cf\u8fd9\u6837\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MockFoo : public Foo {\n  ...\n  // Add the following two lines to the mock class.\n  MOCK_METHOD(void, Die, ());\n  ~MockFoo() override { Die(); }\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\uff08\u5982\u679c\u540d\u79f0\u201cDie()\u201d\u4e0e\u73b0\u6709\u7b26\u53f7\u51b2\u7a81\uff0c\u8bf7\u9009\u62e9\u53e6\u4e00\u4e2a\u540d\u79f0\u3002\uff09\u73b0\u5728\uff0c\n\u6211\u4eec\u5df2\u7ecf\u5c06\u201cMockFoo\u201d\u5bf9\u8c61\u6b7b\u4ea1\u65f6\u7684\u6d4b\u8bd5\u95ee\u9898\u7ffb\u8bd1\u4e3a\n\u6d4b\u8bd5\u4f55\u65f6\u8c03\u7528\u5176 ",(0,s.jsx)(e.code,{children:"Die()"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  MockFoo* foo = new MockFoo;\n  MockBar* bar = new MockBar;\n  ...\n  {\n    InSequence s;\n\n    // Expects *foo to die after bar->A() and before bar->B().\n    EXPECT_CALL(*bar, A());\n    EXPECT_CALL(*foo, Die());\n    EXPECT_CALL(*bar, B());\n  }\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5c31\u662f\u8fd9\u6837\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"UsingThreads",children:"\u4f7f\u7528 kMock \u548c\u7ebf\u7a0b"}),"\n",(0,s.jsxs)(e.p,{children:["\u5728",(0,s.jsx)(e.strong,{children:"\u5355\u5143"}),"\u6d4b\u8bd5\u4e2d\uff0c\u6700\u597d\u80fd\u591f\u5728\u4e00\u4e2a\u5355\u5143\u4e2d\u9694\u79bb\u5e76\u6d4b\u8bd5\u4e00\u6bb5\u4ee3\u7801\u3002\n\u5355\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u3002\u8fd9\u907f\u514d\u4e86\u7ade\u4e89\u6761\u4ef6\u548c\u6b7b\u9501\uff0c\u5e76\u4e14\u4f7f\u5f97\n\u8c03\u8bd5\u60a8\u7684\u6d4b\u8bd5\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u7136\u800c\u5927\u591a\u6570\u7a0b\u5e8f\u90fd\u662f\u591a\u7ebf\u7a0b\u7684\uff0c\u6709\u65f6\u4e3a\u4e86\u6d4b\u8bd5\u6211\u4eec\u9700\u8981\u7684\u4e1c\u897f\n\u4ece\u591a\u4e2a\u7ebf\u7a0b\u4e0a\u6572\u51fb\u5b83\u3002 kMock \u4e5f\u9002\u7528\u4e8e\u6b64\u76ee\u7684\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u8bb0\u4f4f\u4f7f\u7528\u6a21\u62df\u7684\u6b65\u9aa4\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\u521b\u5efa\u4e00\u4e2a\u6a21\u62df\u5bf9\u8c61 ",(0,s.jsx)(e.code,{children:"foo"}),"\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:["\u4f7f\u7528",(0,s.jsx)(e.code,{children:"ON_CALL()"}),"\u8bbe\u7f6e\u5176\u9ed8\u8ba4\u64cd\u4f5c\u548c\u671f\u671b\n",(0,s.jsx)(e.code,{children:"EXPECT_CALL()"}),"\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:["\u88ab\u6d4b\u4ee3\u7801\u8c03\u7528",(0,s.jsx)(e.code,{children:"foo"}),"\u7684\u65b9\u6cd5\u3002"]}),"\n",(0,s.jsx)(e.li,{children:"\uff08\u53ef\u9009\uff09\u9a8c\u8bc1\u5e76\u91cd\u7f6e\u6a21\u62df\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u81ea\u5df1\u9500\u6bc1\u6a21\u62df\uff0c\u6216\u8005\u8ba9\u88ab\u6d4b\u8bd5\u7684\u4ee3\u7801\u9500\u6bc1\u5b83\u3002\u8fd9\n\u6790\u6784\u51fd\u6570\u4f1a\u81ea\u52a8\u9a8c\u8bc1\u5b83\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u60a8\u9075\u5faa\u4ee5\u4e0b\u7b80\u5355\u89c4\u5219\uff0c\u60a8\u7684\u6a21\u62df\u548c\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u751f\u5b58\n\u5e78\u798f\u5730\u5728\u4e00\u8d77\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u5728",(0,s.jsx)(e.em,{children:"one"}),"\u4e2d\u6267\u884c\u60a8\u7684",(0,s.jsx)(e.em,{children:"\u6d4b\u8bd5\u4ee3\u7801"}),"\uff08\u800c\u4e0d\u662f\u6b63\u5728\u6d4b\u8bd5\u7684\u4ee3\u7801\uff09\n\u7ebf\u3002\u8fd9\u4f7f\u60a8\u7684\u6d4b\u8bd5\u6613\u4e8e\u9075\u5faa\u3002"]}),"\n",(0,s.jsx)(e.li,{children:"\u663e\u7136\uff0c\u60a8\u53ef\u4ee5\u5728\u4e0d\u9501\u5b9a\u7684\u60c5\u51b5\u4e0b\u6267\u884c\u6b65\u9aa4 #1\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u6267\u884c\u6b65\u9aa4#2 \u548c#5 \u65f6\uff0c\u786e\u4fdd\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u6b63\u5728\u8bbf\u95ee\u201cfoo\u201d\u3002\n\u4e5f\u5f88\u660e\u663e\u5427\uff1f"}),"\n",(0,s.jsx)(e.li,{children:"#3 \u548c #4 \u53ef\u4ee5\u5728\u4e00\u4e2a\u7ebf\u7a0b\u6216\u591a\u7ebf\u7a0b\u4e2d\u5b8c\u6210 - \u65e0\u8bba\u5982\u4f55\n\u4f60\u60f3\u8981\u7684\u3002 kMock \u8d1f\u8d23\u9501\u5b9a\uff0c\u56e0\u6b64\u60a8\u65e0\u9700\u6267\u884c\u4efb\u4f55\u64cd\u4f5c -\n\u9664\u975e\u60a8\u7684\u6d4b\u8bd5\u903b\u8f91\u9700\u8981\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u60a8\u8fdd\u53cd\u4e86\u89c4\u5219\uff08\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u5bf9\u6a21\u62df\u8bbe\u5b9a\u4e86\u671f\u671b\uff0c\u800c\n\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u6b63\u5728\u8c03\u7528\u5b83\u7684\u65b9\u6cd5\uff09\uff0c\u4f60\u4f1a\u5f97\u5230\u672a\u5b9a\u4e49\u7684\u884c\u4e3a\u3002\u90a3\u4e0d\u662f\n\u6709\u8da3\uff0c\u6240\u4ee5\u4e0d\u8981\u8fd9\u6837\u505a\u3002"}),"\n",(0,s.jsx)(e.p,{children:"kMock \u4fdd\u8bc1\u6a21\u62df\u51fd\u6570\u7684\u64cd\u4f5c\u5728\u540c\u4e00\u7ebf\u7a0b\u4e2d\u5b8c\u6210\n\u8c03\u7528\u4e86\u6a21\u62df\u51fd\u6570\u3002\u4f8b\u5982\uff0c\u5728"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  EXPECT_CALL(mock, Foo(1))\n      .WillOnce(action1);\n  EXPECT_CALL(mock, Foo(2))\n      .WillOnce(action2);\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u5728\u7ebf\u7a0b 1 \u4e2d\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"Foo(1)"})," \u5e76\u4e14\u5728\u7ebf\u7a0b 2 \u4e2d\u8c03\u7528 ",(0,s.jsx)(e.code,{children:"Foo(2)"}),"\uff0ckMock \u5c06\n\u5728\u7ebf\u7a0b 1 \u4e2d\u6267\u884c\u201caction1\u201d\uff0c\u5728\u7ebf\u7a0b 2 \u4e2d\u6267\u884c\u201caction2\u201d\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["kMock ",(0,s.jsx)(e.em,{children:"\u4e0d"}),"\u5bf9\u4e0d\u540c\u7ebf\u7a0b\u4e2d\u6267\u884c\u7684\u64cd\u4f5c\u5f3a\u52a0\u987a\u5e8f\n\uff08\u8fd9\u6837\u505a\u53ef\u80fd\u4f1a\u9020\u6210\u50f5\u5c40\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u64cd\u4f5c\u53ef\u80fd\u9700\u8981\u5408\u4f5c\uff09\u3002\u8fd9\u610f\u5473\u7740\n\u4e0a\u4f8b\u4e2d\u201caction1\u201d\u548c\u201caction2\u201d\u7684\u6267\u884c",(0,s.jsx)(e.em,{children:"\u53ef\u80fd"}),"\n\u4ea4\u9519\u3002\u5982\u679c\u8fd9\u662f\u4e00\u4e2a\u95ee\u9898\uff0c\u60a8\u5e94\u8be5\u6dfb\u52a0\u9002\u5f53\u7684\u540c\u6b65\u903b\u8f91\n",(0,s.jsx)(e.code,{children:"action1"})," \u548c ",(0,s.jsx)(e.code,{children:"action2"})," \u4f7f\u6d4b\u8bd5\u7ebf\u7a0b\u5b89\u5168\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u53e6\u5916\uff0c\u8bf7\u8bb0\u4f4f",(0,s.jsx)(e.code,{children:"DefaultValue<T>"}),"\u662f\u4e00\u4e2a\u5168\u5c40\u8d44\u6e90\uff0c\u53ef\u80fd\u4f1a\n\u5f71\u54cd\u7a0b\u5e8f\u4e2d\u7684\u201c\u6240\u6709\u201d\u6d3b\u52a8\u6a21\u62df\u5bf9\u8c61\u3002\u81ea\u7136\uff0c\u4f60\u4e0d\u4f1a\u613f\u610f\n\u4ece\u591a\u4e2a\u7ebf\u7a0b\u6216\u8005\u4ecd\u7136\u6709\u6a21\u62df\u5728\u8fd0\u884c\u65f6\u5f04\u4e71\u5b83\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u63a7\u5236-kmock-\u6253\u5370\u7684\u4fe1\u606f\u91cf",children:"\u63a7\u5236 kMock \u6253\u5370\u7684\u4fe1\u606f\u91cf"}),"\n",(0,s.jsx)(e.p,{children:"\u5f53 kMock \u53d1\u73b0\u53ef\u80fd\u51fa\u73b0\u9519\u8bef\u7684\u5185\u5bb9\u65f6\uff08\u4f8b\u5982\u6a21\u62df\n\u6ca1\u6709\u671f\u671b\u7684\u51fd\u6570\u88ab\u8c03\u7528\uff0c\u53c8\u540d\u65e0\u8da3\u7684\u8c03\u7528\uff0c\u5373\n\u5141\u8bb8\uff0c\u4f46\u4e5f\u8bb8\u60a8\u5fd8\u8bb0\u660e\u786e\u7981\u6b62\u8be5\u8c03\u7528\uff09\uff0c\u5b83\u4f1a\u6253\u5370\u4e00\u4e9b\n\u8b66\u544a\u6d88\u606f\uff0c\u5305\u62ec\u51fd\u6570\u7684\u53c2\u6570\u3001\u8fd4\u56de\u503c\u548c\n\u5806\u6808\u8ddf\u8e2a\u3002\u5e0c\u671b\u8fd9\u4f1a\u63d0\u9192\u60a8\u770b\u4e00\u770b\u662f\u5426\u6709\n\u786e\u5b9e\u662f\u4e2a\u95ee\u9898\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u6709\u65f6\u60a8\u786e\u4fe1\u81ea\u5df1\u7684\u6d4b\u8bd5\u662f\u6b63\u786e\u7684\uff0c\u4f46\u53ef\u80fd\u5e76\u4e0d\u6b23\u8d4f\n\u5982\u6b64\u53cb\u597d\u7684\u4fe1\u606f\u3002\u6709\u65f6\uff0c\u60a8\u6b63\u5728\u8c03\u8bd5\u6d4b\u8bd5\u6216\n\u4e86\u89e3\u60a8\u6b63\u5728\u6d4b\u8bd5\u7684\u4ee3\u7801\u7684\u884c\u4e3a\uff0c\u5e76\u5e0c\u671b\u60a8\u80fd\u591f\n\u89c2\u5bdf\u53d1\u751f\u7684\u6bcf\u4e2a\u6a21\u62df\u8c03\u7528\uff08\u5305\u62ec\u53c2\u6570\u503c\u3001\u8fd4\u56de\u503c\n\u503c\u548c\u5806\u6808\u8ddf\u8e2a\uff09\u3002\u663e\u7136\uff0c\u4e00\u79cd\u5c3a\u5bf8\u5e76\u4e0d\u9002\u5408\u6240\u6709\u60c5\u51b5\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u53ef\u4ee5\u4f7f\u7528\u201c--kmock_verbose=LEVEL\u201d\u6765\u63a7\u5236 kMock \u544a\u8bc9\u60a8\u7684\u4fe1\u606f\u91cf\n\u547d\u4ee4\u884c\u6807\u5fd7\uff0c\u5176\u4e2d\u201cLEVEL\u201d\u662f\u4e00\u4e2a\u5177\u6709\u4e09\u4e2a\u53ef\u80fd\u503c\u7684\u5b57\u7b26\u4e32\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"info"}),"\uff1akMock \u5c06\u6253\u5370\u6240\u6709\u4fe1\u606f\u6027\u6d88\u606f\u3001\u8b66\u544a\u548c\u9519\u8bef\n\uff08\u6700\u8be6\u7ec6\uff09\u3002\u5728\u6b64\u8bbe\u7f6e\u4e0b\uff0ckMock \u8fd8\u5c06\u8bb0\u5f55\u5bf9\n",(0,s.jsx)(e.code,{children:"ON_CALL/EXPECT_CALL"})," \u5b8f\u3002\u5b83\u5c06\u5305\u542b\u5806\u6808\u8ddf\u8e2a\n\u201c\u65e0\u8da3\u7684\u7535\u8bdd\u201d\u8b66\u544a\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"warning"}),"\uff1akMock \u5c06\u6253\u5370\u8b66\u544a\u548c\u9519\u8bef\uff08\u4e0d\u592a\u8be6\u7ec6\uff09\uff1b\u5b83\u5c06\n\u5ffd\u7565\u201c\u65e0\u8da3\u7684\u8c03\u7528\u201d\u8b66\u544a\u4e2d\u7684\u5806\u6808\u8ddf\u8e2a\u3002\u8fd9\u662f\u9ed8\u8ba4\u8bbe\u7f6e\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"error"}),"\uff1akMock \u5c06\u4ec5\u6253\u5370\u9519\u8bef\uff08\u6700\u4e0d\u8be6\u7ec6\uff09\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u5728\u6d4b\u8bd5\u4e2d\u8c03\u6574\u8be5\u6807\u5fd7\u7684\u503c\uff0c\u4f8b\u5982\n\u6240\u4ee5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'  ::testing::FLAGS_kmock_verbose = "error";\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u53d1\u73b0 kMock \u6253\u5370\u4e86\u592a\u591a\u5806\u6808\u5e27\u53ca\u5176\u4fe1\u606f\u6216\n\u8b66\u544a\u6d88\u606f\uff0c\u8bf7\u8bb0\u4f4f\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u63a7\u5236\u5176\u6570\u91cf\n",(0,s.jsx)(e.code,{children:"--ktest_stack_trace_depth=max_depth"})," \u6807\u5fd7\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u73b0\u5728\uff0c\u660e\u667a\u5730\u4f7f\u7528\u6b63\u786e\u7684\u6807\u5fd7\uff0c\u8ba9 kMock \u66f4\u597d\u5730\u4e3a\u60a8\u670d\u52a1\uff01"}),"\n",(0,s.jsx)(e.h3,{id:"\u5728\u6a21\u62df\u901a\u8bdd\u4e2d\u83b7\u5f97\u8d85\u7ea7\u89c6\u89c9",children:"\u5728\u6a21\u62df\u901a\u8bdd\u4e2d\u83b7\u5f97\u8d85\u7ea7\u89c6\u89c9"}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u4f7f\u7528 kMock \u8fdb\u884c\u4e86\u6d4b\u8bd5\u3002\u5b83\u5931\u8d25\u4e86\uff1akMock \u544a\u8bc9\u4f60\u6709\u4e9b\u671f\u671b\u6ca1\u6709\u5b9e\u73b0\n\u4f7f\u6ee1\u610f\u3002\u4f46\u662f\uff0c\u60a8\u4e0d\u786e\u5b9a\u4e3a\u4ec0\u4e48\uff1a\u662f\u5426\u6709\u62fc\u5199\u9519\u8bef\uff1f\n\u5339\u914d\u8005\uff1f\u60a8\u662f\u5426\u641e\u4e71\u4e86\u201cEXPECT_CALL\u201d\u7684\u987a\u5e8f\uff1f\u6216\u8005\u662f\u4e0b\u9762\u7684\u4ee3\u7801\n\u6d4b\u8bd5\u505a\u9519\u4e86\u4ec0\u4e48\uff1f\u600e\u6837\u624d\u80fd\u627e\u51fa\u539f\u56e0\u5462\uff1f"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u4f60\u6709X\u5149\u89c6\u529b\uff0c\u80fd\u771f\u6b63\u770b\u5230\u4e00\u5207\u7684\u75d5\u8ff9\uff0c\u90a3\u8be5\u591a\u597d\u554a\n\u8fdb\u884c\u201cEXPECT_CALL\u201d\u548c\u6a21\u62df\u65b9\u6cd5\u8c03\u7528\u65f6\uff1f\u5bf9\u4e8e\u6bcf\u6b21\u901a\u8bdd\uff0c\u60a8\u4f1a\n\u559c\u6b22\u67e5\u770b\u5b83\u7684\u5b9e\u9645\u53c2\u6570\u503c\u4ee5\u53ca kMock \u8ba4\u4e3a\u7684\u201cEXPECT_CALL\u201d\n\u5339\u914d\uff1f\u5982\u679c\u60a8\u4ecd\u7136\u9700\u8981\u4e00\u4e9b\u5e2e\u52a9\u6765\u627e\u51fa\u662f\u8c01\u62e8\u6253\u4e86\u8fd9\u4e9b\u7535\u8bdd\uff0c\u5982\u4f55\n\u5173\u4e8e\u80fd\u591f\u5728\u6bcf\u6b21\u6a21\u62df\u8c03\u7528\u65f6\u770b\u5230\u5b8c\u6574\u7684\u5806\u6808\u8ddf\u8e2a\uff1f"}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u201c--kmock_verbose=info\u201d\u8fd0\u884c\u6d4b\u8bd5\u6765\u89e3\u9501\u6b64\u529f\u80fd\n\u65d7\u5e1c\u3002\u4f8b\u5982\uff0c\u7ed9\u5b9a\u6d4b\u8bd5\u7a0b\u5e8f\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'#include "kmock/kmock.h"\n\nusing testing::_;\nusing testing::HasSubstr;\nusing testing::Return;\n\nclass MockFoo {\n public:\n  MOCK_METHOD(void, F, (const string& x, const string& y));\n};\n\nTEST(Foo, Bar) {\n  MockFoo mock;\n  EXPECT_CALL(mock, F(_, _)).WillRepeatedly(Return());\n  EXPECT_CALL(mock, F("a", "b"));\n  EXPECT_CALL(mock, F("c", HasSubstr("d")));\n\n  mock.F("a", "good");\n  mock.F("a", "b");\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u60a8\u4f7f\u7528\u201c--kmock_verbose=info\u201d\u8fd0\u884c\u5b83\uff0c\u60a8\u5c06\u770b\u5230\u4ee5\u4e0b\u8f93\u51fa\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:'[ RUN       ] Foo.Bar\n\nfoo_test.cc:14: EXPECT_CALL(mock, F(_, _)) invoked\nStack trace: ...\n\nfoo_test.cc:15: EXPECT_CALL(mock, F("a", "b")) invoked\nStack trace: ...\n\nfoo_test.cc:16: EXPECT_CALL(mock, F("c", HasSubstr("d"))) invoked\nStack trace: ...\n\nfoo_test.cc:14: Mock function call matches EXPECT_CALL(mock, F(_, _))...\n    Function call: F(@0x7fff7c8dad40"a",@0x7fff7c8dad10"good")\nStack trace: ...\n\nfoo_test.cc:15: Mock function call matches EXPECT_CALL(mock, F("a", "b"))...\n    Function call: F(@0x7fff7c8dada0"a",@0x7fff7c8dad70"b")\nStack trace: ...\n\nfoo_test.cc:16: Failure\nActual function call count doesn\'t match EXPECT_CALL(mock, F("c", HasSubstr("d")))...\n         Expected: to be called once\n           Actual: never called - unsatisfied and active\n[  FAILED  ] Foo.Bar\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u5047\u8bbe\u9519\u8bef\u662f\u7b2c\u4e09\u4e2a\u201cEXPECT_CALL\u201d\u4e2d\u7684\u201cc\u201d\u662f\u4e00\u4e2a\u62fc\u5199\u9519\u8bef\uff0c\u5e76\u4e14\n\u5b9e\u9645\u4e0a\u5e94\u8be5\u662f\u201ca\u201d\u3002\u901a\u8fc7\u4e0a\u9762\u7684\u6d88\u606f\uff0c\u60a8\u5e94\u8be5\u770b\u5230\u5b9e\u9645\u7684\n",(0,s.jsx)(e.code,{children:'F("a", "good")'})," \u8c03\u7528\u4e0e\u7b2c\u4e00\u4e2a ",(0,s.jsx)(e.code,{children:"EXPECT_CALL"})," \u5339\u914d\uff0c\u800c\u4e0d\u662f\u7b2c\u4e09\u4e2a\uff0c\u56e0\u4e3a\n\u4f60\u60f3\u3002\u7531\u6b64\u53ef\u89c1\uff0c\u7b2c\u4e09\u4e2a\u201cEXPECT_CALL\u201d\u662f\n\u5199\u9519\u4e86\u3002\u6848\u5b50\u89e3\u51b3\u4e86\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u5bf9\u6a21\u62df\u8c03\u7528\u8ddf\u8e2a\u611f\u5174\u8da3\u800c\u4e0d\u662f\u5806\u6808\u8ddf\u8e2a\uff0c\u60a8\u53ef\u4ee5\n\u5728\u6d4b\u8bd5\u4e2d\u5c06 ",(0,s.jsx)(e.code,{children:"--kmock_verbose=info"})," \u4e0e ",(0,s.jsx)(e.code,{children:"--ktest_stack_trace_depth=0"})," \u7ed3\u5408\u8d77\u6765\n\u547d\u4ee4\u884c\u3002"]}),"\n",(0,s.jsx)(e.h2,{id:"extending-kmock",children:"\u6269\u5c55 kMock"}),"\n",(0,s.jsx)(e.h3,{id:"NewMatchers",children:"\u5feb\u901f\u7f16\u5199\u65b0\u7684\u5339\u914d\u5668"}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:["\u8b66\u544a\uff1akMock \u4e0d\u4fdd\u8bc1\u5339\u914d\u5668\u4f55\u65f6\u6216\u591a\u5c11\u6b21\n\u8c03\u7528\u3002\u56e0\u6b64\uff0c\u6240\u6709\u5339\u914d\u5668\u5fc5\u987b\u662f\u529f\u80fd\u7eaf\u7684\u3002\u770b\n",(0,s.jsx)(e.a,{href:"#PureMatchers",children:"\u672c\u8282"})," \u4e86\u89e3\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u3002"]})}),"\n",(0,s.jsx)(e.p,{children:"\u201cMATCHER*\u201d\u5b8f\u7cfb\u5217\u53ef\u7528\u4e8e\u8f7b\u677e\u5b9a\u4e49\u81ea\u5b9a\u4e49\u5339\u914d\u5668\u3002\n\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"MATCHER(name, description_string_expression) { statements; }\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06\u5b9a\u4e49\u4e00\u4e2a\u5177\u6709\u6267\u884c\u8bed\u53e5\u7684\u7ed9\u5b9a\u540d\u79f0\u7684\u5339\u914d\u5668\uff0c\u5176\u4e2d\n\u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u201cbool\u201d\u6765\u6307\u793a\u5339\u914d\u662f\u5426\u6210\u529f\u3002\u5728\u58f0\u660e\u4e2d\uff0c\n\u60a8\u53ef\u4ee5\u5f15\u7528\u201carg\u201d\u5339\u914d\u7684\u503c\uff0c\u5e76\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5f15\u7528\u5176\u7c7b\u578b\n",(0,s.jsx)(e.code,{children:"arg_type"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.em,{children:"\u63cf\u8ff0\u5b57\u7b26\u4e32"}),"\u662f\u4e00\u4e2a\u201c\u5b57\u7b26\u4e32\u201d\u7c7b\u578b\u7684\u8868\u8fbe\u5f0f\uff0c\u8bb0\u5f55\u4e86\u5185\u5bb9\nmatcher \u4f1a\u6267\u884c\u6b64\u64cd\u4f5c\uff0c\u5e76\u7528\u4e8e\u5728\u5339\u914d\u5931\u8d25\u65f6\u751f\u6210\u5931\u8d25\u6d88\u606f\u3002\n\u5b83\u53ef\u4ee5\uff08\u5e76\u4e14\u5e94\u8be5\uff09\u5f15\u7528\u7279\u6b8a\u7684\u201cbool\u201d\u53d8\u91cf\u201cnegation\u201d\uff0c\u5e76\u4e14\u5e94\u8be5\n\u5f53\u201cnegation\u201d\u4e3a\u201cfalse\u201d\u65f6\u8bc4\u4f30\u5339\u914d\u5668\u7684\u63cf\u8ff0\uff0c\u6216\u8005\n\u5f53\u201cnegation\u201d\u4e3a\u201ctrue\u201d\u65f6\u5339\u914d\u5668\u7684\u5426\u5b9a\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u4eec\u5141\u8bb8\u63cf\u8ff0\u5b57\u7b26\u4e32\u4e3a\u7a7a\uff08",(0,s.jsx)(e.code,{children:'""'}),"\uff09\uff0c\u5176\u4e2d\ncase kMock \u5c06\u4f7f\u7528\u5339\u914d\u5668\u540d\u79f0\u4e2d\u7684\u5355\u8bcd\u5e8f\u5217\u4f5c\u4e3a\n\u63cf\u8ff0\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u4f8b\u5982\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'MATCHER(IsDivisibleBy7, "") { return (arg % 7) == 0; }\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5141\u8bb8\u4f60\u5199"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  // Expects mock_foo.Bar(n) to be called where n is divisible by 7.\n  EXPECT_CALL(mock_foo, Bar(IsDivisibleBy7()));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6216\u8005\uff0c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  using ::testing::Not;\n  ...\n  // Verifies that a value is divisible by 7 and the other is not.\n  EXPECT_THAT(some_expression, IsDivisibleBy7());\n  EXPECT_THAT(some_other_expression, Not(IsDivisibleBy7()));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u4e0a\u8ff0\u65ad\u8a00\u5931\u8d25\uff0c\u5b83\u4eec\u5c06\u6253\u5370\u5982\u4e0b\u5185\u5bb9\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"  Value of: some_expression\n  Expected: is divisible by 7\n    Actual: 27\n  ...\n  Value of: some_other_expression\n  Expected: not (is divisible by 7)\n    Actual: 21\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5176\u4e2d\u63cf\u8ff0\u201c\u201c\u53ef\u88ab 7 \u6574\u9664\u201d\u201d\u548c\u201c\u201c\u4e0d\u80fd\uff08\u53ef\u88ab 7 \u6574\u9664\uff09\u201d\u201d\u662f\n\u6839\u636e\u5339\u914d\u5668\u540d\u79f0\u201cIsDivisibleBy7\u201d\u81ea\u52a8\u8ba1\u7b97\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u53ef\u80fd\u5df2\u7ecf\u6ce8\u610f\u5230\uff0c\u81ea\u52a8\u751f\u6210\u7684\u63cf\u8ff0\uff08\u5c24\u5176\u662f\u90a3\u4e9b\n\u5426\u5b9a\uff09\u53ef\u80fd\u6ca1\u6709\u90a3\u4e48\u5927\u3002\u60a8\u59cb\u7ec8\u53ef\u4ee5\u4f7f\u7528\u201c\u5b57\u7b26\u4e32\u201d\u8986\u76d6\u5b83\u4eec\n\u81ea\u5df1\u7684\u8868\u8fbe\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'MATCHER(IsDivisibleBy7,\n        absl::StrCat(negation ? "isn\'t" : "is", " divisible by 7")) {\n  return (arg % 7) == 0;\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u5c06\u9644\u52a0\u4fe1\u606f\u6d41\u5f0f\u4f20\u8f93\u5230\u540d\u4e3a\u7684\u9690\u85cf\u53c2\u6570\n",(0,s.jsx)(e.code,{children:"result_listener"})," \u89e3\u91ca\u6bd4\u8d5b\u7ed3\u679c\u3002\u4f8b\u5982\uff0c\u66f4\u597d\u7684\u5b9a\u4e49\n",(0,s.jsx)(e.code,{children:"IsDivisibleBy7"})," \u7684\u503c\u4e3a\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'MATCHER(IsDivisibleBy7, "") {\n  if ((arg % 7) == 0)\n    return true;\n\n  *result_listener << "the remainder is " << (arg % 7);\n  return false;\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u6709\u4e86\u8fd9\u4e2a\u5b9a\u4e49\uff0c\u4e0a\u9762\u7684\u65ad\u8a00\u5c06\u7ed9\u51fa\u66f4\u597d\u7684\u4fe1\u606f\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"  Value of: some_expression\n  Expected: is divisible by 7\n    Actual: 27 (the remainder is 6)\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u5e94\u8be5\u8ba9 ",(0,s.jsx)(e.code,{children:"MatchAndExplain()"})," \u6253\u5370",(0,s.jsx)(e.em,{children:"\u4efb\u4f55\u9644\u52a0\u4fe1\u606f"}),"\n\u5e2e\u52a9\u7528\u6237\u4e86\u89e3\u6bd4\u8d5b\u7ed3\u679c\u3002\u8bf7\u6ce8\u610f\uff0c\u5b83\u5e94\u8be5\u89e3\u91ca\u4e3a\u4ec0\u4e48\n\u5982\u679c\u6210\u529f\u5219\u5339\u914d\u6210\u529f\uff08\u9664\u975e\u5f88\u660e\u663e\uff09 - \u8fd9\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\u5f88\u6709\u7528\n\u5339\u914d\u5668\u5728",(0,s.jsx)(e.code,{children:"Not()"}),"\u5185\u90e8\u4f7f\u7528\u3002\u4e0d\u9700\u8981\u6253\u5370\u53c2\u6570\u503c\n\u672c\u8eab\uff0c\u56e0\u4e3a kMock \u5df2\u7ecf\u4e3a\u60a8\u6253\u5370\u4e86\u5b83\u3002"]}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:["\u6ce8\u610f\uff1a\u5339\u914d\u7684\u503c\u7684\u7c7b\u578b\uff08",(0,s.jsx)(e.code,{children:"arg_type"}),"\uff09\u7531\n\u60a8\u4f7f\u7528\u5339\u914d\u5668\u7684\u4e0a\u4e0b\u6587\u662f\u7531\u7f16\u8bd1\u5668\u63d0\u4f9b\u7ed9\u60a8\u7684\uff0c\u6240\u4ee5\n\u4f60\u4e0d\u9700\u8981\u62c5\u5fc3\u58f0\u660e\u5b83\uff08\u4f60\u4e5f\u4e0d\u80fd\uff09\u3002\u8fd9\u5141\u8bb8\n\u5339\u914d\u5668\u662f\u591a\u6001\u7684\u3002\u4f8b\u5982\uff0c",(0,s.jsx)(e.code,{children:"IsDivisibleBy7()"}),"\u53ef\u7528\u4e8e\u5339\u914d\n\u4efb\u4f55\u7c7b\u578b\uff0c\u5176\u4e2d ",(0,s.jsx)(e.code,{children:"(arg % 7) == 0"})," \u7684\u503c\u53ef\u4ee5\u9690\u5f0f\u8f6c\u6362\u4e3a\n",(0,s.jsx)(e.code,{children:"\u5e03\u5c14"}),"\u3002\u5728\u4e0a\u9762\u7684 Bar(IsDivisibleBy7()) \u793a\u4f8b\u4e2d\uff0c\u5982\u679c\u65b9\u6cd5 Bar() \u63a5\u53d7\u4e00\u4e2a\n",(0,s.jsx)(e.code,{children:"int"}),"\u3001",(0,s.jsx)(e.code,{children:"arg_type"})," \u5c06\u662f ",(0,s.jsx)(e.code,{children:"int"}),"\uff1b\u5982\u679c\u5b83\u9700\u8981\u4e00\u4e2a\u201cunsigned long\u201d\uff0c\u201carg_type\u201d\u5c06\n\u4e3a\u201c\u65e0\u7b26\u53f7\u957f\u201d\uff1b\u7b49\u7b49\u3002"]})}),"\n",(0,s.jsx)(e.h3,{id:"\u5feb\u901f\u7f16\u5199\u65b0\u7684\u53c2\u6570\u5316\u5339\u914d\u5668",children:"\u5feb\u901f\u7f16\u5199\u65b0\u7684\u53c2\u6570\u5316\u5339\u914d\u5668"}),"\n",(0,s.jsx)(e.p,{children:"\u6709\u65f6\u60a8\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u5177\u6709\u53c2\u6570\u7684\u5339\u914d\u5668\u3002\u4e3a\u6b64\u4f60\u53ef\u4ee5\n\u4f7f\u7528\u5b8f\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"MATCHER_P(name, param_name, description_string) { statements; }\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5176\u4e2d\u63cf\u8ff0\u5b57\u7b26\u4e32\u53ef\u4ee5\u662f ",(0,s.jsx)(e.code,{children:'""'})," \u6216 ",(0,s.jsx)(e.code,{children:"string"})," \u8868\u8fbe\u5f0f\n\u5f15\u7528\u201c\u5426\u5b9a\u201d\u548c\u201cparam_name\u201d\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u4f8b\u5982\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'MATCHER_P(HasAbsoluteValue, value, "") { return abs(arg) == value; }\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5c06\u5141\u8bb8\u4f60\u5199\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'  EXPECT_THAT(Blah("a"), HasAbsoluteValue(n));\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6b64\u6d88\u606f\uff08\u5047\u8bbe\u201cn\u201d\u4e3a 10\uff09\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:'  Value of: Blah("a")\n  Expected: has absolute value 10\n    Actual: -9\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u8bf7\u6ce8\u610f\uff0c\u5339\u914d\u5668\u63cf\u8ff0\u53ca\u5176\u53c2\u6570\u90fd\u4f1a\u88ab\u6253\u5370\uff0c\u4f7f\u5f97\n\u6d88\u606f\u4eba\u6027\u5316\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u5339\u914d\u5668\u5b9a\u4e49\u4e3b\u4f53\u4e2d\uff0c\u60a8\u53ef\u4ee5\u7f16\u5199\u201cfoo_type\u201d\u6765\u5f15\u7528\u7c7b\u578b\n\u540d\u4e3a\u201cfoo\u201d\u7684\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u5728\u6b63\u6587\u4e2d\n\u4e0a\u9762",(0,s.jsx)(e.code,{children:"MATCHER_P(HasAbsoluteValue, value)"}),"\uff0c\u53ef\u4ee5\u5199",(0,s.jsx)(e.code,{children:"value_type"}),"\u6765\u5f15\u7528\n\u5230\u201c\u503c\u201d\u7684\u7c7b\u578b\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["kMock\u8fd8\u63d0\u4f9b",(0,s.jsx)(e.code,{children:"MATCHER_P2"}),"\uff0c",(0,s.jsx)(e.code,{children:"MATCHER_P3"}),"\uff0c...\uff0c\u76f4\u5230",(0,s.jsx)(e.code,{children:"MATCHER_P10"}),"\n\u652f\u6301\u591a\u53c2\u6570\u5339\u914d\u5668\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"MATCHER_Pk(name, param_1, ..., param_k, description_string) { statements; }\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u81ea\u5b9a\u4e49\u63cf\u8ff0\u5b57\u7b26\u4e32\u9002\u7528\u4e8e\u7279\u5b9a\u7684",(0,s.jsx)(e.em,{children:"\u5b9e\u4f8b"}),"\n\u5339\u914d\u5668\uff0c\u5176\u4e2d\u53c2\u6570\u5df2\u7ed1\u5b9a\u5230\u5b9e\u9645\u503c\u3002\u6240\u4ee5\n\u901a\u5e38\u60a8\u4f1a\u5e0c\u671b\u53c2\u6570\u503c\u6210\u4e3a\u63cf\u8ff0\u7684\u4e00\u90e8\u5206\u3002\u6a21\u62df\n\u8ba9\u60a8\u53ef\u4ee5\u901a\u8fc7\u5f15\u7528\u63cf\u8ff0\u5b57\u7b26\u4e32\u4e2d\u7684\u5339\u914d\u5668\u53c2\u6570\u6765\u505a\u5230\u8fd9\u4e00\u70b9\n\u8868\u8fbe\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u4f8b\u5982\uff0c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::PrintToString;\nMATCHER_P2(InClosedRange, low, hi,\n           absl::StrFormat("%s in range [%s, %s]", negation ? "isn\'t" : "is",\n                           PrintToString(low), PrintToString(hi))) {\n  return low <= arg && arg <= hi;\n}\n...\nEXPECT_THAT(3, InClosedRange(4, 6));\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5c06\u751f\u6210\u5305\u542b\u4ee5\u4e0b\u6d88\u606f\u7684\u6545\u969c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"  Expected: is in range [4, 6]\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u6307\u5b9a ",(0,s.jsx)(e.code,{children:'""'})," \u4f5c\u4e3a\u63cf\u8ff0\uff0c\u5219\u5931\u8d25\u6d88\u606f\u5c06\u5305\u542b\n\u5339\u914d\u5668\u540d\u79f0\u4e2d\u7684\u5355\u8bcd\u5e8f\u5217\uff0c\u540e\u8ddf\u6253\u5370\u7684\u53c2\u6570\u503c\n\u4f5c\u4e3a\u4e00\u4e2a\u5143\u7ec4\u3002\u4f8b\u5982\uff0c"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'  MATCHER_P2(InClosedRange, low, hi, "") { ... }\n  ...\n  EXPECT_THAT(3, InClosedRange(4, 6));\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u5c06\u751f\u6210\u5305\u542b\u4ee5\u4e0b\u6587\u672c\u7684\u5931\u8d25\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"  Expected: in closed range (4, 6)\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3a\u4e86\u6253\u5b57\u7684\u76ee\u7684\uff0c\u60a8\u53ef\u4ee5\u67e5\u770b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"MATCHER_Pk(Foo, p1, ..., pk, description_string) { ... }\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4f5c\u4e3a\u7b80\u5199"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"template <typename p1_type, ..., typename pk_type>\nFooMatcherPk<p1_type, ..., pk_type>\nFoo(p1_type p1, ..., pk_type pk) { ... }\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5f53\u4f60\u5199 Foo(v1, ..., vk) \u65f6\uff0c\u7f16\u8bd1\u5668\u4f1a\u63a8\u65ad\u51fa Foo(v1, ..., vk) \u7684\u7c7b\u578b\n\u4e3a\u60a8\u63d0\u4f9b\u53c2\u6570\u201cv1\u201d\u3001...\u548c\u201cvk\u201d\u3002\u5982\u679c\u60a8\u5bf9\u7ed3\u679c\u4e0d\u6ee1\u610f\n\u7c7b\u578b\u63a8\u65ad\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u663e\u5f0f\u5b9e\u4f8b\u5316\u6765\u6307\u5b9a\u7c7b\u578b\n\u6a21\u677f\uff0c\u5982",(0,s.jsx)(e.code,{children:"Foo<long, bool>(5, false)"}),"\u3002\u6b63\u5982\u4e4b\u524d\u6240\u8bf4\uff0c\u4f60\u4e0d\u80fd\n\uff08\u6216\u9700\u8981\uff09\u6307\u5b9a\u201carg_type\u201d\uff0c\u56e0\u4e3a\u5b83\u662f\u7531\u4e0a\u4e0b\u6587\u786e\u5b9a\u7684\n\u4f7f\u7528\u5339\u914d\u5668\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u53ef\u4ee5\u5c06\u8868\u8fbe\u5f0f ",(0,s.jsx)(e.code,{children:"Foo(p1, ..., pk)"})," \u7684\u7ed3\u679c\u5206\u914d\u7ed9\u7c7b\u578b\u53d8\u91cf\n",(0,s.jsx)(e.code,{children:"FooMatcherPk<p1_type, ..., pk_type>"}),"\u3002\u8fd9\u5728\u4f5c\u66f2\u65f6\u5f88\u6709\u7528\n\u5339\u914d\u8005\u3002\u6ca1\u6709\u53c2\u6570\u6216\u53ea\u6709\u4e00\u4e2a\u53c2\u6570\u7684\u5339\u914d\u5668\u6709\n\u7279\u6b8a\u7c7b\u578b\uff1a\u60a8\u53ef\u4ee5\u5c06 ",(0,s.jsx)(e.code,{children:"Foo()"})," \u5206\u914d\u7ed9 ",(0,s.jsx)(e.code,{children:"FooMatcher"})," \u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u5e76\u4e14\n\u5c06 ",(0,s.jsx)(e.code,{children:"Foo(p)"})," \u5206\u914d\u7ed9 ",(0,s.jsx)(e.code,{children:"FooMatcherP<p_type>"})," \u7c7b\u578b\u53d8\u91cf\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u867d\u7136\u60a8\u53ef\u4ee5\u4f7f\u7528\u5f15\u7528\u7c7b\u578b\u5b9e\u4f8b\u5316\u5339\u914d\u5668\u6a21\u677f\uff0c\u4f46\u4f20\u9012\n\u901a\u8fc7\u6307\u9488\u4f20\u9012\u53c2\u6570\u901a\u5e38\u4f1a\u4f7f\u4ee3\u7801\u66f4\u5177\u53ef\u8bfb\u6027\u3002\u7136\u800c\uff0c\u5982\u679c\u4f60\n\u4ecd\u7136\u60f3\u901a\u8fc7\u5f15\u7528\u4f20\u9012\u53c2\u6570\uff0c\u8bf7\u6ce8\u610f\u5728\u5931\u8d25\u65f6\n\u5339\u914d\u5668\u751f\u6210\u7684\u6d88\u606f\u60a8\u5c06\u770b\u5230\u5f15\u7528\u5bf9\u8c61\u7684\u503c\n\u4f46\u4e0d\u662f\u5b83\u7684\u5730\u5740\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u6570\u91cf\u7684\u53c2\u6570\u91cd\u8f7d\u5339\u914d\u5668\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"MATCHER_P(Blah, a, description_string_1) { ... }\nMATCHER_P2(Blah, a, b, description_string_2) { ... }\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u867d\u7136\u5728\u5b9a\u4e49\u65b0\u7684\u65f6\u603b\u662f\u4f7f\u7528\u201cMATCHER*\u201d\u5b8f\u5f88\u8bf1\u4eba\nmatcher\uff0c\u4f60\u8fd8\u5e94\u8be5\u8003\u8651\u76f4\u63a5\u5b9e\u73b0matcher\u63a5\u53e3\n\u76f8\u53cd\uff08\u8bf7\u53c2\u9605\u4e0b\u9762\u7684\u98df\u8c31\uff09\uff0c\u7279\u522b\u662f\u5982\u679c\u60a8\u9700\u8981\u4f7f\u7528\u5339\u914d\u5668\n\u5f88\u591a\u3002\u867d\u7136\u8fd9\u4e9b\u65b9\u6cd5\u9700\u8981\u66f4\u591a\u7684\u5de5\u4f5c\uff0c\u4f46\u5b83\u4eec\u53ef\u4ee5\u8ba9\u60a8\u66f4\u597d\u5730\u63a7\u5236\n\u88ab\u5339\u914d\u7684\u503c\u7684\u7c7b\u578b\u548c\u5339\u914d\u5668\u53c2\u6570\uff0c\u5176\u4e2d\nGeneral \u4f1a\u5e26\u6765\u66f4\u597d\u7684\u7f16\u8bd1\u5668\u9519\u8bef\u6d88\u606f\uff0c\u4ece\u957f\u8fdc\u6765\u770b\u4f1a\u5e26\u6765\u56de\u62a5\u3002\n\u5b83\u4eec\u8fd8\u5141\u8bb8\u57fa\u4e8e\u53c2\u6570\u7c7b\u578b\u91cd\u8f7d\u5339\u914d\u5668\uff08\u4e0e\n\u4ec5\u57fa\u4e8e\u53c2\u6570\u7684\u6570\u91cf\uff09\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"\u7f16\u5199\u65b0\u7684\u5355\u6001\u5339\u914d\u5668",children:"\u7f16\u5199\u65b0\u7684\u5355\u6001\u5339\u914d\u5668"}),"\n",(0,s.jsx)(e.p,{children:"\u53c2\u6570\u7c7b\u578b\u201cT\u201d\u7684\u5339\u914d\u5668\u5b9e\u73b0\u201cT\u201d\u7684\u5339\u914d\u5668\u63a5\u53e3\u5e76\u6267\u884c\n\u4e24\u4ef6\u4e8b\uff1a\u5b83\u6d4b\u8bd5\u7c7b\u578b\u201cT\u201d\u7684\u503c\u662f\u5426\u4e0e\u5339\u914d\u5668\u5339\u914d\uff0c\u5e76\u4e14\u53ef\u4ee5\n\u63cf\u8ff0\u5b83\u5339\u914d\u4ec0\u4e48\u6837\u7684\u503c\u3002\u540e\u4e00\u79cd\u80fd\u529b\u7528\u4e8e\n\u5f53\u8fdd\u53cd\u671f\u671b\u65f6\u751f\u6210\u53ef\u8bfb\u7684\u9519\u8bef\u6d88\u606f\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"T"})," \u7684\u5339\u914d\u5668\u5fc5\u987b\u58f0\u660e\u4e00\u4e2a typedef\uff0c\u5982\u4e0b\u6240\u793a\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using is_ktest_matcher = void;\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5e76\u652f\u6301\u4ee5\u4e0b\u64cd\u4f5c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"// Match a value and optionally explain into an ostream.\nbool matched = matcher.MatchAndExplain(value, maybe_os);\n// where `value` is of type `T` and\n// `maybe_os` is of type `std::ostream*`, where it can be null if the caller\n// is not interested in there textual explanation.\n\nmatcher.DescribeTo(os);\nmatcher.DescribeNegationTo(os);\n// where `os` is of type `std::ostream*`.\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u60a8\u9700\u8981\u81ea\u5b9a\u4e49\u5339\u914d\u5668\uff0c\u4f46 ",(0,s.jsx)(e.code,{children:"Truly()"})," \u4e0d\u662f\u4e00\u4e2a\u597d\u7684\u9009\u62e9\uff08\u4f8b\u5982\uff0c\n\u60a8\u53ef\u80fd\u5bf9\u201cTruly(predicate)\u201d\u7684\u63cf\u8ff0\u65b9\u5f0f\u4e0d\u6ee1\u610f\uff0c\u6216\u8005\u60a8\n\u53ef\u80fd\u5e0c\u671b\u4f60\u7684\u5339\u914d\u5668\u50cf ",(0,s.jsx)(e.code,{children:"Eq(value)"})," \u90a3\u6837\u662f\u591a\u6001\u7684\uff09\uff0c\u4f60\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\n\u5339\u914d\u5668\u5206\u4e24\u6b65\u505a\u4f60\u60f3\u505a\u7684\u4e8b\u60c5\uff1a\u9996\u5148\u5b9e\u73b0\u5339\u914d\u5668\n\u63a5\u53e3\uff0c\u7136\u540e\u5b9a\u4e49\u4e00\u4e2a\u5de5\u5382\u51fd\u6570\u6765\u521b\u5efa\u5339\u914d\u5668\u5b9e\u4f8b\u3002\u8fd9\n\u7b2c\u4e8c\u6b65\u5e76\u4e0d\u662f\u4e25\u683c\u9700\u8981\u7684\uff0c\u4f46\u5b83\u4f7f\u5f97\u4f7f\u7528\u5339\u914d\u5668\u7684\u8bed\u6cd5\n\u66f4\u597d\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u5339\u914d\u5668\u6765\u6d4b\u8bd5\u201cint\u201d\u662f\u5426\u80fd\u88ab7\u6574\u9664\n\u7136\u540e\u50cf\u8fd9\u6837\u4f7f\u7528\u5b83\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::Matcher;\n\nclass DivisibleBy7Matcher {\n public:\n  using is_ktest_matcher = void;\n\n  bool MatchAndExplain(int n, std::ostream*) const {\n    return (n % 7) == 0;\n  }\n\n  void DescribeTo(std::ostream* os) const {\n    *os << "is divisible by 7";\n  }\n\n  void DescribeNegationTo(std::ostream* os) const {\n    *os << "is not divisible by 7";\n  }\n};\n\nMatcher<int> DivisibleBy7() {\n  return DivisibleBy7Matcher();\n}\n\n...\n  EXPECT_CALL(foo, Bar(DivisibleBy7()));\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u60a8\u53ef\u4ee5\u901a\u8fc7\u5c06\u9644\u52a0\u4fe1\u606f\u6d41\u5f0f\u4f20\u8f93\u5230\n",(0,s.jsx)(e.code,{children:"MatchAndExplain()"})," \u4e2d\u7684 ",(0,s.jsx)(e.code,{children:"os"})," \u53c2\u6570\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'class DivisibleBy7Matcher {\n public:\n  bool MatchAndExplain(int n, std::ostream* os) const {\n    const int remainder = n % 7;\n    if (remainder != 0 && os != nullptr) {\n      *os << "the remainder is " << remainder;\n    }\n    return remainder == 0;\n  }\n  ...\n};\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u7136\u540e\uff0c\u201cEXPECT_THAT(x, DivisibleBy7());\u201d\u53ef\u80fd\u4f1a\u751f\u6210\u5982\u4e0b\u6d88\u606f\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"Value of: x\nExpected: is divisible by 7\n  Actual: 23 (the remainder is 2)\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"{: .callout .tip}"}),"\nTip: for convenience, ",(0,s.jsx)(e.code,{children:"MatchAndExplain()"})," can take a ",(0,s.jsx)(e.code,{children:"MatchResultListener*"}),"\ninstead of ",(0,s.jsx)(e.code,{children:"std::ostream*"}),"."]}),"\n",(0,s.jsx)(e.h3,{id:"\u7f16\u5199\u65b0\u7684\u591a\u6001\u5339\u914d\u5668",children:"\u7f16\u5199\u65b0\u7684\u591a\u6001\u5339\u914d\u5668"}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06\u6211\u4eec\u4e0a\u9762\u5b66\u5230\u7684\u77e5\u8bc6\u6269\u5c55\u5230",(0,s.jsx)(e.em,{children:"\u591a\u6001"}),"\u5339\u914d\u5668\u73b0\u5728\u5c31\u4e00\u6837\u7b80\u5355\n\u5728\u6b63\u786e\u7684\u4f4d\u7f6e\u6dfb\u52a0\u6a21\u677f\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'\nclass NotNullMatcher {\n public:\n  using is_ktest_matcher = void;\n\n  // To implement a polymorphic matcher, we just need to make MatchAndExplain a\n  // template on its first argument.\n\n  // In this example, we want to use NotNull() with any pointer, so\n  // MatchAndExplain() accepts a pointer of any type as its first argument.\n  // In general, you can define MatchAndExplain() as an ordinary method or\n  // a method template, or even overload it.\n  template <typename T>\n  bool MatchAndExplain(T* p, std::ostream*) const {\n    return p != nullptr;\n  }\n\n  // Describes the property of a value matching this matcher.\n  void DescribeTo(std::ostream* os) const { *os << "is not NULL"; }\n\n  // Describes the property of a value NOT matching this matcher.\n  void DescribeNegationTo(std::ostream* os) const { *os << "is NULL"; }\n};\n\nNotNullMatcher NotNull() {\n  return NotNullMatcher();\n}\n\n...\n\n  EXPECT_CALL(foo, Bar(NotNull()));  // The argument must be a non-NULL pointer.\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u9057\u7559\u5339\u914d\u5668\u5b9e\u65bd",children:"\u9057\u7559\u5339\u914d\u5668\u5b9e\u65bd"}),"\n",(0,s.jsxs)(e.p,{children:["\u5b9a\u4e49\u5339\u914d\u5668\u66fe\u7ecf\u6709\u70b9\u590d\u6742\uff0c\u5176\u4e2d\u9700\u8981\n\u51e0\u4e2a\u652f\u6301\u7c7b\u548c\u865a\u51fd\u6570\u3002\u5b9e\u73b0\u5339\u914d\u5668\n\u4f7f\u7528\u5fc5\u987b\u4ece ",(0,s.jsx)(e.code,{children:"MatcherInterface<T>"})," \u6d3e\u751f\u7684\u65e7\u7248 API \u8f93\u5165 ",(0,s.jsx)(e.code,{children:"T"})," \u5e76\n\u8c03\u7528",(0,s.jsx)(e.code,{children:"MakeMatcher"}),"\u6765\u6784\u9020\u5bf9\u8c61\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u754c\u9762\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class MatchResultListener {\n public:\n  ...\n  // Streams x to the underlying ostream; does nothing if the ostream\n  // is NULL.\n  template <typename T>\n  MatchResultListener& operator<<(const T& x);\n\n  // Returns the underlying ostream.\n  std::ostream* stream();\n};\n\ntemplate <typename T>\nclass MatcherInterface {\n public:\n  virtual ~MatcherInterface();\n\n  // Returns true if and only if the matcher matches x; also explains the match\n  // result to 'listener'.\n  virtual bool MatchAndExplain(T x, MatchResultListener* listener) const = 0;\n\n  // Describes this matcher to an ostream.\n  virtual void DescribeTo(std::ostream* os) const = 0;\n\n  // Describes the negation of this matcher to an ostream.\n  virtual void DescribeNegationTo(std::ostream* os) const;\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5e78\u8fd0\u7684\u662f\uff0c\u5927\u591a\u6570\u65f6\u5019\u60a8\u53ef\u4ee5\u8f7b\u677e\u5730\u5b9a\u4e49\u591a\u6001\u5339\u914d\u5668\n\u5728 ",(0,s.jsx)(e.code,{children:"MakePolymorphicMatcher()"})," \u7684\u5e2e\u52a9\u4e0b\u3002\u4ee5\u4e0b\u662f\u5982\u4f55\u5c06 ",(0,s.jsx)(e.code,{children:"NotNull()"})," \u5b9a\u4e49\u4e3a\n\u4e00\u4e2a\u4f8b\u5b50\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::MakePolymorphicMatcher;\nusing ::testing::MatchResultListener;\nusing ::testing::PolymorphicMatcher;\n\nclass NotNullMatcher {\n public:\n  // To implement a polymorphic matcher, first define a COPYABLE class\n  // that has three members MatchAndExplain(), DescribeTo(), and\n  // DescribeNegationTo(), like the following.\n\n  // In this example, we want to use NotNull() with any pointer, so\n  // MatchAndExplain() accepts a pointer of any type as its first argument.\n  // In general, you can define MatchAndExplain() as an ordinary method or\n  // a method template, or even overload it.\n  template <typename T>\n  bool MatchAndExplain(T* p,\n                       MatchResultListener* /* listener */) const {\n    return p != NULL;\n  }\n\n  // Describes the property of a value matching this matcher.\n  void DescribeTo(std::ostream* os) const { *os << "is not NULL"; }\n\n  // Describes the property of a value NOT matching this matcher.\n  void DescribeNegationTo(std::ostream* os) const { *os << "is NULL"; }\n};\n\n// To construct a polymorphic matcher, pass an instance of the class\n// to MakePolymorphicMatcher().  Note the return type.\nPolymorphicMatcher<NotNullMatcher> NotNull() {\n  return MakePolymorphicMatcher(NotNullMatcher());\n}\n\n...\n\n  EXPECT_CALL(foo, Bar(NotNull()));  // The argument must be a non-NULL pointer.\n'})}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:[(0,s.jsxs)(e.strong,{children:["\u6ce8\u610f\uff1a",(0,s.jsx)(e.strong,{children:"\u60a8\u7684\u591a\u6001\u5339\u914d\u5668\u7c7b"}),"\u4e0d\u9700\u8981"]}),"\u9700\u8981\u7ee7\u627f\u81ea\n",(0,s.jsx)(e.code,{children:"MatcherInterface"})," \u6216\u4efb\u4f55\u5176\u4ed6\u7c7b\uff0c\u53ca\u5176\u65b9\u6cd5",(0,s.jsx)(e.strong,{children:"\u4e0d\u9700\u8981"}),"\n\u865a\u62df\u7684\u3002"]})}),"\n",(0,s.jsxs)(e.p,{children:["\u5c31\u50cf\u5728\u5355\u6001\u5339\u914d\u5668\u4e2d\u4e00\u6837\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u6d41\u5f0f\u4f20\u8f93\u6765\u89e3\u91ca\u5339\u914d\u7ed3\u679c\n",(0,s.jsx)(e.code,{children:"MatchAndExplain()"})," \u4e2d\u7684 ",(0,s.jsx)(e.code,{children:"listener"})," \u53c2\u6570\u7684\u9644\u52a0\u4fe1\u606f\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u7f16\u5199\u65b0\u7684\u57fa\u6570",children:"\u7f16\u5199\u65b0\u7684\u57fa\u6570"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"Times()"})," \u4e2d\u4f7f\u7528\u57fa\u6570\u6765\u544a\u8bc9 kMock \u4f60\u671f\u671b\u51fa\u73b0\u591a\u5c11\u6b21\n\u8c03\u7528\u53d1\u751f\u3002\u5b83\u4e0d\u5fc5\u662f\u7cbe\u786e\u7684\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u8bf4\n",(0,s.jsx)(e.code,{children:"AtLeast(5)"})," \u6216 ",(0,s.jsx)(e.code,{children:"Between(2, 4)"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u57fa\u6570\u7684",(0,s.jsx)(e.a,{href:"/docs/next/cpp/base/testing/kt/kmock_cheat_sheet#CardinalityList",children:"\u5185\u7f6e\u96c6"}),"\n\u4e0d\u9002\u5408\u60a8\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u5b9e\u65bd\u4ee5\u4e0b\u5185\u5bb9\u81ea\u7531\u5b9a\u4e49\u81ea\u5df1\u7684\n\u63a5\u53e3\uff08\u5728\u547d\u540d\u7a7a\u95f4\u201ctesting\u201d\u4e2d\uff09\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class CardinalityInterface {\n public:\n  virtual ~CardinalityInterface();\n\n  // Returns true if and only if call_count calls will satisfy this cardinality.\n  virtual bool IsSatisfiedByCallCount(int call_count) const = 0;\n\n  // Returns true if and only if call_count calls will saturate this\n  // cardinality.\n  virtual bool IsSaturatedByCallCount(int call_count) const = 0;\n\n  // Describes self to an ostream.\n  virtual void DescribeTo(std::ostream* os) const = 0;\n};\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4f8b\u5982\uff0c\u8981\u6307\u5b9a\u8c03\u7528\u5fc5\u987b\u53d1\u751f\u5076\u6570\u6b21\uff0c\u60a8\u53ef\u4ee5\n\u5199"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::Cardinality;\nusing ::testing::CardinalityInterface;\nusing ::testing::MakeCardinality;\n\nclass EvenNumberCardinality : public CardinalityInterface {\n public:\n  bool IsSatisfiedByCallCount(int call_count) const override {\n    return (call_count % 2) == 0;\n  }\n\n  bool IsSaturatedByCallCount(int call_count) const override {\n    return false;\n  }\n\n  void DescribeTo(std::ostream* os) const {\n    *os << "called even number of times";\n  }\n};\n\nCardinality EvenNumber() {\n  return MakeCardinality(new EvenNumberCardinality);\n}\n\n...\n  EXPECT_CALL(foo, Bar(3))\n      .Times(EvenNumber());\n'})}),"\n",(0,s.jsx)(e.h3,{id:"QuickNewActions",children:"\u7f16\u5199\u65b0\u52a8\u4f5c"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u5185\u7f6e\u64cd\u4f5c\u4e0d\u9002\u5408\u60a8\uff0c\u60a8\u53ef\u4ee5\u8f7b\u677e\u5b9a\u4e49\u81ea\u5df1\u7684\u64cd\u4f5c\u3002\n\u60a8\u6240\u9700\u8981\u7684\u53ea\u662f\u4e00\u4e2a\u5177\u6709\u4e0e\u6a21\u62df\u517c\u5bb9\u7684\u7b7e\u540d\u7684\u8c03\u7528\u8fd0\u7b97\u7b26\n\u529f\u80fd\u3002\u6240\u4ee5\u4f60\u53ef\u4ee5\u4f7f\u7528 lambda\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"MockFunction<int(int)> mock;\nEXPECT_CALL(mock, Call).WillOnce([](const int input) { return input * 7; });\nEXPECT_EQ(14, mock.AsStdFunction()(2));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6216\u8005\u5e26\u6709\u8c03\u7528\u8fd0\u7b97\u7b26\u7684\u7ed3\u6784\uff08\u751a\u81f3\u662f\u6a21\u677f\u5316\u7684\u7ed3\u6784\uff09\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"struct MultiplyBy {\n  template <typename T>\n  T operator()(T arg) { return arg * multiplier; }\n\n  int multiplier;\n};\n\n// Then use:\n// EXPECT_CALL(...).WillOnce(MultiplyBy{7});\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u53ef\u8c03\u7528\u5bf9\u8c61\u4e0d\u5e26\u53c2\u6570\u4e5f\u53ef\u4ee5\uff0c\u5ffd\u7565\u53c2\u6570\n\u63d0\u4f9b\u7ed9\u6a21\u62df\u51fd\u6570\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"MockFunction<int(int)> mock;\nEXPECT_CALL(mock, Call).WillOnce([] { return 17; });\nEXPECT_EQ(17, mock.AsStdFunction()(0));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u4e0e\u201cWillOnce\u201d\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u53ef\u8c03\u7528\u5bf9\u8c61\u53ef\u4ee5\u5047\u8bbe\u5b83\u6700\u591a\u4f1a\u88ab\u8c03\u7528\n\u4e00\u6b21\u5e76\u4e14\u5141\u8bb8\u662f\u4ec5\u79fb\u52a8\u7c7b\u578b\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"// An action that contains move-only types and has an &&-qualified operator,\n// demanding in the type system that it be called at most once. This can be\n// used with WillOnce, but the compiler will reject it if handed to\n// WillRepeatedly.\nstruct MoveOnlyAction {\n  std::unique_ptr<int> move_only_state;\n  std::unique_ptr<int> operator()() && { return std::move(move_only_state); }\n};\n\nMockFunction<std::unique_ptr<int>()> mock;\nEXPECT_CALL(mock, Call).WillOnce(MoveOnlyAction{std::make_unique<int>(17)});\nEXPECT_THAT(mock.AsStdFunction()(), Pointee(Eq(17)));\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u66f4\u4e00\u822c\u5730\u8bf4\uff0c\u4e0e\u7b7e\u540d\u4e3a",(0,s.jsx)(e.code,{children:"R(Args...)"}),"\u7684\u6a21\u62df\u51fd\u6570\u4e00\u8d77\u4f7f\u7528\n\u5bf9\u8c61\u53ef\u4ee5\u662f\u4efb\u4f55\u53ef\u8f6c\u6362\u4e3a ",(0,s.jsx)(e.code,{children:"OnceAction<R(Args...)>"})," \u6216\n",(0,s.jsx)(e.code,{children:"\u64cd\u4f5c<R(\u53c2\u6570...)>"}),"\u3002\u4e24\u8005\u4e4b\u95f4\u7684\u533a\u522b\u5728\u4e8e ",(0,s.jsx)(e.code,{children:"OnceAction"})," \u6709\n\u8f83\u5f31\u7684\u8981\u6c42\uff08",(0,s.jsx)(e.code,{children:"Action"}),"\u9700\u8981\u4e00\u4e2a\u53ef\u590d\u5236\u6784\u9020\u7684\u8f93\u5165\uff0c\u53ef\u4ee5\u662f\n\u91cd\u590d\u8c03\u7528\uff0c\u800c",(0,s.jsx)(e.code,{children:"OnceAction"}),"\u53ea\u9700\u8981\u53ef\u79fb\u52a8\u6784\u9020\u5e76\u4e14\n\u652f\u6301\u201c&&\u201d\u9650\u5b9a\u7684\u8c03\u7528\u8fd0\u7b97\u7b26\uff09\uff0c\u4f46\u53ea\u80fd\u4e0e\u201cWillOnce\u201d\u4e00\u8d77\u4f7f\u7528\u3002\n",(0,s.jsx)(e.code,{children:"OnceAction"})," \u901a\u5e38\u4ec5\u5728\u652f\u6301\u4ec5\u79fb\u52a8\u7c7b\u578b\u6216\n\u9700\u8981\u7c7b\u578b\u7cfb\u7edf\u7684\u64cd\u4f5c\u4fdd\u8bc1\u5b83\u4eec\u6700\u591a\u88ab\u8c03\u7528\u4e00\u6b21\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u901a\u5e38\u4e0d\u9700\u8981\u5f15\u7528",(0,s.jsx)(e.code,{children:"OnceAction"}),"\u548c",(0,s.jsx)(e.code,{children:"Action"}),"\u6a21\u677f\n\u76f4\u63a5\u5728\u60a8\u7684\u64cd\u4f5c\u4e2d\uff1a\u5e26\u6709\u8c03\u7528\u8fd0\u7b97\u7b26\u7684\u7ed3\u6784\u6216\u7c7b\u5c31\u8db3\u591f\u4e86\uff0c\n\u5982\u4e0a\u9762\u7684\u4f8b\u5b50\u3002\u4f46\u66f4\u9ad8\u7ea7\u7684\u591a\u6001\u884c\u4e3a\u9700\u8981\u4e86\u89e3\n\u6a21\u62df\u51fd\u6570\u7684\u7279\u5b9a\u8fd4\u56de\u7c7b\u578b\u53ef\u4ee5\u5b9a\u4e49\u6a21\u677f\u5316\u8f6c\u6362\n\u8fd0\u8425\u5546\u4f7f\u4e4b\u6210\u4e3a\u53ef\u80fd\u3002\u6709\u5173\u793a\u4f8b\uff0c\u8bf7\u53c2\u9605\u201ckmock-actions.h\u201d\u3002"]}),"\n",(0,s.jsx)(e.h4,{id:"\u65e7\u7684\u57fa\u4e8e\u5b8f\u7684\u64cd\u4f5c",children:"\u65e7\u7684\u57fa\u4e8e\u5b8f\u7684\u64cd\u4f5c"}),"\n",(0,s.jsx)(e.p,{children:"\u5728 C++11 \u4e4b\u524d\uff0c\u4e0d\u652f\u6301\u57fa\u4e8e\u51fd\u5b50\u7684\u64cd\u4f5c\uff1b\u8001\u529e\u6cd5\n\u7f16\u5199\u52a8\u4f5c\u662f\u901a\u8fc7\u4e00\u7ec4\u201cACTION*\u201d\u5b8f\u6765\u5b8c\u6210\u7684\u3002\u6211\u4eec\u5efa\u8bae\u907f\u514d\u4f7f\u7528\u5b83\u4eec\n\u5728\u65b0\u4ee3\u7801\u4e2d\uff1b\u4ed6\u4eec\u5728\u5b8f\u80cc\u540e\u9690\u85cf\u4e86\u5f88\u591a\u903b\u8f91\uff0c\u53ef\u80fd\u5bfc\u81f4\n\u66f4\u96be\u7406\u89e3\u7684\u7f16\u8bd1\u5668\u9519\u8bef\u3002\u5c3d\u7ba1\u5982\u6b64\uff0c\u6211\u4eec\u8fd8\u662f\u5728\u8fd9\u91cc\u4ecb\u7ecd\u5b83\u4eec\n\u5b8c\u6574\u6027\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u901a\u8fc7\u5199\u4f5c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ACTION(name) { statements; }\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u547d\u540d\u7a7a\u95f4\u8303\u56f4\u5185\uff08\u5373\u4e0d\u5728\u7c7b\u6216\u51fd\u6570\u5185\uff09\uff0c\u60a8\u5c06\u5b9a\u4e49\u4e00\u4e2a\n\u6267\u884c\u8bed\u53e5\u7684\u5177\u6709\u7ed9\u5b9a\u540d\u79f0\u7684\u64cd\u4f5c\u3002\u8fd4\u56de\u7684\u503c\n",(0,s.jsx)(e.code,{children:"statements"})," \u5c06\u7528\u4f5c\u64cd\u4f5c\u7684\u8fd4\u56de\u503c\u3002\u91cc\u9762\u7684\n\u8bed\u53e5\uff0c\u60a8\u53ef\u4ee5\u5c06\u6a21\u62df\u51fd\u6570\u7684\u7b2c K \u4e2a\uff08\u4ece 0 \u5f00\u59cb\uff09\u53c2\u6570\u5f15\u7528\u4e3a\n",(0,s.jsx)(e.code,{children:"argK"}),"\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ACTION(IncrementArg1) { return ++(*arg1); }\n"})}),"\n",(0,s.jsx)(e.p,{children:"allows you to write"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"... WillOnce(IncrementArg1());\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u60a8\u4e0d\u9700\u8981\u6307\u5b9a\u6a21\u62df\u51fd\u6570\u53c2\u6570\u7684\u7c7b\u578b\u3002\n\u4e0d\u8fc7\u8bf7\u653e\u5fc3\uff0c\u60a8\u7684\u4ee3\u7801\u662f\u7c7b\u578b\u5b89\u5168\u7684\uff1a\u5982\u679c\u51fa\u73b0\u4ee5\u4e0b\u60c5\u51b5\uff0c\u60a8\u5c06\u6536\u5230\u7f16\u8bd1\u5668\u9519\u8bef\uff1a\n",(0,s.jsx)(e.code,{children:"*arg1"})," \u4e0d\u652f\u6301 ",(0,s.jsx)(e.code,{children:"++"})," \u8fd0\u7b97\u7b26\uff0c\u6216\u8005\u5982\u679c ",(0,s.jsx)(e.code,{children:"++(*arg1)"})," \u7684\u7c7b\u578b\u4e0d\u652f\u6301\n\u4e0e\u6a21\u62df\u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b\u517c\u5bb9\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u53e6\u4e00\u4e2a\u4f8b\u5b50\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ACTION(Foo) {\n  (*arg2)(5);\n  Blah();\n  *arg1 = 0;\n  return arg0;\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5b9a\u4e49\u4e00\u4e2a\u52a8\u4f5c\u201cFoo()\u201d\uff0c\u7528 5 \u8c03\u7528\u53c2\u6570 #2\uff08\u51fd\u6570\u6307\u9488\uff09\uff0c\n\u8c03\u7528\u51fd\u6570\u201cBlah()\u201d\uff0c\u5c06\u53c2\u6570 #1 \u6307\u5411\u7684\u503c\u8bbe\u7f6e\u4e3a 0\uff0c\u5e76\u4e14\n\u8fd4\u56de\u53c2\u6570#0\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u4e3a\u4e86\u66f4\u52a0\u65b9\u4fbf\u548c\u7075\u6d3b\uff0c\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u9884\u5b9a\u4e49\u7684\n",(0,s.jsx)(e.code,{children:"ACTION"})," \u6b63\u6587\u4e2d\u7684\u7b26\u53f7\uff1a"]}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{style:{textAlign:"left"},children:(0,s.jsx)(e.code,{children:"argK_type"})}),(0,s.jsx)(e.th,{style:{textAlign:"left"},children:"\u6a21\u62df\u51fd\u6570\u7684\u7b2c K \u4e2a\uff08\u4ece 0 \u5f00\u59cb\uff09\u53c2\u6570\u7684\u7c7b\u578b"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.code,{children:"args"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"\u6a21\u62df\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\u4f5c\u4e3a\u5143\u7ec4"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.code,{children:"args_type"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"\u6a21\u62df\u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\u7684\u7c7b\u578b\u4f5c\u4e3a\u5143\u7ec4"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.code,{children:"return_type"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"\u6a21\u62df\u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.code,{children:"function_type"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"\u6a21\u62df\u51fd\u6570\u7684\u7c7b\u578b"})]})]})]}),"\n",(0,s.jsx)(e.p,{children:"\u4f8b\u5982\uff0c\u5f53\u4f7f\u7528\u201cACTION\u201d\u4f5c\u4e3a\u6a21\u62df\u51fd\u6570\u7684\u5b58\u6839\u64cd\u4f5c\u65f6\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"int DoSomething(bool flag, int* ptr);\n"})}),"\n",(0,s.jsx)(e.p,{children:"we have:"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Pre-defined Symbol"}),(0,s.jsx)(e.th,{children:"Is Bound To"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"arg0"})}),(0,s.jsxs)(e.td,{children:["the value of ",(0,s.jsx)(e.code,{children:"flag"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"arg0_type"})}),(0,s.jsxs)(e.td,{children:["the type ",(0,s.jsx)(e.code,{children:"bool"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"arg1"})}),(0,s.jsxs)(e.td,{children:["the value of ",(0,s.jsx)(e.code,{children:"ptr"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"arg1_type"})}),(0,s.jsxs)(e.td,{children:["the type ",(0,s.jsx)(e.code,{children:"int*"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"args"})}),(0,s.jsxs)(e.td,{children:["the tuple ",(0,s.jsx)(e.code,{children:"(flag, ptr)"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"args_type"})}),(0,s.jsxs)(e.td,{children:["the type ",(0,s.jsx)(e.code,{children:"std::tuple<bool, int*>"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"return_type"})}),(0,s.jsxs)(e.td,{children:["the type ",(0,s.jsx)(e.code,{children:"int"})]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"function_type"})}),(0,s.jsxs)(e.td,{children:["the type ",(0,s.jsx)(e.code,{children:"int(bool, int*)"})]})]})]})]}),"\n",(0,s.jsx)(e.h4,{id:"\u4f20\u7edf\u7684\u57fa\u4e8e\u5b8f\u7684\u53c2\u6570\u5316\u64cd\u4f5c",children:"\u4f20\u7edf\u7684\u57fa\u4e8e\u5b8f\u7684\u53c2\u6570\u5316\u64cd\u4f5c"}),"\n",(0,s.jsx)(e.p,{children:"\u6709\u65f6\u60a8\u9700\u8981\u53c2\u6570\u5316\u60a8\u5b9a\u4e49\u7684\u64cd\u4f5c\u3002\u4e3a\u6b64\u6211\u4eec\u6709\n\u53e6\u4e00\u4e2a\u5b8f"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ACTION_P(name, param) { statements; }\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4f8b\u5982\uff0c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ACTION_P(Add, n) { return arg0 + n; }\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5c06\u5141\u8bb8\u4f60\u5199"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"// Returns argument #0 + 5.\n... WillOnce(Add(5));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u4eec\u4f7f\u7528\u672f\u8bed\u201c\u53c2\u6570\u201d\u6765\u8868\u793a\u7528\u4e8e\u8c03\u7528\n\u6a21\u62df\u51fd\u6570\uff0c\u4ee5\u53ca\u7528\u4e8e\u5b9e\u4f8b\u5316\u7684\u503c\u7684\u672f\u8bed\u201c\u53c2\u6570\u201d\n\u884c\u52a8\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u8bf7\u6ce8\u610f\uff0c\u60a8\u4e5f\u4e0d\u9700\u8981\u63d0\u4f9b\u53c2\u6570\u7684\u7c7b\u578b\u3002\u8ba4\u4e3a\n\u53c2\u6570\u540d\u4e3a\u201cparam\u201d\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528kMock\u5b9a\u4e49\u7684\u7b26\u53f7\n",(0,s.jsx)(e.code,{children:"param_type"})," \u6307\u7f16\u8bd1\u5668\u63a8\u65ad\u7684\u53c2\u6570\u7c7b\u578b\u3002\n\u4f8b\u5982\uff0c\u5728\u4e0a\u9762\u7684\u201cACTION_P(Add, n)\u201d\u4e3b\u4f53\u4e2d\uff0c\u60a8\u53ef\u4ee5\u7f16\u5199\u201cn_type\u201d\n",(0,s.jsx)(e.code,{children:"n"})," \u7684\u7c7b\u578b\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["kMock\u8fd8\u63d0\u4f9b",(0,s.jsx)(e.code,{children:"ACTION_P2"}),"\u3001",(0,s.jsx)(e.code,{children:"ACTION_P3"}),"\u7b49\u652f\u6301\u591a\u53c2\u6570\n\u884c\u52a8\u3002\u4f8b\u5982\uff0c"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ACTION_P2(ReturnDistanceTo, x, y) {\n  double dx = arg0 - x;\n  double dy = arg1 - y;\n  return sqrt(dx*dx + dy*dy);\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8ba9\u4f60\u5199"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"... WillOnce(ReturnDistanceTo(5.0, 26.5));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u53ef\u4ee5\u5c06\u201cACTION\u201d\u89c6\u4e3a\u9000\u5316\u7684\u53c2\u6570\u5316\u64cd\u4f5c\uff0c\u5176\u4e2d\n\u53c2\u6570\u4e3a0\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u60a8\u8fd8\u53ef\u4ee5\u8f7b\u677e\u5b9a\u4e49\u5728\u591a\u4e2a\u53c2\u6570\u4e0a\u91cd\u8f7d\u7684\u64cd\u4f5c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ACTION_P(Plus, a) { ... }\nACTION_P2(Plus, a, b) { ... }\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u9650\u5236-action-\u4e2d\u53c2\u6570\u6216\u53c2\u6570\u7684\u7c7b\u578b",children:"\u9650\u5236 ACTION \u4e2d\u53c2\u6570\u6216\u53c2\u6570\u7684\u7c7b\u578b"}),"\n",(0,s.jsx)(e.p,{children:"\u4e3a\u4e86\u6700\u5927\u7a0b\u5ea6\u5730\u7b80\u6d01\u548c\u53ef\u91cd\u7528\u6027\uff0c\u201cACTION*\u201d\u5b8f\u4e0d\u4f1a\u8981\u6c42\u60a8\n\u63d0\u4f9b\u6a21\u62df\u51fd\u6570\u53c2\u6570\u548c\u64cd\u4f5c\u53c2\u6570\u7684\u7c7b\u578b\u3002\n\u76f8\u53cd\uff0c\u6211\u4eec\u8ba9\u7f16\u8bd1\u5668\u4e3a\u6211\u4eec\u63a8\u65ad\u7c7b\u578b\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u7136\u800c\uff0c\u6709\u65f6\u6211\u4eec\u53ef\u80fd\u5e0c\u671b\u66f4\u660e\u786e\u5730\u4e86\u89e3\u7c7b\u578b\u3002\u6709\n\u6709\u51e0\u4e2a\u6280\u5de7\u53ef\u4ee5\u505a\u5230\u8fd9\u4e00\u70b9\u3002\u4f8b\u5982\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ACTION(Foo) {\n  // Makes sure arg0 can be converted to int.\n  int n = arg0;\n  ... use n instead of arg0 here ...\n}\n\nACTION_P(Bar, param) {\n  // Makes sure the type of arg1 is const char*.\n  ::testing::StaticAssertTypeEq<const char*, arg1_type>();\n\n  // Makes sure param can be converted to bool.\n  bool flag = param;\n}\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5176\u4e2d ",(0,s.jsx)(e.code,{children:"StaticAssertTypeEq"})," \u662f googletest \u4e2d\u7684\u7f16\u8bd1\u65f6\u65ad\u8a00\n\u9a8c\u8bc1\u4e24\u4e2a\u7c7b\u578b\u662f\u5426\u76f8\u540c\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"writing-new-action-templates-quickly",children:"Writing New Action Templates Quickly"}),"\n",(0,s.jsxs)(e.p,{children:["\u6709\u65f6\u4f60\u60f3\u7ed9\u4e00\u4e2a\u52a8\u4f5c\u660e\u786e\u7684\u6a21\u677f\u53c2\u6570\uff0c\u4f46\u4e0d\u80fd\n\u4ece\u5176\u503c\u53c2\u6570\u63a8\u65ad\u3002 ",(0,s.jsx)(e.code,{children:"ACTION_TEMPLATE()"})," \u652f\u6301\u8fd9\u4e00\u70b9\u5e76\u4e14\u53ef\u4ee5\n\u88ab\u89c6\u4e3a\u201cACTION()\u201d\u548c\u201cACTION_P*()\u201d\u7684\u6269\u5c55\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u8bed\u6cd5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ACTION_TEMPLATE(ActionName,\n                HAS_m_TEMPLATE_PARAMS(kind1, name1, ..., kind_m, name_m),\n                AND_n_VALUE_PARAMS(p1, ..., p_n)) { statements; }\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5b9a\u4e49\u4e00\u4e2a\u64cd\u4f5c\u6a21\u677f\uff0c\u5b83\u91c7\u7528 ",(0,s.jsx)(e.em,{children:"m"})," \u4e2a\u663e\u5f0f\u6a21\u677f\u53c2\u6570\u548c ",(0,s.jsx)(e.em,{children:"n"})," \u4e2a\n\u503c\u53c2\u6570\uff0c\u5176\u4e2d ",(0,s.jsx)(e.em,{children:"m"})," \u4f4d\u4e8e [1, 10] \u4e2d\uff0c",(0,s.jsx)(e.em,{children:"n"})," \u4f4d\u4e8e [0, 10] \u4e2d\u3002 ",(0,s.jsx)(e.code,{children:"name_i"})," \u662f\n\u7b2c ",(0,s.jsx)(e.em,{children:"i"})," \u4e2a\u6a21\u677f\u53c2\u6570\u7684\u540d\u79f0\uff0c\u201ckind_i\u201d\u6307\u5b9a\u5b83\u662f\u5426\u662f\n",(0,s.jsx)(e.code,{children:"typename"}),"\uff0c\u4e00\u4e2a\u6574\u578b\u5e38\u91cf\uff0c\u6216\u8005\u4e00\u4e2a\u6a21\u677f\u3002 ",(0,s.jsx)(e.code,{children:"p_i"})," \u662f\u7b2c ",(0,s.jsx)(e.em,{children:"i"})," \u4e2a\u7684\u540d\u79f0\n\u503c\u53c2\u6570\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u4f8b\u5b50\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"// DuplicateArg<k, T>(output) converts the k-th argument of the mock\n// function to type T and copies it to *output.\nACTION_TEMPLATE(DuplicateArg,\n                // Note the comma between int and k:\n                HAS_2_TEMPLATE_PARAMS(int, k, typename, T),\n                AND_1_VALUE_PARAMS(output)) {\n  *output = T(std::get<k>(args));\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u8981\u521b\u5efa\u64cd\u4f5c\u6a21\u677f\u7684\u5b9e\u4f8b\uff0c\u8bf7\u7f16\u5199\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ActionName<t1, ..., t_m>(v1, ..., v_n)\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5176\u4e2d\u201ct\u201d\u662f\u6a21\u677f\u53c2\u6570\uff0c\u201cv\u201d\u662f\u503c\u53c2\u6570\u3002\n\u503c\u53c2\u6570\u7c7b\u578b\u7531\u7f16\u8bd1\u5668\u63a8\u65ad\u3002\u4f8b\u5982\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\n...\n  int n;\n  EXPECT_CALL(mock, Foo).WillOnce(DuplicateArg<1, unsigned char>(&n));\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u60a8\u60f3\u663e\u5f0f\u6307\u5b9a\u503c\u53c2\u6570\u7c7b\u578b\uff0c\u60a8\u53ef\u4ee5\u63d0\u4f9b\n\u9644\u52a0\u6a21\u677f\u53c2\u6570\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"ActionName<t1, ..., t_m, u1, ..., u_k>(v1, ..., v_n)\n"})}),"\n",(0,s.jsxs)(e.p,{children:["where ",(0,s.jsx)(e.code,{children:"u_i"})," is the desired type of ",(0,s.jsx)(e.code,{children:"v_i"}),"."]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"ACTION_TEMPLATE"})," \u548c ",(0,s.jsx)(e.code,{children:"ACTION"}),"/",(0,s.jsx)(e.code,{children:"ACTION_P*"})," \u53ef\u4ee5\u5728\u6570\u91cf\u4e0a\u91cd\u8f7d\nvalue \u53c2\u6570\uff0c\u4f46\u4e0d\u5f71\u54cd\u6a21\u677f\u53c2\u6570\u7684\u6570\u91cf\u3002\u5982\u679c\u6ca1\u6709\n\u9650\u5236\uff0c\u4ee5\u4e0b\u542b\u4e49\u4e0d\u6e05\u695a\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  OverloadedAction<int, bool>(x);\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u6211\u4eec\u662f\u5426\u4f7f\u7528\u5355\u6a21\u677f\u53c2\u6570\u64cd\u4f5c\uff0c\u5176\u4e2d\u201cbool\u201d\u6307\u7684\u662f\u7c7b\u578b\n",(0,s.jsx)(e.code,{children:"x"})," \u7684\uff0c\u6216\u8005\u8981\u6c42\u7f16\u8bd1\u5668\u63a8\u65ad\u7684\u4e24\u4e2a\u6a21\u677f\u53c2\u6570\u64cd\u4f5c\n",(0,s.jsx)(e.code,{children:"x"})," \u7684\u7c7b\u578b\uff1f"]}),"\n",(0,s.jsx)(e.h3,{id:"using-the-action-objects-type",children:"Using the ACTION Object's Type"}),"\n",(0,s.jsx)(e.p,{children:"\u5982\u679c\u60a8\u6b63\u5728\u7f16\u5199\u4e00\u4e2a\u8fd4\u56de\u201cACTION\u201d\u5bf9\u8c61\u7684\u51fd\u6570\uff0c\u5219\u9700\u8981\n\u77e5\u9053\u5b83\u7684\u7c7b\u578b\u3002\u7c7b\u578b\u53d6\u51b3\u4e8e\u7528\u4e8e\u5b9a\u4e49\u64cd\u4f5c\u7684\u5b8f\u548c\n\u53c2\u6570\u7c7b\u578b\u3002\u89c4\u5219\u76f8\u5bf9\u7b80\u5355\uff1a"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Given Definition"}),(0,s.jsx)(e.th,{children:"Expression"}),(0,s.jsx)(e.th,{children:"Has Type"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"ACTION(Foo)"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"Foo()"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"FooAction"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"ACTION_TEMPLATE(Foo, HAS_m_TEMPLATE_PARAMS(...), AND_0_VALUE_PARAMS())"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"Foo<t1, ..., t_m>()"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"FooAction<t1, ..., t_m>"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"ACTION_P(Bar, param)"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"Bar(int_value)"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"BarActionP<int>"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"ACTION_TEMPLATE(Bar, HAS_m_TEMPLATE_PARAMS(...), AND_1_VALUE_PARAMS(p1))"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"Bar<t1, ..., t_m>(int_value)"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"BarActionP<t1, ..., t_m, int>"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"ACTION_P2(Baz, p1, p2)"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"Baz(bool_value, int_value)"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"BazActionP2<bool, int>"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"ACTION_TEMPLATE(Baz, HAS_m_TEMPLATE_PARAMS(...), AND_2_VALUE_PARAMS(p1, p2))"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"Baz<t1, ..., t_m>(bool_value, int_value)"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"BazActionP2<t1, ..., t_m, bool, int>"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"..."}),(0,s.jsx)(e.td,{children:"..."}),(0,s.jsx)(e.td,{children:"..."})]})]})]}),"\n",(0,s.jsx)(e.p,{children:"\u8bf7\u6ce8\u610f\uff0c\u6211\u4eec\u5fc5\u987b\u9009\u62e9\u4e0d\u540c\u7684\u540e\u7f00\uff08\u201cAction\u201d\u3001\u201cActionP\u201d\u3001\u201cActionP2\u201d\u3001\n\u7b49\u7b49\uff09\u5bf9\u4e8e\u5177\u6709\u4e0d\u540c\u6570\u91cf\u503c\u53c2\u6570\u7684\u64cd\u4f5c\uff0c\u6216\u8005\u64cd\u4f5c\n\u5b9a\u4e49\u7684\u6570\u91cf\u4e0d\u80fd\u8fc7\u591a\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"NewMonoActions",children:"\u7f16\u5199\u65b0\u7684\u5355\u6001\u52a8\u4f5c"}),"\n",(0,s.jsx)(e.p,{children:"\u867d\u7136\u201cACTION*\u201d\u5b8f\u975e\u5e38\u65b9\u4fbf\uff0c\u4f46\u6709\u65f6\u5b83\u4eec\n\u4e0d\u5f53\u3002\u4f8b\u5982\uff0c\u5c3d\u7ba1\u524d\u9762\u7684\u98df\u8c31\u4e2d\u5c55\u793a\u4e86\u4e00\u4e9b\u6280\u5de7\uff0c\n\u5b83\u4eec\u4e0d\u5141\u8bb8\u60a8\u76f4\u63a5\u6307\u5b9a\u6a21\u62df\u51fd\u6570\u53c2\u6570\u7684\u7c7b\u578b\u5e76\u4e14\n\u64cd\u4f5c\u53c2\u6570\uff0c\u8fd9\u901a\u5e38\u4f1a\u5bfc\u81f4\u672a\u4f18\u5316\u7684\u7f16\u8bd1\u5668\u9519\u8bef\n\u53ef\u80fd\u4f1a\u8ba9\u4e0d\u719f\u6089\u7684\u7528\u6237\u611f\u5230\u56f0\u60d1\u7684\u6d88\u606f\u3002\u4ed6\u4eec\u4e5f\u4e0d\u5141\u8bb8\u8d85\u8f7d\n\u57fa\u4e8e\u53c2\u6570\u7c7b\u578b\u7684\u64cd\u4f5c\uff0c\u65e0\u9700\u8df3\u8fc7\u4e00\u4e9b\u73af\u8282\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"ACTION*"})," \u5b8f\u7684\u66ff\u4ee3\u65b9\u6cd5\u662f\u5b9e\u73b0\n",(0,s.jsx)(e.code,{children:"::testing::ActionInterface<F>"}),"\uff0c\u5176\u4e2d ",(0,s.jsx)(e.code,{children:"F"})," \u662f\u6a21\u62df\u51fd\u6570\u7684\u7c7b\u578b\n\u5c06\u4f7f\u7528\u8be5\u64cd\u4f5c\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"template <typename F>\nclass ActionInterface {\n public:\n  virtual ~ActionInterface();\n\n  // Performs the action.  Result is the return type of function type\n  // F, and ArgumentTuple is the tuple of arguments of F.\n  //\n\n  // For example, if F is int(bool, const string&), then Result would\n  // be int, and ArgumentTuple would be std::tuple<bool, const string&>.\n  virtual Result Perform(const ArgumentTuple& args) = 0;\n};\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::_;\nusing ::testing::Action;\nusing ::testing::ActionInterface;\nusing ::testing::MakeAction;\n\ntypedef int IncrementMethod(int*);\n\nclass IncrementArgumentAction : public ActionInterface<IncrementMethod> {\n public:\n  int Perform(const std::tuple<int*>& args) override {\n    int* p = std::get<0>(args);  // Grabs the first argument.\n    return *p++;\n  }\n};\n\nAction<IncrementMethod> IncrementArgument() {\n  return MakeAction(new IncrementArgumentAction);\n}\n\n...\n  EXPECT_CALL(foo, Baz(_))\n      .WillOnce(IncrementArgument());\n\n  int n = 5;\n  foo.Baz(&n);  // Should return 5 and change n to 6.\n"})}),"\n",(0,s.jsx)(e.h3,{id:"NewPolyActions",children:"\u7f16\u5199\u65b0\u7684\u591a\u6001\u52a8\u4f5c"}),"\n",(0,s.jsxs)(e.p,{children:["\u524d\u9762\u7684\u98df\u8c31\u5411\u60a8\u5c55\u793a\u4e86\u5982\u4f55\u5b9a\u4e49\u81ea\u5df1\u7684\u64cd\u4f5c\u3002\u8fd9\u4e00\u5207\u90fd\u5f88\u597d\uff0c\n\u53ea\u4e0d\u8fc7\u60a8\u9700\u8981\u77e5\u9053\u8be5\u64cd\u4f5c\u5c06\u5728\u5176\u4e2d\u6267\u884c\u7684\u51fd\u6570\u7684\u7c7b\u578b\n\u88ab\u4f7f\u7528\u3002\u6709\u65f6\u8fd9\u53ef\u80fd\u662f\u4e00\u4e2a\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u60f3\u4f7f\u7528\n\u5177\u6709",(0,s.jsx)(e.em,{children:"\u4e0d\u540c"}),"\u7c7b\u578b\u7684\u51fd\u6570\u4e2d\u7684\u64cd\u4f5c\uff08\u4f8b\u5982\u201cReturn()\u201d\u548c\n",(0,s.jsx)(e.code,{children:"SetArgPointee()"}),")\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u4e00\u4e2a\u52a8\u4f5c\u53ef\u4ee5\u5728\u591a\u79cd\u7c7b\u578b\u7684\u6a21\u62df\u51fd\u6570\u4e2d\u4f7f\u7528\uff0c\u6211\u4eec\u8bf4\u5b83\u662f\n",(0,s.jsx)(e.em,{children:"\u591a\u6001"}),"\u3002 ",(0,s.jsx)(e.code,{children:"MakePolymorphicAction()"})," \u51fd\u6570\u6a21\u677f\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\n\u5b9a\u4e49\u8fd9\u6837\u4e00\u4e2a\u52a8\u4f5c\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"namespace testing {\ntemplate <typename Impl>\nPolymorphicAction<Impl> MakePolymorphicAction(const Impl& impl);\n}  // namespace testing\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4f5c\u4e3a\u793a\u4f8b\uff0c\u8ba9\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u8fd4\u56de\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7684\u64cd\u4f5c\n\u6a21\u62df\u51fd\u6570\u7684\u53c2\u6570\u5217\u8868\u3002\u7b2c\u4e00\u6b65\u662f\u5b9a\u4e49\u4e00\u4e2a\u5b9e\u73b0\n\u73ed\u7ea7\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"class ReturnSecondArgumentAction {\n public:\n  template <typename Result, typename ArgumentTuple>\n  Result Perform(const ArgumentTuple& args) const {\n    // To get the i-th (0-based) argument, use std::get(args).\n    return std::get<1>(args);\n  }\n};\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8be5\u5b9e\u73b0\u7c7b",(0,s.jsx)(e.em,{children:"\u4e0d\u9700\u8981"}),"\u9700\u8981\u4ece\u4efb\u4f55\u7279\u5b9a\u7c7b\u7ee7\u627f\u3002\n\u91cd\u8981\u7684\u662f\u5b83\u5fc5\u987b\u6709\u4e00\u4e2a",(0,s.jsx)(e.code,{children:"Perform()"}),"\u65b9\u6cd5\u6a21\u677f\u3002\u8fd9\u4e2a\u65b9\u6cd5\n\u6a21\u677f\u5c06\u6a21\u62df\u51fd\u6570\u7684\u53c2\u6570\u4f5c\u4e3a ",(0,s.jsx)(e.strong,{children:"single"})," \u4e2d\u7684\u5143\u7ec4\n\u53c2\u6570\uff0c\u5e76\u8fd4\u56de\u64cd\u4f5c\u7684\u7ed3\u679c\u3002\u5b83\u53ef\u4ee5\u662f ",(0,s.jsx)(e.code,{children:"const"})," \u4e5f\u53ef\u4ee5\u4e0d\u662f\uff0c\n\u4f46\u5fc5\u987b\u53ea\u80fd\u4f7f\u7528\u4e00\u4e2a\u6a21\u677f\u53c2\u6570\u6765\u8c03\u7528\uff0c\u8fd9\u5c31\u662f\u7ed3\u679c\n\u7c7b\u578b\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u60a8\u5fc5\u987b\u80fd\u591f\u8c03\u7528",(0,s.jsx)(e.code,{children:"Perform<R>(args)"}),"\uff0c\u5176\u4e2d",(0,s.jsx)(e.code,{children:"R"}),"\u662f\n\u6a21\u62df\u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b\uff0c",(0,s.jsx)(e.code,{children:"args"}),"\u662f\u5143\u7ec4\u4e2d\u7684\u53c2\u6570\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4f7f\u7528 MakePolymorphicAction() \u6765\u8f6c\u6362\u5b9e\u73b0\u7684\u5b9e\u4f8b\n\u7c7b\u5230\u6211\u4eec\u9700\u8981\u7684\u591a\u6001\u52a8\u4f5c\u4e2d\u3002\u62e5\u6709\u4e00\u4e2a\u4f1a\u5f88\u65b9\u4fbf\n\u5bf9\u6b64\u7684\u5305\u88c5\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"using ::testing::MakePolymorphicAction;\nusing ::testing::PolymorphicAction;\n\nPolymorphicAction<ReturnSecondArgumentAction> ReturnSecondArgument() {\n  return MakePolymorphicAction(ReturnSecondArgumentAction());\n}\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u73b0\u5728\uff0c\u60a8\u53ef\u4ee5\u50cf\u4f7f\u7528\u5185\u7f6e\u64cd\u4f5c\u4e00\u6837\u4f7f\u7528\u6b64\u591a\u6001\u64cd\u4f5c\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'using ::testing::_;\n\nclass MockFoo : public Foo {\n public:\n  MOCK_METHOD(int, DoThis, (bool flag, int n), (override));\n  MOCK_METHOD(string, DoThat, (int x, const char* str1, const char* str2),\n              (override));\n};\n\n  ...\n  MockFoo foo;\n  EXPECT_CALL(foo, DoThis).WillOnce(ReturnSecondArgument());\n  EXPECT_CALL(foo, DoThat).WillOnce(ReturnSecondArgument());\n  ...\n  foo.DoThis(true, 5);  // Will return 5.\n  foo.DoThat(1, "Hi", "Bye");  // Will return "Hi".\n'})}),"\n",(0,s.jsx)(e.h3,{id:"teaching-kmock-how-to-print-your-values",children:"Teaching kMock How to Print Your Values"}),"\n",(0,s.jsxs)(e.p,{children:["\u5f53\u53d1\u751f\u65e0\u8da3\u6216\u610f\u5916\u7684\u8c03\u7528\u65f6\uff0ckMock \u4f1a\u6253\u5370\u53c2\u6570\n\u503c\u548c\u5806\u6808\u8ddf\u8e2a\u6765\u5e2e\u52a9\u60a8\u8c03\u8bd5\u3002\u65ad\u8a00\u5b8f\u5982\n",(0,s.jsx)(e.code,{children:"EXPECT_THAT"})," \u548c ",(0,s.jsx)(e.code,{children:"EXPECT_EQ"})," \u4e5f\u4f1a\u5728\n\u65ad\u8a00\u5931\u8d25\u3002 kMock \u548c googletest \u4f7f\u7528 googletest \u7684\u7528\u6237\u53ef\u6269\u5c55\u6765\u505a\u5230\u8fd9\u4e00\u70b9\n\u4ef7\u503c\u6253\u5370\u673a\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u8be5\u6253\u5370\u673a\u77e5\u9053\u5982\u4f55\u6253\u5370\u5185\u7f6e C++ \u7c7b\u578b\u3001\u672c\u673a\u6570\u7ec4\u3001STL\n\u5bb9\u5668\u4ee5\u53ca\u4efb\u4f55\u652f\u6301 ",(0,s.jsx)(e.code,{children:"<<"})," \u8fd0\u7b97\u7b26\u7684\u7c7b\u578b\u3002\u5bf9\u4e8e\u5176\u4ed6\u7c7b\u578b\uff0c\u5b83\n\u6253\u5370\u503c\u4e2d\u7684\u539f\u59cb\u5b57\u8282\uff0c\u5e76\u5e0c\u671b\u7528\u6237\u80fd\u591f\u5f04\u6e05\u695a\u3002\n",(0,s.jsx)(e.a,{href:"/docs/next/cpp/base/testing/kt/advanced#teaching-kumotest-how-to-print-your-values",children:"KumoTest \u9ad8\u7ea7\u6307\u5357"}),"\n\u89e3\u91ca\u5982\u4f55\u6269\u5c55\u6253\u5370\u673a\u4ee5\u66f4\u597d\u5730\u6253\u5370\u60a8\u7684\u5185\u5bb9\n\u7279\u5b9a\u7c7b\u578b\u800c\u4e0d\u662f\u8f6c\u50a8\u5b57\u8282\u3002"]}),"\n",(0,s.jsx)(e.h2,{id:"useful-mocks-created-using-kmock",children:"\u4f7f\u7528 kMock \u521b\u5efa\u6709\u7528\u7684\u6a21\u62df"}),"\n",(0,s.jsx)(e.h3,{id:"MockFunction",children:"Mock std::function"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"std::function"})," \u662f C++11 \u4e2d\u5f15\u5165\u7684\u901a\u7528\u51fd\u6570\u7c7b\u578b\u3002\u5b83\u662f\u4e00\u4e2a\n\u5c06\u56de\u8c03\u4f20\u9012\u7ed9\u65b0\u63a5\u53e3\u7684\u9996\u9009\u65b9\u5f0f\u3002\u51fd\u6570\u662f\u53ef\u590d\u5236\u7684\uff0c\n\u5e76\u4e14\u901a\u5e38\u4e0d\u901a\u8fc7\u6307\u9488\u4f20\u9012\uff0c\u8fd9\u4f7f\u5f97\u5b83\u4eec\u5f88\u96be\u6a21\u62df\u3002\n\u4f46\u4e0d\u8981\u62c5\u5fc3 - ",(0,s.jsx)(e.code,{children:"MockFunction"})," \u53ef\u4ee5\u5e2e\u52a9\u4f60\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"MockFunction<R(T1, ..., Tn)>"})," \u6709\u4e00\u4e2a\u6a21\u62df\u65b9\u6cd5 ",(0,s.jsx)(e.code,{children:"Call()"})," \uff0c\u5176\u7b7e\u540d\u4e3a\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  R Call(T1, ..., Tn);\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5b83\u8fd8\u6709\u4e00\u4e2a ",(0,s.jsx)(e.code,{children:"AsStdFunction()"})," \u65b9\u6cd5\uff0c\u5b83\u521b\u5efa\u4e00\u4e2a ",(0,s.jsx)(e.code,{children:"std::function"})," \u4ee3\u7406\n\u8f6c\u63a5\u81f3\u547c\u53eb\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:"  std::function<R(T1, ..., Tn)> AsStdFunction();\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8981\u4f7f\u7528",(0,s.jsx)(e.code,{children:"MockFunction"}),"\uff0c\u9996\u5148\u521b\u5efa",(0,s.jsx)(e.code,{children:"MockFunction"}),"\u5bf9\u8c61\u5e76\u8bbe\u7f6e\n\u5bf9\u5176\u201cCall\u201d\u65b9\u6cd5\u7684\u671f\u671b\u3002\u7136\u540e\u4f20\u9012\u4ece\u83b7\u53d6\u7684\u4ee3\u7406\n\u5c06\u201cAsStdFunction()\u201d\u6dfb\u52a0\u5230\u60a8\u6b63\u5728\u6d4b\u8bd5\u7684\u4ee3\u7801\u4e2d\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",children:'TEST(FooTest, RunsCallbackWithBarArgument) {\n  // 1. Create a mock object.\n  MockFunction<int(string)> mock_function;\n\n  // 2. Set expectations on Call() method.\n  EXPECT_CALL(mock_function, Call("bar")).WillOnce(Return(1));\n\n  // 3. Exercise code that uses std::function.\n  Foo(mock_function.AsStdFunction());\n  // Foo\'s signature can be either of:\n  // void Foo(const std::function<int(string)>& fun);\n  // void Foo(std::function<int(string)> fun);\n\n  // 4. All expectations will be verified when mock_function\n  //     goes out of scope and is destroyed.\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u8bf7\u8bb0\u4f4f\uff0c\u4f7f\u7528 AsStdFunction() \u521b\u5efa\u7684\u51fd\u6570\u5bf9\u8c61\u53ea\u662f\n\u8d27\u8fd0\u4ee3\u7406\u3002\u5982\u679c\u60a8\u521b\u5efa\u591a\u4e2a\uff0c\u5b83\u4eec\u5c06\u5171\u4eab\u540c\u4e00\u7ec4\n\u671f\u671b\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u867d\u7136 ",(0,s.jsx)(e.code,{children:"std::function"})," \u652f\u6301\u65e0\u9650\u6570\u91cf\u7684\u53c2\u6570\uff0c\u4f46 ",(0,s.jsx)(e.code,{children:"MockFunction"}),"\n\u5b9e\u65bd\u4ec5\u9650\u4e8e\u5341\u4e2a\u3002\u5982\u679c\u4f60\u8fbe\u5230\u4e86\u8fd9\u4e2a\u6781\u9650......\u597d\u5427\uff0c\u4f60\u7684\n\u56de\u8c03\u6709\u6bd4\u53ef\u6a21\u62df\u66f4\u5927\u7684\u95ee\u9898\u3002 :-)"]})]})}function h(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},28453:(n,e,c)=>{c.d(e,{R:()=>r,x:()=>o});var s=c(96540);const i={},l=s.createContext(i);function r(n){const e=s.useContext(l);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),s.createElement(l.Provider,{value:e},n.children)}}}]);