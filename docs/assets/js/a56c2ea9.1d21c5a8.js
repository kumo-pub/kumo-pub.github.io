(self.webpackChunkkumo_website=self.webpackChunkkumo_website||[]).push([[52869],{52953:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/kthread_jump_fcontext.d34f2a5.640.png 640w,"+n.p+"assets/ideal-img/kthread_jump_fcontext.21e07f5.1030.png 1030w",images:[{path:n.p+"assets/ideal-img/kthread_jump_fcontext.d34f2a5.640.png",width:640,height:235},{path:n.p+"assets/ideal-img/kthread_jump_fcontext.21e07f5.1030.png",width:1030,height:379}],src:n.p+"assets/ideal-img/kthread_jump_fcontext.d34f2a5.640.png",toString:function(){return n.p+"assets/ideal-img/kthread_jump_fcontext.d34f2a5.640.png"},placeholder:void 0,width:640,height:235},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlUlEQVR4nC3OsQpCIRSAYSnu1tBS0dgj9A7trdHQKD1G1NwgPUE0G9xnyWe4NChHFDU9hnGg7f+2nzHGGADcrLV7amPM3Tm3pdZab4wxD6XUhNwh4oCIVwIi5pTSibqUcqy1fqWUS/I4xvgKIZwJtdYPAFyoc86HlNJbSjknz4QQ677vF5zzznv/tNbu/ktTAFi11kY/sIlafdVh9KQAAAAASUVORK5CYII="}},74527:(e,t,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/kthread_make_fcontext.0329857.640.png 640w,"+n.p+"assets/ideal-img/kthread_make_fcontext.4fe5fa7.1030.png 1030w",images:[{path:n.p+"assets/ideal-img/kthread_make_fcontext.0329857.640.png",width:640,height:637},{path:n.p+"assets/ideal-img/kthread_make_fcontext.4fe5fa7.1030.png",width:1030,height:1026}],src:n.p+"assets/ideal-img/kthread_make_fcontext.0329857.640.png",toString:function(){return n.p+"assets/ideal-img/kthread_make_fcontext.0329857.640.png"},placeholder:void 0,width:640,height:637},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAABD0lEQVR4nFWPPWqEQBTHH5uFTQxJFRPSSqocQMgNcoAIgeyuuYAXSOM98tnbW2uTPpWFlY2CrDqKOjvjKBOeuLBWvwfvz/8DAACklCfIpmkehRB/QohfIUTAGHub/gskmKZ5isyy7FVKKSmlHDkMw8dMaFnWCpmmqYkCQsge2XXd+0x4iC6KYoMCxtjoWNf19/EfPM9bTh03QgiZ5/kobNv2a+aoquodAFz1fb9OkkT6vs8ppRj9ORNqmnYNABec820URdJ1XV7XNZpix5Wu65ezjpTSNSFExnE8jmGMjWMO1ZaGYZzhUVXVdlrbTR1/jo1uFEW5BYBzx3Huy7J8DsPwabfbvQRB8IDRtm0v/gET+trwq9Z9BwAAAABJRU5ErkJggg=="}},98925:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>j,contentTitle:()=>h,default:()=>f,frontMatter:()=>c,metadata:()=>a,toc:()=>o});var l=n(74848),s=n(28453),r=n(74527),d=n.n(r),i=n(52953),x=n.n(i);const c={weight:2},h="kthread\u673a\u5236",a={id:"cpp/kthread/kthread",title:"kthread\u673a\u5236",description:"\u4e3a\u4e86\u5b9e\u73b0\u534f\u7a0b\u9700\u8981\u534f\u7a0b\u6808\u3001\u534f\u7a0b\u7684\u521d\u59cb\u5316\uff0c\u4ee5\u53ca\u534f\u7a0b\u95f4\u7684\u5207\u6362\uff0c\u63a5\u4e0b\u6765\u9010\u4e00\u5206\u6790\u4e00\u4e0b\u8fd9\u51e0\u4e2a\u8fc7\u7a0b\u3002\u5728\u5206\u6790\u4e4b\u524d\u9700\u8981\u9996\u5148\u8865\u5145\u4e00\u70b9\u6c47\u7f16\u77e5\u8bc6\u4ee5\u65b9\u4fbf\u6211\u4eec\u9605\u8bfb\u5176\u4e2d\u7684\u6c47\u7f16\u4ee3\u7801\u3002",source:"@site/versioned_docs/version-1.1.1/cpp/kthread/kthread.mdx",sourceDirName:"cpp/kthread",slug:"/cpp/kthread/",permalink:"/docs/cpp/kthread/",draft:!1,unlisted:!1,tags:[],version:"1.1.1",frontMatter:{weight:2},sidebar:"docs",previous:{title:"\u539f\u5b50\u64cd\u4f5c\u7684\u5371\u9669",permalink:"/docs/cpp/kthread/atomic_danger"},next:{title:"kthread\u8c03\u5ea6\u6267\u884c\u6d41\u7a0b",permalink:"/docs/cpp/kthread/kthread_schedule"}},j={},o=[{value:"\u57fa\u7840\u6c47\u7f16\u77e5\u8bc6",id:"\u57fa\u7840\u6c47\u7f16\u77e5\u8bc6",level:2},{value:"AT&amp;T\u98ce\u683c\u7684\u6c47\u7f16\u8bed\u8a00",id:"att\u98ce\u683c\u7684\u6c47\u7f16\u8bed\u8a00",level:3},{value:"\u51fd\u6570\u7684\u8c03\u7528\u7ea6\u5b9a",id:"\u51fd\u6570\u7684\u8c03\u7528\u7ea6\u5b9a",level:3},{value:"\u8c03\u7528\u51fd\u6570\u524d",id:"\u8c03\u7528\u51fd\u6570\u524d",level:3},{value:"x86_64\u542b\u670916\u4e2a64\u4f4d\u6574\u6570\u5bc4\u5b58\u5668",id:"x86_64\u542b\u670916\u4e2a64\u4f4d\u6574\u6570\u5bc4\u5b58\u5668",level:3},{value:"\u534f\u7a0b\u6808\u7684\u7ed3\u6784",id:"\u534f\u7a0b\u6808\u7684\u7ed3\u6784",level:2},{value:"\u534f\u7a0b\u6808",id:"\u534f\u7a0b\u6808",level:3},{value:"\u534f\u7a0b\u7684\u521d\u59cb\u5316",id:"\u534f\u7a0b\u7684\u521d\u59cb\u5316",level:3},{value:"\u4ee3\u7801\u4e2d\u7684\u6c47\u7f16\u6307\u4ee4\u89e3\u91ca",id:"\u4ee3\u7801\u4e2d\u7684\u6c47\u7f16\u6307\u4ee4\u89e3\u91ca",level:4},{value:"\u534f\u7a0b\u7684\u5207\u6362\u90e8\u5206",id:"\u534f\u7a0b\u7684\u5207\u6362\u90e8\u5206",level:3},{value:"\u4ee3\u7801\u4e2d\u7684\u6c47\u7f16\u6307\u4ee4\u89e3\u91ca",id:"\u4ee3\u7801\u4e2d\u7684\u6c47\u7f16\u6307\u4ee4\u89e3\u91ca-1",level:4}];function p(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.header,{children:(0,l.jsx)(t.h1,{id:"kthread\u673a\u5236",children:"kthread\u673a\u5236"})}),"\n",(0,l.jsx)(t.p,{children:"\u4e3a\u4e86\u5b9e\u73b0\u534f\u7a0b\u9700\u8981\u534f\u7a0b\u6808\u3001\u534f\u7a0b\u7684\u521d\u59cb\u5316\uff0c\u4ee5\u53ca\u534f\u7a0b\u95f4\u7684\u5207\u6362\uff0c\u63a5\u4e0b\u6765\u9010\u4e00\u5206\u6790\u4e00\u4e0b\u8fd9\u51e0\u4e2a\u8fc7\u7a0b\u3002\u5728\u5206\u6790\u4e4b\u524d\u9700\u8981\u9996\u5148\u8865\u5145\u4e00\u70b9\u6c47\u7f16\u77e5\u8bc6\u4ee5\u65b9\u4fbf\u6211\u4eec\u9605\u8bfb\u5176\u4e2d\u7684\u6c47\u7f16\u4ee3\u7801\u3002"}),"\n",(0,l.jsx)(t.h2,{id:"\u57fa\u7840\u6c47\u7f16\u77e5\u8bc6",children:"\u57fa\u7840\u6c47\u7f16\u77e5\u8bc6"}),"\n",(0,l.jsx)(t.p,{children:"\u9996\u5148\u8bed\u6cd5\u4e60\u60ef\uff0c\u4ee3\u7801\u4e2d\u7684\u662fAT&T\u98ce\u683c\u7684\u6c47\u7f16\u8bed\u8a00\uff0cgdb\u770b\u53cd\u6c47\u7f16\u9ed8\u8ba4\u7684\u98ce\u683c\u4e5f\u662fAT&T\u3002"}),"\n",(0,l.jsx)(t.h3,{id:"att\u98ce\u683c\u7684\u6c47\u7f16\u8bed\u8a00",children:"AT&T\u98ce\u683c\u7684\u6c47\u7f16\u8bed\u8a00"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"\u7acb\u5373\u6570\uff1a$ \u5f00\u5934"}),"\n",(0,l.jsx)(t.li,{children:"\u5bc4\u5b58\u5668\uff1a% \u5f00\u5934"}),"\n",(0,l.jsx)(t.li,{children:"\u53d6\u5730\u5740\u91cc\u9762\u7684\u503c\uff1a\u504f\u79fb\u91cf(%\u5bc4\u5b58\u5668\uff09"}),"\n",(0,l.jsx)(t.li,{children:"\u6574\u5f62\u64cd\u4f5c\u901a\u7528\u540e\u7f00\uff1a[B] Byte\u3001[W] Word 2Byte\u3001[L] Long 4Byte\u3001[Q] QuadWord 8Byte"}),"\n",(0,l.jsx)(t.li,{children:"\u6d6e\u70b9\u64cd\u4f5c\u901a\u7528\u540e\u7f00\uff1a[S] Singled 4\u3001[D] Double 8\u3001[T] Extended 16\uff08\u4fee\u9970\u7cbe\u5ea6: precision\uff09"}),"\n"]}),"\n",(0,l.jsx)(t.h3,{id:"\u51fd\u6570\u7684\u8c03\u7528\u7ea6\u5b9a",children:"\u51fd\u6570\u7684\u8c03\u7528\u7ea6\u5b9a"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"\u6574\u578b\u53c2\u6570\u4f9d\u6b21\u5b58\u653e\u5728 %rdi\u3001%rsi\u3001%rdx\u3001%rcx\u3001%8\u3001%9"}),"\n",(0,l.jsx)(t.li,{children:"\u6d6e\u70b9\u53c2\u6570\u4f9d\u6b21\u5b58\u653e\u5728%xmm0 - %xmm7\u4e2d"}),"\n",(0,l.jsx)(t.li,{children:"\u5bc4\u5b58\u5668\u4e0d\u591f\u7528\u65f6\uff0c\u53c2\u6570\u653e\u5230\u6808\u4e2d"}),"\n",(0,l.jsx)(t.li,{children:"\u88ab\u8c03\u7528\u7684\u51fd\u6570\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u5bc4\u5b58\u5668\uff0c\u4f46\u5b83\u5fc5\u987b\u4fdd\u8bc1%rbx\u3001%rbp\u3001%rsp\u548c%12-%15\u6062\u590d\u5230\u539f\u6765\u7684\u503c"}),"\n",(0,l.jsx)(t.li,{children:"\u8fd4\u56de\u503c\u5b58\u653e\u5728%rax\u4e2d"}),"\n"]}),"\n",(0,l.jsx)(t.h3,{id:"\u8c03\u7528\u51fd\u6570\u524d",children:"\u8c03\u7528\u51fd\u6570\u524d"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"\u8c03\u7528\u65b9\u8981\u5c06\u53c2\u6570\u653e\u5230\u5bc4\u5b58\u5668\u4e2d"}),"\n",(0,l.jsx)(t.li,{children:"\u7136\u540e\u628a%10\u3001%11\u7684\u503c\u4fdd\u5b58\u5230\u6808\u4e2d"}),"\n",(0,l.jsx)(t.li,{children:"\u7136\u540e\u8c03\u7528call \u8df3\u8f6c\u5230\u51fd\u6570\u6267\u884c"}),"\n",(0,l.jsx)(t.li,{children:"\u8fd4\u56de\u540e\uff0c\u6062\u590d%10\u3001%11"}),"\n",(0,l.jsx)(t.li,{children:"\u4ece%eax\u4e2d\u53d6\u51fa\u8fd4\u56de\u503c"}),"\n"]}),"\n",(0,l.jsx)(t.h3,{id:"x86_64\u542b\u670916\u4e2a64\u4f4d\u6574\u6570\u5bc4\u5b58\u5668",children:"x86_64\u542b\u670916\u4e2a64\u4f4d\u6574\u6570\u5bc4\u5b58\u5668"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"%rsi\u3001%rdi \u7528\u4e8e\u5b57\u7b26\u4e32\u5904\u7406"}),"\n",(0,l.jsx)(t.li,{children:"%rsp\u3001%rbp \u6808\u76f8\u5173\uff0c\u6808\u4ece\u9ad8\u5730\u5740\u5230\u4f4e\u5730\u5740 %rsp--\x3e\u6808\u9876\uff0cpush\u548cpop\u4f1a\u6539\u53d8 %rbp--\x3e\u6808\u57fa\u5740"}),"\n",(0,l.jsx)(t.li,{children:"%8 ~ %15"}),"\n"]}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u5bc4\u5b58\u5668"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u89e3\u91ca"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"// \u521b\u5efa\u90e8\u5206"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"%rax"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u4e34\u65f6\u5bc4\u5b58\u5668\uff1b\u53c2\u6570\u53ef\u53d8\u65f6\u4f20\u9012\u5173\u4e8e SSE \u5bc4\u5b58\u5668\u7528\u91cf\u7684\u4fe1\u606f\uff1b\u7b2c 1 \u4e2a\u8fd4\u56de\u503c\u5bc4\u5b58\u5668"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"%rdi"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u7528\u6765\u7ed9\u51fd\u6570\u4f20\u9012\u7b2c 1 \u4e2a\u53c2\u6570"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"%rsi"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u7528\u6765\u7ed9\u51fd\u6570\u4f20\u9012\u7b2c 2 \u4e2a\u53c2\u6570"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"%rdx"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u7528\u6765\u7ed9\u51fd\u6570\u4f20\u9012\u7b2c 3 \u4e2a\u6574\u6570\u53c2\u6570"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"%rcx"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u7528\u6765\u7ed9\u51fd\u6570\u4f20\u9012\u7b2c 4\u4e2a\u6574\u6570\u53c2\u6570"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"%rsp"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5806\u6808\u9876\u6307\u9488"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"%rbp"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5806\u6808\u57fa\u6307\u9488"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"%rip"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u6307\u4ee4\u5bc4\u5b58\u5668"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"// \u5207\u6362\u90e8\u5206"}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"%rbx"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u88ab\u8c03\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\uff1b\u6216\u7528\u4f5c\u57fa\u6307\u9488"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"%r12-%r15"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u88ab\u8c03\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668"})]})]})]}),"\n",(0,l.jsx)(t.h2,{id:"\u534f\u7a0b\u6808\u7684\u7ed3\u6784",children:"\u534f\u7a0b\u6808\u7684\u7ed3\u6784"}),"\n",(0,l.jsx)(t.h3,{id:"\u534f\u7a0b\u6808",children:"\u534f\u7a0b\u6808"}),"\n",(0,l.jsx)(t.p,{children:"\u9996\u5148\u770b\u4e0b\u534f\u7a0b\u6808\u7684\u7ed3\u6784\uff1acontext\u6307\u5411\u534f\u7a0b\u6808\u9876\uff0cstacktype\u8868\u793a\u6808\u7684\u7c7b\u578b(\u5927\u5c0f)\uff0cstorage\u4e3a\u6808\u7a7a\u95f4\u3002"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-c++",children:"/* kthread/kthread/stack.h */\nstruct ContextualStack {\n    kthread_fcontext_t context;\n    StackType stacktype;\n    StackStorage storage;\n};\n\nenum StackType {\n    STACK_TYPE_MAIN = 0,\n    STACK_TYPE_PTHREAD = BTHREAD_STACKTYPE_PTHREAD,\n    STACK_TYPE_SMALL = BTHREAD_STACKTYPE_SMALL,\n    STACK_TYPE_NORMAL = BTHREAD_STACKTYPE_NORMAL,\n    STACK_TYPE_LARGE = BTHREAD_STACKTYPE_LARGE\n};\n\nstruct StackStorage {\n    int stacksize;\n    int guardsize;\n    // Assume stack grows upwards.\n    // http://www.boost.org/doc/libs/1_55_0/libs/context/doc/html/context/stack.html\n    void* bottom;\n    unsigned valgrind_stack_id;\n\n    // Clears all members.\n    void zeroize() {\n        stacksize = 0;\n        guardsize = 0;\n        bottom = NULL;\n        valgrind_stack_id = 0;\n    }\n};\n"})}),"\n",(0,l.jsx)(t.h3,{id:"\u534f\u7a0b\u7684\u521d\u59cb\u5316",children:"\u534f\u7a0b\u7684\u521d\u59cb\u5316"}),"\n",(0,l.jsx)(t.p,{children:"\u6808\u5206\u914d\u65f6\uff08allocate_stack_storage(StackStorage* s, int stacksize_in, int guardsize_in)\uff09\u4f1a\u901a\u8fc7mmap\u533f\u540d\u6620\u5c04\u4e00\u6bb5\u7a7a\u95f4\uff0c\u7136\u540e\u5c06\u9ad8\u5730\u5740\u4f4d\u8d4b\u503c\u7ed9bottom\u3002"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-c++",children:"/* kthread/kthread/stack_inl.h */\ntemplate <typename StackClass> struct StackFactory {\n    struct Wrapper : public ContextualStack {\n        explicit Wrapper(void (*entry)(intptr_t)) {\n            if (allocate_stack_storage(&storage, *StackClass::stack_size_flag,\n                                       FLAGS_guard_page_size) != 0) {\n                storage.zeroize();\n                context = NULL;\n                return;\n            }\n"})}),"\n",(0,l.jsx)(t.p,{children:"\u7136\u540e\u521b\u5efakthread\u534f\u7a0b\u6808\uff0c\u8fd4\u56de\u503c\u4e3a\u534f\u7a0b\u6808\u9876context\uff0c\u51fd\u6570\u5165\u53c2\u5206\u522b\u4e3a\u534f\u7a0b\u6808\u5e95\uff0c\u6808\u5927\u5c0f\uff0c\u4ee5\u53ca\u8fd9\u4e2akthread\u8981\u6267\u884c\u7684\u51fd\u6570entry\u3002"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-c++",children:"            context = kthread_make_fcontext(storage.bottom, storage.stacksize, entry);\n            stacktype = (StackType)StackClass::stacktype;\n        }\n        ...\n    };\n    ...\n};\n"})}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-c++",children:'#if defined(BTHREAD_CONTEXT_PLATFORM_linux_x86_64) && defined(BTHREAD_CONTEXT_COMPILER_gcc)\n__asm (\n".text\\n"\n".globl kthread_make_fcontext\\n"\n".type kthread_make_fcontext,@function\\n"\n".align 16\\n"\n"kthread_make_fcontext:\\n"\n"    movq  %rdi, %rax\\n"\n"    andq  $-16, %rax\\n"\n"    leaq  -0x48(%rax), %rax\\n"\n"    movq  %rdx, 0x38(%rax)\\n"\n"    stmxcsr  (%rax)\\n"\n"    fnstcw   0x4(%rax)\\n"\n"    leaq  finish(%rip), %rcx\\n"\n"    movq  %rcx, 0x40(%rax)\\n"\n"    ret \\n"\n"finish:\\n"\n"    xorq  %rdi, %rdi\\n"\n"    call  _exit@PLT\\n"\n"    hlt\\n"\n".size kthread_make_fcontext,.-kthread_make_fcontext\\n"\n".section .note.GNU-stack,\\"\\",%progbits\\n"\n);\n\n#endif\n'})}),"\n",(0,l.jsx)(t.h4,{id:"\u4ee3\u7801\u4e2d\u7684\u6c47\u7f16\u6307\u4ee4\u89e3\u91ca",children:"\u4ee3\u7801\u4e2d\u7684\u6c47\u7f16\u6307\u4ee4\u89e3\u91ca"}),"\n",(0,l.jsx)(t.p,{children:"MXCSR\u72b6\u6001\u7ba1\u7406\u6307\u4ee4\uff08State Management Instructions\uff09\uff0cLDMXCSR\u4e0eSTMXCSR\uff0c\u7528\u4e8e\u63a7\u5236MXCSR\u5bc4\u5b58\u5668\u72b6\u6001\u3002"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"LDMXCSR\u6307\u4ee4\u4ece\u5b58\u50a8\u5668\u4e2d\u52a0\u8f7dMXCSR\u5bc4\u5b58\u5668\u72b6\u6001"}),"\n",(0,l.jsx)(t.li,{children:"STMXCSR\u6307\u4ee4\u5c06MXCSR\u5bc4\u5b58\u5668\u72b6\u6001\u4fdd\u5b58\u5230\u5b58\u50a8\u5668\u4e2d"}),"\n"]}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u6c47\u7f16\u6307\u4ee4"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u89e3\u91ca"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"movq  %rdi, %rax"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:'"movq" is a move of a quadword (64-bit value)\uff0ccopy %src %dst\uff0c\u5c06\u7b2c\u4e00\u4e2a\u53c2\u6570\u2018storage.bottom\u2019\u62f7\u8d1d\u5230%rax\u5bc4\u5b58\u5668'})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"andq  $-16, %rax"})}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["\u4e0e&\u64cd\u4f5c\uff0c\u5c06%rax\u7684\u503c\uff0c\u5373\u9ad8\u4f4d\u5730\u5740",(0,l.jsx)(t.code,{children:"bottom"})," & -16\uff08\u8865\u7801:0xfffffff0\uff09\uff0c\u5c06\u5730\u5740\u53d6\u4e3a16\u7684\u6574\u6570\u500d\uff0c\u8fdb\u884c16\u5b57\u8282\u5bf9\u9f50\u3002"]})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"leaq  -0x48(%rax), %rax"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"leaq \u53d664\u4f4d\u5730\u5740\u6307\u4ee4\uff0c\u5c06%rax\u4e2d\u4fdd\u5b58\u7684\u9ad8\u4f4d\u5730\u5740\u5411\u4e0b\u504f\u79fb72\u4e2a\u5b57\u8282\u540e\uff0c\u518d\u4fdd\u5b58\u5230%rax\u5bc4\u5b58\u5668\uff0c\u5373\u7559\u51fa 0x48 \u4e2a\u5b57\u8282\u7528\u4e8e\u5b58\u653e\u4e0a\u4e0b\u6587 Context Data"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"movq  %rdx, 0x38(%rax)"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5c06rdx\u4fdd\u5b58\u81f3rax + 56\uff0crdx\u4e3a\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c\u5373\u51fd\u6570fn\u7684\u5165\u53e3\u5730\u5740entry"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"stmxcsr  (%rax)"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5b58\u50a8 MMX \u63a7\u5236\u5b57\u548c\u72b6\u6001\u5b57\uff0c\u5c06MXCSR\u5bc4\u5b58\u5668\u72b6\u6001\u4fdd\u5b58\u5230rax\u6240\u5728\u4f4d\u7f6e"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"fnstcw   0x4(%rax)"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5b58\u50a8 x87 \u63a7\u5236\u5b57\uff0c\u5c06 FPU \u63a7\u5236\u5b57\u7684\u5f53\u524d\u503c\u5b58\u50a8\u5230%rax + 4"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"leaq  finish(%rip), %rcx"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u8ba1\u7b97finish\u6807\u5fd7\u7684\u7edd\u5bf9\u5730\u5740\uff0c\u5c06\u5176\u4fdd\u5b58\u81f3%rcx\u5bc4\u5b58\u5668\u4e2d"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"movq  %rcx, 0x40(%rax)"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5c06rcx\u4fdd\u5b58\u5230rax + 64\uff0cfinish\u521a\u597d\u4f4d\u4e8e\u542f\u52a8\u51fd\u6570\u4e0a\u65b9 ---\x3e \u542f\u52a8\u51fd\u6570\u6267\u884c\u5b8c\u4ee5\u540e\u5c31\u4f1a\u6267\u884cfinish\u5904\u7684\u4ee3\u7801\uff0c\u800cfinish\u4f1acall _exit\u7ed3\u675f\u8fdb\u7a0b\u3002"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"ret"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"rax\u5c31\u662f\u4e0a\u8ff0\u7684\u57fa\u70b9\uff08\u6808\u9876\uff09\uff0c\u8fd4\u56de\u7684\u7c7b\u578b\u4e3afcontext_t"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"finish:"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"xorq  %rdi, %rdi"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u9000\u51fa\u7801\u662f0"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"call  _exit@PLT"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"call _exit\u7ed3\u675f\u8fdb\u7a0b"})]})]})]}),"\n",(0,l.jsx)(t.p,{children:"\u521d\u59cb\u5316\u8fc7\u7a0b\u53ef\u7531\u4e0b\u56fe\u76f4\u89c2\u8868\u793a\uff1a"}),"\n","\n",(0,l.jsx)("img",{src:d()}),"\n",(0,l.jsx)(t.h3,{id:"\u534f\u7a0b\u7684\u5207\u6362\u90e8\u5206",children:"\u534f\u7a0b\u7684\u5207\u6362\u90e8\u5206"}),"\n",(0,l.jsx)(t.p,{children:"\u5b9e\u73b0\u534f\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u6709\u5f88\u591a\u79cd\u65b9\u6cd5\uff0c\u672c\u8d28\u8981\u505a\u7684\u90fd\u662f\u4fdd\u5b58\u548c\u6062\u590d\u5bc4\u5b58\u5668\u548c\u6808\u4fe1\u606f\u3002"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-c++",children:"inline void jump_stack(ContextualStack* from, ContextualStack* to) {\n    kthread_jump_fcontext(&from->context, to->context, 0/*not skip remained*/);\n}\n"})}),"\n",(0,l.jsx)(t.p,{children:"\u8c03\u7528\u65f6\u4f1a\u5c06\u5f53\u524d\u7684\u4e0a\u4e0b\u6587\u4fdd\u5b58\u5230ofc\u4e2d\uff0c\u5e76\u5207\u6362\u5230\u76ee\u6807\u4e0a\u4e0b\u6587nfc\u8fdb\u884c\u6267\u884c"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-c++",children:'intptr_t BTHREAD_CONTEXT_CALL_CONVENTION\nkthread_jump_fcontext(kthread_fcontext_t * ofc, kthread_fcontext_t nfc,\n                      intptr_t vp, bool preserve_fpu = false);\n#if defined(BTHREAD_CONTEXT_PLATFORM_linux_x86_64) && defined(BTHREAD_CONTEXT_COMPILER_gcc)\n__asm (\n".text\\n"\n".globl kthread_jump_fcontext\\n"\n".type kthread_jump_fcontext,@function\\n"\n".align 16\\n"\n"kthread_jump_fcontext:\\n"\n"    pushq  %rbp  \\n"\n"    pushq  %rbx  \\n"\n"    pushq  %r15  \\n"\n"    pushq  %r14  \\n"\n"    pushq  %r13  \\n"\n"    pushq  %r12  \\n"\n"    leaq  -0x8(%rsp), %rsp\\n"\n"    cmp  $0, %rcx\\n"\n"    je  1f\\n"\n"    stmxcsr  (%rsp)\\n"\n"    fnstcw   0x4(%rsp)\\n"\n"1:\\n"\n"    movq  %rsp, (%rdi)\\n"\n"    movq  %rsi, %rsp\\n"\n"    cmp  $0, %rcx\\n"\n"    je  2f\\n"\n"    ldmxcsr  (%rsp)\\n"\n"    fldcw  0x4(%rsp)\\n"\n"2:\\n"\n"    leaq  0x8(%rsp), %rsp\\n"\n"    popq  %r12  \\n"\n"    popq  %r13  \\n"\n"    popq  %r14  \\n"\n"    popq  %r15  \\n"\n"    popq  %rbx  \\n"\n"    popq  %rbp  \\n"\n"    popq  %r8\\n"\n"    movq  %rdx, %rax\\n"\n"    movq  %rdx, %rdi\\n"\n"    jmp  *%r8\\n"\n".size kthread_jump_fcontext,.-kthread_jump_fcontext\\n"\n".section .note.GNU-stack,\\"\\",%progbits\\n"\n);\n\n#endif\n'})}),"\n",(0,l.jsx)(t.h4,{id:"\u4ee3\u7801\u4e2d\u7684\u6c47\u7f16\u6307\u4ee4\u89e3\u91ca-1",children:"\u4ee3\u7801\u4e2d\u7684\u6c47\u7f16\u6307\u4ee4\u89e3\u91ca"}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u6c47\u7f16\u6307\u4ee4"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"\u89e3\u91ca"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"pushq  %rbp"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5c06\u5bc4\u5b58\u5668rbp-r12\u4f9d\u6b64push\u5230\u5f53\u524d\u534f\u7a0b\u6808\u4e2d\u4fdd\u5b58"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"pushq  %rbx"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"-"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"pushq  %r15"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"-"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"pushq  %r14"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"-"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"pushq  %r13"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"-"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"pushq  %r12"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"-"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"leaq  -0x8(%rsp), %rsp"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"rsp\u6808\u9876\u4e0b\u79fb8\u5b57\u8282 ---\x3eprepare stack for FPU \u6d6e\u70b9\u8fd0\u7b97\u5bc4\u5b58\u5668"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"cmp  $0, %rcx"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u6bd4\u8f83rcx\u548c0\uff0c\u56e0\u4e3arcx\u4e3a0\uff0c\u6240\u4ee5zf\u4e3a1\uff0crcx\uff1a\u7b2c\u56db\u4e2a\u53c2\u6570 preserve_fpu"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"je  1f"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u56e0\u4e3azf\u4e3a1\uff0c\u6240\u4ee5\u8df3\u8f6c"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"stmxcsr  (%rsp)"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5b58\u50a8 MMX \u63a7\u5236\u5b57\u548c\u72b6\u6001\u5b57\uff0c\u5c06MXCSR\u5bc4\u5b58\u5668\u72b6\u6001\u4fdd\u5b58\u5230rsp\u6240\u5728\u4f4d\u7f6e"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"fnstcw   0x4(%rsp)"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5b58\u50a8 x87 \u63a7\u5236\u5b57\uff0c\u5c06 FPU \u63a7\u5236\u5b57\u7684\u5f53\u524d\u503c\u5b58\u50a8\u5230rsp + 4"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"1f:"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"movq  %rsp, (%rdi)"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5c06rsp\u4fdd\u5b58\u81f3rdi\u4e2d\uff0crsp\u6307\u5411\u5f53\u524d\u534f\u7a0b\u6808\u6808\u9876\uff08\u539f\u4e0a\u4e0b\u6587\uff09\uff0crdi\u4e3a\u7b2c\u4e00\u4e2a\u5165\u53c2\uff0c\u5373ofc"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"movq  %rsi, %rsp"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5c06rsi\u4fdd\u5b58\u5230rsp\u4e2d\uff0crsi\u4e3a\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff0c\u5373nfc\uff08\u76ee\u6807\u4e0a\u4e0b\u6587\uff09\uff0c\u6b64\u65f6\u6808\u9876\u6307\u9488rsp\u6307\u5411\u4e86\u65b0\u7684\u534f\u7a0b\u6808"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"cmp  $0, %rcx"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u6bd4\u8f83rcx\u548c0\uff0c\u56e0\u4e3arcx\u4e3a0\uff0c\u6240\u4ee5zf\u4e3a1"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"je  2f"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u56e0\u4e3azf\u4e3a1\uff0c\u6240\u4ee5\u8df3\u8f6c"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"ldmxcsr  (%rsp)"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"fldcw  0x4(%rsp)"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"2f:"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:'leaq  0x8(%rsp), %rsp\\n"'})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5c06rsp\u4e0a\u79fb8\u5b57\u8282"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"popq  %r12"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5c06\u534f\u7a0b\u6808\u4e2dr12-rbp\u4f9d\u6b21pop\u5230\u5bf9\u5e94\u5bc4\u5b58\u5668"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"popq  %r13"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"-"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"popq  %r14"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"-"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"popq  %r15"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"-"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"popq  %rbx"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"-"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"popq  %rbp"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"-"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"popq  %r8"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"-"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"movq  %rdx, %rax"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5c06rdx\u4fdd\u5b58\u5230rax\uff0crdx\u4e3a\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0crax\u4e3a\u8fd4\u56de\u503c"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"movq  %rdx, %rdi"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u5c06rdx\u4fdd\u5b58\u5230rdi\uff0crdi\u4e3a\u7b2c\u4e00\u4e2a\u5165\u53c2\uff0c\u56e0\u6b64\u5c06\u4f5c\u4e3a\u65b0\u534f\u7a0b\u8fd0\u884c\u7684\u5165\u53c2"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:(0,l.jsx)(t.code,{children:"jmp  *%r8"})}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"\u8df3\u8f6c\u5230r8\u5bf9\u5e94\u7684\u5bc4\u5b58\u5668\u8fd0\u884c"})]})]})]}),"\n",(0,l.jsx)(t.p,{children:"\u5728\u534f\u7a0b\u5207\u6362\u8fc7\u7a0b\u4e2d\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u7b2c\u4e00\u79cd\u4e3a\u65b0\u534f\u7a0b\u662f\u901a\u8fc7kthread_make_fcontext\u51fd\u6570\u521a\u521a\u521b\u5efa\u7684\u6808\uff0c\u53e6\u4e00\u79cd\u662f\u5df2\u7ecf\u8fd0\u884c\u8fc7\u7684\u6808\uff0c\u8fd9\u4e24\u79cd\u8fc7\u7a0b\u5206\u522b\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n","\n",(0,l.jsx)("img",{src:x()}),"\n",(0,l.jsx)(t.p,{children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.a,{href:"https://zhuanlan.zhihu.com/p/148314164",children:"https://zhuanlan.zhihu.com/p/148314164"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.a,{href:"http://jinke.me/2018-09-14-coroutine-context-switch/",children:"http://jinke.me/2018-09-14-coroutine-context-switch/"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.a,{href:"http://cons.mit.edu/fa18/x86-64-architecture-guide.html",children:"http://cons.mit.edu/fa18/x86-64-architecture-guide.html"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.a,{href:"https://blog.csdn.net/thisinnocence/article/details/50936470",children:"https://blog.csdn.net/thisinnocence/article/details/50936470"})}),"\n"]})]})}function f(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(p,{...e})}):p(e)}},28453:(e,t,n)=>{"use strict";n.d(t,{R:()=>d,x:()=>i});var l=n(96540);const s={},r=l.createContext(s);function d(e){const t=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),l.createElement(r.Provider,{value:t},e.children)}}}]);