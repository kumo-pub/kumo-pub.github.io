"use strict";(self.webpackChunkkumo_website=self.webpackChunkkumo_website||[]).push([[14783],{75535:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>l});var s=t(74848),i=t(28453);const c={},r="\u6269\u5c55",o={id:"cpp/base/testing/doct/extensions",title:"\u6269\u5c55",description:"Extensions",source:"@site/versioned_docs/version-1.1.1/cpp/base/testing/doct/extensions.mdx",sourceDirName:"cpp/base/testing/doct",slug:"/cpp/base/testing/doct/extensions",permalink:"/docs/cpp/base/testing/doct/extensions",draft:!1,unlisted:!1,tags:[],version:"1.1.1",frontMatter:{},sidebar:"docs",previous:{title:"\u6d4b\u8bd5\u62a5\u544a",permalink:"/docs/cpp/base/testing/doct/reporters"},next:{title:"faq",permalink:"/docs/cpp/base/testing/doct/faq"}},d={},l=[{value:"Extensions",id:"extensions",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:2},{value:"MPI_TEST_CASE",id:"mpi_test_case",level:3},{value:"\u65ad\u8a00",id:"\u65ad\u8a00",level:3},{value:"\u4e3b\u8981\u5165\u53e3\u70b9\u548c mpi \u6d4b\u8bd5\u62a5\u544a",id:"\u4e3b\u8981\u5165\u53e3\u70b9\u548c-mpi-\u6d4b\u8bd5\u62a5\u544a",level:2},{value:"MpiConsoleReporter",id:"mpiconsolereporter",level:3},{value:"MpiFileReporter",id:"mpifilereporter",level:3},{value:"\u5176\u4ed6\u8bb0\u8005",id:"\u5176\u4ed6\u8bb0\u8005",level:3},{value:"\u8bf4\u660e",id:"\u8bf4\u660e",level:2},{value:"TODO",id:"todo",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u6269\u5c55",children:"\u6269\u5c55"})}),"\n",(0,s.jsx)(n.h2,{id:"extensions",children:"Extensions"}),"\n",(0,s.jsxs)(n.p,{children:["doctest \u6807\u5934\u5728\u5176\u63a5\u53e3\u90e8\u5206\u4e2d\u4e0d\u5305\u542b\u4efb\u4f55\u5916\u90e8\u6216 stdlib \u6807\u5934\uff0c\u4ee5\u63d0\u4f9b\u6700\u4f73\u7684\u6784\u5efa\u65f6\u95f4\uff0c\u4f46\u8fd9\u610f\u5473\u7740\u5b83\u53ef\u4ee5\n\u63d0\u4f9b\u7684\u529f\u80fd\u6709\u9650 ",(0,s.jsx)(n.code,{children:"=>"})," \u8fd9\u5c31\u662f\u6269\u5c55\u53d1\u6325\u4f5c\u7528\u7684\u65f6\u5019\u3002\u5b83\u4eec\u4f5c\u4e3a\u5934\u6587\u4ef6\u4f4d\u4e8e ",(0,s.jsx)(n.a,{href:"https://gitee.com/kumo-hub/doctest/tree/master/doctest/extensions",children:(0,s.jsx)(n.code,{children:"doctest/extensions"})})," \u4e2d\uff0c\u5e76\u4e14\u6bcf\u4e2a\u6587\u4ef6\n\u90fd\u8bb0\u5f55\u5728\u6b64\u5904\u7684\u4e00\u4e2a\u90e8\u5206\u4e2d\u3002"]}),"\n",(0,s.jsx)(n.h1,{id:"utils",children:(0,s.jsx)(n.a,{href:"https://gitee.com/kumo-hub/doctest/tree/master/doctest/extensions/doctest_util.h",children:"Utils"})}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u91cc\u8fd8\u4ec0\u4e48\u90fd\u6ca1\u6709..."}),"\n",(0,s.jsx)(n.h1,{id:"distributed-tests-with-mpi",children:(0,s.jsx)(n.a,{href:"https://gitee.com/kumo-hub/doctest/tree/master/doctest/extensions/doctest_mpi.h",children:"Distributed tests with MPI"})}),"\n",(0,s.jsxs)(n.p,{children:["\u901a\u8fc7\u5206\u5e03\u5f0f\u8fdb\u7a0b\u6d4b\u8bd5\u4ee3\u7801\u9700\u8981\u6d4b\u8bd5\u6846\u67b6\u7684\u652f\u6301\u3002 ",(0,s.jsx)(n.code,{children:"\u201cdoctest/extensions/doctest_mpi.h\u201d"}),"\u6807\u5934\u4e2d\u63d0\u4f9b\u4e86\u5bf9 MPI \u5e76\u884c\u901a\u4fe1\u7684 ",(0,s.jsx)(n.strong,{children:"Doctest"})," \u652f\u6301\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,s.jsxs)(n.p,{children:["\u53c2\u8003 ",(0,s.jsx)(n.a,{href:"https://gitee.com/kumo-hub/doctest/tree/master/examples/mpi/mpi.cpp",children:(0,s.jsx)(n.strong,{children:"the complete test"})})," and ",(0,s.jsx)(n.a,{href:"https://gitee.com/kumo-hub/doctest/tree/master/examples/mpi/main.cpp",children:(0,s.jsx)(n.strong,{children:"the configuration of main()"})})]}),"\n",(0,s.jsx)(n.h3,{id:"mpi_test_case",children:"MPI_TEST_CASE"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c++",children:'#include "doctest/extensions/doctest_mpi.h"\n\nint my_function_to_test(MPI_Comm comm) {\n  int rank;\n  MPI_Comm_rank(comm,&rank);\n  if (rank == 0) {\n    return 10;\n  }\n  return 11;\n}\n\n\nMPI_TEST_CASE("test over two processes",2) { // Parallel test on 2 processes\n  int x = my_function_to_test(test_comm);\n\n  MPI_CHECK( 0,  x==10 ); // CHECK for rank 0, that x==10\n  MPI_CHECK( 1,  x==11 ); // CHECK for rank 1, that x==11\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"MPI_TEST_CASE"}),"\u7c7b\u4f3c\u4e8e\u5e38\u89c4\u7684",(0,s.jsx)(n.code,{children:"TEST_CASE"}),"\uff0c\u53ea\u4e0d\u8fc7\u5b83\u9700\u8981\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff0c\u5373\u8fd0\u884c\u6d4b\u8bd5\u6240\u9700\u7684\u8fdb\u7a0b\u6570\u3002  \u5982\u679c\u8fdb\u7a0b\u6570\u5c0f\u4e8e2\uff0c\u5219\u6d4b\u8bd5\u5931\u8d25\u3002\u5982\u679c\u8fdb\u7a0b\u6570\u5927\u4e8e\u6216\u7b49\u4e8e2\uff0c\u5b83\u5c06\u57282\u4e2a\u8fdb\n\u7a0b\u4e0a\u521b\u5efa\u4e00\u4e2a\u5b50\u901a\u4fe1\u5668\uff0c\u79f0\u4e3a",(0,s.jsx)(n.code,{children:"test_comm"}),"\uff0c\u5e76\u5bf9\u8fd9\u4e9b\u8fdb\u7a0b\u6267\u884c\u6d4b\u8bd5\u3002 ",(0,s.jsx)(n.code,{children:"MPI_TEST_CASE"}),"\u63d0\u4f9b\u4e86\u4e09\u4e2a\u5bf9\u8c61\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"test_comm"}),"\uff0c\u7c7b\u578b\u4e3a",(0,s.jsx)(n.code,{children:"MPI_Comm"}),"\uff1a\u8fd0\u884c\u6d4b\u8bd5\u7684 mpi \u901a\u4fe1\u5668\uff0c"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"test_rank"})," \u548c ",(0,s.jsx)(n.code,{children:"test_nb_procs"}),"\uff0c\u4e24\u4e2a ",(0,s.jsx)(n.code,{children:"int"})," \u5206\u522b\u7ed9\u51fa\u5f53\u524d\u8fdb\u7a0b\u7684\u7b49\u7ea7\u548c ",(0,s.jsx)(n.code,{children:"test_comm"})," \u901a\u4fe1\u5668\u7684\u5927\u5c0f\u3002\u6700\u540e\u4e24\u4e2a\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0c\u53ef\u4ee5\u4ece\u201ctest_comm\u201d\u4e2d\u68c0\u7d22\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u603b\u662f\u6709\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c++",children:'MPI_TEST_CASE("my_test",N) {\n  CHECK( test_nb_procs == N );\n  MPI_CHECK( i, test_rank==i ); // for any i<N\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u65ad\u8a00",children:"\u65ad\u8a00"}),"\n",(0,s.jsxs)(n.p,{children:["\u53ef\u4ee5\u5728",(0,s.jsx)(n.code,{children:"MPI_TEST_CASE"}),"\u4e2d\u4f7f\u7528\u5e38\u89c4\u65ad\u8a00\u3002\u8fd8\u63d0\u4f9b\u4e86\u7279\u5b9a\u4e8e MPI \u7684\u65ad\u8a00\uff0c\u5e76\u4e14\u5168\u90e8\u4ee5",(0,s.jsx)(n.code,{children:"MPI_"})," \u4e3a\u524d\u7f00\uff08",(0,s.jsx)(n.code,{children:"MPI_CHECK"}),"\u3001",(0,s.jsx)(n.code,{children:"MPI_ASSERT"}),"...\uff09\u3002\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u68c0\u67e5\u5b83\u4eec\u7684\u6392\u540d\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u8981\u68c0\u67e5\u7684\u5e38\u7528\u8868\u8fbe\u5f0f\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"\u4e3b\u8981\u5165\u53e3\u70b9\u548c-mpi-\u6d4b\u8bd5\u62a5\u544a",children:"\u4e3b\u8981\u5165\u53e3\u70b9\u548c mpi \u6d4b\u8bd5\u62a5\u544a"}),"\n",(0,s.jsx)(n.p,{children:"\u60a8\u9700\u8981\u4f7f\u7528\u201cmpirun\u201d\u6216\u201cmpiexec\u201d\u547d\u4ee4\u542f\u52a8\u5355\u5143\u6d4b\u8bd5\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"mpirun -np 2 unit_test_executable.exe\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5fc5\u987b\u5728\u8fd0\u884c\u5355\u5143\u6d4b\u8bd5\u4e4b\u524d\u8c03\u7528",(0,s.jsx)(n.code,{children:"doctest::mpi_init_thread()"}),"\uff0c\u5e76\u5728\u7a0b\u5e8f\n\u672b\u5c3e\u8c03\u7528",(0,s.jsx)(n.code,{children:"doctest::mpi_finalize()"}),"\u3002\u6b64\u5916\uff0c\u4f7f\u7528\u9ed8\u8ba4\u7684\u63a7\u5236\u53f0\u62a5\u544a\u5668\u5c06\u5bfc\u81f4\u6bcf\u4e2a\u8fdb\u7a0b\u5c06\u6240\u6709\u5185\u5bb9\u5199\u5165\u540c\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u8fd9\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u3002\u63d0\u4f9b\u5e76\u53ef\u4ee5\u542f\u7528\u4e24\u4e2a\u62a5\u544a\u5668\u3002\u4e00\u4e2a\u5b8c\u6574\u7684 ",(0,s.jsx)(n.code,{children:"main()"})," \u5e94\u8be5\u662f\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c++",children:'#define DOCTEST_CONFIG_IMPLEMENT\n\n#include "doctest/extensions/doctest_mpi.h"\n\nint main(int argc, char** argv) {\n  doctest::mpi_init_thread(argc,argv,MPI_THREAD_MULTIPLE); // Or any MPI thread level\n\n  doctest::Context ctx;\n  ctx.setOption("reporters", "MpiConsoleReporter");\n  ctx.setOption("reporters", "MpiFileReporter");\n  ctx.setOption("force-colors", true);\n  ctx.applyCommandLine(argc, argv);\n\n  int test_result = ctx.run();\n\n  doctest::mpi_finalize();\n\n  return test_result;\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"mpiconsolereporter",children:"MpiConsoleReporter"}),"\n",(0,s.jsx)(n.p,{children:"\u5e94\u5c06\u201cMpiConsoleReporter\u201d\u66ff\u6362\u4e3a\u9ed8\u8ba4\u62a5\u544a\u5668\u3002\u5b83\u4e0e\u5e38\u89c4\u65ad\u8a00\u7684\u9ed8\u8ba4\u63a7\u5236\u53f0\u62a5\u544a\u7a0b\u5e8f\u76f8\u540c\uff0c\u4f46\u4ec5\u5728\u8fdb\u7a0b 0 \u4e0a\u8f93\u51fa\u3002\u5bf9\u4e8e MPI \u6d4b\u8bd5\u7528\u4f8b\uff0c\u5982\u679c\u51fa\u73b0\u6545\u969c\uff0c\u5b83\u4f1a\u544a\u8bc9\u5931\u8d25\u7684\u8fdb\u7a0b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'[doctest] doctest version is "2.4.0"\n[doctest] run with "--help" for options\n===============================================================================\n[doctest] test cases:    171 |    171 passed |      0 failed |      0 skipped\n[doctest] assertions:    864 |    864 passed |      0 failed |\n[doctest] Status: SUCCESS!\nstd_e_mpi_unit_tests\n[doctest] doctest version is "2.4.0"\n[doctest] run with "--help" for options\n===============================================================================\npath/to/test.cpp:30:\nTEST CASE: my test case\n\nOn rank [2] : path/to/test.cpp:35: CHECK( x==-1 ) is NOT correct!\n  values: CHECK( 0 == -1 )\n\n===============================================================================\n[doctest] test cases:      2 |      2 passed |      0 failed |      0 skipped\n[doctest] assertions:      2 |      2 passed |      0 failed |\n[doctest] Status: SUCCESS!\n===============================================================================\n[doctest] assertions on all processes:   5 |   4 passed |      1 failed |\n===============================================================================\n[doctest] fail on rank:\n    -> On rank [2] with 1 test failed\n[doctest] Status: FAILURE!\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u542f\u52a8\u6d4b\u8bd5\u53ef\u6267\u884c\u6587\u4ef6\u65f6\u4f7f\u7528\u7684\u8fdb\u7a0b\u5c11\u4e8e\u4e00\u9879\u6d4b\u8bd5\u6240\u9700\u7684\u8fdb\u7a0b\u6570\uff0c\u5219\u5c06\u8df3\u8fc7\u8be5\u6d4b\u8bd5\u5e76\u5728 mpi \u63a7\u5236\u53f0\u62a5\u544a\u5668\u4e2d\u5c06\u5176\u6807\u8bb0\u4e3a\u8fd9\u6837\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c++",children:'MPI_TEST_CASE("my_test",3) {\n  // ...\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"mpirun -np 2 unit_test_executable.exe\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"===============================================================================\n[doctest] test cases:      1 |      1 passed |      0 failed |      1 skipped\n[doctest] assertions:      1 |      1 passed |      0 failed |\n[doctest] Status: SUCCESS!\n===============================================================================\n[doctest] assertions on all processes:   1 |   1 passed |      0 failed |\n[doctest] WARNING: Skipped 1 test requiring more than 2 MPI processes to run\n===============================================================================\n"})}),"\n",(0,s.jsx)(n.h3,{id:"mpifilereporter",children:"MpiFileReporter"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"MpiFileReporter"}),"\u53ea\u4f1a\u5728\u5176\u81ea\u5df1\u7684\u6587\u4ef6\u4e2d\u6253\u5370\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u7ed3\u679c\uff0c\u540d\u4e3a",(0,s.jsx)(n.code,{children:"doctest_[rank].log"}),"\u3002\u4ec5\u5f53\u60a8\u60f3\u4e86\u89e3\u5e76\u884c\u6d4b\u8bd5\u7528\u4f8b\u5931\u8d25\u65f6\u5230\u5e95\u53d1\u751f\u4e86\u4ec0\u4e48\u65f6\uff0c\u624d\u4f7f\u7528\u6b64\u62a5\u544a\u5668\u4f5c\u4e3a\u8c03\u8bd5\u5de5\u5177\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5176\u4ed6\u8bb0\u8005",children:"\u5176\u4ed6\u8bb0\u8005"}),"\n",(0,s.jsx)(n.p,{children:"\u4e0d\u76f4\u63a5\u652f\u6301\u5176\u4ed6\u62a5\u544a\u5668\uff08jUnit\u3001XML\uff09\uff0c\u8fd9\u610f\u5473\u7740\u60a8\u59cb\u7ec8\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u7ed3\u679c\u6253\u5370\u5230\u5176\u81ea\u5df1\u7684\u6587\u4ef6\u4e2d\uff0c\u4f46\uff08\u5f53\u524d\uff09\u6ca1\u6709\u7b49\u6548\u7684\u201cMpiConsoleReporter\u201d\u6765\u805a\u5408\u6240\u6709\u8fc7\u7a0b\u7684\u7ed3\u679c\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u8bf4\u660e",children:"\u8bf4\u660e"}),"\n",(0,s.jsxs)(n.p,{children:["\u6b64\u529f\u80fd\u662f\u4e3a\u4e86\u5bf9 mpi \u5206\u5e03\u5f0f\u4ee3\u7801\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\u800c\u63d0\u4f9b\u7684\u3002\u5b83",(0,s.jsx)(n.strong,{children:"\u4e0d\u662f"}),"\u5728\u591a\u4e2a\u8fdb\u7a0b\u4e0a\u5e76\u884c\u5316\u8bb8\u591a\u5355\u5143\u6d4b\u8bd5\u7684\u65b9\u6cd5\uff08\u4e3a\u6b64\uff0c\u8bf7\u53c2\u9605",(0,s.jsx)(n.a,{href:"https://gitee.com/kumo-hub/doctest/tree/master/examples/range_based_execution.py",children:(0,s.jsx)(n.strong,{children:"\u793a\u4f8b python \u811a\u672c"})}),")\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"todo",children:"TODO"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5c06",(0,s.jsx)(n.code,{children:"ConsoleReporter"}),"\u7684",(0,s.jsx)(n.code,{children:"s"}),"\u6210\u5458\u53d8\u91cf\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9\u6210\u5458\u51fd\u6570\uff0c\u4ee5\u4fbf\u6211\u4eec\u53ef\u4ee5\u5c06\u5b83\u4eec\u4e0e\u53e6\u4e00\u4e2a\u5bf9\u8c61\u4e00\u8d77\u4f7f\u7528\uff08\u5c06\u6709\u52a9\u4e8e\u5206\u89e3",(0,s.jsx)(n.code,{children:"MPIConsoleReporter"}),"\uff09"]}),"\n",(0,s.jsx)(n.li,{children:"\u4ec5\u6d4b\u8bd5 MPI_CHECK\u3002 MPI_REQUIRE\uff0c\u5f02\u5e38\u5904\u7406\uff1a\u672a\u8fdb\u884c\u4efb\u4f55\u6d4b\u8bd5"}),"\n",(0,s.jsx)(n.li,{children:"\u66f4\u591a\u6d4b\u8bd5\uff0c\u81ea\u52a8\u6d4b\u8bd5"}),"\n",(0,s.jsxs)(n.li,{children:["\u6253\u5305\uff1a\u521b\u5efa\u4e00\u4e2a\u65b0\u76ee\u6807",(0,s.jsx)(n.code,{children:"mpi_doctest"}),"\uff1f \uff08\u5bf9\u4e8e ",(0,s.jsx)(n.code,{children:"mpi/doctest.h"})," \u660e\u786e\u4f9d\u8d56 MPI \u53ef\u80fd\u66f4\u5e72\u51c0\uff09"]}),"\n",(0,s.jsx)(n.li,{children:"\u7a0d\u540e\uff0c\u4e5f\u8bb8\uff1a\u6709\u4e00\u4e2a\u901a\u7528\u7684\u673a\u5236\u6765\u8868\u793a\u65ad\u8a00\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u62a5\u544a\u683c\u5f0f\uff08\u63a7\u5236\u53f0\u3001xml\u3001junit...\uff09\u4e0e\u62a5\u544a\u7b56\u7565\uff08\u987a\u5e8f\u4e0e MPI\uff09\u5206\u5f00"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var s=t(96540);const i={},c=s.createContext(i);function r(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);